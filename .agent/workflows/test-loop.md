# 🎯 Lint 错误修复循环 (Lint Fix Loop)

// turbo-all

此工作流定义了系统性消除 Lint 错误和警告的流程。Agent 必须严格遵循此流程，直到所有可修复的问题都解决。

---

## Phase 1: 诊断阶段 (Diagnosis)

**目标**: 收集并分析所有 Lint 错误和警告。

### 1.1 执行完整检查
```bash
pnpm lint 2>&1 | tee lint-output.txt
```

### 1.2 分析结果
- 统计 **Error** 数量
- 统计 **Warning** 数量
- 判断规模:
  - 🟢 **少量 (≤10)**: 直接进入 Phase 3 逐个解决
  - 🟡 **中量 (11-50)**: 按模块分组处理
  - 🔴 **大量 (>50)**: 按模块 + 类型双重分组

---

## Phase 2: 分组策略 (Grouping Strategy)

**原则**: 优先按模块分组，再按类型细分。

### 2.1 模块分组优先级
按以下顺序组织工作：
1. `src/shared/` - 共享模块（影响范围最大，优先处理）
2. `src/features/` - 业务功能模块
3. `src/app/` - 页面和路由
4. `src/services/` - 服务层
5. `scripts/` - 脚本
6. `tests/` - 测试文件

### 2.2 类型分组
在每个模块内，按错误类型排列：
1. `unused-vars` - 未使用变量（低风险，快速修复）
2. `no-explicit-any` - any 类型（需谨慎处理）
3. `no-console` - console 语句（移除或替换为 logger）
4. `react-hooks/*` - Hooks 规则（需理解逻辑）
5. 其他更复杂的错误

### 2.3 棘手问题识别
以下情况标记为"棘手"，暂不处理：
- ⚠️ 修改可能导致运行时行为变化
- ⚠️ 涉及复杂类型推断或泛型
- ⚠️ 需要重构才能解决的问题
- ⚠️ 禁用规则需要团队讨论

---

## Phase 3: 迭代修复 (Iterative Fix)

**原则**: 修改一个，测试一个；修改一组，测试一组。

### 3.1 单个/单组修复流程
```
┌─────────────────────────────────────────────┐
│  1. 选择目标错误/分组                        │
│  2. 分析错误原因                             │
│  3. 实施修复                                 │
│  4. 验证修复 (pnpm lint [file])             │
│  5. ✅ 通过 → 提交并进入下一个               │
│     ❌ 失败 → 继续修复或标记为棘手           │
└─────────────────────────────────────────────┘
```

### 3.2 验证命令
```bash
# 验证单个文件
pnpm eslint [file-path] --fix

# 验证全局（每完成一个模块后执行）
pnpm lint
```

### 3.3 循环规则
- **必须**: 每次修复后立即验证
- **禁止**: 批量修改多个模块后才验证
- **强制**: 如果验证失败，必须回滚并重新分析

---

## Phase 4: 棘手问题报告 (Risk Report)

**目标**: 将无法安全修复的问题记录到报告中。

### 4.1 报告路径
```
docs/lint错误.md
```

### 4.2 报告格式
```markdown
# Lint 棘手问题报告

> 最后更新: [日期]

## 概览
- 总棘手问题: X 个
- 高风险: X 个
- 需讨论: X 个

## 问题清单

### 1. [文件路径]
- **错误类型**: [规则名称]
- **风险等级**: 高/中/低
- **原因**: [为什么不能直接修复]
- **建议**: [推荐的解决方案]

### 2. ...
```

---

## Phase 5: 完成条件 (Definition of Done)

### ✅ 成功标准
- [ ] `pnpm lint` 无 Error（0 errors）
- [ ] `pnpm lint` 警告数量已最小化
- [ ] 棘手问题已记录到 `docs/lint错误.md`
- [ ] 每个模块修复后都经过验证

### ❌ 失败条件 → 强制继续
只要满足以下任一条件，必须继续循环：
- 存在未处理的 Error（棘手问题除外）
- 存在可修复但未修复的 Warning

---

## 快速参考 (Quick Reference)

| 阶段 | 命令 | 目的 |
|------|------|------|
| 诊断 | `pnpm lint` | 获取全部错误 |
| 修复 | `pnpm eslint [path] --fix` | 自动修复 |
| 验证 | `pnpm lint [path]` | 确认修复成功 |
| 类型 | `pnpm type-check` | 确保类型安全 |

---

> **Rule**: 修改一个，测试一个。绝不积累未验证的修改。