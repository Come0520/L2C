---
description: 逐个完成 todolist.md 中的待办任务，测试通过后迁移至（已完成）.md
---

# TodoList Killer 工作流

此工作流指导 Agent 逐个完成 `docs/todolist.md` 中的待办事项，每完成一项都进行测试验证，通过后将该任务迁移至 `docs/（已完成）.md`。

## 核心原则

1. **逐个击破**：一次只专注一个任务，完成后才进入下一个
2. **测试驱动**：每个任务完成后必须通过测试验证
3. **即时归档**：测试通过后立即将任务迁移到（已完成）.md
4. **状态同步**：保持 `todolist.md` 和 `（已完成）.md` 的一致性

---

## 步骤详解

### 1. 读取任务列表
// turbo
读取 `docs/todolist.md` 文件，识别所有未完成的任务（标记为 `[ ]` 的任务）。

**输出**：
- 按优先级排序的未完成任务列表（P0 > P1 > P2 > P3 > P4）
- 选择最高优先级的第一个未完成任务

---

### 2. 分析任务需求

分析选定任务的具体需求：
- 阅读任务描述和子项
- 识别涉及的文件和模块
- 确定验收标准
- 预估工时

**输出**：
- 任务范围定义
- 实现计划

---

### 3. 实现任务

执行任务实现：
- 创建或修改相关文件
- 实现功能代码
- 添加必要的注释和文档

**注意**：
- 遵循项目编码规范
- 保持代码风格一致
- 添加中文注释

---

### 4. 运行测试验证
// turbo-all

根据任务类型运行相应的测试：

#### 4.1 如果任务涉及 E2E 测试
```powershell
pnpm test:e2e e2e/flows/<相关测试文件>.spec.ts --project=chromium
```

#### 4.2 如果任务涉及单元测试
```powershell
pnpm test <相关测试文件>
```

#### 4.3 如果任务涉及类型检查
```powershell
pnpm type-check
```

#### 4.4 如果任务涉及 UI 组件
```powershell
pnpm dev
# 使用浏览器工具验证 UI
```

**测试结果判定**：
- ✅ **PASS**：所有测试通过 → 进入步骤 5
- ❌ **FAIL**：测试失败 → 分析错误，修复后重新测试

---

### 5. 更新任务状态

在 `docs/todolist.md` 中将完成的任务标记为 `[x]`：
- 找到对应的任务项
- 将 `[ ]` 改为 `[x]`
- 保存文件

---

### 6. 迁移到（已完成）.md

将已完成的任务内容追加到 `docs/（已完成）.md`：

**迁移内容格式**：
```markdown
## [模块名] - [任务编号] [任务名称]

**完成日期**：YYYY-MM-DD
**验证方式**：[E2E 测试 / 单元测试 / 手动验证]

### 已完成项
- [x] 任务描述 1
- [x] 任务描述 2
- ...

---
```

**注意**：
- 保持（已完成）.md 的格式一致
- 添加完成日期和验证方式
- 如果整个模块的所有任务都完成，可以将整个模块块迁移

---

### 7. 循环或完成

- 🔄 **还有未完成任务**：返回步骤 1，处理下一个任务
- ✅ **所有任务完成**：输出完成报告，通知用户

---

## 智能决策树

### 🌳 Branch A: 任务无法理解
- **特征**：任务描述模糊，无法确定实现方式
- **行动**：
  1. 查阅相关需求文档 (`docs/02-requirements/`)
  2. 查看相似任务的已完成实现
  3. 如仍不清楚，使用 `notify_user` 询问用户

### 🌳 Branch B: 测试失败
- **特征**：E2E 或单元测试未通过
- **行动**：
  1. 分析测试错误日志
  2. 定位问题代码
  3. 修复并重新运行测试
  4. 如反复失败，查看是否是测试本身的问题

### 🌳 Branch C: 依赖其他任务
- **特征**：当前任务依赖尚未完成的其他任务
- **行动**：
  1. 标记当前任务为"跳过"
  2. 先完成依赖的任务
  3. 返回处理当前任务

### 🌳 Branch D: 任务范围过大
- **特征**：单个任务包含多个独立子任务
- **行动**：
  1. 将任务拆分为更小的子任务
  2. 逐个完成子任务
  3. 所有子任务完成后再整体迁移

---

## 完成报告模板

任务全部完成后，生成如下报告：

```markdown
# TodoList Killer 完成报告

**执行时间**：YYYY-MM-DD HH:MM ~ HH:MM
**完成任务数**：X 项

## 已完成任务

| 优先级 | 任务编号 | 任务名称 | 验证方式 |
|--------|----------|----------|----------|
| P0 | [Approval-01] | 完善审批引擎核心逻辑 | E2E |
| ... | ... | ... | ... |

## 测试结果摘要

- 通过测试：XX 项
- 跳过任务：XX 项（原因：依赖/范围）

## 下一步建议

- [建议 1]
- [建议 2]
```

---

## 注意事项

1. **保持专注**：一次只处理一个任务，避免多任务并行
2. **及时保存**：每完成一个步骤都保存相关文件
3. **记录进度**：使用 `task.md` 跟踪当前进度
4. **遇到问题及时反馈**：如果陷入困境，使用 `notify_user` 寻求帮助
5. **测试优先**：如果没有现成的测试，先编写测试再实现功能

---

*工作流版本：v1.0*
*创建时间：2026-01-19*
