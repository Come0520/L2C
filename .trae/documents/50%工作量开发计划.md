# 50%工作量开发计划

## 1. 工程一致性修复

### 1.1 目录结构统一
- 将 `backend` 目录重命名为 `slideboard-backend`
- 更新所有引用路径

### 1.2 根脚本修复
- **文件**: `package.json`
  - 将所有 `backend` 路径改为 `slideboard-backend`
  - 修复 `install:all`, `build:all`, `test:all`, `lint:all`, `clean`, `setup` 脚本

- **文件**: `scripts/dev-start.sh`
  - 将所有 `backend` 路径改为 `slideboard-backend`
  - 修复环境变量检查和数据库初始化脚本

### 1.3 CI配置修复
- **文件**: `.github/workflows/ci-cd.yml`
  - 更新后端路径引用
  - 确保CI流程使用正确的目录结构

## 2. 后端最小集可运行

### 2.1 工程配置
- **文件**: `slideboard-backend/package.json`
  - 配置NestJS、TypeORM等依赖
  - 添加开发脚本

- **文件**: `slideboard-backend/tsconfig.json`
  - 配置TypeScript编译选项

- **文件**: `slideboard-backend/nest-cli.json`
  - 配置NestJS CLI选项

### 2.2 数据库配置
- 移除或补齐 `users` 依赖
- 确保所有表字段使用 `snake_case` 格式
- 启用TypeORM迁移

### 2.3 基础模块
- 确保现有模块（orders, installation-orders, reconciliation-orders）可正常工作
- 修复模块间依赖关系

## 3. 订单接口闭环

### 3.1 实现订单接口
- **文件**: `slideboard-backend/src/orders/orders.controller.ts`
  - 实现 `GET /orders` - 获取订单列表
  - 实现 `POST /orders/:id/urge` - 催单功能

- **文件**: `slideboard-backend/src/reconciliation-orders/reconciliation-orders.controller.ts`
  - 实现 `GET /reconciliation-orders` - 获取对账订单列表

### 3.2 数据结构对齐
- 确保API返回数据结构与前端页面契合
- 修复现有接口的数据格式问题

## 4. 前端API路由补齐

### 4.1 新增API路由
- **文件**: `slideboard-frontend/src/app/api/orders/route.ts`
  - 实现 `GET /api/orders` - 代理或直连后端订单列表

- **文件**: `slideboard-frontend/src/app/api/orders/[id]/urge/route.ts`
  - 实现 `POST /api/orders/:id/urge` - 代理或直连后端催单功能

### 4.2 页面联通
- **文件**: `slideboard-frontend/src/app/orders/status/[status]/page.tsx`
  - 通过 `/api/orders` 加载数据
  - 实现催单功能
  - 完善错误态与空态展示

## 5. Supabase类型与RPC

### 5.1 生成Supabase类型
- 为前端生成 `supabase.ts` 类型文件
- 确保类型与数据库表结构一致

### 5.2 对齐RPC函数
- 检查现有 `create_order`/`update_order` RPC函数
- 根据需要创建SQL函数或改为REST接口

## 6. 质量门槛恢复

### 6.1 ESLint检查
- 恢复构建期ESLint检查
- 确保代码符合团队规范

### 6.2 修复pre-commit脚本
- **文件**: `slideboard-frontend/.husky/pre-commit`
  - 确保pre-commit脚本正常工作
  - 添加lint和测试检查

### 6.3 基础单元测试
- 为订单相关API添加基础单元测试
- 配置测试覆盖率报告

## 7. 验收标准

### 7.1 启动验证
- 本地 `npm run dev` 可同时启动前后端
- 后端监听 `3001`
- 前端访问 `3000`

### 7.2 功能验证
- 订单状态页可加载数据
- 可对指定订单执行“催单”操作成功

### 7.3 质量验证
- `lint` 与 `typecheck` 无错误
- 基础测试用例通过并生成覆盖率报告

### 7.4 CI验证
- 主流水线（代码质量/单元测试/安全扫描）运行成功

## 8. 风险与缓解

### 8.1 路径与脚本不一致
- 统一使用 `slideboard-*` 目录
- 批量替换所有引用路径

### 8.2 RPC缺失
- 优先改为REST接口
- 如需RPC，安排SQL函数创建并写入迁移

### 8.3 实体依赖缺失
- 临时移除 `users` 依赖或补充简化实体
- 后续在剩余50%中完善

### 8.4 命名不一致
- 强制 `snake_case`（表/字段）
- 强制 `camelCase`（变量/函数）
- 建立lint规则校验

## 9. 交付物

### 9.1 代码
- 修复的根脚本与CI配置
- 后端工程文件
- 最小订单接口实现
- Next API路由
- `supabase.ts` 类型文件

### 9.2 文档
- 变更说明（目录/脚本/接口）
- 迁移说明
- 验收清单

## 10. 时间安排

- **Day1**: 工程一致性修复
- **Day2**: 后端最小集实现
- **Day3**: 前端API路由与页面联通
- **Day4**: Supabase类型与RPC对齐，基础测试
- **Day5**: CI修复与质量验收

## 11. 角色与分工

- **FE**: Next API路由、页面联通与交互完善
- **BE**: Nest工程化与最小接口、迁移与数据库一致性
- **Infra**: CI修复、安全扫描对接、质量门槛落地

## 12. 状态汇报节奏

- 每日站会：进度、阻塞、风险
- 里程碑评审：Day2、Day3、Day5 对照验收清单进行评审与归档