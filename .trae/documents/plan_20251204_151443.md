# 测试覆盖提升计划（第二阶段）

## 1. 优先测试组件

### 1.1 线索管理核心组件

**LeadTable 组件测试**
- **测试文件**：`src/features/leads/components/list/__tests__/lead-table.test.tsx`
- **测试重点**：
  - 表格渲染和数据展示
  - 排序和分页功能
  - 行操作和批量操作
  - 响应式设计
  - 空状态处理

**LeadActionButtons 组件测试**
- **测试文件**：`src/features/leads/components/__tests__/lead-action-buttons.test.tsx`
- **测试重点**：
  - 基于不同状态渲染不同按钮
  - 权限控制逻辑
  - 按钮点击事件处理
  - 状态流转验证

### 1.2 订单管理核心组件

**OrderStatusFlow 组件测试**
- **测试文件**：`src/features/orders/__tests__/order-status-flow.test.tsx`
- **测试重点**：
  - 订单状态流转逻辑
  - 不同状态下的可执行操作
  - 状态变更事件处理

**SalesOrderTable 组件测试**
- **测试文件**：`src/features/orders/components/sales-orders/__tests__/sales-order-table.test.tsx`
- **测试重点**：
  - 订单列表渲染
  - 订单筛选和搜索
  - 订单操作功能

### 1.3 测量管理核心组件

**MeasurementCalendar 组件测试**
- **测试文件**：`src/features/measurements/components/calendar/__tests__/measurement-calendar.test.tsx`
- **测试重点**：
  - 测量任务日历展示
  - 拖拽功能
  - 任务创建和编辑
  - 日期导航

## 2. 服务层测试

### 2.1 线索服务测试

**leads.client.ts 测试**
- **测试文件**：`src/services/__tests__/leads-client.test.ts`
- **测试重点**：
  - 线索 CRUD 操作
  - 线索状态变更
  - 线索分配逻辑
  - 线索搜索和筛选

### 2.2 订单服务测试

**salesOrders.client.ts 测试**
- **测试文件**：`src/services/__tests__/salesOrders.client.test.ts`
- **测试重点**：
  - 订单创建和更新
  - 订单状态流转
  - 订单催办功能
  - 订单对账逻辑

### 2.3 测量服务测试

**measurements.client.ts 测试**
- **测试文件**：`src/services/__tests__/measurements.client.test.ts`
- **测试重点**：
  - 测量任务创建和分配
  - 测量状态更新
  - 测量数据提交
  - 测量报告生成

## 3. 钩子函数测试

### 3.1 useLeads 钩子测试

**useLeads.test.ts 测试**
- **测试文件**：`src/hooks/__tests__/useLeads.test.ts`
- **测试重点**：
  - 实时数据获取
  - 线索筛选和分页
  - 线索状态变更
  - 错误处理

### 3.2 useMeasurements 钩子测试

**useMeasurements.test.ts 测试**
- **测试文件**：`src/hooks/__tests__/useMeasurements.test.ts`
- **测试重点**：
  - 测量任务列表获取
  - 测量状态更新
  - 实时订阅功能

## 4. 工具函数测试

### 4.1 核心工具函数测试

**lib-utils.ts 测试**
- **测试文件**：`src/utils/__tests__/lib-utils.test.ts`
- **测试重点**：
  - debounce 函数
  - cn 函数
  - 其他核心工具函数

**format.ts 测试**
- **测试文件**：`src/utils/__tests__/format.test.ts`
- **测试重点**：
  - 日期格式化
  - 数字格式化
  - 货币格式化

## 5. 测试执行策略

### 5.1 测试优先级

1. **核心业务组件**（线索管理、订单管理、测量管理）
2. **服务层**（API 调用和业务逻辑）
3. **钩子函数**（状态管理和数据获取）
4. **工具函数**（通用功能）
5. **UI 组件**（界面展示）

### 5.2 测试用例设计原则

- **覆盖率优先**：确保每个组件的核心功能都有测试覆盖
- **边界条件**：测试各种边界情况和异常处理
- **真实场景**：模拟真实用户操作流程
- **可维护性**：编写清晰、易维护的测试用例
- **性能考虑**：避免过度测试和冗余测试

### 5.3 测试执行计划

- **每日执行**：开发过程中运行相关组件测试
- **每周执行**：完整测试套件运行
- **CI/CD 集成**：提交代码时运行测试
- **覆盖率监控**：定期检查覆盖率报告，调整测试重点

## 6. 预期成果

### 6.1 覆盖率目标

| 模块 | 目标覆盖率 | 当前覆盖率 | 提升幅度 |
|------|------------|------------|----------|
| 线索管理组件 | 80%+ | 44.15% | 35.85%+ |
| 订单管理组件 | 70%+ | 74.07% | 保持稳定 |
| 测量管理组件 | 60%+ | 0% | 60%+ |
| 服务层 | 50%+ | 27.03% | 22.97%+ |
| 钩子函数 | 40%+ | 11.02% | 28.98%+ |
| 整体项目 | 50%+ | 15-20% | 30-35%+ |

### 6.2 质量提升

- 减少生产环境 bug 数量
- 提高代码可维护性
- 增强重构信心
- 确保业务逻辑正确性
- 提高开发效率

## 7. 实施步骤

1. **第一周**：完成线索管理核心组件测试（LeadTable、LeadActionButtons）
2. **第二周**：完成订单管理核心组件测试
3. **第三周**：完成测量管理核心组件测试
4. **第四周**：补充服务层和钩子函数测试
5. **第五周**：优化测试用例，提高覆盖率
6. **持续维护**：每次添加新功能时同步编写测试

## 8. 测试工具和框架

- **单元测试**：Vitest + React Testing Library
- **API 模拟**：MSW
- **E2E 测试**：Playwright（后续阶段）
- **覆盖率报告**：Vitest Coverage（V8）

通过系统地执行这个测试计划，我们将逐步提高项目的测试覆盖率，确保核心业务逻辑的正确性和可靠性，为项目的长期发展奠定坚实的质量基础。