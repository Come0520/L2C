# Bundle 分析脚本实施计划

## 1. 现状分析
- ✅ `analyze` 脚本已存在于 `package.json`：`"analyze": "ANALYZE=true next build"`
- ✅ `@next/bundle-analyzer` 已安装并配置在 `next.config.js` 中
- ❌ 缺少主包和路由包的大小阈值设置
- ❌ 未在 PR 流程中自动运行分析

## 2. 实施步骤

### 步骤 1：添加 Bundle Size 阈值检查工具
- 安装 `bundlesize` 或类似工具用于设置和检查 bundle 大小阈值
- 配置主包和各路由包的大小阈值

### 步骤 2：创建 Bundle 大小配置文件
- 在项目根目录创建 `.bundlesize.config.json` 或类似配置文件
- 定义主包和关键路由包的大小阈值（例如：主包 < 1MB，路由包 < 500KB）
- 根据项目实际情况调整阈值

### 步骤 3：更新 CI/CD 工作流
- 在 `.github/workflows/ci-cd.yml` 中添加新的 `bundle-analysis` 作业
- 配置该作业在 PR 事件时运行
- 作业步骤：
  1. 检出代码
  2. 安装依赖
  3. 运行 `npm run analyze` 生成 bundle 分析报告
  4. 运行 bundle 大小检查工具验证阈值

### 步骤 4：测试和验证
- 在本地运行 `npm run analyze` 确保分析正常工作
- 验证 bundle 大小检查工具能正确识别阈值违规
- 提交测试 PR 验证 CI 流程正常运行

## 3. 预期结果
- PR 提交时自动运行 bundle 分析
- 当 bundle 大小超过阈值时，CI 流程失败并给出明确提示
- 生成可视化的 bundle 分析报告供开发者查看
- 帮助团队监控和优化 bundle 大小，提升应用性能

## 4. 技术选型
- 使用 `@next/bundle-analyzer` 生成分析报告
- 使用 `bundlesize` 或 `size-limit` 进行阈值检查
- 配置文件采用 JSON 格式，便于维护和调整阈值