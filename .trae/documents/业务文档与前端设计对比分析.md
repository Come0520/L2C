# 业务文档与前端设计对比分析

## 1. 概述

通过对比业务单据生命周期流程图和前端代码实现，发现了一些不一致的地方，包括状态定义、流程顺序、缺少的功能等。

## 2. 主要差异点

### 2.1 报价单版本状态

**业务文档**：已删除`expired`状态，只保留`draft`、`preliminary`、`measuring`、`revised`、`confirmed`、`cancelled`

**前端实现**：`QuoteVersion`状态包含`expired`，与业务文档不一致

### 2.2 订单状态定义

**业务文档**：销售单状态清晰定义为：`draft` → `confirmed` → `purchasing` → `shipping` → `installing` → `confirming` → `reconciliation` → `completed`

**前端实现**：订单状态链接包含28个状态，命名方式与业务文档不一致，如：
- `draft-sign`（开单）
- `pending-survey`（待测量）
- `surveying-pending-assignment`（测量中-待分配）
- `plan-pending-confirmation`（方案待确认）
- `pending-push`（待推单）
- `pending-place-order`（待下单）
- `in-production`（生产/备货中）
- `pending-shipment`（待发货）

### 2.3 流程顺序

**业务文档**：明确规定测量单必须在销售单之前生成
- 线索 → 报价单 → 报价单版本 → 测量单 → 调整报价单 → 客户确认 → 销售单

**前端实现**：订单状态流程中，测量相关状态在开单之后，与业务文档的流程顺序不符

### 2.4 缺少的功能模块

1. **测量单管理**：缺少测量单的明确类型定义和管理页面
2. **安装单管理**：缺少安装单的明确类型定义和管理页面
3. **对账单管理**：缺少对账单相关的类型定义、页面和功能
4. **状态同步机制**：缺少测量单→报价单、安装单→销售单的自动状态同步实现

### 2.5 版本号管理

**业务文档**：报价单版本号采用V1.0、V1.1格式，支持基于历史版本创建新版本

**前端实现**：报价单版本使用数字编号（如1、2、3），没有实现V1.0、V1.1格式

## 3. 建议改进措施

### 3.1 统一状态定义

1. 删除前端`QuoteVersion`类型中的`expired`状态，与业务文档保持一致
2. 重新梳理订单状态，按照业务文档的状态定义进行调整
3. 确保所有状态名称和流转逻辑与业务文档一致

### 3.2 调整流程顺序

1. 确保测量单在销售单之前生成
2. 调整前端订单状态流程，使其符合业务文档的流程顺序
3. 实现测量单→报价单、安装单→销售单的自动状态同步

### 3.3 补充缺失功能

1. 添加测量单类型定义和管理页面
2. 添加安装单类型定义和管理页面
3. 添加对账单相关功能
4. 实现报价单版本号V1.0、V1.1格式的生成和管理

### 3.4 优化状态同步

1. 实现测量单状态变化时自动同步到报价单
2. 实现安装单状态变化时自动同步到销售单
3. 实现对账单状态变化时自动同步到销售单

## 4. 具体修改建议

### 4.1 修改报价单版本状态

**文件**：`src/types/quote.ts`
**修改**：删除`QuoteVersion`状态中的`expired`选项

### 4.2 重新设计订单状态管理

**文件**：`src/app/orders/page.tsx`
**修改**：按照业务文档重新定义订单状态链接

### 4.3 添加测量单和安装单类型定义

**文件**：`src/types/measurement.ts`（新建）
**内容**：定义测量单相关类型

**文件**：`src/types/installation.ts`（新建）
**内容**：定义安装单相关类型

### 4.4 添加对账单类型定义

**文件**：`src/types/reconciliation.ts`（新建）
**内容**：定义对账单相关类型

### 4.5 实现状态同步机制

**文件**：`src/services/measurement.ts`（新建）
**内容**：实现测量单状态变化时同步到报价单的逻辑

**文件**：`src/services/installation.ts`（新建）
**内容**：实现安装单状态变化时同步到销售单的逻辑

## 5. 结论

通过以上分析和建议，可以使前端实现与业务文档保持一致，确保系统按照设计的业务流程正常运行。建议按照业务文档的规范，逐步调整前端实现，确保所有状态定义、流程顺序和功能模块都符合业务需求。