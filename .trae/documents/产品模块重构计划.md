# 产品模块重构计划

## 目标
将产品模块迁移到 Next.js 16 + React 19 + Supabase 最佳实践，包括页面优先使用 Server Components，API 安全使用 Zod 校验，以及优化用户体验。

## 重构步骤

### 1. 创建服务端服务
- **文件**：`src/services/products.server.ts`
- **功能**：实现服务端数据获取逻辑，使用服务端 Supabase 客户端
- **实现**：
  - 复制 `products.client.ts` 中的核心逻辑
  - 改用服务端 Supabase 客户端（参考 `salesOrders.server.ts`）
  - 实现 `getAllProducts`、`getProductById` 等方法

### 2. 重构产品页面
- **文件**：`src/app/products/page.tsx`
- **功能**：将客户端组件改为 Server Component
- **实现**：
  - 移除 `'use client'` 指令
  - 将组件改为 `async function`
  - 使用 `src/services/products.server.ts` 获取数据
  - 通过 URL Search Params 处理筛选和搜索
  - 保留现有的标签页结构和组件

### 3. 优化组件结构
- **确保子组件兼容性**：验证 `ProductArchivesTab`、`CategoryManagementTab` 等子组件能在 Server Component 中正常工作
- **调整数据传递**：将服务端获取的数据通过 props 传递给子组件
- **保持客户端交互**：搜索、筛选等交互功能通过 URL 参数实现，确保服务端渲染和客户端导航兼容

### 4. 检查并优化 API 路由
- **文件**：`src/app/api/products/*`
- **功能**：确保所有写操作 API 使用 Zod 进行请求体验证
- **实现**：
  - 检查现有 API 路由
  - 为创建/更新产品的路由添加 Zod 校验
  - 确保响应格式统一

## 技术要点

### Server Components 最佳实践
- 页面组件使用 Server Components，减少客户端 JS 体积
- 数据获取在服务端完成，提升首屏加载速度
- 客户端交互通过子组件的 `'use client'` 实现

### API 安全
- 使用 Zod 进行严格的请求体验证
- 服务端服务使用服务端 Supabase 客户端，确保安全

### UI/UX 增强
- 保持现有的 Skeleton 加载状态
- 确保页面流畅的导航和交互体验

## 预期效果
- 产品页面首屏加载速度提升
- 客户端 JS 体积减少
- API 安全性增强
- 保持现有的功能和用户体验

## 实施顺序
1. 创建服务端服务 `products.server.ts`
2. 重构产品页面为 Server Component
3. 测试并验证功能完整性
4. 优化 API 路由安全性

## 验证标准
- 页面能正常渲染和交互
- 搜索和筛选功能正常工作
- 服务端渲染正常
- 无客户端错误
- 符合最佳实践要求