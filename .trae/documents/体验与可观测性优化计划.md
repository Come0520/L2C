# 体验与可观测性优化计划

## 1. 错误监控与埋点 - 接入 Sentry

### 实施步骤
- 安装 Sentry SDK 及其 Next.js 集成包
- 创建 Sentry 项目并获取 DSN
- 在 `next.config.js` 中配置 Sentry
- 在 `app/layout.tsx` 中初始化 Sentry 客户端
- 配置错误采样率和环境区分（开发/生产）
- 添加自定义错误边界组件
- 测试错误上报功能

### 预期文件修改
- `package.json` - 添加 Sentry 依赖
- `next.config.js` - 配置 Sentry 插件
- `app/layout.tsx` - 集成 Sentry 客户端
- `src/components/error-boundary.tsx` - 自定义错误边界

## 2. 骨架态组件 - 统一加载状态

### 实施步骤
- 设计骨架态组件库，包含常用组件的骨架态
- 实现基础骨架态组件（按钮、卡片、列表、表单等）
- 为主要页面添加骨架态支持
- 集成到现有加载逻辑中
- 确保骨架态与实际内容尺寸匹配

### 预期文件修改
- `src/components/ui/skeleton/` - 骨架态组件库
- 主要页面文件 - 添加骨架态使用
- `src/components/loading.tsx` - 统一加载组件

## 3. Web Vitals 监控 - CI 集成性能断言

### 实施步骤
- 配置 Web Vitals 监控
- 集成到现有 Lighthouse CI 流程中
- 设置性能阈值（FCP、LCP、CLS、TTI、TBT）
- 在 CI 中添加性能断言步骤
- 生成可视化性能报告

### 预期文件修改
- `.github/workflows/ci.yml` - 添加性能测试步骤
- `src/app/layout.tsx` - 添加 Web Vitals 监控脚本
- `lighthouserc.js` - 配置 Lighthouse 性能阈值

## 4. 流式 SSR 优化 - 数据密集页面引入 Suspense

### 实施步骤
- 识别数据密集型页面（如仪表盘、列表页等）
- 实现数据获取的 Suspense 支持
- 为相关页面添加 Suspense 边界
- 优化组件渲染顺序
- 测试流式渲染效果

### 预期文件修改
- 数据密集型页面组件 - 添加 Suspense 边界
- 数据获取钩子 - 支持 Suspense
- `src/app/layout.tsx` - 配置流式渲染支持

## 技术要点
- 遵循现有代码规范和架构
- 确保所有修改向后兼容
- 进行充分测试
- 监控性能指标变化

## 验收标准
- 错误能够正确上报到 Sentry
- 所有主要页面都有统一的骨架态
- CI 流程能够进行性能断言
- 数据密集页面实现流式 SSR
- 首屏时间下降，Lighthouse 性能分提升