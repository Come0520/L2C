# 修复测量中-待分配状态实现不一致问题

## 问题分析

通过对比文档和前端代码，发现以下不一致问题：

1. **状态命名不一致**：
   - 文档定义：`测量中-待分配` 对应 `MEASURING_PENDING_ASSIGNMENT`
   - 前端代码：
     - `order-status.ts` 中定义为 `MEASURING_ASSIGNING: 'measuring_assigning'`
     - 组件中使用 `surveying-pending-assignment` 作为 API 请求状态值
     - Mock 数据中使用 `MEASURING_PENDING_ASSIGNMENT`

2. **状态流转 API 调用不一致**：
   - 不同组件使用不同的状态值调用 API
   - 缺少统一的状态流转服务层

3. **测量阶段状态数量不匹配**：
   - 文档定义测量阶段有6个状态
   - 前端代码中定义了5个测量相关状态，缺少"方案待确认"状态

## 修复方案

### 1. 统一状态命名
- 修改 `order-status.ts` 中的状态定义，确保与文档完全一致
- 将 `MEASURING_ASSIGNING` 重命名为 `MEASURING_PENDING_ASSIGNMENT`
- 将 `MEASURING_ASSIGNED` 重命名为 `MEASURING_ASSIGNING`

### 2. 统一 API 调用状态值
- 修改 `pending-survey-view.tsx` 中的 API 调用，使用正确的状态值 `measuring_pending_assignment`
- 确保所有组件使用统一的状态常量，而不是硬编码的字符串

### 3. 完善状态配置
- 检查并补充所有测量阶段的状态配置
- 确保 `ORDER_STATUS_CONFIG` 中包含所有文档中定义的状态

### 4. 统一状态流转逻辑
- 创建统一的状态流转服务层，处理所有状态变更请求
- 确保状态流转符合文档中定义的触发条件和权限控制

### 5. 验证数据库表结构
- 检查数据库迁移文件，确保 `measurement_orders` 表包含所有必要的字段
- 验证与 `sales_orders` 表的关联关系是否正确

## 实施步骤

1. 修改 `src/constants/order-status.ts` 中的状态定义
2. 更新所有使用硬编码状态值的组件
3. 检查并补充 `ORDER_STATUS_CONFIG` 配置
4. 验证状态流转 API 调用
5. 检查数据库表结构（如果有迁移文件）
6. 测试所有测量阶段的状态流转

## 预期结果

- 前端代码中的状态定义与文档完全一致
- 所有组件使用统一的状态常量
- 状态流转符合文档中定义的触发条件
- 数据库表结构支持完整的测量流程

这个修复计划将确保前端实现与文档中定义的"测量中-待分配"状态完全匹配，避免因状态命名不一致导致的功能问题。