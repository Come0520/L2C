## 多登录方式实现计划

### 当前认证系统分析
- **认证框架**: Supabase Auth
- **当前支持**: 仅手机号+密码登录
- **前端实现**: 使用 Supabase Client SDK
- **后端实现**: 模拟登录API，实际使用 Supabase Auth

### 需求分析
需要支持三种登录方式：
1. ✅ 手机号+密码登录（已实现）
2. ⬜ 手机验证码登录
3. ⬜ 微信/飞书扫码登录

### 实现方案

#### 1. 手机验证码登录
- **技术方案**: 使用 Supabase Auth 的 OTP（一次性密码）功能
- **配置**: 在 Supabase 控制台启用手机号登录
- **实现**: 
  - 更新登录页面，添加验证码登录选项
  - 实现发送验证码和验证码验证逻辑
  - 更新 AuthContext 支持验证码登录

#### 2. 微信扫码登录
- **技术方案**: Supabase Auth OAuth 集成
- **配置**: 
  - 在微信开放平台注册应用
  - 在 Supabase 控制台添加微信作为 OAuth 提供商
  - 配置回调 URL
- **实现**: 
  - 添加微信登录按钮到登录页面
  - 实现 OAuth 回调处理
  - 同步微信用户信息到系统用户表

#### 3. 飞书扫码登录
- **技术方案**: Supabase Auth 自定义 OAuth 提供商
- **配置**: 
  - 在飞书开发者平台注册应用
  - 在 Supabase 控制台添加飞书作为自定义 OAuth 提供商
  - 配置回调 URL 和密钥
- **实现**: 
  - 添加飞书登录按钮到登录页面
  - 实现 OAuth 回调处理
  - 同步飞书用户信息到系统用户表

### 实施步骤

1. **配置 Supabase Auth**
   - 启用手机号登录和 OTP
   - 配置微信 OAuth
   - 配置飞书自定义 OAuth

2. **更新前端组件**
   - 修改登录页面，添加多种登录选项
   - 实现验证码发送和验证表单
   - 添加微信和飞书登录按钮

3. **更新认证上下文**
   - 扩展 AuthContext，支持多种登录方法
   - 实现验证码登录逻辑
   - 实现 OAuth 登录逻辑

4. **更新 API 路由**
   - 替换模拟登录 API，使用真实的 Supabase Auth
   - 实现用户信息同步逻辑

5. **测试与验证**
   - 测试手机号+密码登录
   - 测试手机验证码登录
   - 测试微信扫码登录
   - 测试飞书扫码登录

### 预期结果
- 登录页面支持三种登录方式切换
- 所有登录方式都能正常工作
- 用户信息正确同步到系统
- 登录流程安全可靠

### 技术要点
- 使用 Supabase Auth 统一处理所有登录方式
- 确保 OAuth 配置安全，密钥不泄露
- 实现用户信息的正确映射和同步
- 处理好不同登录方式的错误情况

### 注意事项
- 需要在微信和飞书开放平台注册应用
- 需要配置正确的回调 URL
- 需要处理用户首次登录时的信息补充
- 需要确保登录流程的安全性和可靠性