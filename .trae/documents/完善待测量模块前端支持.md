# 完善待测量模块前端支持计划

## 需求分析

根据26状态流程图，"待测量"模块需要支持以下功能：
1. **状态定义**：包含待测量、测量中-待分配、测量中-分配中、测量中-待上门、测量中-待确认等状态
2. **状态流转**：从草签状态流转到待测量状态，再到后续测量相关状态
3. **触发机制**：销售人员点击"去测量"按钮触发状态变更
4. **角色权限**：销售人员、派单员、测量师等不同角色的操作权限
5. **时效控制**：待测量状态的时效要求和提醒机制

## 当前系统支持情况

### ✅ 数据库/后端支持
- 后端已定义完整的待测量相关状态枚举（SalesOrderStatus）
- 后端已实现状态流转规则（SALES_ORDER_STATUS_FLOW）
- 数据库表结构支持这些状态的存储

### ❌ 前端支持不足
- 前端订单状态（ORDER_STATUS）缺少待测量相关状态
- 前端需要添加相应的状态配置和UI组件
- 前端需要实现状态流转的触发机制

## 实施计划

### 1. 完善前端状态定义
- **修改文件**：`slideboard-frontend/src/constants/order-status.ts`
- **添加状态**：
  - PENDING_MEASUREMENT: 'pending_measurement'（待测量）
  - MEASURING_ASSIGNING: 'measuring_assigning'（测量中-待分配）
  - MEASURING_ASSIGNED: 'measuring_assigned'（测量中-分配中）
  - MEASURING_PENDING_VISIT: 'measuring_pending_visit'（测量中-待上门）
  - MEASURING_PENDING_CONFIRM: 'measuring_pending_confirm'（测量中-待确认）
  - PLAN_PENDING_CONFIRM: 'plan_pending_confirm'（方案待确认）
- **添加状态配置**：为每个新状态添加标签、颜色、背景色等配置

### 2. 实现状态流转UI组件
- **修改文件**：订单详情页面、线索详情页面
- **添加功能**：
  - "去测量"按钮（销售人员权限）
  - 测量师分配组件（派单员权限）
  - 测量结果确认组件（销售人员权限）
- **实现逻辑**：
  - 点击"去测量"按钮时，调用后端API将状态从草签变更为待测量
  - 显示当前状态和可执行的操作

### 3. 完善角色权限控制
- **修改文件**：状态配置文件、组件权限控制
- **添加权限**：
  - 销售人员：查看待测量状态、点击"去测量"按钮
  - 派单员：分配测量师权限
  - 测量师：接单、上传测量结果权限
- **实现逻辑**：根据用户角色动态显示可执行的操作按钮

### 4. 添加时效控制和提醒
- **修改文件**：订单列表页面、详情页面
- **添加功能**：
  - 待测量状态停留时间显示
  - 超时提醒机制
  - 时效规则配置
- **实现逻辑**：根据状态变更时间和时效规则，计算并显示剩余时间，超时后显示提醒

### 5. 测试和验证
- **测试场景**：
  - 状态流转测试：从草签到待测量到后续状态的完整流转
  - 角色权限测试：不同角色的操作权限验证
  - 时效提醒测试：超时提醒功能验证
- **验证标准**：
  - 状态流转符合26状态流程图要求
  - 角色权限控制正确
  - 时效提醒功能正常工作

## 预期效果

通过以上实施，前端将完整支持"待测量"模块的需求，实现：
1. 完整的待测量状态定义和流转
2. 符合角色权限的操作界面
3. 有效的时效控制和提醒机制
4. 与后端状态流转的无缝对接

这将确保前端实现与26状态流程图的需求一致，支持完整的订单生命周期管理。