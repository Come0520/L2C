# 实现复制幻灯片功能

## 1. 分析现有代码结构

- 幻灯片列表组件 `SlideThumbnailList` 已经包含复制按钮UI和基本事件处理
- 编辑器页面 `editor/[id]/page.tsx` 管理幻灯片状态和操作
- 项目已有 `callRpc` 辅助函数用于调用Supabase RPC
- 幻灯片数据存储在Supabase的 `slides` 表中

## 2. 实现步骤

### 步骤1：在编辑器页面添加复制幻灯片处理函数

1. 在 `editor/[id]/page.tsx` 中添加 `handleDuplicateSlide` 函数
2. 实现复制逻辑：
   - 复制指定索引的幻灯片数据
   - 生成新的幻灯片ID
   - 更新幻灯片列表状态
   - 调用Supabase RPC复制幻灯片记录

### 步骤2：将复制函数传递给幻灯片列表组件

1. 修改 `SlideThumbnailList` 组件的 `onSlideDuplicate` 属性传递
2. 确保组件可以接收并调用复制函数

### 步骤3：实现客户端复制逻辑

1. 在 `handleDuplicateSlide` 函数中：
   - 深拷贝要复制的幻灯片
   - 生成新的唯一ID
   - 更新幻灯片标题
   - 将新幻灯片插入到列表中
   - 更新当前选中的幻灯片索引

### 步骤4：调用Supabase RPC函数

1. 使用 `callRpc` 辅助函数调用复制幻灯片的RPC函数
2. 传递幻灯片ID和复制参数
3. 处理RPC调用结果

### 步骤5：测试和验证

1. 确保复制按钮点击后能正确复制幻灯片
2. 验证新幻灯片显示在UI中
3. 确认Supabase数据库中已创建复制记录

## 3. 代码修改点

1. **`/src/app/editor/[id]/page.tsx`**：
   - 添加 `handleDuplicateSlide` 函数
   - 在 `SlideThumbnailList` 组件中传递 `onSlideDuplicate` 属性

2. **`/src/features/editor/components/slide-thumbnail-list.tsx`**：
   - 确保 `onSlideDuplicate` 属性已正确定义

## 4. 预期效果

- 点击幻灯片缩略图的复制按钮，会在当前幻灯片后创建一个副本
- 新幻灯片会显示在缩略图列表中
- 当前选中的幻灯片会切换到新复制的幻灯片
- 复制的幻灯片包含原幻灯片的所有元素和样式
- Supabase数据库中会创建新的幻灯片记录

## 5. 注意事项

- 确保复制的幻灯片具有唯一ID
- 正确处理深拷贝，避免引用问题
- 调用RPC函数时处理可能的错误
- 保持代码符合项目的命名规范

这个计划将实现完整的复制幻灯片功能，包括UI更新和数据库操作。