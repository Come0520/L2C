# 客户模块重构计划

## 目标
将客户模块迁移到 Next.js 16 + React 19 + Supabase 最佳实践，包括页面重构为 Server Component，优化加载性能，以及添加骨架屏加载状态。

## 重构步骤

### 1. 创建服务端服务
- **文件**：`src/services/customers.server.ts`
- **功能**：实现服务端数据获取逻辑
- **实现**：
  - 实现 `getAllCustomers` 方法，用于获取客户列表
  - 实现 `getCustomerById` 方法，用于获取客户详情
  - 实现 `getCustomerStats` 方法，用于获取客户统计数据
  - 使用服务端 Supabase 客户端

### 2. 重构客户页面
- **文件**：`src/app/customers/page.tsx`
- **功能**：将客户端组件改为 Server Component
- **实现**：
  - 移除 `'use client'` 指令
  - 将组件改为 `async function`
  - 使用 `src/services/customers.server.ts` 获取数据
  - 通过 URL Search Params 处理搜索和筛选
  - 保留现有的页面结构和组件

### 3. 优化客户列表
- **功能**：优化客户列表的加载性能
- **实现**：
  - 实现分页加载
  - 优化数据获取逻辑
  - 确保服务端渲染的高效性

### 4. 添加骨架屏
- **文件**：创建 `src/features/customers/components/skeletons/` 目录
- **功能**：为客户详情页添加骨架屏
- **实现**：
  - 创建 `CustomerDetailSkeleton` 组件
  - 创建 `CustomerListSkeleton` 组件
  - 创建 `CustomerStatsSkeleton` 组件
  - 在数据加载过程中显示骨架屏

### 5. 拆分组件
- **功能**：将客户详情模态框拆分为独立组件
- **实现**：
  - 创建 `src/features/customers/components/CustomerDetailModal.tsx`
  - 确保组件支持客户端交互
  - 使用 `'use client'` 指令

## 技术要点

### Server Components 最佳实践
- 页面组件使用 Server Components，减少客户端 JS 体积
- 数据获取在服务端完成，提升首屏加载速度
- 客户端交互通过子组件的 `'use client'` 实现

### UI/UX 增强
- 添加骨架屏加载状态，提升用户体验
- 优化页面结构，确保流畅的导航和交互

### 性能优化
- 实现高效的数据获取和分页
- 优化组件渲染，减少不必要的重渲染

## 预期效果
- 客户页面首屏加载速度提升
- 客户端 JS 体积减少
- 加载状态更加友好
- 保持现有的功能和用户体验

## 实施顺序
1. 创建服务端服务文件
2. 重构客户页面为 Server Component
3. 添加骨架屏组件
4. 拆分客户详情模态框
5. 测试并验证功能完整性