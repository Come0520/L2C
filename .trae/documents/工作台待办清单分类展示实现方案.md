# 基于角色职责的工作台待办清单分类展示实现方案

## 1. 角色职责分析

根据《人物角色定义》文档，对关键角色的职责和工作范围进行了详细分析：

### 1.1 销售类角色

#### 驻店销售 (SALES_STORE)
- **核心职责**：线索录入、跟踪、报价、转化、草签、测量安排与确认、方案确认、安装安排与确认
- **关键待办节点**：跟踪中、草签、测量中-待确认、方案待确认、安装中-待确认

#### 远程销售 (SALES_REMOTE)
- **核心职责**：线索跟踪、报价、转化、草签、测量确认、方案确认、推单处理、安装安排与确认
- **关键待办节点**：跟踪中、草签、测量中-待确认、方案待确认、待推单、安装中-待确认

#### 销售负责人 (LEAD_SALES)
- **核心职责**：线索分配、销售团队管理、重要客户关系维护、城市授权分配人员管理
- **关键待办节点**：待分配线索、团队业绩异常、待审批事项

#### 渠道负责人 (LEAD_CHANNEL)
- **核心职责**：渠道合作伙伴开发、渠道政策制定与执行、渠道业绩监控、渠道冲突处理
- **关键待办节点**：渠道业绩异常、待处理渠道投诉、渠道政策待审批

### 1.2 交付类角色

#### 订单客服 (DELIVERY_SERVICE)
- **核心职责**：生产单号填写、备货管理、物流管理、推单确认
- **关键待办节点**：待推单确认、待填写生产单号、待更新备货状态、待填写物流单号

#### 派单员 (SERVICE_DISPATCH)
- **核心职责**：测量需求单分配、测量师调度、安装师派单、服务人员调度安排
- **关键待办节点**：测量中-待分配、测量中-分配中、安装中-待分配、安装中-分配中

## 2. 待办事项分类设计

### 2.1 待办事项数据模型

```typescript
interface TodoItem {
  id: string;
  type: 'lead' | 'order' | 'task' | 'approval';
  businessId: string;
  businessType: string;
  title: string;
  status: string;
  priority: 'low' | 'medium' | 'high';
  createdAt: Date;
  dueDate?: Date;
  assigneeId: string;
  assigneeName: string;
  relatedData: {
    orderNumber?: string;
    leadNumber?: string;
    customerName?: string;
    productName?: string;
    contactPhone?: string;
    assignerName?: string;
  };
}

interface TodoCategory {
  id: string;
  name: string;
  items: TodoItem[];
  count: number;
  icon?: string;
}
```

### 2.2 角色与待办分类映射

| 角色 | 待办分类 | 对应订单状态 |
|------|----------|--------------|
| **驻店销售** | 跟踪中线索 | 跟踪中 |
| | 待草签线索 | 草签 |
| | 待确认测量单 | 测量中-待确认 |
| | 待确认方案 | 方案待确认 |
| | 待确认安装 | 安装中-待确认 |
| **远程销售** | 跟踪中线索 | 跟踪中 |
| | 待草签线索 | 草签 |
| | 待确认测量单 | 测量中-待确认 |
| | 待确认方案 | 方案待确认 |
| | 待推单处理 | 待推单 |
| | 待确认安装 | 安装中-待确认 |
| **销售负责人** | 待分配线索 | 待分配 |
| | 团队业绩异常 | - |
| | 待审批事项 | - |
| | 待确认到店 | - |
| **渠道负责人** | 渠道业绩异常 | - |
| | 待处理渠道投诉 | - |
| | 渠道政策待审批 | - |
| **订单客服** | 待确认推单 | 待推单 |
| | 待填写生产单号 | 待下单 |
| | 待更新备货状态 | 生产中 |
| | 待填写物流单号 | 备货完成 |
| **派单员** | 测量待分配 | 测量中-待分配 |
| | 测量分配中 | 测量中-分配中 |
| | 安装待分配 | 安装中-待分配 |
| | 安装分配中 | 安装中-分配中 |

## 3. 实现方案

### 3.1 后端API设计

```
GET /api/todos
参数：
- userId: string（当前用户ID）
- role: string（当前用户角色）

返回：
{
  categories: TodoCategory[]
}
```

### 3.2 前端实现

1. **待办事项分类组件** (`TodoCategories.tsx`)
   - 根据用户角色动态生成对应的待办分类
   - 每个分类展示对应状态的待办事项
   - 显示每个分类的待办数量
   - 支持点击分类查看详情

2. **待办事项卡片组件** (`TodoCard.tsx`)
   - 展示待办事项核心信息
   - 提供快速操作按钮
   - 显示优先级标识

3. **工作台页面改造** (`page.tsx`)
   - 集成待办事项分类组件
   - 根据用户角色加载不同的分类
   - 实现待办事项的实时更新

### 3.3 核心实现逻辑

```typescript
// 根据角色获取待办分类配置
const getTodoCategoryConfig = (role: string): string[] => {
  const roleCategoryMap: Record<string, string[]> = {
    'SALES_STORE': ['跟踪中线索', '待草签线索', '待确认测量单', '待确认方案', '待确认安装'],
    'SALES_REMOTE': ['跟踪中线索', '待草签线索', '待确认测量单', '待确认方案', '待推单处理', '待确认安装'],
    'LEAD_SALES': ['待分配线索', '团队业绩异常', '待审批事项', '待确认到店'],
    'LEAD_CHANNEL': ['渠道业绩异常', '待处理渠道投诉', '渠道政策待审批'],
    'DELIVERY_SERVICE': ['待确认推单', '待填写生产单号', '待更新备货状态', '待填写物流单号'],
    'SERVICE_DISPATCH': ['测量待分配', '测量分配中', '安装待分配', '安装分配中']
  };
  return roleCategoryMap[role] || [];
};

// 生成待办分类数据
const generateTodoCategories = async (userId: string, role: string): Promise<TodoCategory[]> => {
  const categoryConfigs = getTodoCategoryConfig(role);
  const categories: TodoCategory[] = [];
  
  for (const categoryName of categoryConfigs) {
    const items = await fetchTodoItems(userId, role, categoryName);
    categories.push({
      id: categoryName,
      name: categoryName,
      items,
      count: items.length
    });
  }
  
  return categories;
};
```

## 4. 实施步骤

1. **API开发**：实现待办事项查询API，根据用户角色返回对应的分类待办事项
2. **前端组件开发**：开发待办事项分类组件和卡片组件
3. **工作台集成**：将待办事项分类组件集成到现有工作台页面
4. **数据对接**：对接订单系统和线索系统，实时获取待办事项数据
5. **测试验证**：测试不同角色的待办事项展示效果

## 5. 预期效果

- 每个角色登录后，在工作台待办清单中看到与其职责相关的分类待办事项
- 待办事项按业务类型和状态清晰分类，便于快速识别和处理
- 每个分类显示待办数量，直观了解工作负载
- 支持快速操作，提高工作效率
- 实时更新，确保用户看到最新的待办事项

## 6. 技术栈

- 前端：Next.js 14+、React、TypeScript
- 后端：NestJS、PostgreSQL
- 状态管理：React Context
- 实时更新：WebSocket（可选，MVP阶段可使用定时刷新）

这个方案基于准确的角色职责定义，设计了清晰的待办事项分类，能够满足不同角色的工作需求，提高工作效率和用户体验。