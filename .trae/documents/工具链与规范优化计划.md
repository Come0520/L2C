# 工具链与规范优化计划

## 一、当前现状分析

1. **工具链配置**：
   - 前端项目已配置 `clean:unused` 和 `clean:deadcode` 脚本
   - 依赖分析工具 `depcheck` 和死代码检测工具 `ts-prune` 已安装
   - CI 流程中已有代码质量检查阶段

2. **CI 配置**：
   - 已有前端 ESLint 检查和 TypeScript 检查
   - 检查在 `code-quality` 阶段执行，作为后续阶段的前置条件
   - 但需要确保在 `next lint` 退役后仍然能够正常工作

3. **VibeCoding 敏捷 5S 规则**：
   - 已配置 pre-commit 钩子和 lint-staged
   - 但需要确保定期执行代码清理工作

## 二、优化方案

### 1. 工具链优化

**目标**：确保定期运行 `depcheck` 和 `ts-prune` 清理未使用依赖与死代码

**具体措施**：
- ✅ 保留现有 `clean:unused` 和 `clean:deadcode` 脚本
- ✅ 在 CI 流程中添加依赖和死代码检查阶段
- ✅ 将这些检查作为 PR 合并的强制门槛
- ✅ 更新 package.json 脚本，确保工具正确配置

### 2. CI 流程优化

**目标**：增加前端 `typecheck` 与 `lint:eslint` 的强制门槛，避免 `next lint` 退役后出现不一致

**具体措施**：
- ✅ 确认当前 CI 流程中已包含 `typecheck` 和 `lint:eslint` 检查
- ✅ 移除可能存在的 `next lint` 依赖，确保使用独立的 ESLint 配置
- ✅ 确保 ESLint 配置与 TypeScript 配置保持一致
- ✅ 在 CI 流程中增加构建阶段的 `typecheck` 和 `lint:eslint` 检查

### 3. VibeCoding 敏捷 5S 规则执行

**目标**：确保代码精简、结构有序、环境清洁、标准统一、持续改进

**具体措施**：
- ✅ 配置 pre-commit 钩子，自动运行代码检测工具
- ✅ 添加删除无用代码和注释掉的代码块的检查
- ✅ 定期使用依赖分析工具检查未使用的包
- ✅ 确保每个函数/类保持单一职责原则

## 三、实施步骤

1. **检查当前 ESLint 配置**：
   - 查看 `.eslintrc.js` 或 `.eslintrc.json` 文件
   - 确认是否依赖 `next lint`，如果是则更新配置
   - 确保 ESLint 配置与 TypeScript 配置兼容

2. **更新 CI 流程**：
   - 在 `code-quality` 阶段添加 `clean:unused` 和 `clean:deadcode` 检查
   - 确保这些检查失败时 CI 流程中断
   - 移除重复的检查步骤，优化 CI 流程

3. **优化 pre-commit 钩子**：
   - 确保 pre-commit 钩子运行 `typecheck` 和 `lint:eslint`
   - 添加删除无用代码和注释掉的代码块的检查
   - 确保提交前代码符合 VibeCoding 敏捷 5S 规则

4. **添加定期清理机制**：
   - 添加定期运行 `clean:unused` 和 `clean:deadcode` 的提醒
   - 配置自动清理脚本，定期移除未使用的依赖和死代码
   - 确保代码库保持整洁

## 四、预期效果

1. **工具链**：
   - 定期清理未使用的依赖和死代码
   - 保持代码库的精简和高效
   - 减少构建时间和运行时开销

2. **CI 流程**：
   - 确保 `typecheck` 和 `lint:eslint` 检查是强制的
   - 避免 `next lint` 退役后出现不一致
   - 提高代码质量和稳定性

3. **VibeCoding 敏捷 5S 规则**：
   - 确保代码精简、结构有序、环境清洁、标准统一、持续改进
   - 提高开发效率和代码可维护性
   - 养成良好的编码习惯

## 五、注意事项

1. 确保 `depcheck` 和 `ts-prune` 工具配置正确，避免误报
2. 在 CI 流程中添加检查时，考虑构建时间和资源消耗
3. 更新 ESLint 配置时，确保与现有代码兼容
4. 定期回顾和优化工具链和 CI 流程，适应项目发展需求

通过以上优化，我们将确保项目工具链配置合理，CI 流程稳定可靠，并且严格执行 VibeCoding 敏捷 5S 规则，提高代码质量和开发效率。