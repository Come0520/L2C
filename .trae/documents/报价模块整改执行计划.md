# æŠ¥ä»·æ¨¡å—æ•´æ”¹æ‰§è¡Œè®¡åˆ’

## ğŸ“‹ è®¡åˆ’æ¦‚è¿°

åŸºäºæ•´æ”¹è®¡åˆ’æ–‡æ¡£å’Œå½“å‰ä»£ç çŠ¶æ€åˆ†æ,åˆ¶å®šä»¥ä¸‹åˆ†é˜¶æ®µæ•´æ”¹è®¡åˆ’,ç›®æ ‡æ˜¯å°†æŠ¥ä»·æ¨¡å—å®Œæˆåº¦ä» **30-40%** æå‡è‡³ **85%+**ã€‚

---

## ğŸ¯ ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€è®¾æ–½ä¿®å¤ (Week 1)

### 1.1 æ•°æ®åº“Schemaä¿®æ­£

**ä»»åŠ¡æ¸…å•**:
- æ·»åŠ ç‰ˆæœ¬ç®¡ç†å”¯ä¸€çº¦æŸç´¢å¼•
- åœ¨ordersè¡¨æ·»åŠ quote_snapshot JSONBå­—æ®µç”¨äºå¿«ç…§å­˜å‚¨
- å®šä¹‰JSONBå­—æ®µçš„TypeScriptç±»å‹æ¥å£

**å…³é”®æ–‡ä»¶**:
- åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶: `drizzle/0006_quote_unique_active_version.sql`
- åˆ›å»ºç±»å‹å®šä¹‰: `src/features/quotes/types/quote-item-attributes.ts`
- æ›´æ–°Schema: `src/shared/api/schema/quotes.ts` å’Œ `src/shared/api/schema/orders.ts`

**éªŒæ”¶æ ‡å‡†**:
- æ•°æ®åº“å±‚é¢ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªACTIVEç‰ˆæœ¬
- TypeScriptç±»å‹æ£€æŸ¥é€šè¿‡,æ— anyç±»å‹

---

### 1.2 TypeScriptç±»å‹é”™è¯¯ä¿®å¤

**ä»»åŠ¡æ¸…å•**:
- ä¿®å¤ `curtain-fabric-quote-dialog.tsx` ç±»å‹é”™è¯¯
- ä¿®å¤ `quote-version-compare.tsx` ç±»å‹é”™è¯¯  
- ä¿®å¤ `quote-summary-panel.tsx` ç±»å‹é”™è¯¯
- æ›¿æ¢ `quote-mutations.ts` ä¸­çš„Mockå®ç°

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/components/curtain-fabric-quote-dialog.tsx`
- `src/features/quotes/components/quote-version-compare.tsx`
- `src/features/quotes/components/quote-summary-panel.tsx`
- `src/features/quotes/actions/quote-mutations.ts`

**éªŒæ”¶æ ‡å‡†**:
- è¿è¡Œ `pnpm type-check` æ— é”™è¯¯
- æ‰€æœ‰æŠ¥ä»·ç›¸å…³ç»„ä»¶ç±»å‹å®‰å…¨

---

## ğŸ¯ ç¬¬äºŒé˜¶æ®µ: è®¡ç®—å¼•æ“å®Œå–„ (Week 2)

### 2.1 çª—å¸˜è®¡ç®—å¼•æ“éªŒè¯

**ä»»åŠ¡æ¸…å•**:
- å®¡æŸ¥ç°æœ‰è®¡ç®—å…¬å¼å‡†ç¡®æ€§
- è¡¥å……å®šé«˜/å®šå®½åˆ†æ”¯é€»è¾‘
- å®Œå–„è¶…é«˜é¢„è­¦é€»è¾‘
- ç¼–å†™å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰åœºæ™¯

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/logic/curtain-calc-engine.ts`
- `src/features/quotes/logic/__tests__/curtain-calc-engine.test.ts`

**éªŒæ”¶æ ‡å‡†**:
- è®¡ç®—ç»“æœä¸æ‰‹å·¥è®¡ç®—ä¸€è‡´(è¯¯å·®<1%)
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%

---

### 2.2 å¢™çº¸/å¢™å¸ƒè®¡ç®—å¼•æ“

**ä»»åŠ¡æ¸…å•**:
- å®¡æŸ¥å¢™çº¸è®¡ç®—ç­–ç•¥(æ¡æ•°ã€å·æ•°ã€å¯¹èŠ±)
- éªŒè¯å¢™å¸ƒè®¡ç®—é€»è¾‘(é¢ç§¯ã€å®šé«˜é€‚é…)
- åˆ†ç¦»å¢™å¸ƒä¸ºç‹¬ç«‹ç­–ç•¥ç±»
- ç¼–å†™å•å…ƒæµ‹è¯•

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/calc-strategies/wallpaper-strategy.ts`
- æ–°å»º: `src/features/quotes/calc-strategies/wallcloth-strategy.ts`
- `src/features/quotes/calc-strategies/__tests__/wallpaper-strategy.test.ts`

**éªŒæ”¶æ ‡å‡†**:
- å¢™çº¸/å¢™å¸ƒè®¡ç®—é€»è¾‘å®Œæ•´
- å¤šå¢™æ®µèšåˆåŠŸèƒ½æ­£å¸¸

---

### 2.3 é™„ä»¶è®¡ç®—é€»è¾‘å®Œå–„

**ä»»åŠ¡æ¸…å•**:
- å®ç° `calculateAttachments()` å‡½æ•°
- å®Œå–„æœ¬å¸ƒç»‘å¸¦ã€æŠ±æ•ã€èƒ¶æ°´/åŸºè†œè”åŠ¨è®¡ç®—
- å®ç°è¡Œå†…å°è®¡é€»è¾‘

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/logic/attachment-calc.ts`
- `src/features/quotes/logic/__tests__/attachment-calc.test.ts`

**éªŒæ”¶æ ‡å‡†**:
- é™„ä»¶è‡ªåŠ¨è®¡ç®—åŠŸèƒ½æ­£å¸¸
- è¡Œå†…å°è®¡å‡†ç¡®

---

## ğŸ¯ ç¬¬ä¸‰é˜¶æ®µ: ç‰ˆæœ¬ç®¡ç†ä¸æµè½¬ (Week 3)

### 3.1 ç‰ˆæœ¬ç®¡ç†ä¸šåŠ¡é€»è¾‘

**ä»»åŠ¡æ¸…å•**:
- å®ç°å®Œæ•´çš„ç‰ˆæœ¬çŠ¶æ€æœº
- æ·»åŠ ACTIVEç‰ˆæœ¬ç¼–è¾‘é˜²æŠ¤
- å®ç°ç‰ˆæœ¬æ¿€æ´»æ—¶çš„è‡ªåŠ¨é™çº§é€»è¾‘
- å®Œå–„å…‹éš†ç‰ˆæœ¬åŠŸèƒ½

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/actions/version-actions.ts`
- `src/services/quote.service.ts`

**éªŒæ”¶æ ‡å‡†**:
- ç‰ˆæœ¬åˆ‡æ¢æµç•…,æ•°æ®ä¸€è‡´æ€§ä¿è¯
- ACTIVEç‰ˆæœ¬ä¸å¯ç¼–è¾‘

---

### 3.2 è®¢å•æµè½¬ä¸å¿«ç…§

**ä»»åŠ¡æ¸…å•**:
- å®ç°è½¬å•æ—¶çš„å¿«ç…§å­˜å‚¨é€»è¾‘
- å®ç°åŸºäºcategory_tagçš„æ‹†å•è·¯ç”±
- å®Œå–„convert-to-order.tså®ç°

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/actions/convert-to-order.ts`
- `src/shared/api/schema/orders.ts` (æ·»åŠ quote_snapshotå­—æ®µ)

**éªŒæ”¶æ ‡å‡†**:
- è½¬å•åè®¢å•æ•°æ®ä¸å—å•†å“åº“å˜æ›´å½±å“
- æ‹†å•è·¯ç”±é€»è¾‘æ­£ç¡®

---

## ğŸ¯ ç¬¬å››é˜¶æ®µ: æŠ¥ä»·æ¨¡å¼é…ç½® (Week 4)

### 4.1 é…ç½®æ•°æ®ç»“æ„

**ä»»åŠ¡æ¸…å•**:
- è®¾è®¡ç§Ÿæˆ·çº§é…ç½®ç»“æ„
- è®¾è®¡ç”¨æˆ·çº§é…ç½®ç»“æ„
- å®ç°ä¸‰çº§ä¼˜å…ˆçº§æœºåˆ¶

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/config/quote-mode-config.ts`
- æ›´æ–° `src/shared/api/schema/tenants.ts` å’Œ `users.ts`

**éªŒæ”¶æ ‡å‡†**:
- é…ç½®ç»“æ„æ¸…æ™°,æ”¯æŒä¸‰çº§ä¼˜å…ˆçº§

---

### 4.2 é…ç½®ç®¡ç†API

**ä»»åŠ¡æ¸…å•**:
- å®ç° `GET /api/quote-config` è·å–é…ç½®
- å®ç° `PUT /api/tenant/quote-config` ç§Ÿæˆ·é…ç½®
- å®ç° `PUT /api/user/quote-config` ç”¨æˆ·é…ç½®

**å…³é”®æ–‡ä»¶**:
- æ–°å»º: `src/app/api/quote-config/route.ts`
- æ–°å»º: `src/app/api/tenant/quote-config/route.ts`
- æ–°å»º: `src/app/api/user/quote-config/route.ts`

**éªŒæ”¶æ ‡å‡†**:
- é…ç½®APIåŠŸèƒ½å®Œæ•´,æ”¯æŒä¸‰çº§ä¼˜å…ˆçº§

---

### 4.3 å‰ç«¯åŠ¨æ€è¡¨å•

**ä»»åŠ¡æ¸…å•**:
- åˆ›å»ºDynamicQuoteFormç»„ä»¶
- å®ç°æ¨¡å¼åˆ‡æ¢UI
- å®ç°å­—æ®µåŠ¨æ€æ˜¾ç¤º/éšè—
- å®ç°æ•°æ®ä¿ç•™é€»è¾‘

**å…³é”®æ–‡ä»¶**:
- æ–°å»º: `src/features/quotes/components/DynamicQuoteForm.tsx`
- æ›´æ–°: `src/features/quotes/components/curtain-fabric-quote-form.tsx`

**éªŒæ”¶æ ‡å‡†**:
- æ¨¡å¼åˆ‡æ¢æµç•…,å­—æ®µæ­£ç¡®æ˜¾ç¤º/éšè—
- åˆ‡æ¢æ—¶æ•°æ®ä¿ç•™

---

## ğŸ¯ ç¬¬äº”é˜¶æ®µ: UI/UXä¼˜åŒ– (Week 5)

### 5.1 æ™ºèƒ½è”æƒ³ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**:
- å®ç°é˜²æŠ–(300ms)
- æ·»åŠ å®¢æˆ·ç«¯ç¼“å­˜
- å®ç°æ‹¼éŸ³æœç´¢
- å®Œå–„è‡ªåŠ¨å¡«å……é€»è¾‘

**å…³é”®æ–‡ä»¶**:
- `src/features/quotes/components/product-search-combobox.tsx`

**éªŒæ”¶æ ‡å‡†**:
- å•†å“è”æƒ³æœç´¢<300ms
- è‡ªåŠ¨å¡«å……åŠŸèƒ½æ­£å¸¸

---

### 5.2 åµŒå¥—é™„ä»¶UI

**ä»»åŠ¡æ¸…å•**:
- åˆ›å»ºNestedItemTableç»„ä»¶
- å®ç°æ ‘å½¢æ•°æ®ç»“æ„è¡¨æ ¼ç¼–è¾‘
- å®ç°å­è¡Œç¼©è¿›æ˜¾ç¤º
- å®ç°è¡Œå†…å°è®¡è‡ªåŠ¨æ›´æ–°

**å…³é”®æ–‡ä»¶**:
- æ–°å»º: `src/features/quotes/components/NestedItemTable.tsx`
- æ›´æ–°: `src/features/quotes/components/quote-items-table.tsx`

**éªŒæ”¶æ ‡å‡†**:
- åµŒå¥—é™„ä»¶UIäº¤äº’æµç•…
- è¡Œå†…å°è®¡å‡†ç¡®

---

## ğŸ¯ ç¬¬å…­é˜¶æ®µ: é›†æˆæµ‹è¯•ä¸æ–‡æ¡£ (Week 6)

### 6.1 å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•

**ä»»åŠ¡æ¸…å•**:
- E2Eæµ‹è¯•: åˆ›å»º-ç¼–è¾‘-è½¬å•å®Œæ•´æµç¨‹
- æ€§èƒ½æµ‹è¯•: æŠ¥ä»·å•åŠ è½½æ—¶é—´<2ç§’
- è®¡ç®—æ€§èƒ½æµ‹è¯•: è®¡ç®—å“åº”æ—¶é—´<500ms

**å…³é”®æ–‡ä»¶**:
- `e2e/flows/quote-lifecycle.spec.ts`
- `e2e/flows/quote-first-flow.spec.ts`

**éªŒæ”¶æ ‡å‡†**:
- E2Eæµ‹è¯•é€šè¿‡
- æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

---

### 6.2 å¼€å‘æ–‡æ¡£

**ä»»åŠ¡æ¸…å•**:
- ç¼–å†™è®¡ç®—å¼•æ“æ–‡æ¡£
- ç¼–å†™ç‰ˆæœ¬ç®¡ç†æ–‡æ¡£
- ç¼–å†™é…ç½®ç®¡ç†æ–‡æ¡£

**å…³é”®æ–‡ä»¶**:
- æ›´æ–°: `docs/02-requirements/modules/æŠ¥ä»·å•/æŠ¥ä»·å•.md`
- æ–°å»º: `docs/03-development/quote-calculation-engine.md`
- æ–°å»º: `docs/03-development/quote-version-management.md`

**éªŒæ”¶æ ‡å‡†**:
- æ–‡æ¡£å®Œæ•´,æ˜“äºç†è§£

---

## ğŸ“Š éªŒæ”¶æ ‡å‡†æ±‡æ€»

### åŠŸèƒ½éªŒæ”¶
- âœ… æŠ¥ä»·æ¨¡å¼åˆ‡æ¢æµç•…,å­—æ®µæ­£ç¡®æ˜¾ç¤º/éšè—
- âœ… çª—å¸˜/å¢™çº¸/å¢™å¸ƒè®¡ç®—ç»“æœä¸æ‰‹å·¥è®¡ç®—ä¸€è‡´(è¯¯å·®<1%)
- âœ… ç‰ˆæœ¬ç®¡ç†ç¬¦åˆ"å”¯ä¸€ACTIVE"çº¦æŸ
- âœ… è½¬å•åè®¢å•æ•°æ®ä¸å—å•†å“åº“å˜æ›´å½±å“
- âœ… åµŒå¥—é™„ä»¶è”åŠ¨è®¡ç®—æ­£ç¡®

### æ€§èƒ½éªŒæ”¶
- âœ… æŠ¥ä»·å•åŠ è½½æ—¶é—´<2ç§’(å«100+è¡Œé¡¹ç›®)
- âœ… è®¡ç®—å“åº”æ—¶é—´<500ms
- âœ… å•†å“è”æƒ³æœç´¢<300ms

### ä»£ç è´¨é‡éªŒæ”¶
- âœ… TypeScriptç±»å‹æ£€æŸ¥0é”™è¯¯
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%(è®¡ç®—å¼•æ“100%)
- âœ… E2Eæµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹

---

## âš ï¸ é£é™©æç¤º

1. **ä¸¥é‡**: è®¡ç®—å¼•æ“é”™è¯¯å¯¼è‡´æŠ¥ä»·é‡‘é¢ä¸å‡† - ç¬¬äºŒå‘¨å®Œæˆåå¿…é¡»äººå·¥éªŒè¯10+çœŸå®åœºæ™¯
2. **ä¸¥é‡**: å¿«ç…§æœºåˆ¶ç¼ºå¤±å¯¼è‡´è®¢å•ä»·æ ¼å˜åŠ¨ - ç¬¬ä¸€å‘¨å¿…é¡»ä¼˜å…ˆå®ç°
3. **é«˜**: å¢™çº¸/å¢™å¸ƒè®¡ç®—é€»è¾‘ä¸å®é™…ä¸šåŠ¡ä¸ç¬¦ - éœ€ä¸šåŠ¡æ–¹æ·±åº¦å‚ä¸éªŒè¯
4. **é«˜**: JSONBç»“æ„ä¸ä¸€è‡´å¯¼è‡´æ•°æ®è¿ç§»å›°éš¾ - å°½æ—©æ ‡å‡†åŒ–

---

## ğŸ“ å¤‡æ³¨

- æœ¬è®¡åˆ’éµå¾ªæ•´æ”¹è®¡åˆ’æ–‡æ¡£ä¸­çš„6å‘¨æ—¶é—´è¡¨
- ä¼˜å…ˆå¤„ç†P0çº§é˜»å¡é—®é¢˜
- æ‰€æœ‰ä¿®æ”¹ä»…é™docsæ–‡ä»¶å¤¹å†…çš„æ–‡æ¡£æ›´æ–°(æ ¹æ®workspaceè§„åˆ™)
- ä»£ç å®ç°å°†åœ¨ç”¨æˆ·ç¡®è®¤è®¡åˆ’åè¿›è¡Œ