# 报价模块整改计划

## 📋 整改目标

将报价模块完成度从 **45%** 提升至 **90%+**，修复47个差异点，实现生产级别的报价管理能力。

## 🎯 分阶段目标

| 阶段 | 周期 | 目标完成度 | 核心里程碑 |
|:---|:---:|:---:|:---|
| **短期** | Week 1-2 | 60% | 修复P0级差异，核心功能可用 |
| **中期** | Week 3-4 | 80% | 修复P1级差异，完善重要功能 |
| **长期** | Week 5-8 | 90%+ | 修复P2/P3级差异，优化用户体验 |

## 📅 详细周计划

### Week 1: 折扣风控体系 (P0)
- 添加数据库字段（approvalRequired, approverId, approvedAt）
- 实现折扣底线配置
- 实现审批工作流API
- 实现审批UI

### Week 2: 状态流转与转订单 (P0)
- 实现submitQuote、acceptQuote、rejectQuote API
- 实现lockQuote API
- 实现报价单转订单功能（含快照机制）
- 清理Mock代码

### Week 3: 查询API与房间管理 (P1)
- 实现报价单列表查询（分页、筛选、搜索）
- 实现报价单详情查询
- 实现版本历史查询
- 实现updateRoom和deleteRoom API

### Week 4: 报价模式配置 (P1)
- 实现租户级配置API
- 实现用户级配置API
- 实现配置加载逻辑（三级优先级）
- 实现配置UI（系统设置页面）

### Week 5: 测量数据导入 (P1)
- 设计映射规则（Measure → Quote）
- 实现自动匹配逻辑
- 实现手动关联UI
- 实现数据覆盖逻辑

### Week 6: 前端实时计算 (P1)
- 实现前端计算引擎（共享逻辑）
- 实现实时价格反馈
- 实现前后端一致性校验

### Week 7: UI/UX完善 (P2)
- 实现报价单Tab架构（总表+品类分表）
- 实现模式切换按钮和动画
- 实现嵌套附件UI
- 实现商品型号智能联想

### Week 8: 优化与测试 (P2/P3)
- 修复TenantId硬编码问题
- 统一字段单位（width/height为cm）
- 补充quotePlans需求文档
- 完善单元测试覆盖率

## 👥 资源需求

- **后端开发**: 2人全职 (32天工作量)
- **前端开发**: 1人全职 (24天工作量)
- **QA测试**: 1人兼职 (8天工作量)
- **总计**: 64人日 (3人并行8周完成)

## ⚠️ 关键风险

| 风险 | 等级 | 缓解措施 |
|:---|:---:|:---|
| 折扣审批流程与实际业务不符 | 🔴 高 | Week 1开发前与业务确认详细流程 |
| 测量数据映射逻辑复杂 | 🔴 高 | Week 5提前进行原型验证 |
| 前后端计算逻辑不一致 | 🟡 中 | Week 6实现双重校验机制 |
| 报价模式配置系统复杂度超预期 | 🟡 中 | 简化配置项，分阶段交付 |

## ✅ 验收标准

**功能**:
- ✅ 折扣风控体系100%可用
- ✅ 状态流转端到端可执行
- ✅ 报价单转订单功能完整
- ✅ 测量数据导入准确率≥95%
- ✅ 报价模式切换流畅

**性能**:
- ✅ 报价单列表加载 <2s
- ✅ 计算响应时间 <500ms
- ✅ 前端实时计算无延迟

**质量**:
- ✅ 单元测试覆盖率≥70%
- ✅ E2E测试覆盖核心Flow
- ✅ 无P0/P1 Bug