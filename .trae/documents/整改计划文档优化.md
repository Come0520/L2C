## 问题分析

1. **测试警告**：组件状态更新没有被包裹在 `act()` 函数中，导致测试警告
2. **组件实现与测试期望不一致**：

   * 测试期望加载状态显示 "Loading..." 文本，但实际显示骨架屏

   * 测试查找按钮时使用固定文本，而实际按钮文本包含动态数量
3. **组件实现问题**：

   * 缺少对 `timestamp` 和 `actor` 为 null/undefined 的处理

   * Timeline 组件的 `formatTimestamp` 函数未处理 null 值
4. **测试代码问题**：

   * 使用不准确的 DOM 位置比较

   * 查找元素的方式不够健壮

## 解决方案

### 1. 修复测试代码

* 将加载状态的断言从文本改为骨架屏元素

* 修改按钮查找方式，使用更灵活的选择器

* 改进日志顺序的断言方式

### 2. 修复组件实现

* 确保 Timeline 组件正确处理 null/undefined 值

* 优化 LeadActivityLog 组件的加载状态

* 确保所有事件类型都有对应的图标和颜色

### 3. 增强代码健壮性

* 添加类型检查和默认值

* 确保异步操作正确处理

* 优化测试的断言方式

## 具体实现步骤

1. **修改** **`lead-activity-log.test.tsx`**：

   * 更新加载状态的断言

   * 修改按钮查找方式

   * 改进日志顺序断言

2. **优化** **`timeline.tsx`**：

   * 增强 `formatTimestamp` 函数的健壮性

   * 确保 `getIcon` 函数正确处理所有情况

3. **改进** **`lead-activity-log.tsx`**：

   * 优化加载状态的实现

   * 确保事件转换时的类型安全

4. **运行测试验证修复效果**

