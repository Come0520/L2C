# 订单模块整改实施计划

## 整改范围
根据整改计划文档，将完成以下三大核心问题的整改：

### 1. 数据快照机制（P1 - 严重）
- 在 `orders` 表新增 `snapshot_data` (JSONB) 和 `snapshot_created_at` 字段
- 订单创建时自动生成快照，包含报价单完整数据和客户基础信息
- 订单详情页优先展示快照数据，防止历史订单数据随上游变更而改变

### 2. 状态流转优化（P1 - 严重）
- 新增 `PENDING_CONFIRMATION` (待确认深化图) 状态
- 在 `PENDING_PO` 和 `IN_PRODUCTION` 之间插入此状态
- 支持设计师上传深化图 → 客户/销售确认 → 触发进入生产的流程
- 更新状态流转图和业务规则

### 3. 流程功能完善（P2 - 重要）
- **物流轨迹查询**：设计并实现 LogisticsService，对接快递 100 API，在订单详情页展示物流时间轴
- **变更单机制**：新增 change_orders 表，支持在 `PENDING_PO` 和 `PENDING_CONFIRMATION` 状态下变更订单（加减商品、修改尺寸），一旦进入生产则禁止变更

## 实施步骤
1. **第1周**：数据快照机制（数据库扩展、业务逻辑调整）
2. **第2周**：状态流转优化（新增状态、更新流转逻辑）
3. **第3周**：物流轨迹查询（物流服务、API接口、前端组件）
4. **第4周**：变更单机制（数据表、业务逻辑、审批流程、API接口）
5. **第5周**：测试与文档（端到端测试、更新文档）

## 预期成果
- ✅ 订单数据完整性得到保障，历史订单数据可追溯
- ✅ 状态流转更加完善，覆盖所有业务场景
- ✅ 支持物流轨迹实时查询和订单变更，提升运营效率

## 注意事项
- 所有修改仅限于 docs 文件夹中的文档
- 需要同步更新相关的需求文档、API文档和流程图
- 保持与现有系统架构的一致性