# 质量门禁与工程化实施计划

## 1. 提交钩子完善 - 增加 `npm run test:ci`

**目标**：在提交前自动运行测试，确保代码质量

**实施步骤**：
- 修改 `.husky/pre-commit` 文件，在现有检查后添加 `npm run test:ci` 命令
- 确保测试命令在提交前执行，失败则阻止提交

## 2. 提交信息规范 - 引入 `commitlint`

**目标**：规范提交信息格式，提高代码可维护性

**实施步骤**：
- 安装 `commitlint` 及相关依赖
- 配置 `commitlint.config.js` 文件，使用 conventional commit 规范
- 添加 `commit-msg` 钩子，在提交前验证提交信息格式
- 更新 `package.json`，添加相关脚本

## 3. Bundle 分析脚本 - 新增 `npm run analyze` 与资源预算

**目标**：实现包体积分析，监控资源使用情况

**实施步骤**：
- 在 `package.json` 中添加 `analyze` 脚本，使用 `@next/bundle-analyzer`
- 配置资源预算，在构建时检查包体积
- 测试 `npm run analyze` 命令，确保生成正确的分析报告

## 4. 依赖治理 - 清理无用依赖与死代码

**目标**：移除冗余依赖和无用代码，优化项目结构

**实施步骤**：
- 运行 `npm run clean:unused` 检查无用依赖
- 运行 `npm run clean:deadcode` 检查死代码
- 移除识别出的无用依赖
- 删除或重构死代码
- 验证清理后的代码可以正常构建和运行

## 预期工作量

- 提交钩子完善：约 0.5 天
- 提交信息规范：约 0.5 天
- Bundle 分析脚本：约 0.5 天
- 依赖治理：约 1.5 天

## 验收标准

- 提交前自动运行测试，测试失败则阻止提交
- 提交信息必须符合 conventional commit 规范
- 可以通过 `npm run analyze` 生成包体积分析报告
- 移除所有无用依赖和死代码
- 代码通过所有 lint 和类型检查
- 项目可以正常构建和运行

## 技术栈

- **commitlint**：用于验证提交信息格式
- **husky**：用于管理 git 钩子
- **@next/bundle-analyzer**：用于包体积分析
- **depcheck**：用于检查无用依赖
- **ts-prune**：用于检查死代码

## 实施顺序

1. 提交钩子完善
2. 提交信息规范
3. Bundle 分析脚本
4. 依赖治理

这个顺序确保了基础的质量门禁先建立，然后再进行依赖治理，避免了治理过程中可能出现的问题影响到门禁功能。