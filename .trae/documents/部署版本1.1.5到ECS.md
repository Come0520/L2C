# 部署版本1.1.5到ECS

## 🔍 部署前准备

1. **环境检查**
   - 确认ECS服务器可正常访问（IP: 101.132.152.132）
   - 检查ECS上Docker和Docker Compose是否已安装
   - 验证当前部署环境状态

2. **配置准备**
   - 准备环境变量文件 `.env.production`
   - 确保SSL证书有效且已配置
   - 确认git标签v1.1.5已正确创建并推送

## 🚀 部署流程

1. **连接ECS服务器**
   ```bash
   ssh -i /Users/laichangcheng/Downloads/罗莱-圣都.pem root@101.132.152.132
   ```

2. **进入部署目录**
   ```bash
   cd /opt/l2c
   ```

3. **拉取最新代码**
   ```bash
   git pull origin main
   ```

4. **执行蓝绿部署脚本**
   ```bash
   ./scripts/deploy/blue-green-deploy.sh deploy v1.1.5
   ```
   
   部署脚本将执行以下操作：
   - 检查当前活动环境
   - 将新版本部署到非活动环境
   - 进行健康检查
   - 切换流量到新版本
   - 更新当前环境标记

## ✅ 验证部署

1. **查看部署状态**
   ```bash
   ./scripts/deploy/blue-green-deploy.sh status
   ```

2. **检查服务状态**
   ```bash
   docker-compose ps
   ```

3. **健康检查**
   ```bash
   curl -s https://www.luolai-sd.xin/api/health
   ```

4. **浏览器验证**
   - 访问 https://www.luolai-sd.xin
   - 检查登录页面是否正常显示
   - 验证核心功能是否正常工作

## 🔄 回滚方案

如果部署过程中出现问题，执行以下命令回滚：

```bash
./scripts/deploy/blue-green-deploy.sh rollback
```

回滚脚本将：
- 切换流量回旧版本环境
- 更新当前环境标记
- 保持旧版本容器以便调试

## 🧹 清理旧版本

部署成功后，可以清理旧版本容器：

```bash
./scripts/deploy/blue-green-deploy.sh finalize
```

## 📋 部署检查清单

- [ ] ECS服务器可正常访问
- [ ] Docker和Docker Compose已安装
- [ ] 环境变量配置正确
- [ ] SSL证书有效
- [ ] git标签v1.1.5已正确推送
- [ ] 部署脚本执行成功
- [ ] 服务状态正常
- [ ] 健康检查通过
- [ ] 浏览器访问正常
- [ ] 核心功能验证通过

## 📞 应急联系方式

- 技术支持：tech@luolai-sd.xin
- 运维团队：ops@luolai-sd.xin
- 备用联系：阿里云工单系统