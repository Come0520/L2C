## 1. 门店表 (store_stores) 设计调整

### 1.1 新增字段
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| channel_id | BIGINT | FOREIGN KEY REFERENCES channel_channels(id) | 所属渠道ID |
| in_store_sales_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 驻店销售ID |
| remote_sales_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 远程销售ID |
| order_service_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 订单客服ID |
| dispatcher_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 派单员ID |
| sales_manager_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 销售负责人ID |
| key_contact_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 关键对接人ID |

### 1.2 门店状态字段优化
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| status | SMALLINT | DEFAULT 1 | 门店状态：1-开店, 2-装修中, 3-闭店 |

### 1.3 完整表结构
```sql
CREATE TABLE store_stores (
    id BIGSERIAL PRIMARY KEY,
    store_name VARCHAR(100) NOT NULL COMMENT '门店名称',
    address TEXT NOT NULL COMMENT '门店地址',
    city VARCHAR(100) NOT NULL COMMENT '所在城市',
    contact_info VARCHAR(200) NOT NULL COMMENT '联系方式',
    channel_id BIGINT COMMENT '所属渠道ID',
    in_store_sales_id BIGINT COMMENT '驻店销售ID',
    remote_sales_id BIGINT COMMENT '远程销售ID',
    order_service_id BIGINT COMMENT '订单客服ID',
    dispatcher_id BIGINT COMMENT '派单员ID',
    sales_manager_id BIGINT COMMENT '销售负责人ID',
    key_contact_id BIGINT COMMENT '关键对接人ID',
    status SMALLINT DEFAULT 1 COMMENT '门店状态：1-开店, 2-装修中, 3-闭店',
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '创建时间',
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '更新时间',
    deleted_at TIMESTAMPTZ NULL COMMENT '删除时间(软删除)',
    
    INDEX idx_store_channel_id (channel_id),
    INDEX idx_store_in_store_sales_id (in_store_sales_id),
    INDEX idx_store_remote_sales_id (remote_sales_id),
    INDEX idx_store_order_service_id (order_service_id),
    INDEX idx_store_dispatcher_id (dispatcher_id),
    INDEX idx_store_sales_manager_id (sales_manager_id),
    INDEX idx_store_key_contact_id (key_contact_id),
    INDEX idx_store_status (status),
    INDEX idx_store_city (city),
    
    FOREIGN KEY (channel_id) REFERENCES channel_channels(id) ON DELETE SET NULL,
    FOREIGN KEY (in_store_sales_id) REFERENCES usr_users(id) ON DELETE SET NULL,
    FOREIGN KEY (remote_sales_id) REFERENCES usr_users(id) ON DELETE SET NULL,
    FOREIGN KEY (order_service_id) REFERENCES usr_users(id) ON DELETE SET NULL,
    FOREIGN KEY (dispatcher_id) REFERENCES usr_users(id) ON DELETE SET NULL,
    FOREIGN KEY (sales_manager_id) REFERENCES usr_users(id) ON DELETE SET NULL,
    FOREIGN KEY (key_contact_id) REFERENCES usr_users(id) ON DELETE SET NULL
);
```

## 2. 渠道表 (channel_channels) 设计

### 2.1 表结构
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 渠道ID |
| channel_name | VARCHAR(100) NOT NULL | | 渠道名称 |
| channel_level | SMALLINT NOT NULL | | 渠道级别：1-一级渠道, 2-二级渠道, 3-三级渠道 |
| involved_cities | TEXT | | 涉及的城市（多个城市用逗号分隔） |
| channel_manager_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 渠道负责人ID |
| channel_key_person_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) | 渠道关键人ID |
| channel_description | TEXT | | 渠道描述 |
| status | SMALLINT DEFAULT 1 | | 渠道状态：1-合作中, 2-未合作, 3-开发中 |
| created_at | TIMESTAMPTZ | DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ NULL | | 删除时间(软删除) |

### 2.2 完整表结构
```sql
CREATE TABLE channel_channels (
    id BIGSERIAL PRIMARY KEY,
    channel_name VARCHAR(100) NOT NULL COMMENT '渠道名称',
    channel_level SMALLINT NOT NULL COMMENT '渠道级别：1-一级渠道, 2-二级渠道, 3-三级渠道',
    involved_cities TEXT COMMENT '涉及的城市（多个城市用逗号分隔）',
    channel_manager_id BIGINT COMMENT '渠道负责人ID',
    channel_key_person_id BIGINT COMMENT '渠道关键人ID',
    channel_description TEXT COMMENT '渠道描述',
    status SMALLINT DEFAULT 1 COMMENT '渠道状态：1-合作中, 2-未合作, 3-开发中',
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '创建时间',
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '更新时间',
    deleted_at TIMESTAMPTZ NULL COMMENT '删除时间(软删除)',
    
    INDEX idx_channel_name (channel_name),
    INDEX idx_channel_level (channel_level),
    INDEX idx_channel_manager_id (channel_manager_id),
    INDEX idx_channel_key_person_id (channel_key_person_id),
    INDEX idx_channel_status (status)
);
```

## 3. 人员表 (usr_users) 设计调整

### 3.1 新增字段
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| is_external | BOOLEAN | DEFAULT FALSE | 是否为外部联系人 |
| external_company | VARCHAR(200) | | 外部联系人所属公司 |
| external_position | VARCHAR(100) | | 外部联系人职位 |

### 3.2 用户类型扩展
user_type字段取值范围：
- 1: 内部员工-驻店销售
- 2: 内部员工-远程销售
- 3: 内部员工-订单客服
- 4: 内部员工-派单员
- 5: 内部员工-销售负责人
- 6: 内部员工-渠道负责人
- 7: 外部联系人-渠道关键人
- 8: 外部联系人-门店关键对接人
- 9: 外部联系人-其他

### 3.3 完整表结构
```sql
CREATE TABLE usr_users (
    id BIGSERIAL PRIMARY KEY,
    user_type SMALLINT NOT NULL COMMENT '用户类型：1-驻店销售, 2-远程销售, 3-订单客服, 4-派单员, 5-销售负责人, 6-渠道负责人, 7-渠道关键人, 8-门店关键对接人, 9-其他',
    name VARCHAR(100) NOT NULL COMMENT '用户姓名',
    contact_info VARCHAR(200) NOT NULL COMMENT '联系方式',
    store_id BIGINT COMMENT '所属门店ID',
    is_external BOOLEAN DEFAULT FALSE COMMENT '是否为外部联系人',
    external_company VARCHAR(200) COMMENT '外部联系人所属公司',
    external_position VARCHAR(100) COMMENT '外部联系人职位',
    status SMALLINT DEFAULT 1 COMMENT '用户状态：1-启用, 2-禁用',
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '创建时间',
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW() COMMENT '更新时间',
    deleted_at TIMESTAMPTZ NULL COMMENT '删除时间(软删除)',
    
    INDEX idx_user_type (user_type),
    INDEX idx_user_store_id (store_id),
    INDEX idx_user_is_external (is_external),
    INDEX idx_user_status (status),
    
    FOREIGN KEY (store_id) REFERENCES store_stores(id) ON DELETE SET NULL
);
```

## 4. 关联关系图

```
渠道表 (channel_channels)
  ├── 1:N ──> 门店表 (store_stores)
  └── N:1 ──> 人员表 (usr_users) (渠道负责人、渠道关键人)

门店表 (store_stores)
  ├── N:1 ──> 渠道表 (channel_channels)
  └── N:1 ──> 人员表 (usr_users) (驻店销售、远程销售、订单客服、派单员、销售负责人、关键对接人)

人员表 (usr_users)
  ├── N:1 ──> 门店表 (store_stores) (内部员工所属门店)
  └── N:1 ──> 渠道表 (channel_channels) (渠道负责人、渠道关键人)
```

## 5. 索引优化

| 表名 | 索引字段 | 索引类型 | 描述 |
|------|----------|----------|------|
| store_stores | channel_id | INDEX | 按渠道查询门店 |
| store_stores | city | INDEX | 按城市查询门店 |
| store_stores | status | INDEX | 按状态查询门店 |
| channel_channels | channel_name | INDEX | 按名称查询渠道 |
| channel_channels | channel_level | INDEX | 按级别查询渠道 |
| channel_channels | status | INDEX | 按状态查询渠道 |
| usr_users | user_type | INDEX | 按用户类型查询 |
| usr_users | is_external | INDEX | 按是否为外部联系人查询 |
| usr_users | store_id | INDEX | 按所属门店查询 |

## 6. 实施步骤

1. 创建渠道表 (channel_channels)
2. 修改人员表 (usr_users)，增加外部联系人相关字段
3. 修改门店表 (store_stores)，增加关联字段和优化状态字段
4. 创建相关索引
5. 更新数据字典和文档

## 7. 注意事项

1. 所有外键关系都设置了ON DELETE SET NULL，确保数据完整性的同时避免级联删除问题
2. 状态字段使用SMALLINT类型，便于后续扩展和查询优化
3. 增加了必要的索引，提高查询性能
4. 遵循了之前的数据库设计规范，包括命名规范、数据类型规范等
5. 考虑了业务扩展性，便于后续增加新的用户类型和状态
6. 渠道表的"涉及的城市"字段使用TEXT类型，支持多个城市的存储需求

以上设计方案符合用户需求，同时遵循了数据库设计规范，确保了数据完整性、查询性能和业务扩展性。