# 项目上线前最佳实践检查与修复计划

## 1. 依赖管理与环境修复

### 1.1 修复ESLint配置问题
- 解决无法加载@typescript-eslint/parser的问题
- 确保ESLint配置与TypeScript 5.9.3兼容
- 重新安装或更新相关依赖

### 1.2 清理未使用的依赖
- 根据Knip工具的报告，移除49个未使用的依赖
- 重点清理：axios, react-markdown相关包, gray-matter, debug, dotenv等

## 2. TypeScript类型错误修复

### 2.1 系统性修复常见错误
- 修复created_at/updated_at与createdAt/updatedAt命名不一致问题
- 解决对象可能为undefined的错误
- 修复缺少必要属性的类型错误

### 2.2 重点模块修复
- 安装模块（installations）：修复InstallationCalendar等组件的类型错误
- 订单模块（orders）：修复订单状态管理和表单类型问题
- 测量模块（measurements）：修复测量数据类型定义
- 权限模块（permissions）：修复权限检查函数的类型错误

## 3. 代码质量与最佳实践

### 3.1 移除未使用的代码
- 删除266个未使用的导出
- 清理43个未使用的枚举成员
- 解决7个重复导出问题

### 3.2 代码组织优化
- 检查并优化组件和服务的分类
- 规范测试文件的组织
- 确保文件命名一致

## 4. 性能与安全优化

### 4.1 性能优化
- 确保所有组件都使用了React Compiler优化
- 检查并优化React Query缓存策略
- 确保虚拟滚动（React Virtual）在列表组件中正确使用

### 4.2 安全检查
- 确保所有API路由都有适当的权限检查
- 验证JWT认证和会话管理
- 检查CSP（Content Security Policy）配置

## 5. 测试与验证

### 5.1 运行完整测试套件
- 修复并运行单元测试（Vitest）
- 运行E2E测试（Playwright）
- 确保测试覆盖率达到80%以上

### 5.2 性能测试
- 使用Lighthouse CI运行性能测试
- 确保所有页面的性能评分达到A级别
- 检查打包大小，确保JavaScript chunks不超过500kB

## 6. 文档与配置

### 6.1 更新文档
- 确保技术栈文档（技术栈.md）与实际依赖版本一致
- 更新部署文档
- 确保所有配置文件都有适当的注释

### 6.2 配置优化
- 优化Next.js配置
- 确保Tailwind CSS v4配置正确
- 优化Sentry配置，确保错误追踪正常工作

## 实施步骤

1. **第一阶段（2天）**：修复依赖问题和ESLint配置
2. **第二阶段（3天）**：系统性修复TypeScript错误
3. **第三阶段（2天）**：清理未使用的代码和优化代码组织
4. **第四阶段（2天）**：性能与安全优化
5. **第五阶段（2天）**：运行测试套件和性能测试
6. **第六阶段（1天）**：更新文档和配置

## 预期结果

- ✅ TypeScript错误数量减少到0
- ✅ ESLint检查通过
- ✅ 移除所有未使用的依赖和代码
- ✅ 所有测试通过，覆盖率达到80%以上
- ✅ 性能评分达到A级别
- ✅ 代码符合最佳实践，易于维护和扩展

这个计划将确保项目在上线前遵循所有最佳实践，提高代码质量、性能和安全性。