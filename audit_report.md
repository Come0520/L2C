# Docker数据库与阿里云RDS数据库审计报告

## 一、Docker数据库信息

### 1. 连接信息

- **数据库类型**: PostgreSQL
- **连接地址**: localhost:5433
- **用户名**: l2c_user
- **密码**: l2c_dev_password
- **数据库名**: l2c_dev

### 2. 表结构统计

- **总表数**: 102 张表
- **总列数**: 约 2,500 列（平均每张表约 25 列）
- **总行数**: 约 2,000 行（部分表有数据）

### 3. 主要表分类

#### 用户与权限

- users (27 行) - 用户信息
- customers (42 行) - 客户信息
- roles (24 行) - 角色权限
- approval_flows (40 行) - 审批流程

#### 销售与订单

- orders (51 行) - 订单信息
- order_items (72 行) - 订单项
- quotes (248 行) - 报价单
- quote_items (397 行) - 报价单项

#### 产品与库存

- products (610 行) - 产品信息
- inventory (0 行) - 库存记录
- fabric_inventory (0 行) - 面料库存
- warehouses (0 行) - 仓库信息

#### 工单与安装

- work_orders (0 行) - 工单信息
- install_tasks (65 行) - 安装任务
- measure_tasks (51 行) - 测量任务

#### 财务与结算

- payment_orders (0 行) - 支付订单
- commission_records (0 行) - 佣金记录
- reconciliations (0 行) - 对账记录

## 二、阿里云RDS数据库信息

### 1. 连接信息

- **实例 ID**: pgm-uf6aq31y169c8wvl
- **内网地址**: pgm-uf6aq31y169c8wvl.pg.rds.aliyuncs.com
- **端口**: 5432
- **数据库名**: l2c
- **用户名**: l2c
- **密码**: I@rds2026

### 2. 网络配置

- **网络类型**: VPC (专有网络)
- **VPC ID**: vpc-uf67avnxee2wtucj14ujw
- **VSwitch ID**: vsw-uf62ri444r6suan8x0nrk
- **外网地址**: 未配置（需申请）

### 3. 访问限制

- **白名单配置**: 已添加公网IP 101.87.245.132
- **生效时间**: 配置后1分钟生效

## 三、差异分析（基于现有信息）

### 1. 已知差异

| 比较项       | Docker数据库     | RDS数据库 |
| ------------ | ---------------- | --------- |
| **数据库名** | l2c_dev          | l2c       |
| **用户名**   | l2c_user         | l2c       |
| **密码**     | l2c_dev_password | I@rds2026 |
| **网络类型** | 本地Docker       | VPC内网   |
| **端口**     | 5433             | 5432      |
| **数据量**   | 约2,000行        | 未知      |

### 2. 潜在差异（待确认）

#### 表结构差异

- Docker数据库有102张表，RDS数据库表数量未知
- 可能存在表结构不一致（字段类型、索引、约束）
- 可能存在数据同步延迟或缺失

#### 配置差异

- Docker数据库使用默认配置
- RDS数据库可能有优化配置（如参数组、性能调优）
- 备份策略可能不同

#### 安全配置

- Docker数据库无白名单限制
- RDS数据库有IP白名单限制
- 加密策略可能不同

## 四、审计建议

### 1. 网络连接建议

- **申请外网地址**: 从本地开发环境连接RDS需要申请外网地址
- **配置VPN**: 生产环境建议使用VPN连接VPC
- **测试连接**: 配置完成后使用psql测试连接

### 2. 数据同步建议

- **全量同步**: 首次同步时使用pg_dump/pg_restore全量迁移
- **增量同步**: 后续使用逻辑复制或CDC工具
- **数据验证**: 同步后验证数据一致性

### 3. 安全建议

- **最小权限原则**: 限制数据库用户权限
- **定期轮换密码**: 定期更新数据库密码
- **监控审计**: 开启RDS审计日志

### 4. 性能建议

- **RDS性能优化**: 配置参数组、读写分离
- **索引优化**: 根据查询模式优化索引
- **监控告警**: 配置性能监控和告警

## 五、下一步行动

1. **申请RDS外网地址**
2. **测试RDS连接**
3. **查询RDS表结构**
4. **比较表结构差异**
5. **制定数据同步计划**

---

**审计时间**: 2026-01-25
**审计工具**: Python脚本 + psycopg2
**审计状态**: 部分完成（待RDS连接测试）
