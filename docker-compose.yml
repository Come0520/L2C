version: '3.8'

services:
  supabase-db:
    image: public.ecr.aws/supabase/postgres:17.6.1.043
    container_name: supabase-db
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: postgres
      POSTGRES_USER: postgres
    ports:
      - '5432:5432'
    volumes:
      - supabase-db-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres"]
      interval: 5s
      timeout: 5s
      retries: 5

  supabase-studio:
    image: public.ecr.aws/supabase/studio:2025.11.25-sha-8de52c4
    container_name: supabase-studio
    restart: unless-stopped
    environment:
      - SUPABASE_URL=http://supabase-api:3000
      - SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGFiYXNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE2MjMwMzM5ODUsImV4cCI6MTkzODYwOTk4NX0.0000000000000000000000000000000000000000000000000000000000000000
    ports:
      - '3000:3000'
    depends_on:
      - supabase-db

  supabase-api:
    image: public.ecr.aws/supabase/postgrest:v13.0.7
    container_name: supabase-api
    restart: unless-stopped
    environment:
      - PGRST_DB_URI=postgres://postgres:postgres@supabase-db:5432/postgres
      - PGRST_OPENAPI_SERVER_PROXY_URI=http://localhost:8000
      - PGRST_JWT_SECRET=supabase-jwt-secret-123456789012345678901234-123456789012345678901234-123456789012345678901234
      - PGRST_DB_SCHEMA=public
    ports:
      - '8000:3000'
    depends_on:
      - supabase-db

  supabase-auth:
    image: public.ecr.aws/supabase/gotrue:v2.183.0
    container_name: supabase-auth
    restart: unless-stopped
    environment:
      - DATABASE_URL=postgres://postgres:postgres@supabase-db:5432/postgres
      - API_EXTERNAL_URL=http://localhost:9999
      - JWT_SECRET=supabase-jwt-secret-123456789012345678901234
      - GOTRUE_JWT_SECRET=supabase-jwt-secret-123456789012345678901234
      - DISABLE_SIGNUP=false
      - SITE_URL=http://localhost:3000
      - GOTRUE_SITE_URL=http://localhost:3000
      - GOTRUE_DB_DRIVER=postgres
      - GOTRUE_DB_HOST=supabase-db
      - GOTRUE_DB_PORT=5432
      - GOTRUE_DB_USER=postgres
      - GOTRUE_DB_PASSWORD=postgres
      - GOTRUE_DB_NAME=postgres
    ports:
      - '9999:9999'
    depends_on:
      - supabase-db

  supabase-storage:
    image: public.ecr.aws/supabase/storage-api:v1.32.0
    container_name: supabase-storage
    restart: unless-stopped
    environment:
      - ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGFiYXNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE2MjMwMzM5ODUsImV4cCI6MTkzODYwOTk4NX0.0000000000000000000000000000000000000000000000000000000000000000
      - SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGFiYXNlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTYyMzAzMzk4NSwiZXhwIjoxOTM4NjA5OTg1fQ.0000000000000000000000000000000000000000000000000000000000000000
      - POSTGREST_URL=http://supabase-api:3000
      - PGRST_JWT_SECRET=supabase-jwt-secret
      - DATABASE_URL=postgres://postgres:postgres@supabase-db:5432/postgres
      - FILE_SIZE_LIMIT=52428800
    ports:
      - '5001:5000'
    depends_on:
      - supabase-db
      - supabase-api

  supabase-realtime:
    image: public.ecr.aws/supabase/realtime:v2.65.3
    container_name: supabase-realtime
    restart: unless-stopped
    environment:
      - DB_HOST=supabase-db
      - DB_PORT=5432
      - DB_USER=postgres
      - DB_PASSWORD=postgres
      - DB_NAME=postgres
      - PORT=4000
      - API_JWT_SECRET=supabase-jwt-secret-123456789012345678901234
      - SECRET_KEY_BASE=supabase-secret-key-base-12345678901234567890123456789012345678901234567890123456
      - ERL_AFLAGS=-proto_dist inet_tcp
      - RLIMIT_NOFILE=1048576
    ports:
      - '4000:4000'
    depends_on:
      - supabase-db

volumes:
  supabase-db-data:
    driver: local