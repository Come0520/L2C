# 罗莱L2C销售管理系统 - 核心需求速查

> 本文档整合了项目规划、业务需求、功能规范和角色定义的核心内容,提供快速参考。

## 📌 项目核心信息

**项目名称**: 罗莱L2C销售管理系统  
**技术架构**: Next.js 15 + Supabase BaaS + PostgreSQL  
**项目类型**: 家居软装行业L2C完整销售服务流程管理  
**核心业务**: 从线索获取到现金回款(Lead to Cash)的全流程数字化  
**第一阶段**: MVP(8周) - 线索管理 + 销售单27状态流转 + 积分商城(优先)

---

## 🚀 上线计划

- 部署平台：阿里云 ECS（区域：上海 cn-shanghai）
- 操作系统：Ubuntu 22.04 64位
- 部署方式：代码上传至 ECS，采用容器化（Docker Compose）或 Node 进程管理（如 PM2）运行
- 服务器信息：详见项目根目录 `小秘密.md`（内部使用，勿外传）
- 生产建议：绑定域名与 HTTPS，开启系统防火墙与自动安全更新

---

## 🎯 核心业务目标

1. **L2C全流程管理**: 线索→销售单→测量→安装→回款完整闭环
2. **多品类支持**: 窗帘、墙布、墙咔三大核心品类
3. **状态机控制**: 销售单27状态精准流转管理
4. **积分激励**: 多节点积分发放 + 积分商城兑换(第一阶段重点)
5. **服务商管理**: 测量师/安装师智能派单与结算(第二阶段)

### MVP阶段开发重点

**优先开发**:
- ✅ 线索管理与分配
- ✅ 销售单27状态流转
- ✅ 积分发放与计算
- ✅ **积分商城系统**(优先开发)
- ✅ 基础报表分析

**第二阶段开发**:
- 测量单完整管理系统
- 安装单完整管理系统  
- 智能派单算法  
- 服务商绩效管理

---

## 👥 核心角色与权限

### 销售团队 (40%)
- **驻店销售**: 门店接待，线索录入/跟踪，草签/测量/安装确认
- **远程销售**: 线上跟踪，**推单处理**(上传圣都Home采购申请截图)
- **业务**: 大客户维护，线索分配，渠道合作

### 领导层 (20%)
- **销售负责人**: 团队管理，线索分配(最高权限)，绩效考核
- **领导LEAD_VIEWER**: 仅数据查看(无操作/审批权限)
- **系统管理员**: 系统配置，用户权限，数据备份

### 审批角色 (权限标签)
- **业务审批人**: 特殊折扣审批，报价审批，加急标签
- **财务审批人**: 预算/费用/付款审批
- **管理审批人**: 战略合同，组织调整，危机处理

### 交付团队 (20%)
- **订单客服**: 生产单号填写，备货管理，**推单确认**(审核采购申请截图)
- **派单员**: 测量/安装任务分配，工费计算
- **财务**: 发票开具(前置条件)→回款确认

### 服务商 (35%)
- **测量师**: 接单→上门测量→测量单生成
- **安装师**: 接单→上门安装→上传照片

### 外部合作 (罗莱好伙伴)
- **圣都设计师**: 方案设计，专业咨询，**积分激励**
- **圣都导购**: 产品推荐，客户引流，**积分激励**

### 客户 (小程序端)
- 订单状态查看，方案确认，物流跟踪，服务评价

---

## 🔄 销售单27状态流转

### 线索阶段 (5个状态)
1. **待分配** → 2. **待跟踪** → 3. **跟踪中** → 4. **草签** → 5. **已失效**

### 订单阶段 (15个状态)
6. **预算中** (草签后初始状态)  
7. **等待推单** (上传《预算报价单》后)  
8. **待测量** → 9. **测量中-待分配** → 10. **测量中-分配中** → 11. **测量中-待上门**  
12. **测量中-待确认** → 13. **方案待确认** → 14. **待推单**(方案确认后)  
15. **待下单** (订单客服确认采购需求后)  
16. **生产中** → 17. **备货完成**  
18. **安装中-待分配** → 19. **安装中-分配中** → 20. **安装中-待上门** → 21. **安装中-待确认**  
22. **待对账**

### 财务阶段 (2个状态)
23. **待回款** (财务开具发票并填写发票单号)  
24. **已完成** (回款确认完成)

### 异常状态 (5个状态)
25. **已取消** | 26. **暂停** | 27. **异常**

---

## 📋 关键业务流程

### 1. 线索管理核心流程

```
线索创建(驻店销售/业务/销售负责人)
  ↓ 
线索分配(销售负责人/业务/驻店销售 - 城市授权)
  ↓
线索跟踪(驻店/远程销售 - 添加标签: 产品类/装修阶段/意愿强度)
  ↓ 
预报价(上传Excel格式预报价文件 → 自动添加"quoted"标签 → 90天有效期)
  ↓
草签动作(完成报价单 → 在授权折扣范围内确定成交金额)
  ↓
订单创建(状态: 预算中)
```

**重复检查机制**:
- 高预警: 客户名称+地址完全相同
- 中预警: 客户名称相同,地址相似度>80%
- 低预警: 客户名称+设计师/导购组合相似

**跟踪提醒系统**(定时任务每日凌晨2点执行):
- 第7天: 首次跟踪提醒(系统消息+微信)
- 第30天: 重点跟踪提醒
- 第60天: 紧急跟踪提醒
- 第90天: 即将过期提醒
- "quoted"标签>10天未转化 → 自动添加"需维护"标签

### 2. 销售单关键流程

#### 预算报价单阶段
```
草签动作完成 → 初始状态"预算中"
  ↓
编制《预算报价单》(包含: 客户信息/商品清单/费用明细/施工方案/付款方式)
  ↓
上传《预算报价单》→ 状态自动转为"等待推单"
```

**预算报价单格式要求**:
- 文档编号: YS-YYYYMMDD合订单号后4位
- 必含模块: 客户信息/商品清单/费用明细/施工方案/付款方式
- 有效期: 30天

#### 推单与下单流程
```
等待推单 → 远程销售上传"圣都Home系统采购申请截图"
  ↓
订单客服审核采购需求 → 确认后状态变为"待下单"
  ↓
订单客服填写生产单号(可多个) → 状态"生产中"
  ↓
所有生产单号点击"备货完成" → 状态"备货完成"
```

**说明**: 推单是指圣都Home系统中发出采购申请,作为供货方需由订单客服确认采购需求后才能进入下单环节(防止未收款先下单风险)

#### 测量安装流程 (第一阶段简化)
```
方案待确认 → 销售上传客户确认图片 → 状态"待推单"
  ↓
安排安装 → 销售点击"安排安装" → 填写备注(进门密码等)
  ↓
派单员分配安装师 → 安装师接单→上门→上传照片
  ↓
销售确认安装 → 上传安装后图片 → 状态"待对账"
```

**第一阶段**: 测量/安装数据采用人工填写或表格上传  
**第二阶段**: 开发完整的测量单/安装单管理系统,智能派单功能

#### 财务回款流程
```
待对账 → 财务开具销售发票并填写发票单号 → 状态"待回款"
  ↓
财务上传回款图片并勾选对应单号 → 状态"已完成"
```

**重要**: 必须先开具发票才能进入回款环节(业务流程强制要求)

### 3. 积分激励体系 (第一阶段重点)

#### 积分获取规则

**线索相关积分**:
- 线索创建: +5分 | 线索跟进: +2分/次(每日上限10分)
- 线索转化: +10分 | 客户到店: +5分

**销售单相关积分**:
- 销售单创建: +5分 | 草签完成: +10分
- 测量完成: +15分 | 安装完成: +20分 | 销售单完成: +30分

**罗莱好伙伴积分** (在途积分机制):
- **圣都导购**: 订单金额 × 品类系数(窗帘0.8%/墙布0.6%/墙咔1.0%) | 最低50分,最高500分
- **圣都设计师**: 导购积分的50% | 最低25分,最高250分
- **发放时机**: 订单创建生产单(生产单号上传后)触发
- **在途积分**: 订单确认后积分先进入在途状态,订单验收后转为可用积分
- **首单奖励**: +100分 | 大单奖励(≥3万元): 额外订单金额×0.2%

#### 积分商城功能 (第一阶段优先开发)
- **礼品分类**: 电子产品/家居用品/礼品卡/其他
- **专属礼品**: 专业工具/培训课程/品牌产品/荣誉奖励/特权服务
- **核心功能**: 商品展示,积分兑换,订单管理,物流跟踪(简化)
- **移动端**: 小程序端优先适配

#### 积分计算公式
```
积分 = 成交金额 × 产品品类系数 × 时间段系数 × 门店系数
```

**可配置系数**(管理员可调节):
- 产品品类: 主推1.3倍(1.2-1.5) | 常规1.0倍 | 滞销0.9倍
- 时间段: 促销期1.5倍(1.2-1.8) | 淡季1.1倍 | 常规1.0倍
- 门店: 重点1.2倍 | 普通1.0倍 | 新开1.3倍(1.2-1.5)

---

## 📊 权限矩阵简化版

| 核心权限 | 驻店销售 | 远程销售 | 订单客服 | 派单员 | 测量/安装师 | 财务 | 销售负责人 | 领导查看 |
|---------|---------|---------|---------|--------|-----------|------|----------|---------|
| 线索创建 | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ |
| 线索分配 | 城市授权 | ✗ | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ |
| 草签操作 | ✓ | ✓ | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ |
| 推单上传 | ✗ | ✓(仅远程) | ✗ | ✗ | ✗ | ✗ | ✗ | ✗ |
| 推单确认 | ✗ | ✗ | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ |
| 派单管理 | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ | ✗ | ✗ |
| 接单/执行 | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ | ✗ |
| 发票开具 | ✗ | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| 回款确认 | ✗ | ✗ | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| 数据查看 | 个人 | 个人 | 全局 | 任务范围 | 个人任务 | 财务全局 | 团队全局 | 全局只读 |

---

## 🏗️ 技术架构演进

### MVP阶段: Next.js + Supabase BaaS架构
- **前端**: Next.js 15+ (App Router, Server Components, Server Actions)
- **后端**: Supabase BaaS (Auth, Database, Realtime, Storage, Edge Functions)
- **数据库**: PostgreSQL (Supabase托管)
- **部署**: Vercel + Supabase Cloud

### 扩展阶段: Serverless优化
- Edge Functions处理复杂业务逻辑
- 实时数据同步与通知
- 细粒度RLS策略优化

### 成熟期: 全Serverless架构
- 完整的事件驱动架构
- 边缘计算优化
- 全球CDN加速
- 自动扩缩容

---

## 📂 详细文档索引

### 项目规划
- [01-项目愿景与目标](./01-项目规划/01-项目愿景与目标.md) - 项目背景、目标、成功标准
- [02-需求规范](./01-项目规划/02-需求规范.md) - 需求概述与索引文档
- [02-业务需求分析](./01-项目规划/_详细版/02-业务需求分析.md) - 完整的市场分析、用户画像、需求分析
- [03-功能需求规范](./01-项目规划/_详细版/03-功能需求规范.md) - 详细的功能模块规范和业务流程
- [人物角色](./01-项目规划/_详细版/人物角色.md) - 完整的角色定义和权限矩阵

### 系统设计
- [02-架构设计](./02-系统设计/02-架构设计/) - 31个架构设计文档
- [03-模块设计](./02-系统设计/03-模块设计/) - 28个业务模块设计文档

### 开发实施
- [02-代码规范](./03-开发实施/02-代码规范.md)
- [08-端口分配规范](./03-开发实施/08-端口分配规范.md)
- [09-命名规范标准](./03-开发实施/09-命名规范标准.md)
- [10-环境变量配置规范](./03-开发实施/10-环境变量配置规范.md)
- [11-错误处理日志规范](./03-开发实施/11-错误处理日志规范.md)
- [12-安全规范最佳实践](./03-开发实施/12-安全规范最佳实践.md)
- [13-API设计版本管理规范](./03-开发实施/13-API设计版本管理规范.md)
- [14-数据库设计迁移规范](./03-开发实施/14-数据库设计迁移规范.md)
- [15-Git工作流代码提交规范](./03-开发实施/15-Git工作流代码提交规范.md)

---

## 🎨 快速查询索引

### 按角色查询
- **驻店销售**: 线索创建→跟踪→草签→测量/安装确认
- **远程销售**: 线索跟踪→草签→**推单上传**→测量/安装确认
- **订单客服**: 生产单号→备货管理→物流→**推单确认**
- **派单员**: 测量/安装任务分配
- **财务**: 发票开具→回款确认

### 按业务场景查询
- **线索导入**: [线索管理模块 > 1.2 Excel批量导入](./01-项目规划/03-功能需求规范.md#12-excel批量导入功能)
- **重复检查**: [线索管理模块 > 1.2 重复检查机制](./01-项目规划/03-功能需求规范.md#12-excel批量导入功能)
- **预报价**: [线索管理模块 > 1.7 预报价功能](./01-项目规划/03-功能需求规范.md#17-预报价功能)
- **状态流转**: [销售单管理模块 > 2.2 销售单状态流转](./01-项目规划/03-功能需求规范.md#22-销售单状态流转27个状态)
- **积分规则**: [积分激励体系 > 3.1 积分获取规则](./01-项目规划/03-功能需求规范.md#31-积分获取规则多节点激励)
- **积分商城**: [积分系统模块 > 4.3 积分商城功能](./01-项目规划/03-功能需求规范.md#43-积分商城功能第一阶段优先开发)

### 关键概念解释

**草签**: 业务动作(非状态),线索转化为订单的关键操作节点,完成后订单进入"预算中"状态

**推单**: 远程销售上传"圣都Home系统采购申请截图",由订单客服审核确认采购需求后,订单才能进入"待下单"状态

**在途积分**: 订单确认后积分先进入在途状态,保护公司权益,激励持续跟进,订单验收后转为可用积分

**城市授权分配**: 销售负责人/业务/驻店销售可担任城市授权分配人员,拥有该城市线索分配权限

**quoted标签**: 上传预报价Excel后自动添加,90天有效期,超过10天未转化自动添加"需维护"标签

---

**文档版本**: v1.0  
**创建日期**: 2025-11-28  
**维护人员**: 罗莱L2C项目组

**说明**: 本文档整合了`01-项目愿景与目标.md`、`02-业务需求分析.md`、`03-功能需求规范.md`、`人物角色.md`的核心内容。具体细节请查阅对应的详细文档。
