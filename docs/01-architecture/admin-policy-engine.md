# ADR: 管理策略引擎 (Admin Policy Engine)

## 状态
已决定 (Decided)

## 背景
当前系统权限完全依赖 RBAC 矩阵。随着业务复杂化，纯 RBAC 难以满足以下动态场景：
1. **时间窗限制**: 禁止在非办公时间内进行涉及全局配置的修改。
2. **频率控制**: 防止管理员误操作或恶意脚本短时间大规模修改权限。
3. **资源配额**: 需要根据租户套餐等级动态限制资产（角色、用户）数量。

## 决策
我们决定引入一个内置的**策略引擎 (Policy Engine)** 作为 RBAC 的增强层。

### 选择理由
1. **灵活性**: 预留了从 RBAC 向 ABAC 平滑迁移的能力，无需更改核心 Auth 逻辑。
2. **解耦**: 将复杂的复合校验逻辑从 Server Actions 中抽离到专门的策略模块。
3. **可扩展**: 采用插件式 `PolicyRule` 架构，易于增加新的拦截规则。

## 后果
- **性能**: 同步增加了几毫秒的策略评估开销（内存操作可忽略，数据库查询需谨慎）。
- **代码复杂度**: 开发者在编写管理类 Action 时需要额外考虑策略引擎的集成。
- **配置一致性**: 策略定义需要保持清晰，避免产生难以排查的“拒绝访问”逻辑。

## 后续演进
- 支持从数据库加载租户自定义策略。
- 引入更复杂的逻辑组合操作符 (AND/OR/NOT)。
