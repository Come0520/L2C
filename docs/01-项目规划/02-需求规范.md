# 罗莱L2C销售管理系统 - 需求规范说明书

## 1. 引言

### 1.1 项目概述
**项目名称：** 罗莱L2C销售管理系统
**技术栈：** Next.js 15+ (Web端) + Taro 3.x (小程序端) + Supabase BaaS + PostgreSQL
**项目类型：** 多品类销售服务管理平台
**核心业务：** 从线索到现金（L2C）的完整销售服务流程管理

### 1.2 市场背景与趋势
**行业现状**：家居软装市场规模庞大但数字化程度低，缺乏统一的服务平台。
**数字化趋势**：政策驱动产业数字化，消费者对透明度要求提升，云原生技术降低了实施成本。

### 1.3 技术架构演进
- **MVP阶段**：Next.js + Supabase BaaS，模块化单体架构，快速闭环。
- **扩展阶段**：引入Edge Functions处理复杂逻辑，Supabase Realtime实现实时同步。
- **成熟期**：全Serverless架构，事件驱动，全球CDN加速。

---

## 2. 用户角色与画像

### 2.1 销售团队
- **销售负责人**：负责区域/门店销售管理，拥有最高分配权限，关注全局数据和团队绩效。
- **驻店销售**：负责门店接待和线索跟进，需求实时订单跟踪和客户管理工具。
- **远程销售**：负责跨区域线索跟进和推单处理（上传圣都Home系统采购申请截图），拥有推单权限。
- **订单客服**：负责订单审核、转录和物流跟踪，对接帘客云系统。

### 2.2 服务提供商
- **测量师**：提供精准测量服务，需求智能派单和收入透明。
- **安装师**：负责上门安装，需求详细任务信息和质量反馈机制。
- **派单员**：负责任务调度和资源协调。

### 2.3 管理层
- **财务专员**：负责对账、回款确认和收入核算。
- **审批员**：负责跨部门协调和流程审批。
- **系统管理员**：负责系统运维和配置。

### 2.4 外部合作伙伴（罗莱好伙伴）
- **圣都设计师**：提供设计方案，获取积分激励。
- **圣都导购**：协助销售，获取积分激励。

---

## 3. 核心业务目标

1.  **L2C全流程数字化**：打通线索→商机→报价→订单→交付→回款全链路。
2.  **三单体系管理**：建立销售单（27状态）、测量单、安装单的关联流转。
3.  **积分激励体系**：构建多节点、多维度的积分发放与商城兑换闭环。
4.  **服务商管理**：实现技能认证、智能派单和绩效考核（第二阶段）。

---

## 4. 功能模块详细规范

### 4.1 线索管理模块
- **线索录入**：支持单条录入和Excel批量导入（1000+条），自动查重（名称+地址）。
- **分配机制**：
    - 销售负责人可跨部门分配。
    - 业务人员仅限同部门分配。
    - 支持按城市、负载均衡自动分配。
- **状态流转**：待分配 → 待跟踪 → 跟踪中 → 草签 → 已关闭。
- **预警系统**：7天/15天/30天分级未跟进预警。
- **推单职责**：仅远程销售可进行推单操作（上传采购申请截图），需在草签阶段完成后进行。

### 4.2 销售单管理模块（核心）
- **27状态流转**：
    - **线索阶段**：待分配、待跟踪、跟踪中、草签、已关闭。
    - **订单阶段**：待下单、待审核、待测量、测量中-待分配、测量中-已分配、测量中-已完成、方案确认、待复尺、复尺中、复尺完成、待生产、生产中、生产完成、待发货、已发货。
    - **财务阶段**：待收款、部分收款、已收款。
    - **交付阶段**：待安装、安装中-待分配、安装中-已分配、安装中-已完成、已完成。
    - **异常状态**：已取消、已退单、异常挂起。
- **三单关联**：销售单自动触发测量单和安装单生成。
- **异常处理**：支持状态回退和挂起流程。

### 4.3 积分激励模块
- **积分计算**：`积分 = 成交金额 × 产品系数 × 时间系数 × 门店系数`。
- **发放节点**：线索创建、跟进记录、状态转化、订单成交。
- **在途积分**：订单确认后积分冻结，回款/验收后解冻。
- **积分商城**：支持礼品兑换、库存管理、物流跟踪。

### 4.4 报表分析模块
- **L2C漏斗**：线索转化率、销售周期分析。
- **销售报表**：状态分布、金额趋势、团队业绩。
- **积分报表**：发放统计、兑换分析、成本核算。

### 4.5 系统集成模块
- **VSS系统**：订单和生产信息双向同步。
- **微信集成**：扫码登录、消息推送。
- **外部接口**：2B合作伙伴积分推送接口、小程序API。

---

## 5. 非功能需求

### 5.1 性能要求
- API响应时间 < 1秒。
- 支持并发用户数 1000+。
- 数据一致性达到 99.9%。

### 5.2 安全要求
- **认证**：JWT + OAuth 2.0。
- **权限**：基于RLS（Row Level Security）的数据权限控制。
- **审计**：完整记录关键操作日志。

### 5.3 用户体验
- 全中文界面。
- 移动端适配（特别是施工员日程表）。
- 简化操作流程（一键导航、智能填充）。

---

## 6. 数据库设计

### 6.1 核心数据表（18张）
1.  `users`: 用户表（含角色、门店）
2.  `leads`: 线索表
3.  `sales_orders`: 销售单表（27状态）
4.  `sales_contents`: 销售内容/商品配置
5.  `measurement_orders`: 测量单表
6.  `installation_orders`: 安装单表
7.  `product_lib`: 商品库
8.  `service_providers`: 服务商信息
9.  `point_logs`: 积分流水
10. `gifts`: 礼品表
11. `gift_exchanges`: 兑换记录
12. `roles_permissions`: 权限配置
13. `system_configs`: 系统配置
14. `operation_logs`: 操作日志
15. `notifications`: 通知消息
16. `attachments`: 附件表
17. `address_lib`: 地址库
18. `dictionaries`: 字典表

### 6.2 数据策略
- **强一致性**：核心交易数据。
- **最终一致性**：统计和日志数据。
- **分阶段演进**：MVP单库 → 读写分离 → 分库分表。

---

## 7. 交付与验收

### 7.1 交付物
- 源代码（Git仓库）
- 数据库迁移脚本
- 系统部署文档
- 用户操作手册

### 7.2 验收标准
- 核心业务流程（线索→回款）100%跑通。
- 27个订单状态流转无误。
- 积分计算准确，商城兑换功能正常。
- 页面加载速度符合性能指标。
