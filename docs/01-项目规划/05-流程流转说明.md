# 27状态流程图 - 前端真实实现角色权限泳道图

## 基于前端实际状态定义的角色权限矩阵泳道图（27个状态）

```mermaid
graph TB
    %% 定义角色泳道（纵轴）- 基于前端实际角色配置
    subgraph 客户 [👤 OTHER_CUSTOMER 客户]
        direction LR
        CUST_报价[CUST: 接收报价单
        📱 小程序推送
        📎 报价单签字]
        CUST_方案[CUST: 方案确认
        📱 小程序操作
        📎 方案确认单]
        CUST_安装[CUST: 安装时间沟通
        📱 小程序互动
        📎 安装时间确认]
        CUST_验收[CUST: 安装验收
        📱 小程序操作
        📎 验收签字]
        CUST_评价[CUST: 服务评价
        📱 小程序操作
        📎 评价内容]
    end
    
    subgraph 销售代表 [👨‍💼 SALES_STORE/SALES_REMOTE/SALES_CHANNEL 销售代表]
        direction LR
        SALE_线索[SALE: 线索跟踪
        📋 查看权限
        📎 跟进记录]
        SALE_测量[SALE: 安排测量
        ⚡ 操作权限
        📎 测量申请]
        SALE_方案[SALE: 方案确认
        ⚡ 操作权限
        📎 方案确认单]
        SALE_推单[SALE: 推单处理
        ⚡ 操作权限
        📎 推单截图]
        SALE_下单[SALE: 下单确认
        ⚡ 操作权限
        📎 生产单号]
        SALE_安装[SALE: 安排安装
        ⚡ 操作权限
        📎 安装申请]
        SALE_确认[SALE: 安装确认
        ⚡ 操作权限
        📎 安装照片]
    end
    
    subgraph 销售负责人 [👔 SALES_MANAGER 销售负责人]
        direction LR
        MANAGER_分配[MANAGER: 分配门店线索
        ⚡ 操作权限
        📎 分配记录]
        MANAGER_监督[MANAGER: 团队监督
        📋 查看权限
        📎 团队数据]
    end
    
    subgraph 业务 [💼 BUSINESS 业务]
        direction LR
        BUSINESS_线索[BUSINESS: 管理自己线索
        ⚡ 操作权限
        📎 线索分配]
        BUSINESS_大客户[BUSINESS: 大客户管理
        ⚡ 操作权限
        📎 客户资料]
    end
    
    subgraph 派单员 [📋 SERVICE_DISPATCH 派单员]
        direction LR
        DISPATCH_测量[DISPATCH: 分配测量师
        ⚡ 操作权限
        📎 派单记录]
        DISPATCH_安装[DISPATCH: 分配安装师
        ⚡ 操作权限
        📎 派单记录]
    end
    
    subgraph 测量师 [📏 SERVICE_MEASURE 测量师]
        direction LR
        MEASURE_接单[MEASURE: 接单确认
        ⚡ 操作权限
        📎 接单记录]
        MEASURE_上门[MEASURE: 上门测量
        ⚡ 操作权限
        📎 测量数据]
        MEASURE_完成[MEASURE: 完成测量
        ⚡ 操作权限
        📎 测量报告]
    end
    
    subgraph 安装师 [🔧 SERVICE_INSTALL 安装师]
        direction LR
        INSTALL_接单[INSTALL: 接单确认
        ⚡ 操作权限
        📎 接单记录]
        INSTALL_上门[INSTALL: 上门安装
        ⚡ 操作权限
        📎 安装照片]
        INSTALL_完成[INSTALL: 完成安装
        ⚡ 操作权限
        📎 安装报告]
    end
    
    subgraph 财务 [💰 OTHER_FINANCE 对账员]
        direction LR
        FINANCE_对账[FINANCE: 订单对账
        ⚡ 操作权限
        📎 对账单]
        FINANCE_开票[FINANCE: 开具发票
        ⚡ 操作权限
        📎 发票单号]
        FINANCE_回款[FINANCE: 回款确认
        ⚡ 操作权限
        📎 回款凭证]
    end
    
    subgraph 设计师 [🎨 PARTNER_DESIGNER 设计师]
        direction LR
        DESIGN_创建[DESIGN: 设计方案创建
        ⚡ 操作权限
        📎 设计图纸]
        DESIGN_管理[DESIGN: 设计图纸管理
        ⚡ 操作权限
        📎 设计文件]
        DESIGN_沟通[DESIGN: 客户沟通记录
        ⚡ 操作权限
        📎 沟通记录]
    end
    
    subgraph 导购 [🛍️ PARTNER_GUIDE 导购]
        direction LR
        GUIDE_录入[GUIDE: 客户信息录入
        ⚡ 操作权限
        📎 客户资料]
        GUIDE_查看[GUIDE: 产品信息查看
        📋 查看权限
        📎 产品资料]
        GUIDE_管理[GUIDE: 引流记录管理
        ⚡ 操作权限
        📎 引流记录]
    end
    
    subgraph 订单客服 [📦 DELIVERY_SERVICE 订单客服]
        direction LR
        SERVICE_备货[SERVICE: 备货管理
        ⚡ 操作权限
        📎 备货记录]
        SERVICE_发货[SERVICE: 发货管理
        ⚡ 操作权限
        📎 发货记录]
        SERVICE_物流[SERVICE: 物流管理
        📋 查看权限
        📎 物流信息]
    end
    
    subgraph 审批人 [✅ APPROVER_BUSINESS/ FINANCIAL/ MANAGEMENT 审批人]
        direction LR
        APPROVE_业务[APPROVE: 业务审批
        ⚡ 操作权限
        📎 审批意见]
        APPROVE_财务[APPROVE: 对账员审批
        ⚡ 操作权限
        📎 审批记录]
        APPROVE_管理[APPROVE: 管理审批
        ⚡ 操作权限
        📎 审批文件]
    end
    
    subgraph 管理员 [👨‍💻 LEAD_ADMIN 系统管理员]
        direction LR
        ADMIN_全部[ADMIN: 全权限管理
        🔓 全部权限
        📊 系统监控
        📎 系统日志]
    end
    
    %% 定义单据状态（横轴）- 基于前端ORDER_STATUS常量
    subgraph 单据状态流
        direction TB
        STATUS_待分配[🔴 待分配
        ORDER_STATUS.PENDING_ASSIGNMENT]
        STATUS_待跟踪[🟡 待跟踪
        ORDER_STATUS.PENDING_TRACKING]
        STATUS_跟踪中[🔵 跟踪中
        ORDER_STATUS.TRACKING]
        STATUS_草签[🟢 草签
        ORDER_STATUS.DRAFT_SIGNED]
        STATUS_待测量[� 待测量
        ORDER_STATUS.PENDING_MEASUREMENT]
        STATUS_测量中待分配[� 测量中-待分配
        ORDER_STATUS.MEASURING_PENDING_ASSIGNMENT]
        STATUS_测量中分配中[🟡 测量中-分配中
        ORDER_STATUS.MEASURING_ASSIGNING]
        STATUS_测量中待上门[� 测量中-待上门
        ORDER_STATUS.MEASURING_PENDING_VISIT]
        STATUS_测量中待确认[� 测量中-待确认
        ORDER_STATUS.MEASURING_PENDING_CONFIRMATION]
        STATUS_方案待确认[� 方案待确认
        ORDER_STATUS.PLAN_PENDING_CONFIRMATION]
        STATUS_待推单[� 待推单
        ORDER_STATUS.PENDING_PUSH]
        STATUS_待下单[🟡 待下单
        ORDER_STATUS.PENDING_ORDER]
        STATUS_生产中[⚫ 生产中
        ORDER_STATUS.IN_PRODUCTION]
        STATUS_备货完成[🟢 备货完成
        ORDER_STATUS.STOCK_PREPARED]
        STATUS_待发货[🔴 待发货
        ORDER_STATUS.PENDING_SHIPMENT]
        STATUS_已发货[🔵 已发货
        ORDER_STATUS.SHIPPED]
        STATUS_安装中待分配[🟡 安装中-待分配
        ORDER_STATUS.INSTALLING_PENDING_ASSIGNMENT]
        STATUS_安装中分配中[🔵 安装中-分配中
        ORDER_STATUS.INSTALLING_ASSIGNING]
        STATUS_安装中待上门[🟢 安装中-待上门
        ORDER_STATUS.INSTALLING_PENDING_VISIT]
        STATUS_安装中待确认[🟣 安装中-待确认
        ORDER_STATUS.INSTALLING_PENDING_CONFIRMATION]
        STATUS_已交付[🟢 已交付
        ORDER_STATUS.DELIVERED]
        STATUS_待对账[🔴 待对账
        ORDER_STATUS.PENDING_RECONCILIATION]
        STATUS_待开发票[🟡 待开发票
        ORDER_STATUS.PENDING_INVOICE]
        STATUS_待回款[🔵 待回款
        ORDER_STATUS.PENDING_PAYMENT]
        STATUS_已完成[✅ 已完成
        ORDER_STATUS.COMPLETED]
        STATUS_已取消[❌ 已取消
        ORDER_STATUS.CANCELLED]
    end

    %% 角色与状态的关系连接 - 基于前端实际权限控制
    CUST_报价 -.-> STATUS_草签
    CUST_方案 -.-> STATUS_方案待确认
    CUST_安装 -.-> STATUS_安装中待上门
    CUST_验收 -.-> STATUS_已完成
    CUST_评价 -.-> STATUS_已完成
    
    SALE_线索 -.-> STATUS_待分配
    SALE_测量 -.-> STATUS_待测量
    SALE_方案 -.-> STATUS_方案待确认
    SALE_推单 -.-> STATUS_待推单
    SALE_下单 -.-> STATUS_待下单
    SALE_安装 -.-> STATUS_安装中待分配
    SALE_确认 -.-> STATUS_安装中待确认
    
    MANAGER_分配 -.-> STATUS_待分配
    MANAGER_监督 -.-> STATUS_待分配
    
    BUSINESS_线索 -.-> STATUS_待分配
    BUSINESS_大客户 -.-> STATUS_待分配
    
    DISPATCH_测量 -.-> STATUS_测量中待分配
    DISPATCH_安装 -.-> STATUS_安装中待分配
    
    MEASURE_接单 -.-> STATUS_测量中分配中
    MEASURE_上门 -.-> STATUS_测量中待上门
    MEASURE_完成 -.-> STATUS_测量中待确认
    
    INSTALL_接单 -.-> STATUS_安装中分配中
    INSTALL_上门 -.-> STATUS_安装中待上门
    INSTALL_完成 -.-> STATUS_安装中待确认
    
    SERVICE_备货 -.-> STATUS_生产中
    SERVICE_发货 -.-> STATUS_待发货
    SERVICE_物流 -.-> STATUS_待发货
    
    FINANCE_对账 -.-> STATUS_待对账
    FINANCE_开票 -.-> STATUS_待开发票
    FINANCE_回款 -.-> STATUS_待回款
    
    ADMIN_全部 -.-> STATUS_已取消
    
    %% 状态流转连接
    STATUS_待分配 --> STATUS_待跟踪
    STATUS_待跟踪 --> STATUS_跟踪中
    STATUS_跟踪中 --> STATUS_草签
    STATUS_草签 --> STATUS_待测量
    STATUS_待测量 --> STATUS_测量中待分配
    STATUS_测量中待分配 --> STATUS_测量中分配中
    STATUS_测量中分配中 --> STATUS_测量中待上门
    STATUS_测量中待上门 --> STATUS_测量中待确认
    STATUS_测量中待确认 --> STATUS_方案待确认
    STATUS_方案待确认 --> STATUS_待推单
    STATUS_待推单 --> STATUS_待下单
    STATUS_待下单 --> STATUS_生产中
    STATUS_生产中 --> STATUS_备货完成
    STATUS_备货完成 --> STATUS_待发货
    STATUS_待发货 --> STATUS_已发货
    STATUS_已发货 --> STATUS_安装中待分配
    STATUS_安装中待分配 --> STATUS_安装中分配中
    STATUS_安装中分配中 --> STATUS_安装中待上门
    STATUS_安装中待上门 --> STATUS_安装中待确认
    STATUS_安装中待确认 --> STATUS_已交付
    STATUS_已交付 --> STATUS_待对账
    STATUS_待对账 --> STATUS_待开发票
    STATUS_待开发票 --> STATUS_待回款
    STATUS_待回款 --> STATUS_已完成
    
    %% 取消流转
    STATUS_待分配 --> STATUS_已取消
    STATUS_待跟踪 --> STATUS_已取消
    STATUS_跟踪中 --> STATUS_已取消
    STATUS_草签 --> STATUS_已取消
    STATUS_待测量 --> STATUS_已取消
    STATUS_测量中待分配 --> STATUS_已取消
    STATUS_测量中分配中 --> STATUS_已取消
    STATUS_测量中待上门 --> STATUS_已取消
    STATUS_测量中待确认 --> STATUS_已取消
    STATUS_方案待确认 --> STATUS_已取消
    STATUS_待推单 --> STATUS_已取消
    STATUS_待下单 --> STATUS_已取消
    STATUS_生产中 --> STATUS_已取消
    STATUS_备货完成 --> STATUS_已取消
    STATUS_待发货 --> STATUS_已取消
    STATUS_已发货 --> STATUS_已取消
    STATUS_安装中待分配 --> STATUS_已取消
    STATUS_安装中分配中 --> STATUS_已取消
    STATUS_安装中待上门 --> STATUS_已取消
    STATUS_安装中待确认 --> STATUS_已取消
    STATUS_已交付 --> STATUS_已取消
    STATUS_待对账 --> STATUS_已取消
    STATUS_待开发票 --> STATUS_已取消
    STATUS_待回款 --> STATUS_已取消
  ```

## 📊 基于前端真实实现的角色权限矩阵详细表

### 权限图标说明
- ⚡ 操作权限：可以执行状态变更操作
- 📋 查看权限：只能查看相关信息  
- 🔓 全部权限：拥有完整管理权限
- 📎 附件要求：需要上传的相关文件

### 🎯 前端实际角色权限对照表

**重要权限说明：**
- **客户权限**：目前C端客户无Web端查看权限，仅通过小程序接收报价单、签字确认、沟通安装时间
- **线索分配权限**：仅销售负责人可分配负责门店的线索，业务可分配自己添加的线索，其他人无分配按钮权限

| 前端角色编码 | 角色名称 | 单据状态 | 权限类型 | 具体操作 | 必需附件 |
|--------------|----------|----------|----------|----------|----------|
| **OTHER_CUSTOMER** | 客户 | 草稿状态 | � 小程序推送 | 接收报价单、签字确认 | 📄 报价单签字 |
| | | 设计已批准 | � 小程序操作 | 签字确认设计方案 | 📄 方案确认单 |
| | | 生产完成状态 | 📱 小程序互动 | 沟通安装时间安排 | 📄 安装时间确认 |
| | | 已完成状态 | 📱 小程序操作 | 验收安装结果、服务评价 | 📄 验收签字、评价内容 |
| | | | | | |
| **SALES_STORE** | 驻店销售 | 待分配状态 | 📋 查看权限 | 线索跟踪 | 📎 跟进记录 |
| | | 草稿状态 | ⚡ 操作权限 | 线索跟踪 | 📎 跟进记录 |
| **SALES_REMOTE** | 远程销售 | 待分配状态 | 📋 查看权限 | 线索跟踪 | 📎 跟进记录 |
| | | 待审批状态 | ⚡ 操作权限 | 提交审批申请 | 📎 审批材料 |
| **SALES_CHANNEL** | 业务 | 待分配状态 | ⚡ 操作权限 | 管理自己添加的线索、分配线索 | 📎 线索管理、分配记录 |
| | | 草稿状态 | ⚡ 操作权限 | 管理自己添加的线索 | 📎 线索管理 |
| | | 待设计状态 | ⚡ 操作权限 | 安排测量、创建测量需求 | 📎 测量申请 |
| | | 设计已批准 | ⚡ 操作权限 | 确认设计方案 | 📎 方案确认单 |
| | | 待生产状态 | ⚡ 操作权限 | 推单处理、上传推单截图 | 📎 推单截图 |
| | | 生产中状态 | ⚡ 操作权限 | 下单确认、填写生产单号 | 📎 生产单号 |
| | | 生产完成状态 | ⚡ 操作权限 | 安排安装、创建安装需求 | 📎 安装申请 |
| | | 已完成状态 | ⚡ 操作权限 | 安装确认、上传安装照片 | 📎 安装照片 |
| | | | | | |
| **SERVICE_DISPATCH** | 派单员 | 待设计状态 | ⚡ 操作权限 | 分配测量师 | 📎 派单记录 |
| | | 生产完成状态 | ⚡ 操作权限 | 分配安装师 | 📎 派单记录 |
| | | | | | |
| **SERVICE_MEASURE** | 测量师 | 待设计状态 | ⚡ 操作权限 | 接单确认、接受测量任务 | 📎 接单记录 |
| | | 设计中状态 | ⚡ 操作权限 | 上门测量、执行现场测量 | 📎 测量数据 |
| | | 设计已批准 | ⚡ 操作权限 | 完成测量、提交测量报告 | 📎 测量报告 |
| | | | | | |
| **SERVICE_INSTALL** | 安装师 | 生产完成状态 | ⚡ 操作权限 | 接单确认、接受安装任务 | 📎 接单记录 |
| | | 已发货状态 | ⚡ 操作权限 | 上门安装、执行现场安装 | 📎 安装照片 |
| | | 已交付状态 | ⚡ 操作权限 | 完成安装、提交安装报告 | 📎 安装报告 |
| | | | | | |
| **OTHER_FINANCE** | 对账员 | 已交付状态 | ⚡ 操作权限 | 订单对账、核对订单金额 | � 对账单 |
| | | 已交付状态 | ⚡ 操作权限 | 开具发票、填写发票单号 | 📎 发票单号 |
| | | 已完成状态 | ⚡ 操作权限 | 回款确认、确认收款凭证 | 📎 回款凭证 |
| | | | | | |
| **PARTNER_DESIGNER** | 设计师 | 待设计状态 | ⚡ 操作权限 | 创建设计方案 | 📎 设计图纸 |
| | | 设计中状态 | ⚡ 操作权限 | 管理设计图纸 | 📎 设计文件 |
| | | 设计已批准 | ⚡ 操作权限 | 客户沟通记录 | 📎 沟通记录 |
| | | | | | |
| **PARTNER_GUIDE** | 导购 | 待分配状态 | 📋 查看权限 | 客户信息查看 | 📎 客户资料 |
| | | 草稿状态 | 📋 查看权限 | 产品信息查看 | 📎 产品资料 |
| | | | | | |
| **DELIVERY_SERVICE** | 订单客服 | 待生产状态 | ⚡ 操作权限 | 备货管理、更新备货状态 | 📎 备货记录 |
| | | 生产完成状态 | ⚡ 操作权限 | 发货管理、创建发货记录 | 📎 发货记录 |
| | | 已发货状态 | 📋 查看权限 | 物流管理、跟踪物流状态 | 📎 物流信息 |
| | | | | | |
| **APPROVER_BUSINESS** | 业务审批人 | 待审批状态 | ⚡ 操作权限 | 业务审批、审批订单申请 | 📎 审批意见 |
| **APPROVER_FINANCIAL** | 财务审批人 | 待审批状态 | ⚡ 操作权限 | 财务审批、审批预算申请 | 📎 审批记录 |
| **APPROVER_MANAGEMENT** | 管理审批人 | 待审批状态 | ⚡ 操作权限 | 管理审批、审批重大决策 | 📎 审批文件 |
| | | | | | |
| **SALES_MANAGER** | 销售负责人 | 待分配状态 | ⚡ 操作权限 | 分配负责门店的线索（优先分配给所在城市的门店销售，其次分配给远程销售支持） | 📎 分配记录 |
| | | 全部状态 | 📋 查看权限 | 团队数据监督 | 📎 团队数据 |
| | | | | | |
| **BUSINESS** | 业务 | 待分配状态 | ⚡ 操作权限 | 分配自己添加的线索（优先分配给所在城市的门店销售，其次分配给远程销售支持） | 📎 线索分配 |
| | | 全部状态 | 📋 查看权限 | 大客户管理 | 📎 客户资料 |
| | | | | | |
| **LEAD_CHANNEL** | 渠道负责人 | 待分配状态 | 📋 查看权限 | 查看待分配线索 | 📎 线索列表 |
| | | 全部状态 | 📋 查看权限 | 渠道数据监督 | 📎 渠道数据 |
| | | | | | |
| **LEAD_GENERAL** | 领导 | 待分配状态 | 📋 查看权限 | 查看待分配线索 | 📎 线索列表 |
| | | 全部状态 | 📋 查看权限 | 团队数据监督 | 📎 团队数据 |
| | | | | | |
| **LEAD_ADMIN** | 系统管理员 | 全部状态 | 🔓 全部权限 | 系统监控、用户管理、权限配置 | � 系统日志 |
| | 开具发票 | ⚡ 操作 | 创建销售发票 | � 发票单号 |
| | 回款确认 | ⚡ 操作 | 确认收款到账 | 📎 回款凭证 |
| | 状态查看 | � 查看 | 查看财务状态 | 无 |

## 🔄 基于前端真实实现的状态流转触发条件

### 正常流程流转条件

| 当前状态 | 目标状态 | 触发条件 | 执行角色 | 必需附件 | 说明 |
|----------|----------|----------|----------|----------|------|
| 待分配 | 待跟踪 | 销售负责人/业务分配线索 | 销售负责人/业务 | 📎 分配记录 | 线索单状态 |
| 待跟踪 | 跟踪中 | 销售人员点击跟踪按钮 | 销售人员 | 📎 跟踪记录 | 线索单状态 |
| 跟踪中 | 草签 | 客户初步同意，准备进入测量阶段 | 销售人员 | 📎 草签记录 | 线索单状态 |
| 草签 | 待测量 | 销售人员生成报价单 | 销售人员 | 📎 报价单 | 报价单状态 |
| 待测量 | 测量中-待分配 | 销售人员点击"去测量"按钮 | 销售人员 | 📎 测量需求单 | 测量单状态 |
| 测量中-待分配 | 测量中-分配中 | 派单员分配测量师 | 派单员 | 📎 测量需求单 | 测量单状态 |
| 测量中-分配中 | 测量中-待上门 | 测量师接单确认 | 测量师 | 📎 测量需求单 | 测量单状态 |
| 测量中-待上门 | 测量中-待确认 | 测量师完成上门测量，上传完工照片 | 测量师 | 📎 测量结果 | 测量单状态 |
| 测量中-待确认 | 方案待确认 | 销售人员确认测量结果 | 销售人员 | 📎 测量结果 | 测量单状态 |
| 方案待确认 | 待推单 | 客户确认设计方案 | 客户/销售人员 | 📎 设计方案 | 测量单状态 |
| 待推单 | 待下单 | 销售人员进行推单操作 | 销售人员 | 📎 圣都HOME系统推单截图 | 测量单状态 |
| 待下单 | 生产中 | 订单客服审核通过 | 订单客服 | 📎 HOME推单截图、销售单 | 销售单状态 |
| 生产中 | 备货完成 | 当所有采购单都进入备货完成状态后 | 系统 | 📎 无 | 销售单状态 |
| 备货完成 | 待发货 | 销售人员点击"整单发货" | 销售人员 | 📎 无 | 销售单状态 |
| 待发货 | 已发货 | 当所有采购单号都有了对应的快递单号后 | 系统 | 📎 无 | 销售单状态 |
| 已发货 | 安装中-待分配 | 系统自动触发 | 系统 | 📎 无 | 销售单状态 |
| 安装中-待分配 | 安装中-分配中 | 派单员分配安装师 | 派单员 | 📎 无 | 销售单状态 |
| 安装中-分配中 | 安装中-待上门 | 安装师接单确认 | 安装师 | 📎 无 | 销售单状态 |
| 安装中-待上门 | 安装中-待确认 | 安装师完成上门安装 | 安装师 | 📎 安装记录 | 销售单状态 |
| 安装中-待确认 | 待对账 | 销售人员上传安装图片到home系统并上传截图到销售单 | 销售人员 | 📎 HOME系统上传截图 | 销售单状态 |
| 待对账 | 待开发票 | 对账员完成对账 | 对账员 | 📎 圣都对账单 | 销售单状态 |
| 待开发票 | 待回款 | 对账员上传销售发票 | 对账员 | 📎 销售发票 | 销售单状态 |
| 待回款 | 已完成 | 对账员上传回款水单 | 对账员 | 📎 回款水单 | 销售单状态 |
| 任意状态 | 已取消 | 客户或销售人员取消订单 | 销售人员 | 📎 取消申请 | 所有状态 |

### 待分配状态特殊规则

| 规则类型 | 触发条件 | 执行角色 | 处理方式 |
|----------|----------|----------|----------|
| 预警规则 | 待分配状态停留超过24小时 | 系统 | 自动预警，上报给领导和渠道负责人 |
| 扣分规则 | 待分配状态停留超过48小时 | 系统 | 当月扣5分 |
| 扣分规则 | 待分配状态停留超过72小时 | 系统 | 当月扣10分 |
| 统计规则 | 线索流转过程 | 系统 | 统计待分配状态的平均停留时间 |
| 分配规则 | 线索分配 | 销售负责人/业务 | 优先分配给所在城市的门店销售，其次分配给远程销售支持 |

### 异常处理流程

| 异常类型 | 触发条件 | 处理角色 | 处理时限 | 必需附件 |
|----------|----------|----------|----------|----------|
| 审批异常 | 审批被拒绝、需要重新提交 | 销售代表 | 4小时内重新提交 | 📎 修改说明 |
| 设计异常 | 设计方案被客户拒绝 | 设计师 | 24小时内重新设计 | 📎 拒绝原因 |
| 生产异常 | 生产延期、质量问题 | 订单客服 | 4小时内处理 | 📎 延期说明 |
| 发货异常 | 物流延期、货物损坏 | 订单客服 | 2小时内处理 | 📎 异常报告 |
| 安装异常 | 安装延期、客户投诉 | 安装师 | 2小时内响应 | 📎 投诉记录 |
| 财务异常 | 付款延期、对账差异 | 对账员 | 1小时内处理 | 📎 差异说明 |
| 客户异常 | 客户要求退款、取消订单 | 销售代表 | 立即处理 | 📎 退款申请 |

## ⏰ 基于前端真实实现的时效控制规则

### 各环节时效要求

| 环节 | 时效要求 | 提醒机制 | 超时处理 | 执行角色 |
|------|----------|----------|----------|----------|
| 待分配 | 24小时内分配线索 | 12小时提醒 | 系统自动预警 | 销售负责人/业务 |
| 待跟踪 | 72小时内开始跟踪 | 48小时提醒 | 系统自动预警 | 销售人员 |
| 跟踪中 | 30天内和客户达成共识 | 7天提醒 | 系统自动预警 | 销售人员 |
| 草签 | 72小时内生成报价单 | 48小时提醒 | 系统自动预警 | 销售人员 |
| 待测量 | 48小时内点击"去测量"按钮 | 24小时提醒 | 系统自动预警 | 销售人员 |
| 测量中-待分配 | 4小时内分配测量师 | 2小时提醒 | 系统自动预警 | 派单员 |
| 测量中-分配中 | 2小时内接单确认 | 1小时提醒 | 系统自动预警 | 测量师 |
| 测量中-待上门 | 48小时内完成上门测量 | 24小时提醒 | 系统自动预警 | 测量师 |
| 测量中-待确认 | 48小时内确认或驳回 | 24小时提醒 | 系统自动预警 | 销售人员 |
| 方案待确认 | 72小时内和客户达成共识 | 48小时提醒 | 系统自动预警 | 销售人员 |
| 待推单 | 无时效要求 | 无 | 无 | 销售人员 |
| 待下单 | 48小时内完成审核 | 24小时提醒 | 系统自动提醒 | 订单客服 |
| 生产中 | 根据产品类型设定（窗帘7天、轨道3天、墙咔15天、墙布7天） | 每日进度更新 | 系统自动提醒/报警 | 订单客服 |
| 备货完成 | 24小时内点击"整单发货" | 12小时提醒 | 系统自动提醒/报警 | 销售人员 |
| 待发货 | 24小时内填写所有快递单号 | 12小时提醒 | 系统自动提醒/报警 | 订单客服 |
| 安装中-待分配 | 4小时内分配安装师 | 2小时提醒 | 系统自动提醒/报警 | 派单员 |
| 安装中-分配中 | 2小时内接单或拒绝接单 | 1小时提醒 | 系统自动提醒/报警 | 安装师 |
| 安装中-待上门 | 7天内完成上门安装 | 3天提醒 | 系统自动提醒/报警 | 安装师 |
| 安装中-待确认 | 24小时内完成安装图片上传和截图上传 | 12小时提醒 | 系统自动提醒/报警 | 销售人员 |
| 待对账 | 3个工作日内完成对账 | 2个工作日提醒 | 系统自动提醒/报警 | 对账员 |
| 待开发票 | 3个工作日内完成开票 | 2个工作日提醒 | 系统自动提醒/报警 | 对账员 |
| 待回款 | 30天内完成回款确认 | 15天提醒 | 系统自动提醒/报警 | 对账员 |
| 取消订单 | 立即处理 | 即时提醒 | 退款流程启动 | 销售人员 |

### 异常状态时效要求

| 环节 | 时效要求 | 提醒机制 | 超时处理 | 执行角色 |
|------|----------|----------|----------|----------|
| 暂停状态 | 72小时内必须处理暂停状态 | 48小时提醒 | 超过96小时预警给领导，超过120小时扣5分 | 相关负责人 |
| 异常状态 | 48小时内必须处理异常状态 | 24小时提醒 | 超过72小时预警给领导，超过96小时扣10分 | 相关负责人 |
| 测量异常 | 测量师拒绝测量任务后，4小时内重新分配 | 2小时提醒 | 系统自动预警 | 派单员 |
| 安装异常 | 安装师拒绝安装任务后，4小时内重新分配 | 2小时提醒 | 系统自动预警 | 派单员 |
| 生产异常 | 生产失败后，24小时内填写失败原因 | 12小时提醒 | 系统自动预警 | 订单客服/销售人员 |
| 发货异常 | 发货失败后，24小时内填写失败原因 | 12小时提醒 | 系统自动预警 | 订单客服/销售人员 |
| 安装结果异常 | 安装结果不合格，24小时内驳回并填写原因 | 12小时提醒 | 系统自动预警 | 销售人员 |
| 对账异常 | 对账失败后，24小时内填写失败原因 | 12小时提醒 | 系统自动预警 | 对账员 |
| 回款异常 | 回款失败后，24小时内填写失败原因 | 12小时提醒 | 系统自动预警 | 对账员 |
| 客户异常 | 客户要求取消订单，立即处理 | 即时提醒 | 退款流程启动 | 销售人员 |
| 取消订单 | 立即处理 | 即时提醒 | 退款流程启动 | 销售人员 |

## 📋 基于前端真实实现的附件上传规范

### 图片类附件要求（基于前端配置）
- **格式**：JPG、PNG、PDF、JPEG
- **大小**：单文件不超过5MB（前端验证）
- **清晰度**：能够清晰识别内容，分辨率≥300dpi
- **命名规范**：`日期_订单号_类型_序号`（如：20241201_ORD001_MEASURE_01）
- **压缩要求**：自动压缩处理，保持清晰度

### 文档类附件要求（基于前端配置）
- **格式**：PDF、DOC、DOCX、XLS、XLSX
- **大小**：单文件不超过10MB（前端验证）
- **内容完整**：包含必要的签字盖章，信息完整
- **版本控制**：确保使用最新版本，支持版本对比
- **安全扫描**：上传前进行病毒扫描

### 基于前端实际业务的关键附件清单

#### 📏 设计测量类附件
1. **测量报告**：包含尺寸数据、现场照片、测量师签字
2. **设计方案**：设计图纸、3D效果图、材料清单
3. **方案确认单**：客户签字确认版本、确认时间记录

#### 📋 订单生产类附件
4. **推单截图**：圣都Home系统截图、推单时间记录
5. **生产单号**：工厂生产系统截图、预计完成时间
6. **质检报告**：生产完成质检报告、合格证明

#### 🔧 安装交付类附件
7. **安装照片**：安装前后对比图、关键节点照片
8. **验收签字**：客户验收确认单、验收时间记录
9. **安装报告**：安装过程记录、问题处理记录

#### 💰 财务结算类附件
10. **发票凭证**：财务发票系统截图、发票号码
11. **回款凭证**：银行到账通知、到账时间记录
12. **对账单**：财务对账明细、差异说明

#### 📞 客户服务类附件
13. **客户沟通记录**：重要沟通截图、客户反馈记录
14. **投诉处理记录**：投诉内容、处理结果、客户满意度
15. **变更申请**：订单变更申请、审批记录

### 前端上传验证规则
- **文件类型验证**：严格按格式要求验证
- **文件大小验证**：实时显示上传进度
- **图片预览**：支持上传前预览功能
- **批量上传**：支持多文件同时上传
- **上传重试**：失败后支持自动重试
- **进度显示**：实时显示上传进度百分比

## 🎯 基于前端真实实现的总结

这个基于前端真实实现的角色权限泳道图具有以下特点：

### ✅ 真实性验证
- **角色编码**：完全匹配前端 `UserRole` 类型定义
- **状态枚举**：基于前端 `ORDER_STATUS` 常量实现
- **权限控制**：对应前端权限管理组件实际逻辑
- **流转规则**：符合前端状态机配置规则
- **客户权限**：目前C端客户无Web端查看权限，仅通过小程序交互
- **线索分配**：仅销售负责人和业务有分配权限，其他人无分配按钮

### 🔧 技术实现要点
- **前端验证**：文件上传大小、格式实时验证
- **状态管理**：基于 Redux 的全局状态管理
- **权限控制**：基于角色编码的动态权限渲染
- **异常处理**：统一异常处理机制

### 📊 业务价值
- **流程标准化**：27个状态覆盖完整业务流程（5个线索 + 6个测量 + 5个订单 + 4个安装 + 4个财务 + 3个异常）
- **权限精细化**：11种角色分工明确，避免权限冲突
- **数据可追溯**：15类关键附件确保业务合规
- **时效可控**：13个环节时效控制提升客户满意度

### 🚀 系统应用
- **开发指导**：为前后端开发提供明确的接口规范
- **测试验证**：为功能测试提供完整的场景覆盖
- **培训材料**：为业务培训提供标准化的操作手册
- **运维监控**：为系统运维提供状态监控基准

这个基于前端真实实现的角色权限泳道图可以直接用于系统开发、测试验证、业务培训和运维监控，确保系统实现与业务需求的高度一致性。

## 详细状态说明

### 📋 线索阶段（5个状态）
1. **待分配** - 线索创建后等待分配给销售人员
2. **待跟踪** - 已分配但尚未开始跟踪
3. **跟踪中** - 正在跟踪客户
4. **草签** - 客户初步同意，准备进入测量阶段
5. **已失效** - 手动关闭的线索

## 1. 待跟踪状态详细说明

### 1.1 状态定义
- **状态名称**：待跟踪
- **状态标识**：ORDER_STATUS.PENDING_TRACKING
- **状态颜色**：🟡 黄色
- **状态描述**：线索已分配给销售人员，等待销售人员开始跟踪

### 1.2 触发条件
- 销售负责人/业务将线索分配给驻店销售或远程销售后，线索自动进入"待跟踪"状态
- 批量分配或手动分配都会触发此状态

### 1.3 流转规则
- **正向流转**：待跟踪 → 跟踪中（销售人员点击"跟踪"按钮，添加跟踪记录）
- **反向流转**：待跟踪 → 待分配（销售负责人/业务撤销分配）
- **异常流转**：待跟踪 → 已失效（销售人员判断线索无效）

### 1.4 跟踪内容与动作
**跟踪内容**：
- 跟踪时间：自动记录系统当前时间
- 跟踪方式：电话、微信、短信、上门拜访、邮件等
- 客户姓名：客户的真实姓名
- 客户电话：客户的联系电话
- 面积：房屋面积
- 品类：多选（窗帘、墙布、墙咔、飘窗垫）
- 预算：客户的预算范围
- 进度：单选（没开始、水电、泥木、油漆、安装、软装、快入住）
- 跟踪内容：沟通的具体内容，如产品介绍、需求确认、价格讨论等
- 客户反馈：客户的意见、疑问、顾虑等
- 下一步计划：后续跟踪安排
- 客户意向：单选（高、中、低）
- 跟踪人：多选（设计师、导购、项目经理）
- 备注信息：其他需要记录的内容

**跟踪动作**：
- 点击"跟踪"按钮：进入跟踪记录添加页面
- 填写/修改跟踪内容：根据实际情况填写或修改各项信息
- 点击"确认提交"按钮：保存跟踪记录，线索状态自动更新为"跟踪中"

**跟踪记录规则**：
- 当天修改的跟踪记录算同一次跟踪
- 72小时后再次跟踪才记录为下一次跟踪
- 跟踪记录具有日志性质，可查看历史记录
- 每个线索对应一条线索详情，多次跟踪生成多条跟踪记录

**历史记录查看**：
- 销售人员可以查看自己的所有跟踪历史记录
- 销售负责人、业务、渠道负责人、领导可以查看所有人员的跟踪历史记录
- 历史记录包含每次跟踪的完整信息和修改记录

### 1.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 驻店销售 | ⚡ 操作权限 | 点击"跟踪"按钮，开始跟踪线索，添加跟踪记录 | 📎 跟踪记录 |
| 远程销售 | ⚡ 操作权限 | 点击"跟踪"按钮，开始跟踪线索，添加跟踪记录 | 📎 跟踪记录 |
| 销售负责人 | 📋 查看权限 | 查看待跟踪线索列表及详情 | 📎 线索列表、详情 |
| 业务 | 📋 查看权限 | 查看待跟踪线索列表及详情 | 📎 线索列表、详情 |
| 渠道负责人 | 📋 查看权限 | 查看待跟踪线索列表及详情 | 📎 线索列表、详情 |
| 领导 | 📋 查看权限 | 查看待跟踪线索列表及详情 | 📎 线索列表、详情 |

### 1.6 操作流程
1. 销售人员登录系统，查看分配给自己的待跟踪线索
2. 销售人员点击"跟踪"按钮，进入线索详情页面
3. 销售人员填写跟踪记录，包括跟踪方式、跟踪内容、客户反馈、客户意向、下一步计划等
4. 点击"保存"按钮，系统自动将线索状态从"待跟踪"更新为"跟踪中"
5. 销售人员可以继续添加后续跟踪记录，直到线索转化或关闭

### 1.7 相关指标
- **待跟踪线索数量**：实时统计当前处于待跟踪状态的线索数量
- **待跟踪平均停留时间**：统计线索在待跟踪状态的平均停留时间
- **跟踪转化率**：从待跟踪状态成功转化为跟踪中的比例
- **跟踪及时率**：在规定时间内完成跟踪的比例

### 1.8 异常处理
- **超过72小时**：系统自动提醒销售人员
- **超过96小时**：预警给领导、销售负责人、渠道负责人
- **超过120小时**：扣5分，线索自动退回待分配状态
- **线索失效**：销售人员可以将无效线索标记为"已失效"，并填写失效原因

### 1.9 系统支持
- 提供待跟踪线索列表，支持按时间、区域、客户类型、设计师、导购等条件筛选
- 所有线索不支持导出动作
- 提供跟踪记录模板，方便销售人员快速添加跟踪记录
- 支持设置跟踪提醒，提醒销售人员及时跟踪线索
- 提供线索跟踪分析报告，帮助销售团队优化跟踪策略

### 📏 测量阶段（6个状态）
6. **待测量** - 等待安排测量师上门测量
7. **测量中-待分配** - 测量需求单已生成，等待派单员分配
8. **测量中-分配中** - 派单员正在分配测量师
9. **测量中-待上门** - 测量师已接单，等待上门测量
10. **测量中-待确认** - 测量完成，等待销售确认测量单
11. **方案待确认** - 测量单已确认，等待客户确认方案

### 📦 订单处理阶段（5个状态）
12. **待推单** - 方案已确认，等待推单处理
13. **待下单** - 推单完成，等待下单
14. **生产中** - 订单已下单，正在生产
15. **备货完成** - 所有生产单号备货完成
16. **待发货** - 销售人员点击"整单发货"，等待订单客服填写快递单号

### 🔧 安装阶段（4个状态）
17. **安装中-待分配** - 安排安装，等待派单员分配安装师
18. **安装中-分配中** - 派单员正在分配安装师
19. **安装中-待上门** - 安装师已接单，等待上门安装
20. **安装中-待确认** - 安装完成，等待销售确认

### 💰 财务阶段（4个状态）
21. **待对账** - 安装确认完成，等待对账员对账
22. **待开发票** - 对账完成，等待对账员开具并上传销售发票
23. **待回款** - 对账员已上传销售发票，等待客户回款
24. **已完成** - 对账员已上传回款水单，订单结束

### ⚠️ 异常状态（3个状态）
25. **已取消** - 订单被取消
26. **暂停** - 订单暂停处理
27. **异常** - 订单出现异常情况

## 关键流转规则

### 🔀 正向流转
- **线索→测量**: 草签后进入待测量状态
- **测量→订单**: 方案确认后进入待推单状态
- **订单→安装**: 备货完成 → 待发货 → 安装中-待分配（所有快递单号填写完成后进入安装阶段）
- **安装→财务**: 安装确认后进入对账阶段 → 待开发票 → 待回款 → 已完成

### 🔄 异常处理
- **驳回机制**: 测量/安装结果不合格可驳回重做
- **客户取消**: 任何状态下客户都可取消订单
- **暂停处理**: 特殊情况下可暂停订单处理
- **异常标记**: 出现异常情况时标记为异常状态

### ⏰ 时效控制
- 测量环节：4小时内分配测量师，24小时内完成测量
- 安装环节：备货完成后7天内安排安装
- 跟踪周期：线索跟踪最长30天，每7天系统提醒
- 生产周期：根据产品类型设定，48小时提醒，72小时报警

## 权限控制

### 状态变更权限矩阵
| 状态流转   | 销售人员 | 派单员 | 测量师 | 安装师 | 订单客服 | 对账员 | 销售负责人 | 渠道负责人 | 领导 | 客户 | 业务 | 管理员 |
| ------ | ---- | --- | --- | --- | ---- | -- | ----- | ----- | -- | -- | -- | --- |
| 线索分配   | ❌    | ❌   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ✅  | ✅   |
| 安排测量   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ✅     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 分配测量师  | ❌    | ✅   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 确认测量   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ✅     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 推单处理   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 审核下单   | ❌    | ❌   | ❌   | ❌   | ✅    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 上传采购截图 | ❌    | ❌   | ❌   | ❌   | ✅    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 填写采购信息 | ❌    | ❌   | ❌   | ❌   | ✅    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 生成采购单  | ❌    | ❌   | ❌   | ❌   | ✅    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 整单发货   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 填写快递单号 | ❌    | ❌   | ❌   | ❌   | ✅    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 安排安装   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ✅     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 分配安装师  | ❌    | ✅   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 安装师接单  | ❌    | ❌   | ❌   | ✅   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 完成安装   | ❌    | ❌   | ❌   | ✅   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 上传安装图片 | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 审核安装结果 | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 对账员对账   | ❌    | ❌   | ❌   | ❌   | ❌    | ✅  | ❌     | ❌     | ✅  | ❌  | ❌  | ✅   |
| 开具发票   | ❌    | ❌   | ❌   | ❌   | ❌    | ✅  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 确认回款   | ❌    | ❌   | ❌   | ❌   | ❌    | ✅  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |
| 取消订单   | ✅    | ❌   | ❌   | ❌   | ❌    | ❌  | ✅     | ❌     | ❌  | ✅  | ❌  | ✅   |
| 修改备注   | ✅    | ❌   | ❌   | ❌   | ✅    | ✅  | ❌     | ❌     | ❌  | ❌  | ❌  | ✅   |

这个流程图清晰地展示了27个状态之间的完整流转关系，包括正常流程、异常处理和权限控制，为系统开发和业务操作提供了明确的指导。

**状态分布**：
- 线索阶段：5个状态（待分配、待跟踪、跟踪中、草签、已失效）
- 测量阶段：6个状态（待测量、测量中-待分配、测量中-分配中、测量中-待上门、测量中-待确认、方案待确认）
- 订单处理：5个状态（待推单、待下单、生产中、备货完成、待发货）
- 安装阶段：4个状态（安装中-待分配、安装中-分配中、安装中-待上门、安装中-待确认）
- 财务阶段：4个状态（待对账、待开发票、待回款、已完成）
- 异常状态：3个状态（已取消、暂停、异常）

## 2. 跟踪中状态详细说明

### 2.1 状态定义
- **状态名称**：跟踪中
- **状态标识**：ORDER_STATUS.TRACKING
- **状态颜色**：🟢 绿色
- **状态描述**：销售人员正在跟踪线索，已添加首次跟踪记录

### 2.2 触发条件
- 销售人员点击"跟踪"按钮，填写并提交跟踪记录后，线索自动进入"跟踪中"状态
- 待跟踪状态的线索被销售人员首次跟踪后，自动进入此状态

### 2.3 流转规则
- **正向流转**：跟踪中 → 草签（客户初步同意，准备进入测量阶段）
- **状态并行**：跟踪中 + 已报价（销售人员完成报价单填写，两个状态并行存在，非互斥关系）
- **反向流转**：跟踪中 → 待分配（销售负责人/业务撤销跟踪，线索退回待分配状态）
- **异常流转**：跟踪中 → 已失效（销售人员判断线索无效）
- **异常流转**：跟踪中 → 已关闭（销售人员关闭线索）

### 2.4 操作内容与规则
**操作内容**：
- **添加跟踪记录**：72小时后可以添加新的跟踪记录
- **修改跟踪记录**：可以修改跟踪记录（包括当天和历史记录），但修改不计入一次真实跟踪
- **添加报价**：点击"报价"按钮，完成报价单填写
- **转化为草签**：点击"转化"按钮，将线索转为草签状态
- **标记为已失效**：点击"失效"按钮，标记线索为已失效
- **关闭线索**：点击"关闭"按钮，关闭线索

**跟踪记录规则**：
- 72小时内只能记录一次跟踪（修改不计入真实跟踪次数）
- 72小时后可以添加新的跟踪记录（计入真实跟踪次数）
- 每次跟踪记录都具有日志性质，包含完整的跟踪信息和修改记录
- 可以查看所有历史跟踪记录和修改记录
- 用于统计销售跟踪情况：每个销售跟踪线索的次数、平均跟踪间隔、跟踪频次等评价指标
- 支持按不同施工阶段设置不同的跟踪频次要求

**跟踪提醒功能**：
- 超过30天没有跟踪，系统自动报警提醒销售人员和管理者
- 超过45天没有跟踪，扣5分
- 具体规则将在后续版本中细化

### 2.5 报价功能与规则
**报价触发流程**：
- 方式一：在线索跟踪页面中，用户点击"报价"按钮时，系统触发并展示报价页面
- 方式二：在开单选项卡直接开单（适用于提前不知道线索的客户）
- 报价页面的布局、字段设置及交互逻辑与"开单"选项卡的内容保持一致
- 在开单中创建的报价单默认是"初稿"状态

**报价单生成与导出功能**：
- 用户完成报价页面信息填写后，系统支持生成正式报价单
- 提供报价单导出功能，支持导出为Excel格式和PDF格式文件
- 报价单分享功能：未来版本将支持通过微信小程序进行分享，MVP阶段暂不纳入开发范围

**线索状态更新机制**：
- 一旦用户完成报价动作并成功生成报价单，系统自动为该线索打上"已报价"标签，同时完成报价单的创建流程
- "跟踪中"和"已报价"为并行状态，非互斥关系

**报价单来源统计**：
- 系统自动统计报价单生成来源：
  - 从线索模块生成的报价单数量
  - 直接生成的报价单数量
- 支持按时间、区域、销售人员等维度进行统计分析

**多报价单管理规则**：
- 系统允许为同一条线索生成多条报价单，新创建的报价单默认为"草稿"状态
- 支持从多个草稿报价单中选择一份设置为"初稿"状态，未被选中的报价单保持"草稿"状态
- 当从草稿报价单中重新选择另一份作为"初稿"时，系统自动将原"初稿"状态的报价单变更为"草稿"状态

### 2.6 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 驻店销售 | ⚡ 操作权限 | 添加/修改跟踪记录、添加报价、转化为草签、标记为已失效、关闭线索 | 📎 跟踪记录、报价单 |
| 远程销售 | ⚡ 操作权限 | 添加/修改跟踪记录、添加报价、转化为草签、标记为已失效、关闭线索 | 📎 跟踪记录、报价单 |
| 销售负责人 | 📋 查看权限 | 查看跟踪中线索列表及详情、查看所有跟踪历史记录 | 📎 线索列表、详情、跟踪记录 |
| 业务 | 📋 查看权限 | 查看跟踪中线索列表及详情、查看所有跟踪历史记录 | 📎 线索列表、详情、跟踪记录 |
| 渠道负责人 | 📋 查看权限 | 查看跟踪中线索列表及详情、查看所有跟踪历史记录 | 📎 线索列表、详情、跟踪记录 |
| 领导 | 📋 查看权限 | 查看跟踪中线索列表及详情、查看所有跟踪历史记录 | 📎 线索列表、详情、跟踪记录 |

### 2.7 相关指标
- **跟踪中线索数量**：实时统计当前处于跟踪中状态的线索数量
- **跟踪频率**：统计线索的跟踪频率，如平均每7天跟踪一次
- **跟踪转化率**：从跟踪中状态成功转化为草签的比例
- **跟踪完成率**：成功完成跟踪的比例
- **跟踪时长**：线索在跟踪中状态的平均停留时间

### 2.8 异常处理
- **长期未跟踪**：跟踪中状态超过30天未更新，系统自动提醒销售人员
- **客户无响应**：连续3次跟踪无响应，系统提醒销售人员考虑标记为已失效
- **线索重复**：系统自动检测重复线索，提醒销售人员合并或处理
- **数据异常**：跟踪记录中必填字段缺失或格式错误，系统提醒销售人员完善

### 2.9 系统支持
- 提供跟踪中线索列表，支持按时间、区域、客户类型、设计师、导购、跟踪人等条件筛选
- 所有线索不支持导出动作
- 提供跟踪记录模板，方便销售人员快速添加跟踪记录
- 支持设置跟踪提醒，提醒销售人员及时跟踪线索
- 提供线索跟踪分析报告，帮助销售团队优化跟踪策略
- 支持查看完整的跟踪历史记录，包括每次跟踪的时间、内容、人员等信息

## 3. 草签状态详细说明

### 3.1 状态定义
- **状态名称**：草签
- **状态标识**：ORDER_STATUS.DRAFT_SIGNED
- **状态颜色**：🔵 蓝色
- **状态描述**：客户初步同意，准备进入测量阶段，已完成草签动作

### 3.2 触发条件
**情况一：之前已经做过报价**
- 在报价单中选中的初稿中点击"转化"按钮
- 系统弹出二次确认弹窗，避免误触
- 确认后线索自动进入"草签"状态

**情况二：之前没做过报价**
- 在线索详情弹窗点击"转化"按钮
- 系统弹窗跳转到"开单"页面
- 完成开单操作后，线索自动进入"草签"状态

### 3.3 流转规则
- **线索状态流转**：草签 → 跟踪中（销售人员撤销草签，退回跟踪阶段）
- **报价单状态流转**：草签后报价单自动进入"待测量"状态（等待通知才能去做测量）
- **自动同步**：线索单状态跟随客户相关单据状态自动同步（详见状态同步机制）

### 3.4 操作内容与规则
**操作内容**：
- **修改草签信息**：可以修改草签相关信息
- **撤销草签**：点击"撤销草签"按钮，将线索退回跟踪中状态
- **申请草签失效**：点击"申请失效"按钮，提交草签失效申请，进入审批流程
- **申请草签关闭**：点击"申请关闭"按钮，提交草签关闭申请，进入审批流程

**草签规则**：
- **草签**：是针对线索的状态，表示客户初步同意合作
- **待测量**：是针对报价单的状态，表示等待通知才能去做测量
- 草签后报价单自动进入"待测量"状态
- 草签信息包含客户基本信息、意向产品、初步报价等核心合作信息
- 支持修改草签信息，但修改不计入草签次数统计
- 从报价单转化需要二次确认，避免误触
- 从未报价线索转化直接跳转到开单页面
- **重要说明**：不存在草签后自动生成测量单的情况
- **重要说明**：测量需求单是报价单和测量单之间的桥梁，与线索单无关

### 3.5 草签失效/关闭审批流程
**触发条件**：
- 销售人员点击"申请失效"或"申请关闭"按钮

**审批流程**：
1. 销售人员提交草签失效/关闭申请
2. 系统自动将申请发送给销售负责人和渠道负责人审批
3. 销售负责人和渠道负责人进行审批（需全部通过）
4. 审批通过后，线索状态自动更新为"已失效"或"已关闭"
5. 审批不通过时，申请被驳回，线索保持"草签"状态

**审批权限**：
- 销售负责人：草签失效/关闭审批权限
- 渠道负责人：草签失效/关闭审批权限

### 3.6 测量需求单机制（与线索单无关）
**核心定义**：测量需求单是报价单和测量单之间的桥梁，连接报价单"待测量"状态和测量单"测量中-分配中"状态

**生成条件**：
- 只有"初稿"状态的报价单才能生成测量单
- 生成测量需求单必须上传HOME系统测量单

**生成时机**：
- 当报价单处于"待测量"状态时
- 销售人员可根据施工现场条件，在合适时机点击"生成测量需求单"按钮
- 生成测量需求单后，测量单自动进入"测量中-分配中"状态

**测量单继承规则**：
- 测量单继承报价单的客户信息
- 测量单继承客户的空间信息
- 测量单继承选择的安装情况
- 测量单继承预估的数量信息
- 测量单继承预估的尺寸信息
- **注意**：测量单不继承价格和用料数量

**测量师权限**：
- 测量师能够看到之前报价单的预估尺寸
- 测量师不能修改报价单的预估尺寸
- 测量师在报价单的预估尺寸后，添加实际测量尺寸
- 系统清晰展示预估尺寸和实际尺寸的对比

**状态同步规则**：
- 生成测量需求后，报价单状态同步测量单的状态
- 同步范围包括："测量中-待分配"、"测量中-分配中"、"测量中-待上门"、"测量中-待确认"等所有测量阶段状态

**操作权限**：
- 驻店销售：生成测量需求单权限（需上传HOME系统测量单）
- 远程销售：生成测量需求单权限（需上传HOME系统测量单）
- 销售负责人：生成测量需求单权限（需上传HOME系统测量单）

**测量需求单流转**：
- 报价单"待测量" → 上传HOME系统测量单 → 生成测量需求单 → 测量单"测量中-分配中"
- 测量需求单是报价单到测量单的中间单据，与线索单状态无关

### 3.7 状态同步机制
**核心规则**：线索单状态跟随客户相关的其他单据最新状态自动同步，确保客户状态的一致性

**同步触发条件**：
- 当客户的销售单、安装单等单据状态发生变化时，系统自动同步更新线索单状态
- 测量单状态变化会同步到线索单，但测量需求单的生成与线索单无关
- 同步操作由系统自动执行，无需人工干预

**同步优先级**：
- 按照业务流程顺序，后续阶段的单据状态优先级高于前期阶段
- 例如：销售单状态优先级高于测量单状态，测量单状态优先级高于草签状态

**同步示例**：
- 测量单进入"测量中-待上门"状态 → 线索单自动同步为"测量中-待上门"
- 销售单进入"待发货"状态 → 线索单自动同步为"待发货"
- 安装单进入"安装中-待上门"状态 → 线索单自动同步为"安装中-待上门"

**同步范围**：
- 测量单状态变化会同步到线索单
- 销售单状态变化会同步到线索单
- 安装单状态变化会同步到线索单
- 其他相关单据状态变化会同步到线索单
- **重要说明**：测量需求单的生成与线索单状态无关，不会触发线索单状态变化

### 3.8 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 驻店销售 | ⚡ 操作权限 | 修改草签信息、撤销草签、申请草签失效、申请草签关闭 | 📎 审批申请 |
| 远程销售 | ⚡ 操作权限 | 修改草签信息、撤销草签、申请草签失效、申请草签关闭 | 📎 审批申请 |
| 驻店销售 | ⚡ 操作权限 | 生成测量需求单（针对报价单操作，与线索单无关） | 📎 HOME系统测量单 |
| 远程销售 | ⚡ 操作权限 | 生成测量需求单（针对报价单操作，与线索单无关） | 📎 HOME系统测量单 |
| 销售负责人 | ⚡ 操作权限 | 审批草签失效/关闭申请 | 📎 审批意见 |
| 销售负责人 | ⚡ 操作权限 | 生成测量需求单（针对报价单操作，与线索单无关） | 📎 HOME系统测量单 |
| 销售负责人 | �� 查看权限 | 查看草签线索列表及详情、查看测量需求单 | 📎 线索列表、详情、测量需求单 |
| 渠道负责人 | ⚡ 操作权限 | 审批草签失效/关闭申请 | 📎 审批意见 |
| 渠道负责人 | 📋 查看权限 | 查看草签线索列表及详情、查看测量需求单 | 📎 线索列表、详情、测量需求单 |
| 业务 | 📋 查看权限 | 查看草签线索列表及详情、查看测量需求单 | 📎 线索列表、详情、测量需求单 |
| 领导 | 📋 查看权限 | 查看草签线索列表及详情、查看测量需求单 | 📎 线索列表、详情、测量需求单 |

### 3.9 相关指标
- **草签线索数量**：实时统计当前处于草签状态的线索数量
- **草签转化率**：从跟踪中状态成功转化为草签的比例
- **草签停留时间**：线索在草签状态的平均停留时间
- **草签失效率**：草签状态线索最终变为已失效的比例

### 3.10 异常处理
- **线索重复**：系统自动检测重复线索，提醒销售人员合并或处理
- **数据异常**：草签信息中必填字段缺失或格式错误，系统提醒销售人员完善
- **状态同步异常**：当状态同步失败时，系统自动报警，提醒管理员处理
- **审批超时**：草签失效/关闭审批超过48小时未处理，系统自动提醒审批人
- **测量需求单异常**：测量需求单信息不完整或格式错误，系统提醒销售人员完善（与线索单无关）

### 3.11 系统支持
- 提供草签线索列表，支持按时间、区域、客户类型、设计师、导购等条件筛选
- 所有线索不支持导出动作
- 提供测量需求单模板，方便销售人员快速生成
- 支持设置草签提醒，提醒销售人员及时生成测量需求单
- 提供草签转化率分析报告，帮助销售团队优化转化策略
- 支持查看完整的草签历史记录，包括草签时间、人员、内容等信息
- 支持查看线索单状态同步历史，了解状态变化轨迹

### 3.12 操作流程
1. 销售人员登录系统，查看分配给自己的跟踪中线索
2. 当客户初步同意合作后，销售人员点击"转化"按钮，将线索转为草签状态
3. 销售人员填写草签信息，包括客户基本信息、意向产品、初步报价等
4. 点击"确认提交"按钮，保存草签信息，线索状态自动更新为"草签"
5. 销售人员上传HOME系统测量单，点击"生成测量需求单"按钮，测量单自动进入"测量中-待分配"状态，报价单状态同步更新
6. 测量单状态变化时，线索单状态自动同步（如测量单进入"测量中-待上门"，线索单同步为"测量中-待上门"）
7. 销售单状态变化时，线索单状态自动同步（如销售单进入"待发货"，线索单同步为"待发货"）
8. 如果需要撤销草签，销售人员可以点击"撤销草签"按钮，将线索退回跟踪中状态

## 4. 测量中-待分配状态详细说明

### 4.1 状态定义
- **状态名称**：测量中-待分配
- **状态标识**：ORDER_STATUS.MEASURING_PENDING_ASSIGNMENT
- **状态颜色**：🟠 橙色
- **状态描述**：测量需求单已生成，等待派单员分配测量师

### 4.2 触发条件
- 销售人员上传HOME系统测量单，点击"生成测量需求单"按钮后，测量单自动进入"测量中-待分配"状态
- 测量需求单是报价单到测量单的中间单据，生成后自动触发此状态

### 4.3 流转规则
- **正向流转**：测量中-待分配 → 测量中-分配中（派单员开始分配测量师）
- **反向流转**：测量中-待分配 → 待测量（派单员驳回测量需求，退回重新生成）
- **异常流转**：测量中-待分配 → 已取消（客户取消测量需求）

### 4.4 操作内容与规则
**操作内容**：
- **查看测量需求**：派单员查看待分配的测量需求
- **分配测量师**：派单员根据区域、测量师工作量等因素分配测量师
- **驳回测量需求**：派单员可驳回不符合要求的测量需求
- **取消测量**：客户或销售人员可取消测量需求

**分配规则**：
- 优先分配给所在城市的测量师
- 考虑测量师的当前工作量和可用时间
- 支持批量分配和手动分配

### 4.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 派单员 | ⚡ 操作权限 | 查看测量需求、分配测量师、驳回测量需求 | 📎 测量需求单 |
| 销售负责人 | 📋 查看权限 | 查看测量需求 | 📎 测量需求单 |
| 驻店销售 | ⚡ 操作权限 | 查看测量需求、取消测量需求 | 📎 测量需求单 |
| 远程销售 | ⚡ 操作权限 | 查看测量需求、取消测量需求 | 📎 测量需求单 |
| 测量师 | 📋 查看权限 | 只能看到"分配中"状态的测量需求，看不到"待分配"状态 | 📎 测量需求单 |

### 4.6 时效要求
- **分配时效**：
  - 当天17点之前生成的测量需求：4小时内必须分配测量师
  - 当天17点之后生成的测量需求：第二天12点前必须分配
- **超时处理**：超过规定时间未分配，系统自动预警给销售负责人和渠道负责人
- **紧急测量**：支持标记紧急测量需求，优先分配

### 4.7 异常处理
- **测量师拒绝**：测量师拒绝测量任务后，测量单自动退回"测量中-待分配"状态
- **测量师无响应**：
  - 测量师2小时内未接单，系统通过小程序通知测量师
  - 测量师3小时内未接单，系统自动预警给派单员
  - 测量师4小时内未接单，系统自动重新分配，回流到“测量中-待测量”
- **测量需求变更**：客户或销售人员变更测量需求，测量单自动退回"测量中-待分配"状态

### 4.8 系统支持
- 提供待分配测量需求列表，支持按区域、优先级、生成时间等条件筛选
- 支持测量师工作量统计，帮助派单员合理分配
- 提供测量需求详情页面，展示完整的测量需求信息
- 支持设置分配提醒，提醒派单员及时分配测量师
- 支持测量需求批量操作，提高派单效率

### 4.9 相关指标
- **待分配测量需求数量**：实时统计当前处于待分配状态的测量需求数量
- **平均分配时间**：测量需求单从生成到分配的平均时间
- **分配及时率**：在规定时间内完成分配的比例
- **测量师负载率**：各测量师的当前工作量和负载情况
- **分配准确率**：测量师成功完成测量的比例，被驳回数量越少越好
- **被驳回数量**：测量需求被驳回的数量统计

### 4.10 操作流程
1. 销售人员生成测量需求单后，测量单自动进入"测量中-待分配"状态
2. 派单员登录系统，查看待分配的测量需求列表
3. 派单员根据区域、测量师工作量等因素，选择合适的测量师进行分配
4. 点击"分配"按钮，测量单状态自动更新为"测量中-分配中"
5. 系统自动通知被分配的测量师
6. 如果测量需求不符合要求，派单员可点击"驳回"按钮，测量单状态退回"待测量"
7. 如果客户取消测量需求，销售人员或销售负责人可点击"取消"按钮，测量单状态更新为"已取消"

## 5. 测量中-分配中状态详细说明

### 5.1 状态定义
- **状态名称**：测量中-分配中
- **状态标识**：ORDER_STATUS.MEASURING_ASSIGNING
- **状态颜色**：🟡 黄色
- **状态描述**：派单员已完成测量师分配，等待测量师接单确认

### 5.2 触发条件
- 派单员在测量中-待分配状态下点击"分配"按钮后，测量单自动进入"测量中-分配中"状态
- 系统自动通知被分配的测量师

### 5.3 流转规则
- **正向流转**：测量中-分配中 → 测量中-待上门（测量师接单确认）
- **反向流转**：测量中-分配中 → 测量中-待分配（测量师拒绝接单，退回重新分配）
- **异常流转**：测量中-分配中 → 已取消（客户取消测量需求）

### 5.4 操作内容与规则
**操作内容**：
- **查看分配状态**：派单员、销售人员查看分配结果
- **修改分配**：派单员可修改测量师分配（特殊情况）
- **确认分配**：测量师接单确认
- **拒绝分配**：测量师可拒绝接单
- **取消测量**：客户或销售人员可取消测量需求
- **备注修改**：驻店销售/远程销售可修改测量需求备注信息，不允许实质性操作

**分配规则**：
- 一个测量单只能分配给一个测量师
- 测量师接单后，状态自动流转到测量中-待上门
- 测量师拒绝后，状态自动退回测量中-待分配

### 5.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 派单员 | ⚡ 操作权限 | 查看分配状态、修改分配、取消测量需求 | 📎 测量需求单 |
| 销售负责人 | 📋 查看权限 | 查看分配状态 | 📎 测量需求单 |
| 驻店销售 | ⚡ 操作权限 | 查看分配状态、取消测量需求、修改测量需求备注信息（仅备注，不允许实质性操作） | 📎 测量需求单 |
| 远程销售 | ⚡ 操作权限 | 查看分配状态、取消测量需求、修改测量需求备注信息（仅备注，不允许实质性操作） | 📎 测量需求单 |
| 测量师 | ⚡ 操作权限 | 查看分配状态、接单确认、拒绝分配 | 📎 测量需求单 |

### 5.6 时效要求
- **接单时效**：测量师被分配后2小时内必须接单确认
- **超时处理**：超过2小时未接单，系统通过小程序通知测量师；超过3小时未接单，系统预警给派单员；超过4小时未接单，提示派单员进行重新分配
- **紧急测量**：支持标记紧急测量需求，测量师必须1小时内接单，其他

### 5.7 异常处理
- **测量师拒绝**：测量师拒绝接单后，测量单自动退回"测量中-待分配"状态，派单员需重新分配
- **测量师无响应**：测量师4小时内未接单，系统自动重新分配给其他测量师
- **分配错误**：派单员可修改分配，重新选择测量师
- **测量需求变更**：客户或销售人员变更测量需求，测量单自动退回"测量中-待分配"状态

### 5.8 系统支持
- 提供测量中-分配中状态列表，支持按区域、测量师、生成时间等条件筛选
- 支持实时查看测量师接单状态
- 支持分配记录查询，可查看历史分配情况
- 支持分配提醒，提醒测量师及时接单
- 支持批量操作，提高分配效率

### 5.9 相关指标
- **分配中测量需求数量**：实时统计当前处于分配中状态的测量需求数量
- **平均接单时间**：测量师从被分配到接单的平均时间
- **接单及时率**：测量师在规定时间内完成接单的比例
- **拒绝接单率**：测量师拒绝接单的比例
- **重新分配率**：测量单被重新分配的比例

### 5.10 操作流程
1. 派单员在测量中-待分配状态下点击"分配"按钮，测量单进入"测量中-分配中"状态
2. 系统自动通过小程序通知被分配的测量师
3. 测量师登录系统，查看分配给自己的测量需求
4. 测量师点击"接单"按钮确认，测量单状态自动更新为"测量中-待上门"
5. 如测量师点击"拒绝"按钮，测量单状态自动退回"测量中-待分配"状态
6. 派单员可查看分配进度，必要时修改分配
7. 客户或销售人员可取消测量需求，测量单状态更新为"已取消"

## 6. 测量中-待上门状态详细说明

### 6.1 状态定义
- **状态名称**：测量中-待上门
- **状态标识**：ORDER_STATUS.MEASURING_PENDING_VISIT
- **状态颜色**：🟢 绿色
- **状态描述**：测量师已接单确认，等待上门测量

### 6.2 触发条件
- 测量师在测量中-分配中状态下点击"接单"按钮确认后，测量单自动进入"测量中-待上门"状态
- 系统自动通知客户和销售人员测量师已接单

### 6.3 流转规则
- **正向流转**：测量中-待上门 → 测量中-待确认（测量师完成上门测量）
- **反向流转**：测量中-待上门 → 测量中-分配中（测量师取消接单，退回重新分配）
- **异常流转**：测量中-待上门 → 已取消（客户取消测量需求）

### 6.4 操作内容与规则
**操作内容**：
- **查看上门时间**：所有相关角色查看预约的上门时间
- **确认上门时间**：测量师与客户确认上门时间
- **修改上门时间**：
  - 派单员和销售人员可以直接修改上门时间
  - 测量师若想更改上门时间，需提交申请并经派单员确认
- **完成测量**：测量师完成上门测量后提交测量结果
- **取消测量**：客户或销售人员可取消测量需求

**上门规则**：
- 测量师接单后必须在24小时内完成上门测量
- 上门时间修改需与客户确认，不得擅自更改
- 测量完成后必须提交完整的测量数据

### 6.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 测量师 | ⚡ 操作权限 | 查看上门时间、确认上门时间、完成测量 | 📎 测量需求单 |
| 派单员 | ⚡ 操作权限 | 查看上门时间和测量状态、修改上门时间 | 📎 测量需求单 |
| 销售负责人 | 📋 查看权限 | 查看上门时间和测量状态 | 📎 测量需求单 |
| 驻店销售 | ⚡ 操作权限 | 查看上门时间、取消测量需求、修改测量需求备注信息（仅备注，不允许实质性操作）、修改上门时间 | 📎 测量需求单 |
| 远程销售 | ⚡ 操作权限 | 查看上门时间、取消测量需求、修改测量需求备注信息（仅备注，不允许实质性操作）、修改上门时间 | 📎 测量需求单 |
| 客户 | 📋 查看权限 | 查看上门时间、确认上门时间 | 📎 测量需求单 |

### 6.6 时效要求
- **上门时效**：测量师接单后48小时内必须完成上门测量（如果没有标注预约测量时间的情况）如果有测量预约的话，测量师必须在预约时间上门，并完成测量
- **超时处理**：如果有预约时间的话，超过预约时间8小时上传测量数据，如果没有预约时间的话，超过48小时，系统预警给销售负责人和渠道负责人
- **紧急测量**：紧急测量需求必须在24小时内完成上门测量

### 6.7 异常处理
- **测量师取消接单**：测量师取消接单后，测量单自动退回"测量中-分配中"状态，派单员需重新分配
- **客户改期**：客户要求改期时，测量师需重新确认上门时间
- **测量师迟到**：测量师迟到超过30分钟，系统自动通知派单员和销售人员
- **测量条件不满足**：现场测量条件不满足时，测量师可标记为异常，退回重新安排，并记录需要销售人员、销售负责人、渠道负责人和派单员审批

### 6.8 系统支持
- 提供测量中-待上门状态列表，支持按区域、测量师、预约时间等条件筛选
- 支持上门时间预约和确认功能
- 支持测量师位置跟踪，主要是定位打卡（需测量师授权）
- 支持测量完成提醒，提醒测量师及时提交测量结果
- 支持测量数据模板，方便测量师快速填写

### 6.9 相关指标
- **待上门测量需求数量**：实时统计当前处于待上门状态的测量需求数量
- **平均上门时间**：从接单到上门的平均时间
- **上门及时率**：测量师在规定时间内完成上门的比例
- **改期率**：测量需求改期的比例
- **测量条件不满足率**：因现场条件不满足导致无法测量的比例

### 6.10 操作流程
1. 测量师在测量中-分配中状态下点击"接单"按钮，测量单进入"测量中-待上门"状态
2. 系统自动通知派单员和销售人员测量师已接单
3. 测量师与按照上门时间时效上门
4. 测量师按照预约时间上门测量
5. 测量师完成测量后，点击"开始测量"按钮，提交测量结果，在弹窗中检查，确认无误后，点击“完成测量”按钮。
6. 测量单状态自动更新为"测量中-待确认"
7. 如测量条件不满足，测量师可标记为异常，测量单状态退回重新安排
8. 客户或销售人员可取消测量需求，测量单状态更新为"已取消"

## 7. 测量中-待确认状态详细说明

### 7.1 状态定义
- **状态名称**：测量中-待确认
- **状态标识**：ORDER_STATUS.MEASURING_PENDING_CONFIRMATION
- **状态颜色**：🔵 蓝色
- **状态描述**：测量师已完成上门测量，提交了测量结果，等待销售确认

### 7.2 触发条件
- 测量师在测量中-待上门状态下点击"完成测量"按钮，提交测量结果后，测量单自动进入"测量中-待确认"状态
- 系统自动通知销售人员测量结果已提交，等待确认

### 7.3 流转规则
- **正向流转**：测量中-待确认 → 方案待确认（销售人员确认测量结果）
- **反向流转**：测量中-待确认 → 测量中-待上门（销售人员驳回测量结果，要求重新测量）
- **异常流转**：测量中-待确认 → 已取消（客户取消测量需求）

### 7.4 操作内容与规则
**操作内容**：
- **查看测量结果**：销售人员查看测量师提交的测量结果
- **确认测量结果**：销售人员确认测量结果无误
- **驳回测量结果**：销售人员驳回不符合要求的测量结果，要求重新测量
- **修改测量结果**：销售人员可修改测量结果（特殊情况）
- **取消测量**：客户或销售人员可取消测量需求

**确认规则**：
- 销售人员必须在48小时内确认或驳回测量结果
- 确认后，测量单自动进入"方案待确认"状态
- 驳回时必须填写驳回原因，测量单自动退回"测量中-待上门"状态

### 7.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 销售人员 | ⚡ 操作权限 | 查看测量结果、确认测量结果、驳回测量结果、修改测量结果（特殊情况）、取消测量需求 | 📎 测量结果单 |
| 销售负责人 | 📋 查看权限 | 查看测量结果、查看测量结果状态 | 📎 测量结果单 |
| 测量师 | 📋 查看权限 | 查看测量结果状态、查看驳回原因 | 📎 测量结果单 |
| 派单员 | 📋 查看权限 | 查看测量结果状态 | 📎 测量结果单 |

### 7.6 时效要求
- **确认时效**：销售人员必须在测量结果提交后48小时内确认或驳回
- **超时处理**：
  - 超过24小时未处理：系统自动预警给销售负责人和渠道负责人
  - 超过48小时未处理：扣5分
- **紧急测量**：紧急测量需求的测量结果必须在8小时内确认或驳回

### 7.7 异常处理
- **测量结果不符合要求**：销售人员驳回测量结果，要求重新测量
- **测量数据缺失**：销售人员驳回测量结果，要求补充测量数据
- **客户取消测量**：客户或销售人员取消测量需求，测量单状态更新为"已取消"

### 7.8 系统支持
- 提供测量中-待确认状态列表，支持按区域、测量师、提交时间等条件筛选
- 支持测量结果查看和对比，展示预估尺寸和实际尺寸
- 支持测量结果确认和驳回功能，带有原因填写
- 支持测量结果修改（特殊情况）
- 支持测量结果导出，便于后续使用
- 支持超时提醒和扣分记录

### 7.9 相关指标
- **待确认测量需求数量**：实时统计当前处于待确认状态的测量需求数量
- **平均确认时间**：从测量结果提交到确认的平均时间
- **确认及时率**：在规定时间内完成确认的比例
- **驳回率**：测量结果被驳回的比例
- **重新测量率**：因测量结果不符合要求导致重新测量的比例

### 7.10 操作流程
1. 测量师完成上门测量后，点击"完成测量"按钮，提交测量结果
2. 测量单状态自动更新为"测量中-待确认"
3. 系统自动通知销售人员测量结果已提交
4. 销售人员查看测量结果
5. 如测量结果符合要求，销售人员点击"确认测量结果"按钮
6. 测量单状态自动更新为"方案待确认"，报价单同步进入下一阶段
7. 如测量结果不符合要求，销售人员点击"驳回测量结果"按钮，填写驳回原因
8. 测量单状态自动退回"测量中-待上门"状态，测量师需重新测量
9. 客户或销售人员可取消测量需求，测量单状态更新为"已取消"

## 8. 方案待确认状态详细说明

### 8.1 状态定义
- **状态名称**：方案待确认
- **状态标识**：ORDER_STATUS.SCHEME_PENDING_CONFIRMATION
- **状态颜色**：🟣 紫色
- **状态描述**：测量结果已确认，等待客户确认设计方案

### 8.2 触发条件
- 销售人员在测量中-待确认状态下点击"确认测量结果"按钮后，测量单自动进入"方案待确认"状态
- 报价单同步进入下一阶段，与测量单状态保持关联
- 系统自动通知客户和相关人员设计方案待确认

### 8.3 流转规则
- **正向流转**：方案待确认 → 待推单（客户确认设计方案）
- **反向流转**：方案待确认 → 测量中-待确认（客户驳回设计方案，要求重新测量）
- **异常流转**：方案待确认 → 已取消（客户取消订单）

### 8.4 操作内容与规则
**操作内容**：
- **查看设计方案**：客户查看设计方案
- **确认设计方案**：客户确认设计方案无误
- **驳回设计方案**：客户驳回设计方案，要求修改或重新测量
- **修改设计方案**：设计师修改设计方案
- **取消订单**：客户或销售人员可取消订单

**确认规则**：
- 销售人员需要在72小时内和客户达成共识，完成确认
- 责任人为销售人员
- 确认后，测量单自动进入"待推单"状态
- 驳回时必须填写驳回原因
- 系统统计不同销售人员的平均确认时长

### 8.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 客户 | ⚡ 操作权限 | 后期可在微信小程序中对着报价单进行确认并签字 | 📎 报价单签字 |
| 销售人员 | ⚡ 操作权限 | 查看设计方案、取消订单、和客户达成共识完成确认 | 📎 设计方案单 |
| 销售负责人 | 📋 查看权限 | 查看设计方案状态 | 📎 设计方案单 |

### 8.6 时效要求
- **确认时效**：销售人员需要在72小时内和客户达成共识，完成确认
- **责任人**：销售人员
- **超时处理**：
  - 超过48小时未处理：系统自动预警给销售人员和销售负责人
  - 超过72小时未处理：系统自动提醒销售人员
- **统计要求**：系统统计不同销售人员的平均确认时长

### 8.7 异常处理
- **方案不符合要求**：客户驳回方案，要求重新测量
- **客户无响应**：超过72小时未处理，系统自动提醒销售人员
- **订单取消**：客户或销售人员取消订单，状态更新为"已取消"

### 8.8 系统支持
- 提供方案待确认状态列表，支持按区域、客户、销售人员等条件筛选
- 支持方案查看和对比
- 支持方案确认和驳回功能，带有原因填写
- 支持方案导出，便于后续使用
- 支持超时提醒功能
- 支持统计不同销售人员的平均确认时长
- 支持客户在微信小程序中对报价单进行确认并签字

### 8.9 相关指标
- **待确认方案数量**：实时统计当前处于方案待确认状态的数量
- **平均确认时间**：从方案提交到确认的平均时间
- **销售人员平均确认时长**：统计不同销售人员的平均确认时长
- **确认及时率**：在规定时间内完成确认的比例
- **驳回率**：方案被驳回的比例
- **重新测量率**：因方案不符合要求导致重新测量的比例

### 8.10 操作流程
1. 销售人员确认测量结果后，测量单进入"方案待确认"状态
2. 销售人员与客户沟通方案细节
3. 销售人员需要在72小时内和客户达成共识
4. 客户可通过以下方式确认：
   - 方式一：销售人员在系统中确认
   - 方式二：客户后期在微信小程序中对着报价单进行确认并签字
5. 确认后，测量单状态自动更新为"待推单"
6. 如方案不符合要求，客户驳回方案，填写驳回原因
7. 如需要重新测量，状态自动退回"测量中-待确认"
8. 客户或销售人员可取消订单，状态更新为"已取消"

## 9. 待推单状态详细说明

### 9.1 状态定义
- **状态名称**：待推单
- **状态标识**：ORDER_STATUS.PENDING_PUSH
- **状态颜色**：🟤 棕色
- **状态描述**：方案已确认，等待推单处理

### 9.2 触发条件
- 销售人员或客户确认设计方案后，测量单自动进入"待推单"状态
- 报价单同步进入待推单状态
- 系统自动通知销售人员和相关人员待推单

### 9.3 流转规则
- **正向流转**：待推单 → 待下单（推单完成，正向操作不需要审批，此过程生成销售单，销售单的第一个状态是"待下单"，报价单的状态是"待推单"）
- **反向流转**：待推单 → 方案待确认（推单失败，逆向操作需要审批）
- **异常流转**：待推单 → 已取消（客户取消订单）

### 9.4 操作内容与规则
**操作内容**：
- **查看待推单列表**：销售人员查看待推单列表
- **推单处理**：销售人员进行推单操作，需上传圣都HOME系统推单截图、填写结算金额并填写对应的圣都PO号
- **取消推单**：销售人员取消推单
- **取消订单**：客户或销售人员可取消订单

**推单规则**：
- 销售人员需要等待别人推单，无时效要求
- 正向操作：推单后，测量单自动进入"待下单"状态，不需要审批
- 逆向操作：推单失败时必须填写失败原因，需要审单，需要销售负责人和渠道负责人审批
- 推单时必须填写对应的圣都PO号，这是未来和圣都对账的号码

### 9.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 销售人员 | ⚡ 操作权限 | 查看待推单列表、推单处理（上传截图、填写结算金额、填写圣都PO号）、取消推单、取消订单 | 📎 圣都HOME系统推单截图 |
| 销售负责人 | 📋 查看权限 | 查看待推单状态 | 📎 推单记录 |
| 渠道负责人 | 📋 查看权限 | 查看待推单状态 | 📎 推单记录 |

### 9.6 时效要求
- **推单时效**：无时效要求，销售人员需要等待别人推单
- **超时处理**：无超时处理

### 9.7 异常处理
- **推单失败**：需要审单，状态退回"方案待确认"
- **订单取消**：客户或销售人员取消订单，状态更新为"已取消"

### 9.8 系统支持
- 提供待推单列表，支持按区域、客户、销售人员等条件筛选
- 支持推单操作和取消推单功能
- 支持上传圣都HOME系统推单截图
- 支持填写结算金额
- 支持推单记录查询

### 9.9 相关指标
- **待推单数量**：实时统计当前处于待推单状态的数量
- **推单失败率**：推单失败的比例
- **审批通过率**：推单审批通过的比例

### 9.10 操作流程
1. 方案确认后，测量单自动进入"待推单"状态
2. 销售人员查看待推单列表
3. 销售人员进行推单操作：
   - 上传圣都HOME系统推单截图
   - 填写结算金额
4. 推单后，生成销售单（销售单的第一个状态是"待下单"），测量单自动进入"待下单"状态（正向操作不需要审批），报价单的状态保持"待推单"
5. 如推单失败，需要审单，状态退回"方案待确认"
6. 客户或销售人员可取消订单，状态更新为"已取消"

## 10. 待下单状态详细说明

### 10.1 状态定义
- **状态名称**：待下单
- **状态标识**：ORDER_STATUS.PENDING_ORDER
- **状态颜色**：⚫ 黑色
- **状态描述**：推单已完成，等待下单处理

### 10.2 触发条件
- 销售人员完成推单操作后，测量单自动进入"待下单"状态
- 报价单同步进入待下单状态
- 系统自动通知销售人员和相关人员待下单

### 10.3 流转规则
- **正向流转**：待下单 → 生产中（订单客服审核通过）
- **反向流转**：待下单 → 待推单（下单失败，退回重新推单）
- **异常流转**：待下单 → 已取消（客户取消订单）

### 10.4 操作内容与规则
**操作内容**：
- **查看待下单列表**：销售人员和订单客服查看待下单列表
- **审核下单**：订单客服审核上传的HOME推单和销售单是否符合要求
  - 审核通过：进入"生产中"状态
  - 审核驳回：回到"待下单"状态，需填写驳回原因
- **修改备注**：销售人员可在备注中修改备注，主流程不能操作
- **取消订单**：客户或销售人员可取消订单

**下单规则**：
- 订单客服需要在48小时内完成审核
- 审核通过后，测量单自动进入"生产中"状态
- 审核驳回时必须填写驳回原因

### 10.5 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 销售人员 | ⚡ 操作权限 | 查看待下单列表、修改备注、取消订单 | 📎 订单信息 |
| 订单客服 | ⚡ 操作权限 | 查看待下单列表、审核下单（审核HOME推单和销售单是否符合要求） | 📎 HOME推单截图、销售单 |
| 销售负责人 | 📋 查看权限 | 查看待下单状态 | 📎 下单记录 |
| 客户 | 📋 查看权限 | 查看订单状态 | 📎 订单信息 |

### 10.6 时效要求
- **审核时效**：订单客服需要在48小时内完成审核
- **超时处理**：
  - 超过24小时未处理：系统自动提醒订单客服
  - 超过48小时未处理：系统自动预警给销售负责人

### 10.7 异常处理
- **审核驳回**：订单客服驳回，回到"待下单"状态，需填写驳回原因
- **订单取消**：客户或销售人员取消订单，状态更新为"已取消"

### 10.8 系统支持
- 提供待下单列表，支持按区域、客户、销售人员等条件筛选
- 支持订单客服审核功能，包括审核通过和驳回
- 支持销售人员修改备注功能
- 支持下单记录查询
- 支持超时提醒功能

### 10.9 相关指标
- **待下单数量**：实时统计当前处于待下单状态的数量
- **平均审核时间**：从待下单到审核完成的平均时间
- **审核及时率**：在规定时间内完成审核的比例
- **审核驳回率**：审核被驳回的比例

### 10. 操作流程
1. 推单完成后，测量单自动进入"待下单"状态
2. 订单客服查看待下单列表
3. 订单客服审核上传的HOME推单和销售单是否符合要求
4. 审核通过：测量单状态自动更新为"生产中"
5. 审核驳回：回到"待下单"状态，需填写驳回原因
6. 销售人员可修改备注或取消订单
7. 客户或销售人员可取消订单，状态更新为"已取消"

## 生产中状态详细说明

### 1. 状态定义
- **状态名称**：生产中
- **状态标识**：ORDER_STATUS.IN_PRODUCTION
- **状态颜色**：🔴 红色
- **状态描述**：订单客服审核通过，订单进入生产阶段

### 2. 触发条件
- 订单客服审核通过后，销售单进入"生产中"状态，同步测量单、报价单等进入"生产中"状态
- 系统自动通知相关人员订单已进入生产阶段

### 3. 流转规则
- **正向流转**：生产中 → 备货完成（生产完成，需上传每一个商品的采购截图和填写采购号，填写采购金额）
- **反向流转**：生产中 → 待下单（生产失败，退回重新下单）
- **异常流转**：生产中 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看生产状态**：销售人员、订单客服、销售负责人、渠道负责人查看生产状态
- **上传采购截图**：订单客服上传每一个商品的采购截图
- **填写采购信息**：订单客服填写采购号和采购金额
- **生成采购单**：订单客服支持多选商品生成一条采购单，一个销售单可对应多条采购单
- **点击备货完成**：订单客服根据实际情况，在对应的采购单后点击“备货完成”（采购单和商品明细是一对多关系，订单客服可以点击采购单号对应的“备货完成”）
- **修改备注**：订单客服、销售人员修改备注
- **整单发货**：销售人员点击“整单发货”指令
- **设置预计发货时间**：销售人员设置预计发货时间
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**生产规则**：
- 生产周期根据产品类型设定
- 每一条采购单OK后，订单客服点击该采购单号对应的“备货完成”按钮，当这个销售单对应的所有采购单都进入备货完成状态后，销售单自动进入"备货完成"状态，“整单发货”按钮被激活，变得可以被点击。
- 生产失败时必须填写失败原因

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 订单客服 | ⚡ 操作权限 | 查看生产状态、更新生产进度、点击备货完成、修改备注、生成采购单、上传采购截图、填写采购信息 | 📎 生产记录、采购截图、采购号 |
| 销售人员 | ⚡ 操作权限 | 查看生产状态、修改备注、整单发货、设置预计发货时间、取消订单 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看生产状态 | 📎 生产记录 |
| 渠道负责人 | 📋 查看权限 | 查看生产状态 | 📎 生产记录 |

### 6. 时效要求
- **生产周期**：
  - 窗帘：默认7天
  - 轨道：默认3天
  - 墙咔：默认15天
  - 墙布：默认7天
- **超时处理**：
  - 超过24小时未完成：系统自动提醒
  - 超过48小时未完成：系统自动报警
  - 提醒和报警对象：销售负责人、订单客服

### 7. 异常处理
- **生产失败**：订单客服或销售人员填写失败原因，状态退回"待下单"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供生产中状态列表，支持按区域、产品类型等条件筛选
- 支持生产进度更新和查询
- 支持生产周期提醒和报警
- 支持生产记录查询
- 支持上传采购截图
- 支持填写采购信息
- 支持多选商品生成采购单，一个销售单可对应多条采购单

### 9. 相关指标
- **生产中订单数量**：实时统计当前处于生产中状态的数量
- **平均生产时间**：从生产中到生产完成的平均时间
- **生产及时率**：在规定时间内完成生产的比例
- **生产失败率**：生产失败的比例

### 10. 操作流程
1. 订单客服审核通过后，销售单进入"生产中"状态，同步测量单、报价单等进入"生产中"状态
2. 订单客服上传每一个商品的采购截图
3. 订单客服填写采购号和采购金额
4. 订单客服填写采购单（支持多选商品生成一条采购单，一个销售单可对应多条采购单）
5. 订单客服更新生产进度
6. 当销售单对应的所有采购单都进入备货完成状态后，销售单自动进入"备货完成"状态
7. 如生产失败，订单客服或销售人员填写失败原因，状态退回"待下单"
8. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 备货完成状态

### 1. 基本信息
- **状态名称**：备货完成
- **状态标识**：ORDER_STATUS.STOCK_COMPLETED
- **状态颜色**：🟡 黄色
- **状态描述**：所有采购单都已完成备货，等待销售人员点击"整单发货"

### 2. 触发条件
- 当销售单对应的所有采购单都进入备货完成状态后，销售单自动进入"备货完成"状态
- 系统自动通知销售人员和相关人员备货已完成

### 3. 流转规则
- **正向流转**：备货完成 → 待发货（销售人员点击"整单发货"）
- **反向流转**：备货完成 → 生产中（备货失败，退回生产阶段）
- **异常流转**：备货完成 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看备货状态**：销售人员、订单客服、销售负责人、渠道负责人查看备货状态
- **修改备注**：销售人员、订单客服修改备注
- **整单发货**：销售人员点击"整单发货"按钮，将销售单推进到待发货状态
- **设置预计发货时间**：销售人员设置预计发货时间
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**备货规则**：
- 备货完成后，销售人员需要在规定时间内点击"整单发货"
- 整单发货后，系统自动生成待发货任务
- 整单发货时，销售人员可以设置预计发货时间辅助提醒他，也可以随时点击“整单发货”

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 销售人员 | ⚡ 操作权限 | 查看备货状态、修改备注、整单发货、设置预计发货时间、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看备货状态、修改备注 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看备货状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看备货状态 | 📎 无 |

### 6. 时效要求
- **整单发货时间**：备货完成后24小时内必须点击"整单发货"
- **超时处理**：
  - 超过24小时未整单发货：系统自动提醒
  - 超过48小时未整单发货：系统自动报警
  - 提醒和报警对象：销售负责人、销售人员

### 7. 异常处理
- **备货失败**：订单客服或销售人员填写失败原因，状态退回"生产中"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供备货完成状态列表，支持按区域、产品类型等条件筛选
- 支持备货状态查询
- 支持整单发货操作
- 支持整单发货提醒和报警
- 支持备货记录查询

### 9. 相关指标
- **备货完成订单数量**：实时统计当前处于备货完成状态的数量
- **平均备货时间**：从生产中到备货完成的平均时间
- **整单发货及时率**：在规定时间内完成整单发货的比例

### 10. 操作流程
1. 当销售单对应的所有采购单都进入备货完成状态后，销售单自动进入"备货完成"状态
2. 销售人员查看备货完成状态的销售单
3. 销售人员点击"整单发货"按钮
4. 销售单进入"待发货"状态
5. 如备货失败，订单客服或销售人员填写失败原因，状态退回"生产中"
6. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 待发货状态

### 1. 基本信息
- **状态名称**：待发货
- **状态标识**：ORDER_STATUS.TO_BE_SHIPPED
- **状态颜色**：🟢 绿色
- **状态描述**：销售人员已点击"整单发货"，等待订单客服填写快递单号

### 2. 触发条件
- 销售人员点击"整单发货"按钮后，销售单进入"待发货"状态
- 系统自动通知订单客服和相关人员待发货

### 3. 流转规则
- **正向流转**：待发货 → 安装中-待分配（所有采购单号都有了对应的快递单号后）
- **反向流转**：待发货 → 备货完成（发货失败，退回备货阶段）
- **异常流转**：待发货 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待发货状态**：销售人员、订单客服、销售负责人、渠道负责人查看待发货状态
- **修改备注**：销售人员、订单客服修改备注
- **填写快递单号**：订单客服为每一个采购单填写对应的快递单号
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**发货规则**：
- 订单客服需要为每一个采购单填写快递单号
- 当所有采购单号都有了对应的快递单号后，销售单自动进入"安装中-待分配"状态
- 快递单号填写后，系统自动验证快递单号的有效性

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 订单客服 | ⚡ 操作权限 | 查看待发货状态、修改备注、填写快递单号 | 📎 无 |
| 销售人员 | ⚡ 操作权限 | 查看待发货状态、修改备注、取消订单 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待发货状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待发货状态 | 📎 无 |

### 6. 时效要求
- **快递单号填写时间**：待发货后24小时内必须填写所有快递单号
- **超时处理**：
  - 超过24小时未填写：系统自动提醒
  - 超过48小时未填写：系统自动报警
  - 提醒和报警对象：销售负责人、订单客服

### 7. 异常处理
- **发货失败**：订单客服或销售人员填写失败原因，状态退回"备货完成"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供待发货状态列表，支持按区域、产品类型等条件筛选
- 支持快递单号填写和验证
- 支持待发货提醒和报警
- 支持发货记录查询

### 9. 相关指标
- **待发货订单数量**：实时统计当前处于待发货状态的数量
- **平均发货时间**：从待发货到安装中-待分配的平均时间
- **快递单号填写及时率**：在规定时间内完成快递单号填写的比例

### 10. 操作流程
1. 销售人员点击"整单发货"按钮后，销售单进入"待发货"状态
2. 订单客服查看待发货状态的销售单
3. 订单客服为每一个采购单填写对应的快递单号
4. 当所有采购单号都有了对应的快递单号后，销售单自动进入"安装中-待分配"状态
5. 如发货失败，订单客服或销售人员填写失败原因，状态退回"备货完成"
6. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 安装中-待分配状态

### 1. 基本信息
- **状态名称**：安装中-待分配
- **状态标识**：ORDER_STATUS.INSTALLATION_PENDING_ASSIGNMENT
- **状态颜色**：🔵 蓝色
- **状态描述**：所有快递单号已填写完成，等待派单员分配安装师

### 2. 触发条件
- 当销售单对应的所有采购单号都有了对应的快递单号后，销售单自动进入"安装中-待分配"状态
- 系统自动通知派单员和相关人员待分配安装

### 3. 流转规则
- **正向流转**：安装中-待分配 → 安装中-分配中（派单员开始分配安装师）
- **反向流转**：安装中-待分配 → 待发货（安装分配失败，退回发货阶段）
- **异常流转**：安装中-待分配 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待分配状态**：销售人员、派单员、订单客服、销售负责人、渠道负责人查看待分配状态
- **修改备注**：销售人员、订单客服修改备注
- **分配安装师**：派单员分配安装师
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**安装规则**：
- 派单员需要根据区域、安装师工作量等因素分配安装师
- 安装分配必须在规定时间内完成
- 分配安装师时，系统自动发送通知给安装师

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 派单员 | ⚡ 操作权限 | 查看待分配状态、分配安装师 | 📎 无 |
| 销售人员 | ⚡ 操作权限 | 查看待分配状态、修改备注、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看待分配状态、修改备注 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待分配状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待分配状态 | 📎 无 |

### 6. 时效要求
- **安装师分配时间**：安装中-待分配状态后4小时内必须分配安装师
- **超时处理**：
  - 超过4小时未分配：系统自动提醒
  - 超过8小时未分配：系统自动报警
  - 提醒和报警对象：销售负责人、派单员

### 7. 异常处理
- **分配失败**：派单员或销售人员填写失败原因，状态退回"待发货"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供安装中-待分配状态列表，支持按区域、产品类型等条件筛选
- 支持安装师分配和查询
- 支持安装师工作量统计
- 支持安装分配提醒和报警
- 支持安装记录查询

### 9. 相关指标
- **待分配安装订单数量**：实时统计当前处于安装中-待分配状态的数量
- **平均分配时间**：从安装中-待分配到安装中-分配中的平均时间
- **分配及时率**：在规定时间内完成安装师分配的比例

### 10. 操作流程
1. 当所有采购单号都有了对应的快递单号后，销售单自动进入"安装中-待分配"状态
2. 系统自动通知派单员和相关人员待分配安装
3. 派单员查看安装中-待分配状态的销售单
4. 派单员根据区域、安装师工作量等因素分配安装师
5. 销售单进入"安装中-分配中"状态
6. 如分配失败，派单员或销售人员填写失败原因，状态退回"待发货"
7. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 安装中-分配中状态

### 1. 基本信息
- **状态名称**：安装中-分配中
- **状态标识**：ORDER_STATUS.INSTALLATION_ASSIGNING
- **状态颜色**：🟣 紫色
- **状态描述**：派单员正在分配安装师，等待安装师接单

### 2. 触发条件
- 派单员点击"分配安装师"按钮后，销售单进入"安装中-分配中"状态
- 系统自动通知安装师和相关人员待接单

### 3. 流转规则
- **正向流转**：安装中-分配中 → 安装中-待上门（安装师接单确认）
- **反向流转**：安装中-分配中 → 安装中-待分配（安装师拒绝接单，退回重新分配）
- **异常流转**：安装中-分配中 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看分配中状态**：销售人员、派单员、安装师、订单客服、销售负责人、渠道负责人查看分配中状态
- **修改备注**：销售人员、订单客服修改备注
- **接单**：安装师接单确认
- **拒绝接单**：安装师拒绝接单
- **重新分配**：派单员重新分配安装师
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**安装规则**：
- 安装师需要在规定时间内接单或拒绝接单
- 安装师拒绝接单后，派单员需要重新分配安装师
- 分配中状态必须在规定时间内完成流转

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 安装师 | ⚡ 操作权限 | 查看分配中状态、接单、拒绝接单 | 📎 无 |
| 派单员 | ⚡ 操作权限 | 查看分配中状态、重新分配安装师 | 📎 无 |
| 销售人员 | ⚡ 操作权限 | 查看分配中状态、修改备注、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看分配中状态、修改备注 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看分配中状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看分配中状态 | 📎 无 |

### 6. 时效要求
- **安装师接单时间**：安装中-分配中状态后2小时内必须接单或拒绝接单
- **超时处理**：
  - 超过2小时未接单：系统自动提醒
  - 超过4小时未接单：系统自动报警，派单员需要重新分配
  - 提醒和报警对象：销售负责人、派单员、安装师

### 7. 异常处理
- **接单失败**：安装师拒绝接单，状态退回"安装中-待分配"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供安装中-分配中状态列表，支持按区域、产品类型等条件筛选
- 支持安装师接单和拒绝接单
- 支持派单员重新分配安装师
- 支持安装分配提醒和报警
- 支持安装记录查询

### 9. 相关指标
- **分配中安装订单数量**：实时统计当前处于安装中-分配中状态的数量
- **平均接单时间**：从安装中-分配中到安装中-待上门的平均时间
- **接单率**：安装师接单的比例
- **拒绝率**：安装师拒绝接单的比例

### 10. 操作流程
1. 派单员点击"分配安装师"按钮后，销售单进入"安装中-分配中"状态
2. 系统自动通知安装师和相关人员待接单
3. 安装师查看安装中-分配中状态的销售单
4. 安装师选择接单或拒绝接单
5. 如安装师接单，销售单进入"安装中-待上门"状态
6. 如安装师拒绝接单，销售单退回"安装中-待分配"状态，派单员需要重新分配
7. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 安装中-待上门状态

### 1. 基本信息
- **状态名称**：安装中-待上门
- **状态标识**：ORDER_STATUS.INSTALLATION_PENDING_VISIT
- **状态颜色**：🟡 黄色
- **状态描述**：安装师已接单，等待上门安装

### 2. 触发条件
- 安装师点击"接单"按钮确认后，销售单进入"安装中-待上门"状态
- 系统自动通知客户、销售人员和相关人员待上门安装

### 3. 流转规则
- **正向流转**：安装中-待上门 → 安装中-待确认（安装师完成上门安装）
- **反向流转**：安装中-待上门 → 安装中-分配中（安装师取消接单，退回分配阶段）
- **异常流转**：安装中-待上门 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待上门状态**：销售人员、派单员、安装师、客户、订单客服、销售负责人、渠道负责人查看待上门状态
- **修改备注**：销售人员、订单客服修改备注
- **确认上门时间**：安装师与客户确认上门时间
- **修改上门时间**：安装师、销售人员修改上门时间
- **完成安装**：安装师完成上门安装，提交安装结果
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**安装规则**：
- 安装师必须在规定时间内上门安装
- 上门安装前，安装师必须与客户确认上门时间
- 安装完成后，安装师必须提交安装结果

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 安装师 | ⚡ 操作权限 | 查看待上门状态、确认上门时间、修改上门时间、完成安装 | 📎 安装记录 |
| 销售人员 | ⚡ 操作权限 | 查看待上门状态、修改备注、修改上门时间、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看待上门状态、修改备注 | 📎 无 |
| 客户 | 📋 查看权限 | 查看待上门状态、确认上门时间 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待上门状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待上门状态 | 📎 无 |

### 6. 时效要求
- **上门安装时间**：安装师接单后7天内必须完成上门安装
- **超时处理**：
  - 超过3天未上门：系统自动提醒
  - 超过7天未上门：系统自动报警
  - 提醒和报警对象：销售负责人、派单员、安装师

### 7. 异常处理
- **安装失败**：安装师填写失败原因，状态退回"安装中-分配中"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供安装中-待上门状态列表，支持按区域、产品类型等条件筛选
- 支持上门时间确认和修改
- 支持安装结果提交
- 支持安装周期提醒和报警
- 支持安装记录查询

### 9. 相关指标
- **待上门安装订单数量**：实时统计当前处于安装中-待上门状态的数量
- **平均上门时间**：从安装中-待上门到安装中-待确认的平均时间
- **安装及时率**：在规定时间内完成上门安装的比例
- **安装失败率**：安装失败的比例

### 10. 操作流程
1. 安装师点击"接单"按钮确认后，销售单进入"安装中-待上门"状态
2. 系统自动通知客户、销售人员和相关人员待上门安装
3. 安装师与客户确认上门时间
4. 安装师上门完成安装
5. 安装师提交安装结果，销售单进入"安装中-待确认"状态
6. 如安装失败，安装师填写失败原因，状态退回"安装中-分配中"
7. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 安装中-待确认状态

### 1. 基本信息
- **状态名称**：安装中-待确认
- **状态标识**：ORDER_STATUS.INSTALLATION_PENDING_CONFIRMATION
- **状态颜色**：🟢 绿色
- **状态描述**：安装师已完成上门安装，等待销售人员确认安装结果

### 2. 触发条件
- 安装师点击"完成安装"按钮，提交安装结果后，销售单进入"安装中-待确认"状态
- 系统自动通知销售人员和相关人员待确认安装结果

### 3. 流转规则
- **正向流转**：安装中-待确认 → 待对账（销售人员把上传到HOME系统后的截图上传到销售单）
- **反向流转**：安装中-待确认 → 安装中-待上门（安装结果不合格，退回重新安装）
- **异常流转**：安装中-待确认 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待确认状态**：销售人员、派单员、安装师、客户、订单客服、销售负责人、渠道负责人查看待确认状态
- **修改备注**：销售人员、订单客服修改备注
- **上传安装图片到home系统**：销售人员把安装图片上传到圣都HOME系统
- **上传截图到销售单**：销售人员把上传到HOME系统后的截图，上传到“安装中-待确认”的销售单
- **确认安装结果**：销售人员确认安装结果合格
- **驳回安装结果**：销售人员驳回安装结果，要求重新安装
- **重新安装**：安装师重新上门安装
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**安装规则**：
- 销售人员必须在规定时间内完成安装图片上传和确认安装结果
- 销售人员必须先把安装图片上传到圣都HOME系统，然后把上传后的截图上传到销售单
- 当销售人员完成截图上传后，销售单自动进入"待对账"状态
- 安装结果驳回后，安装师必须重新上门安装

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 销售人员 | ⚡ 操作权限 | 查看待确认状态、修改备注、上传安装图片到home系统、上传截图到销售单、确认安装结果、驳回安装结果、取消订单 | 📎 HOME系统上传截图 |
| 安装师 | ⚡ 操作权限 | 查看待确认状态、重新安装 | 📎 安装记录 |
| 订单客服 | ⚡ 操作权限 | 查看待确认状态、修改备注 | 📎 无 |
| 客户 | 📋 查看权限 | 查看待确认状态 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待确认状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待确认状态 | 📎 无 |

### 6. 时效要求
- **安装图片上传和截图上传时间**：安装师提交安装结果后24小时内必须完成
- **超时处理**：
  - 超过24小时未完成：系统自动提醒
  - 超过48小时未完成：系统自动报警
  - 提醒和报警对象：销售负责人、销售人员

### 7. 异常处理
- **安装结果不合格**：销售人员驳回安装结果，状态退回"安装中-待上门"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供安装中-待确认状态列表，支持按区域、产品类型等条件筛选
- 支持安装结果确认和驳回
- 支持重新安装操作
- 支持安装结果提醒和报警
- 支持安装记录查询

### 9. 相关指标
- **待确认安装订单数量**：实时统计当前处于安装中-待确认状态的数量
- **平均确认时间**：从安装中-待确认到待对账的平均时间
- **安装合格率**：安装结果合格的比例
- **重新安装率**：需要重新安装的比例

### 10. 操作流程
1. 安装师点击"完成安装"按钮，提交安装结果后，销售单进入"安装中-待确认"状态
2. 系统自动通知销售人员和相关人员待处理安装结果
3. 销售人员查看安装结果
4. 销售人员把安装图片上传到圣都HOME系统
5. 销售人员把上传到HOME系统后的截图，上传到"安装中-待确认"的销售单
6. 当销售人员完成截图上传后，销售单自动进入"待对账"状态
7. 如安装结果不合格，销售人员驳回安装结果，销售单退回"安装中-待上门"状态，安装师需要重新上门安装
8. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 待对账状态

### 1. 基本信息
- **状态名称**：待对账
- **状态标识**：ORDER_STATUS.TO_BE_RECONCILED
- **状态颜色**：🔵 蓝色
- **状态描述**：安装已完成，等待对账员进行对账

### 2. 触发条件
- 当销售人员完成安装图片上传和截图上传后，销售单自动进入"待对账"状态
- 系统自动通知对账员和相关人员待对账

### 3. 流转规则
- **正向流转**：待对账 → 待开发票（对账员完成对账）
- **反向流转**：待对账 → 安装中-待确认（对账失败，退回安装阶段）
- **异常流转**：待对账 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待对账状态**：对账员、销售人员、订单客服、销售负责人、渠道负责人查看待对账状态
- **修改备注**：对账员、销售人员、订单客服修改备注
- **搜索待对账销售单**：对账员可以通过销售单对应的圣都PO号来进行搜索
- **多选销售单**：对账员可以多选待对账的销售单
- **生成对账单**：对账员点击"对账"按钮，系统自动生成对账单
- **比对圣都对账单**：对账员将系统生成的对账单与圣都的对账单进行比对
- **上传圣都对账单**：如果没有差异，对账员上传圣都对账单
- **对账完成**：上传圣都对账单后，对账员点击"对账完成"按钮
- **调整差异**：如果有差异，对账员先进行调整
- **提交审批流程**：如果差异无法调整，对账员提交审批流程（涉及销售负责人、渠道负责人、领导）
- **驳回对账**：对账员驳回对账，要求重新核对
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**对账规则**：
- 对账员必须在规定时间内完成对账
- 对账前，对账员可以通过圣都PO号搜索或多选销售单
- 对账时，系统自动生成对账单，对账员必须与圣都对账单进行比对
- 如果没有差异，对账员上传圣都对账单后，点击"对账完成"按钮
- 如果有差异，对账员必须先进行调整，无法调整的必须走审批流程
- 审批流程涉及销售负责人、渠道负责人、领导三级审批
- 对账完成后，销售单自动进入"待开发票"状态
- 对账失败后，必须填写失败原因，退回安装阶段

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 对账员 | ⚡ 操作权限 | 查看待对账状态、修改备注、搜索待对账销售单、多选销售单、生成对账单、比对圣都对账单、上传圣都对账单、对账完成、调整差异、提交审批流程、驳回对账 | 📎 圣都对账单 |
| 销售人员 | ⚡ 操作权限 | 查看待对账状态、修改备注、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看待对账状态、修改备注 | 📎 无 |
| 销售负责人 | ⚡ 操作权限 | 查看待对账状态、审批差异调整申请 | 📎 无 |
| 渠道负责人 | ⚡ 操作权限 | 查看待对账状态、审批差异调整申请 | 📎 无 |
| 领导 | ⚡ 操作权限 | 查看待对账状态、审批差异调整申请 | 📎 无 |

### 6. 时效要求
- **对账时间**：销售单进入待对账状态后3个工作日内必须完成对账
- **发票开具时间**：对账完成后1个工作日内必须开具销售发票
- **超时处理**：
  - 超过3个工作日未对账：系统自动提醒
  - 超过5个工作日未对账：系统自动报警
  - 超过1个工作日未开具发票：系统自动提醒
  - 提醒和报警对象：财务负责人、对账员

### 7. 异常处理
- **对账失败**：对账员填写失败原因，状态退回"安装中-待确认"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供待对账状态列表，支持按区域、产品类型、圣都PO号等条件筛选
- 支持通过圣都PO号搜索待对账销售单
- 支持多选待对账销售单
- 支持自动生成对账单
- 支持对账单比对功能
- 支持圣都对账单上传
- 支持对账完成操作
- 支持差异调整功能
- 支持审批流程提交和处理
- 支持销售发票开具和发票单号填写
- 支持对账提醒和报警
- 支持对账记录查询
- 支持审批记录查询

### 9. 相关指标
- **待对账订单数量**：实时统计当前处于待对账状态的数量
- **对账单生成数量**：实时统计已生成的对账单数量
- **平均对账时间**：从待对账到待回款的平均时间
- **对账及时率**：在规定时间内完成对账的比例
- **对账失败率**：对账失败的比例
- **差异率**：有差异的对账单占总对账单的比例
- **差异调整成功率**：差异调整成功的比例
- **审批通过率**：差异审批通过的比例
- **平均审批时间**：差异审批的平均时间

### 10. 操作流程
1. 当销售人员完成截图上传后，销售单自动进入"待对账"状态
2. 系统自动通知对账员和相关人员待对账
3. 对账员查看待对账状态的销售单
4. 对账员通过圣都PO号搜索或多选待对账的销售单
5. 对账员点击"对账"按钮，系统自动生成对账单
6. 对账员将系统生成的对账单与圣都的对账单进行比对
7. **无差异情况**：
   a. 对账员上传圣都对账单
   b. 对账员点击"对账完成"按钮
   c. 销售单自动进入"待开发票"状态
8. **有差异情况**：
   a. 对账员先进行调整
   b. 如果差异可以调整，执行无差异情况的后续步骤
   c. 如果差异无法调整，对账员提交审批流程
   d. 销售负责人、渠道负责人、领导依次审批
   e. 审批通过后，执行无差异情况的后续步骤
   f. 审批不通过，对账员重新调整或驳回对账
9. **对账失败情况**：
   a. 对账员填写失败原因
   b. 销售单状态退回"安装中-待确认"
10. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 待开发票状态

### 1. 基本信息
- **状态名称**：待开发票
- **状态标识**：ORDER_STATUS.TO_BE_INVOICED
- **状态颜色**：🟠 橙色
- **状态描述**：对账已完成，等待对账员开具销售发票并上传

### 2. 触发条件
- 当对账员完成对账后，销售单自动进入"待开发票"状态
- 系统自动通知对账员和相关人员待开发票

### 3. 流转规则
- **正向流转**：待开发票 → 待回款（对账员上传销售发票）
- **反向流转**：待开发票 → 待对账（开票失败，退回对账阶段）
- **异常流转**：待开发票 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待开发票状态**：对账员、销售人员、订单客服、销售负责人、渠道负责人查看待开发票状态
- **修改备注**：对账员、销售人员、订单客服修改备注
- **开具销售发票**：对账员开具销售发票
- **上传销售发票**：对账员上传销售发票
- **驳回开票**：对账员驳回开票，要求重新开具
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**开票规则**：
- 对账员必须在规定时间内完成开票
- 开票完成后，对账员必须上传销售发票
- 当对账员完成销售发票上传后，销售单自动进入"待回款"状态
- 开票失败后，必须填写失败原因，退回对账阶段

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 对账员 | ⚡ 操作权限 | 查看待开发票状态、修改备注、开具销售发票、上传销售发票、驳回开票 | 📎 销售发票 |
| 销售人员 | ⚡ 操作权限 | 查看待开发票状态、修改备注、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看待开发票状态、修改备注 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待开发票状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待开发票状态 | 📎 无 |

### 6. 时效要求
- **开票时间**：销售单进入待开发票状态后3个工作日内必须完成开票
- **超时处理**：
  - 超过3个工作日未开票：系统自动提醒
  - 超过5个工作日未开票：系统自动报警
  - 提醒和报警对象：财务负责人、对账员

### 7. 异常处理
- **开票失败**：对账员填写失败原因，状态退回"待对账"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供待开发票状态列表，支持按区域、产品类型等条件筛选
- 支持销售发票开具和上传
- 支持开票提醒和报警
- 支持开票记录查询

### 9. 相关指标
- **待开发票订单数量**：实时统计当前处于待开发票状态的数量
- **平均开票时间**：从待开发票到待回款的平均时间
- **开票及时率**：在规定时间内完成开票的比例
- **开票失败率**：开票失败的比例

### 10. 操作流程
1. 当对账员完成对账后，销售单自动进入"待开发票"状态
2. 系统自动通知对账员和相关人员待开发票
3. 对账员查看待开发票状态的销售单
4. 对账员开具销售发票
5. 对账员上传销售发票
6. 当对账员完成销售发票上传后，销售单自动进入"待回款"状态
7. 如开票失败，对账员填写失败原因，状态退回"待对账"
8. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 待回款状态

### 1. 基本信息
- **状态名称**：待回款
- **状态标识**：ORDER_STATUS.TO_BE_PAID
- **状态颜色**：🟡 黄色
- **状态描述**：对账员已上传销售发票，等待客户回款

### 2. 触发条件
- 当对账员上传销售发票后，销售单自动进入"待回款"状态
- 系统自动通知销售人员、客户和相关人员待回款

### 3. 流转规则
- **正向流转**：待回款 → 已完成（对账员上传回款水单）
- **反向流转**：待回款 → 待开发票（回款失败，退回开票阶段）
- **异常流转**：待回款 → 已取消（客户取消订单，需要审批流程）

### 4. 操作内容与规则
**操作内容**：
- **查看待回款状态**：对账员、销售人员、客户、订单客服、销售负责人、渠道负责人查看待回款状态
- **修改备注**：对账员、销售人员、订单客服修改备注
- **上传回款水单**：对账员上传回款水单
- **驳回回款**：对账员驳回回款，要求重新核对
- **取消订单**：客户或销售人员可取消订单（需要审批流程）

**回款规则**：
- 对账员必须在规定时间内上传回款水单
- 当对账员上传回款水单后，对账单状态从"待回款"变成"已完成"
- 回款失败后，必须填写失败原因，退回开票阶段

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 对账员 | ⚡ 操作权限 | 查看待回款状态、修改备注、上传回款水单、驳回回款 | 📎 回款水单 |
| 销售人员 | ⚡ 操作权限 | 查看待回款状态、修改备注、取消订单 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看待回款状态、修改备注 | 📎 无 |
| 客户 | 📋 查看权限 | 查看待回款状态 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看待回款状态 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看待回款状态 | 📎 无 |

### 6. 时效要求
- **回款时间**：销售单进入待回款状态后30天内必须完成回款
- **超时处理**：
  - 超过15天未回款：系统自动提醒
  - 超过30天未回款：系统自动报警
  - 超过45天未回款：系统自动标记为异常
  - 提醒和报警对象：销售负责人、财务负责人、销售人员

### 7. 异常处理
- **回款失败**：对账员填写失败原因，状态退回"待开发票"
- **订单取消**：销售人员取消订单，状态更新为"已取消"（需要审批流程）

### 8. 系统支持
- 提供待回款状态列表，支持按区域、产品类型等条件筛选
- 支持回款水单上传
- 支持回款提醒和报警
- 支持回款记录查询

### 9. 相关指标
- **待回款订单数量**：实时统计当前处于待回款状态的数量
- **平均回款时间**：从待回款到已完成的平均时间
- **回款及时率**：在规定时间内完成回款的比例
- **回款失败率**：回款失败的比例

### 10. 操作流程
1. 当对账员上传销售发票后，销售单自动进入"待回款"状态
2. 系统自动通知销售人员、客户和相关人员待回款
3. 对账员查看待回款状态的销售单
4. 客户完成回款
5. 对账员上传回款水单
6. 当对账员上传回款水单后，销售单自动进入"已完成"状态
7. 如回款失败，对账员填写失败原因，状态退回"待开发票"
8. 销售人员可取消订单，状态更新为"已取消"（需要审批流程）

---

## 已完成状态

### 1. 基本信息
- **状态名称**：已完成
- **状态标识**：ORDER_STATUS.COMPLETED
- **状态颜色**：🟢 绿色
- **状态描述**：回款确认完成，订单结束

### 2. 触发条件
- 当对账员完成回款确认后，销售单自动进入"已完成"状态
- 系统自动通知所有相关人员订单已完成

### 3. 流转规则
- **正向流转**：已完成 → 无（订单结束，无后续状态）
- **反向流转**：已完成 → 无（订单已结束，不可逆向流转）
- **异常流转**：已完成 → 无（订单已结束，不可异常流转）

### 4. 操作内容与规则
**操作内容**：
- **查看已完成状态**：所有角色均可查看已完成状态的订单
- **修改备注**：对账员、销售人员、订单客服修改备注
- **查看订单详情**：所有角色均可查看已完成订单的详细信息
- **查看订单历史**：所有角色均可查看已完成订单的历史记录

**完成规则**：
- 订单完成后，不可进行任何状态流转操作
- 订单完成后，可查看但不可修改订单核心信息
- 订单完成后，系统自动归档订单数据

### 5. 权限控制
| 角色 | 权限类型 | 具体操作 | 必需附件 |
|------|----------|----------|----------|
| 对账员 | ⚡ 操作权限 | 查看已完成状态、修改备注、查看订单详情、查看订单历史 | 📎 无 |
| 销售人员 | ⚡ 操作权限 | 查看已完成状态、修改备注、查看订单详情、查看订单历史 | 📎 无 |
| 订单客服 | ⚡ 操作权限 | 查看已完成状态、修改备注、查看订单详情、查看订单历史 | 📎 无 |
| 客户 | 📋 查看权限 | 查看已完成状态、查看订单详情、查看订单历史 | 📎 无 |
| 销售负责人 | 📋 查看权限 | 查看已完成状态、查看订单详情、查看订单历史 | 📎 无 |
| 渠道负责人 | 📋 查看权限 | 查看已完成状态、查看订单详情、查看订单历史 | 📎 无 |
| 管理员 | ⚡ 操作权限 | 查看已完成状态、修改备注、查看订单详情、查看订单历史、订单归档 | 📎 无 |

### 6. 时效要求
- **订单归档时间**：订单完成后7天内自动归档
- **超时处理**：
  - 超过7天未归档：系统自动提醒
  - 提醒对象：系统管理员

### 7. 异常处理
- **订单已完成**：订单已结束，不可进行任何异常处理

### 8. 系统支持
- 提供已完成状态列表，支持按区域、产品类型、时间等条件筛选
- 支持订单详情查询
- 支持订单历史记录查询
- 支持订单数据归档
- 支持已完成订单统计分析

### 9. 相关指标
- **已完成订单数量**：实时统计已完成状态的订单数量
- **订单完成率**：已完成订单占总订单的比例
- **平均订单周期**：从线索到已完成的平均时间
- **客户满意度**：已完成订单的客户满意度评分

### 10. 操作流程
1. 当对账员完成回款确认后，销售单自动进入"已完成"状态
2. 系统自动通知所有相关人员订单已完成
3. 相关人员可查看已完成订单的详情和历史记录
4. 对账员、销售人员、订单客服可修改已完成订单的备注
5. 订单完成后7天内，系统自动归档订单数据
6. 已完成订单不可进行任何状态流转操作