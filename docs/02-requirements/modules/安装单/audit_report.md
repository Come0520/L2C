# å®‰è£…å•æ¨¡å—å®¡è®¡æŠ¥å‘Š (Audit Report: Installation Module)

> **å®¡è®¡æ—¥æœŸ**: 2026-01-17
> **å®¡è®¡å¯¹è±¡**: å®‰è£…å• (Installation)
> **å¯¹æ¯”åŸºå‡†**: `docs/02-requirements/modules/å®‰è£…å•/å®‰è£…å•.md`
> **å½“å‰ç‰ˆæœ¬**: ä»£ç åº“ `src/features/service/installation`

---

## 1. æ€»ä½“è¯„ä¼° (Executive Summary)

å½“å‰å®‰è£…æ¨¡å—çš„åŸºç¡€ CRUD (åˆ›å»ºã€åˆ—è¡¨ã€è¯¦æƒ…) å·²å®žçŽ°ï¼Œæ•°æ®åº“ Schema è®¾è®¡è¾ƒä¸ºå®Œå–„ï¼Œè¦†ç›–äº†å¤§éƒ¨åˆ†æ ¸å¿ƒå­—æ®µã€‚

**ä¸»è¦å·®è· (Key Gaps)**ï¼š

1.  **ç”µå­ç­¾å (Digital Signature)**ï¼šSchema å·²æ”¯æŒï¼Œä½† API å’Œå‰ç«¯ UI å®Œå…¨ç¼ºå¤±ã€‚
2.  **è°ƒåº¦å†²çªæ£€æµ‹ (Scheduling Conflict)**ï¼šä¸šåŠ¡é€»è¾‘å±‚ç¼ºå¤±å†²çªæ£€æµ‹ç®—æ³•ï¼Œå‰ç«¯ç»„ä»¶ `SmartWorkerSelector` ä»ä¸º Mock æ•°æ®ã€‚
3.  **ç‰©æµè”åŠ¨ (Logistics Integration)**ï¼šç¼ºå¤± "è´§é½æ‰å…è®¸æ´¾å•" çš„æ ¡éªŒé€»è¾‘ã€‚
4.  **UI/UX å®Œæˆåº¦**ï¼šéƒ¨åˆ†ç»„ä»¶ (å¦‚ `InstallDispatchDialog`) åŠŸèƒ½ç®€é™‹ï¼Œæœªå®žçŽ°é«˜çº§ç­›é€‰å’Œå¯è§†åŒ–è°ƒåº¦ã€‚

---

## 2. å·®å¼‚è¯¦ç»†åˆ†æž (Detailed Analysis)

### 2.1 å®¢æˆ·ç”µå­ç­¾å (Digital Signature)

| ç»´åº¦       | éœ€æ±‚æè¿°                                     | å½“å‰å®žçŽ°                                                              | å·®å¼‚ç­‰çº§        |
| :--------- | :------------------------------------------- | :-------------------------------------------------------------------- | :-------------- |
| **Schema** | éœ€å­˜å‚¨ `customer_signature_url`, `signed_at` | **å·²å®žçŽ°**: `installTasks` è¡¨ä¸­åŒ…å«ç›¸åº”å­—æ®µ                           | âœ… æ— å·®å¼‚       |
| **Action** | `confirm` æˆ– `checkOut` æ—¶æäº¤ç­¾åå›¾         | **ç¼ºå¤±**: `checkOutInstallTaskAction` ä»…æŽ¥æ”¶ locationï¼Œæœªå¤„ç†ç­¾åä¸Šä¼  | ðŸ”´ **ä¸¥é‡ç¼ºå¤±** |
| **UI**     | å°ç¨‹åº/H5 ç”»å¸ƒç­¾åï¼Œè‡ªåŠ¨ç”Ÿæˆæ°´å°å›¾           | **ç¼ºå¤±**: `SubmitInstallCompletionDialog` æ— ç­¾åå…¥å£                  | ðŸ”´ **ä¸¥é‡ç¼ºå¤±** |

### 2.2 è°ƒåº¦å†²çªæ£€æµ‹ (Conflict Detection)

| ç»´åº¦      | éœ€æ±‚æè¿°                                    | å½“å‰å®žçŽ°                                                                       | å·®å¼‚ç­‰çº§        |
| :-------- | :------------------------------------------ | :----------------------------------------------------------------------------- | :-------------- |
| **Logic** | å¼ºå†²çª(åŒæ—¶é—´æ®µç¦æ­¢) & è½¯å†²çª(è·ç¦»è¿‡è¿œè­¦å‘Š) | **ç¼ºå¤±**: `dispatchInstallTaskAction` ç›´æŽ¥æ›´æ–°çŠ¶æ€ï¼Œæ— ä»»ä½•æ£€æŸ¥é€»è¾‘             | ðŸ”´ **ä¸¥é‡ç¼ºå¤±** |
| **Logic** | èŽ·å–æ­¤æ—¶æ®µå¯ç”¨å¸ˆå‚…åˆ—è¡¨                      | **ç®€é™‹**: `getInstallWorkersAction` ä»…è¿”å›žæ‰€æœ‰ WORKER è§’è‰²ç”¨æˆ·ï¼Œæœªè¿‡æ»¤å¿™ç¢ŒçŠ¶æ€ | ðŸŸ  éƒ¨åˆ†ç¼ºå¤±     |
| **UI**    | æ´¾å•å¼¹çª—æç¤ºå†²çª/è­¦å‘Š                       | **ç¼ºå¤±**: `InstallDispatchDialog` æœªå±•ç¤ºè­¦å‘Šä¿¡æ¯                               | ðŸ”´ **ä¸¥é‡ç¼ºå¤±** |
| **UI**    | æ™ºèƒ½é€‰äººç»„ä»¶                                | **Mock**: `SmartWorkerSelector` ä½¿ç”¨ç¡¬ç¼–ç çš„ Mock æ•°æ® (`Worker A/B`)          | ðŸ”´ **ä¸¥é‡ç¼ºå¤±** |

### 2.3 ç‰©æµä¸Žåº“å­˜è”åŠ¨ (Logistics Integration)

| ç»´åº¦      | éœ€æ±‚æè¿°                            | å½“å‰å®žçŽ°                                                                                     | å·®å¼‚ç­‰çº§        |
| :-------- | :---------------------------------- | :------------------------------------------------------------------------------------------- | :-------------- |
| **Logic** | æ´¾å•å‰æ ¡éªŒ `logistics_ready_status` | **ç¼ºå¤±**: `dispatchInstallTaskAction` æœªæ£€æŸ¥å…³è”é‡‡è´­å•çŠ¶æ€                                   | ðŸŸ  **åŠŸèƒ½ç¼ºå¤±** |
| **Data**  | å®žæ—¶æ›´æ–°è´§é½çŠ¶æ€                    | **æœªæŸ¥è¯**: éœ€æ£€æŸ¥ `purchase-orders` æ¨¡å—æ˜¯å¦æœ‰å›žè°ƒ update å®‰è£…å•çŠ¶æ€ (æœ¬æ¬¡å®¡è®¡æœªè§ç›¸å…³å¼•ç”¨) | âš ï¸ éœ€ç¡®è®¤       |

### 2.4 è¿”å·¥ä¸Žå”®åŽ (Rework Logic)

| ç»´åº¦      | éœ€æ±‚æè¿°                  | å½“å‰å®žçŽ°                                                            | å·®å¼‚ç­‰çº§  |
| :-------- | :------------------------ | :------------------------------------------------------------------ | :-------- |
| **Logic** | é©³å›žè¿”å·¥ (åŒä¸€å•çŠ¶æ€å›žæ»š) | **å·²å®žçŽ°**: `rejectInstallationAction` å°†çŠ¶æ€é‡ç½®ä¸º `PENDING_VISIT` | âœ… æ— å·®å¼‚ |
| **Logic** | å”®åŽè¿”å·¥ (ç‹¬ç«‹æ–°å•)       | **å·²å®žçŽ°**: `createInstallTaskAction` æ”¯æŒ `sourceType='REWORK'`    | âœ… æ— å·®å¼‚ |

### 2.5 æµç¨‹ä¸Žè¿½è¸ª (Tracking)

| ç»´åº¦      | éœ€æ±‚æè¿°                                 | å½“å‰å®žçŽ°                                                | å·®å¼‚ç­‰çº§    |
| :-------- | :--------------------------------------- | :------------------------------------------------------ | :---------- |
| **Logic** | ç­¾åˆ°/ç­¾é€€ (GPS + æ—¶é—´)                   | **å·²å®žçŽ°**: Action æ”¯æŒæ›´æ–° checkIn/checkOut æ—¶é—´ä¸Žä½ç½® | âœ… æ— å·®å¼‚   |
| **Field** | å®žé™…å·¥æ—¶è®¡ç®— (`ActualEnd - ActualStart`) | **éšå¼å®žçŽ°**: å­—æ®µå­˜åœ¨ï¼Œä½† UI ä¸Šæœªå±•ç¤ºè‡ªåŠ¨è®¡ç®—çš„å·¥æ—¶    | ðŸ”µ ä½“éªŒä¼˜åŒ– |

---

## 3. æ•´æ”¹å»ºè®® (Recommendations)

### 3.1 å¿…é¡»ç«‹å³ä¿®å¤ (P0)

1.  **å®Œå–„ `SmartWorkerSelector` ç»„ä»¶**ï¼šç§»é™¤ Mock æ•°æ®ï¼Œå¯¹æŽ¥çœŸå®ž APIï¼Œå¹¶å®žçŽ° "å†²çªæ£€æµ‹" é€»è¾‘ã€‚
2.  **å®žçŽ°ç­¾ååŠŸèƒ½**ï¼š
    - å‰ç«¯ï¼šå¼•å…¥ `react-signature-canvas` (æˆ–ç±»ä¼¼åº“) å®žçŽ° H5 ç­¾åæ¿ã€‚
    - åŽç«¯ï¼šå‡çº§ `checkOutInstallTaskAction`ï¼Œæ”¯æŒ Base64/File ä¸Šä¼ å¹¶è½¬å­˜ OSSï¼Œæ›´æ–° `customer_signature_url`ã€‚
3.  **å¢žåŠ æ´¾å•æ ¡éªŒ**ï¼šåœ¨ `dispatch` åŠ¨ä½œä¸­å¢žåŠ  `checkSchedulingConflict` å’Œ `checkLogisticsReady` (å¯é€‰é…ç½®) å‡½æ•°ã€‚

### 3.2 å»ºè®®ä¼˜åŒ– (P1)

1.  **ç‰©æµçŠ¶æ€å›žè°ƒ**ï¼šç¡®ä¿é‡‡è´­å•ç­¾æ”¶æ—¶ï¼Œè§¦å‘ `UpdateInstallTaskLogisticsStatus` åŠ¨ä½œã€‚
2.  **å¯è§†åŒ–è°ƒåº¦è§†å›¾**ï¼šå¼•å…¥ç”˜ç‰¹å›¾æˆ–æ—¥åŽ†è§†å›¾ (`FullCalendar`) æ›¿ä»£å½“å‰çš„ä¸‹æ‹‰æ¡†é€‰äººï¼Œç›´è§‚å±•ç¤ºå¸ˆå‚…æŽ’æœŸã€‚

---

> **æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-17
> **å®¡è®¡äºº**: Antigravity Agent
