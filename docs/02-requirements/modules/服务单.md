# L2C 客服服务单模块 (Service Module) 需求说明书

## 1. 模块定位
`service`（服务单）模块是 L2C (Lead to Cash) 售后及运营链路中极为关键的一环。它主要负责承接来自外部客户或内部协同人员提出的一般性咨询、客诉、现场服务请求等。区别于硬性的“售后赔偿单”(After-sales Ticket)，服务单关注于过程服务与流转调度。

## 2. 核心功能需求

### 2.1 服务单的创建与分类
- **创建来源**: 服务单可由销售、客服人员手动创建，或通过客户门户/热线系统自动接入。
- **服务类型字典**: 包含但不限于：技术咨询、上门勘测、定期维保、产品投诉、其他。
- **关联模型**: 每个服务单必须可以（可选）关联至特定「客户」(Customer)、「订单」(Order) 或「产品」(Product)，以构建完整的追溯链条。

### 2.2 状态流转机 (State Machine)
服务单具有严格的生命周期管理，需要支持以下核心状态及其合法变迁：
1. **PENDING (待处理)**: 工单生成初始状态。
2. **ASSIGNED (已派单)**: 工单分配给指定的处理人（工程师 / 客服专员）。
3. **IN_PROGRESS (处理中)**: 负责人已接单并开始处理。
4. **RESOLVED (已解决)**: 负责人标记问题解决，等待客户/发起人确认。
5. **CLOSED (已关闭)**: 客户验收通过，或流转结束正常归档。
6. **CANCELLED (已取消)**: 发起人主动撤回，或评估后认为无效作废。

*流转约束*：除了特权管理员，普通处理人必须逐级流转状态，不可跳级（例如从 PENDING 直接变为 CLOSED）。

### 2.3 操作权限控制 (RBAC)
- **客服/创建者**: 拥有创建、补充图文信息、主动撤销（PENDING 状态下）的权限。
- **派单调度员**: 具有分配（ASSIGN）或重分配服务单给其他处理人的权限。
- **处理人**: 具有接单（变为 IN_PROGRESS）、提交日志及完工反馈（RESOLVED）的权限。
- **全局管理员**: 对所有状态具有强行流转及数据删除/强制修正的超级权限。

### 2.4 可观测性与审计点
- 所有的状态变更（如 PENDING -> ASSIGNED）必须在 `audit_logs` 留存。
- 所有的日志与备注添加操作需明确记录操作人标识。

## 3. 核心数据设计 (Data Model)
主要的 Schema 应该包含：
- `id`: 服务单唯一标志符 (UUID/ULID)。
- `ticketNo`: 可读编号，如 SR-20240401-0001。
- `tenantId`: 保证租户数据隔离。
- `customerId`, `orderId`: 关联的业务主体实体 ID。
- `type`: 服务类型枚举。
- `status`: 当前服务单状态枚举。
- `priority`: 优先级 (LOW, MEDIUM, HIGH, URGENT)。
- `title`, `description`: 服务标题及详细描述。
- `assignedTo`: 负责处理的人员 ID。
- `createdAt`, `updatedAt`, `resolvedAt`, `closedAt`: 关键时间节点。

## 4. UI交互三态规范要求
- **列表页视图**: 要求具有各种状态的过滤标签（Tabs）。支持通过表格展示。无数据时需要展示清晰的空数据态 (`EmptyState`)。加载时支持骨架屏渲染 (`Skeleton`)。
- **详情页视图**: 展示服务单上下文，具备时间轴式的日志追踪 (`Timeline`)，并具备清晰的操作按钮防反跳与 Toast 反馈。
