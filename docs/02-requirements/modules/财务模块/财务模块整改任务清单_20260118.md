# 财务模块整改任务清单

## Phase 1: 基础架构 (Infrastructure)

- [ ] **Schema**: 更新 `financial_accounts` 支持 `VIRTUAL` 类型 @schema
- [ ] **Schema**: 创建 `internal_transfers` 表 @schema
- [ ] **Action**: 实现 `createInternalTransfer` @action
- [ ] **Action**: 实现 `verifyInternalTransfer` (含事务处理) @action
- [ ] **UI**: 资金调拨列表页开发 @ui
- [ ] **UI**: 资金调拨新建/详情弹窗 @ui

## Phase 2: 逆向流程 (Refunds)

- [ ] **Schema**: 创建 `credit_notes` 表 @schema
- [ ] **Schema**: 创建 `debit_notes` 表 @schema
- [ ] **Schema**: 更新 `payment_bills` 支持退款类型 @schema
- [ ] **Schema**: 更新 `receipt_bills` 支持退款类型 @schema
- [ ] **Action**: 实现 `createCreditNote` @action
- [ ] **Action**: 实现 `createCustomerRefund` @action
- [ ] **Action**: 实现 `verifyPaymentBill` 兼容退款逻辑 @action
- [ ] **Action**: 实现 `createDebitNote` @action
- [ ] **Action**: 实现 `createSupplierRefund` @action
- [ ] **Action**: 实现 `verifyReceiptBill` 兼容退款逻辑 @action
- [ ] **UI**: 付款单-客户退款适配 @ui
- [ ] **UI**: 收款单-供应商退款适配 @ui

## Phase 3: 对账与联动 (Reconciliation)

- [ ] **Schema**: 创建 `statement_confirmations` 表 @schema
- [ ] **Schema**: 创建 `statement_confirmation_details` 表 @schema
- [ ] **Action**: 实现 `generateInternalStatement` (或类似定时任务逻辑) @action
- [ ] **Action**: 确认工费结算联动逻辑 (InstallTask -> AP Labor) @action
- [ ] **Action**: 确认佣金结算联动逻辑 (AR Paid -> Commission) @action
