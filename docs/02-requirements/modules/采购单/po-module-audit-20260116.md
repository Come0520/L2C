# é‡‡è´­å•æ¨¡å—å®¡è®¡æŠ¥å‘Š (ç®€ç‰ˆ)

## å®¡è®¡æ¦‚è§ˆ

**å®¡è®¡æ—¥æœŸ**: 2026-01-16  
**éœ€æ±‚æ–‡æ¡£**: [é‡‡è´­å•.md](file:///c:/Users/bigey/Documents/Antigravity/L2C/docs/02-requirements/modules/é‡‡è´­å•/é‡‡è´­å•.md) (312è¡Œ)  
**å½“å‰å®Œæˆåº¦**: ~50-60%  
**è¯„çº§**: ğŸŸ¡ **éƒ¨åˆ†å®Œæˆ** - æ ¸å¿ƒåŠŸèƒ½å­˜åœ¨ä½†ç¼ºå°‘å…³é”®ç‰¹æ€§

---

## æ•°æ®åº“Schemaå®¡æŸ¥

### âœ… å·²å®ç°çš„è¡¨

#### 1. `purchase_orders` è¡¨

[supply-chain.ts:25-50](file:///c:/Users/bigey/Documents/Antigravity/L2C/src/shared/api/schema/supply-chain.ts#L25-L50)

**å®Œæˆå­—æ®µ**:

- âœ… åŸºç¡€ä¿¡æ¯: `poNo`, `orderId`, `supplierId`,`supplierName`
- âœ… ç±»å‹ä¸çŠ¶æ€: `type` (poTypeEnum), `status`
- âœ… é‡‘é¢: `totalAmount`
- âœ… æ—¶é—´: `expectedDate`

**ç¼ºå¤±å­—æ®µ**:

- âŒ `after_sales_id` (å”®åè¡¥ä»¶æº¯æº)
- âŒ `external_po_no` (å¤–éƒ¨å•å·/å·¥å‚æ–¹å•å·)
- âŒ `supplier_quote_img` (ä¾›åº”å•†ç¡®è®¤æˆªå›¾)
- âŒ `sent_method`, `sent_at` (å‘é€ä¿¡æ¯)
- âŒ `produced_at` (ç”Ÿäº§å®Œæˆæ—¶é—´)
- âŒ `logistics_company`, `logistics_no` (ç‰©æµä¿¡æ¯)
- âŒ `shipped_at`, `delivered_at` (ç‰©æµæ—¶é—´)
- âŒ `payment_status` (ä»˜æ¬¾çŠ¶æ€)

**é—®é¢˜**: **13ä¸ªæ ¸å¿ƒå­—æ®µç¼ºå¤±**ï¼Œå½±å“ä¸šåŠ¡è¿½è¸ªå’Œç‰©æµç®¡ç†

---

#### 2. `purchase_order_items` è¡¨

[supply-chain.ts:52-64](file:///c:/Users/bigey/Documents/Antigravity/L2C/src/shared/api/schema/supply-chain.ts#L52-L64)

**å®Œæˆå­—æ®µ**:

- âœ… åŸºç¡€ä¿¡æ¯: `productName`, `quantity`, `unitPrice`
- âœ… å…³è”: `quoteItemId`

**ç¼ºå¤±å­—æ®µ**:

- âŒ `order_item_id` (å…³è”è®¢å•æ˜ç»†) - **å…³é”®å­—æ®µ**
- âŒ `product_id`, `product_sku` (å•†å“å…³è”)
- âŒ `category` (å“ç±»)
- âŒ `unit_cost` (æˆæœ¬å•ä»·ï¼Œå½“å‰åªæœ‰ unitPrice)
- âŒ `width`, `height` (å°ºå¯¸)
- âŒ `subtotal` (å°è®¡)

**é—®é¢˜**: ç¼ºå°‘ä¸è®¢å•æ˜ç»†çš„å¼ºå…³è”ï¼Œæ— æ³•è¿½æº¯æŠ¥ä»·æ¥æº

---

#### 3. `suppliers` è¡¨

[supply-chain.ts:6-23](file:///c:/Users/bigey/Documents/Antigravity/L2C/src/shared/api/schema/supply-chain.ts#L6-L23)

**è¯„ä»·**: âœ… **åŸºæœ¬å®Œæ•´** - åŒ…å«ä¾›åº”å•†å·ã€åç§°ã€è”ç³»äººã€ä»˜æ¬¾å‘¨æœŸç­‰

---

### âŒ ç¼ºå¤±çš„æšä¸¾/çº¦æŸ

#### 1. POçŠ¶æ€æšä¸¾ä¸å®Œæ•´

**éœ€æ±‚çŠ¶æ€**:

- æˆå“: `DRAFT`, `IN_PRODUCTION`, `READY`, `SHIPPED`, `DELIVERED`, `CANCELLED`
- é¢æ–™: `DRAFT`, `IN_PRODUCTION`, `DELIVERED`, `STOCKED`, `CANCELLED`

**å½“å‰å®ç°**: `status: varchar(50)` - **æ— æšä¸¾å®šä¹‰**ï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

#### 2. POç±»å‹æšä¸¾

**å½“å‰**: `poTypeEnum` å®šä¹‰ä¸º `FINISHED`, `FABRIC`, `STOCK`  
**è¯„ä»·**: âœ… ä¸éœ€æ±‚ä¸€è‡´

---

## API/ä¸šåŠ¡é€»è¾‘å®¡æŸ¥

### âš ï¸ å…³é”®åŠŸèƒ½ç¼ºå¤±

#### 1. è®¢å•æ‹†å•é€»è¾‘ **(P0 - æ ¸å¿ƒ)**

**éœ€æ±‚**: "è®¢å•åˆ›å»ºåè‡ªåŠ¨æŒ‰ä¾›åº”å•†å’Œå•†å“ç±»å‹æ‹†åˆ†ç”Ÿæˆé‡‡è´­å•"  
**ç°çŠ¶**: âŒ **æœªæ‰¾åˆ°è‡ªåŠ¨æ‹†å•é€»è¾‘**

**é¢„æœŸå®ç°è·¯å¾„**:

```typescript
// åº”è¯¥åœ¨ OrderService.createOrder æˆ–è®¢å•çŠ¶æ€å˜æ›´æ—¶è§¦å‘
async function splitOrderToPOs(orderId) {
  const order = await db.query.orders.findFirst({
    where: eq(orders.id, orderId),
    with: { items: true },
  });

  // æŒ‰ä¾›åº”å•†åˆ†ç»„
  const itemsBySupplier = groupBy(order.items, 'supplierId');

  for (const [supplierId, items] of Object.entries(itemsBySupplier)) {
    await createPurchaseOrder({
      orderId,
      supplierId,
      items,
      type: determinePOType(items), // FINISHED/FABRIC/STOCK
    });
  }
}
```

---

#### 2. çŠ¶æ€è”åŠ¨é€»è¾‘ **(P0 - å…³é”®)**

**éœ€æ±‚**: é‡‡è´­å•çŠ¶æ€å˜æ›´éœ€å‘ä¸Šé©±åŠ¨è®¢å•çŠ¶æ€  
**ä¾‹**: "æ‰€æœ‰æˆå“PO â†’ READY" æ—¶ï¼Œè®¢å•åº”è¿›å…¥ `PENDING_DELIVERY`

**ç°çŠ¶**: âŒ **æœªæ‰¾åˆ°çŠ¶æ€è”åŠ¨ä»£ç **

---

#### 3. ç‰©æµä¿¡æ¯ç®¡ç† **(P1)**

**éœ€æ±‚**: å¡«å†™ç‰©æµå…¬å¸å’Œå•å·ï¼Œè‡ªåŠ¨å˜æ›´çŠ¶æ€ä¸º `SHIPPED`  
**ç°çŠ¶**: âŒ **æ•°æ®åº“å­—æ®µç¼ºå¤±** (`logistics_company`, `logistics_no`)

---

#### 4. å”®åè¡¥ä»¶åˆ›å»º **(P1)**

**éœ€æ±‚**: "å”®åå·¥å•å®šè´£ä¸ºè¡¥ä»¶æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå”®åè¡¥ä»¶é‡‡è´­å•"  
**ç°çŠ¶**: âŒ **æœªæ‰¾åˆ°ç›¸å…³é€»è¾‘**ï¼Œä¸”æ•°æ®åº“ç¼ºå°‘ `after_sales_id` å­—æ®µ

---

### ğŸ“ Server Actions æ£€æŸ¥

```
src/features/supply-chain/actions/
â”œâ”€â”€ po-actions.ts (11ä¸ªæ–‡ä»¶)
```

**éœ€è¦è¯¦ç»†å®¡æŸ¥**:

- [ ] æ˜¯å¦æœ‰ `createPOFromOrder` (æ‹†å•)
- [ ] æ˜¯å¦æœ‰ `updatePOStatus` (çŠ¶æ€å˜æ›´)
- [ ] æ˜¯å¦æœ‰ `addLogistics` (ç‰©æµ)

---

## UI/UX ç»„ä»¶å®¡æŸ¥

### ğŸ“ ç»„ä»¶ç›®å½•

```
src/features/supply-chain/components/
â”œâ”€â”€ (17ä¸ªç»„ä»¶)
```

### âš ï¸ å…³é”®ç»„ä»¶æ£€æŸ¥æ¸…å•

- [ ] **POåˆ—è¡¨é¡µ**: æ˜¯å¦åŒ…å«éœ€æ±‚ä¸­çš„ç­›é€‰æ¡ä»¶ (æ—¶é—´ã€ä¾›åº”å•†ã€ä»˜æ¬¾çŠ¶æ€)
- [ ] **POè¯¦æƒ…é¡µ**: æ˜¯å¦æœ‰çŠ¶æ€è¿›åº¦æ¡
- [ ] **ç‰©æµå¡«å†™å¼¹çª—**: ç‰©æµå…¬å¸é€‰æ‹©å™¨
- [ ] **ä¾›åº”å•†ç¡®è®¤æˆªå›¾ä¸Šä¼ **: æ˜¯å¦å®ç°

---

## å…³é”®å·®å¼‚æ€»ç»“

| ç»´åº¦             | å®Œæˆåº¦ | ä¸»è¦é—®é¢˜                              |
| ---------------- | ------ | ------------------------------------- |
| **æ•°æ®åº“Schema** | 40%    | ç¼ºå¤±13ä¸ªæ ¸å¿ƒå­—æ®µ (ç‰©æµã€ä»˜æ¬¾ã€æˆªå›¾ç­‰) |
| **æ‹†å•é€»è¾‘**     | 0%     | æ ¸å¿ƒåŠŸèƒ½å®Œå…¨ç¼ºå¤±                      |
| **çŠ¶æ€è”åŠ¨**     | 0%     | æœªå®ç°å‘ä¸Šé©±åŠ¨è®¢å•çŠ¶æ€                |
| **ç‰©æµç®¡ç†**     | 0%     | å­—æ®µå’Œé€»è¾‘å‡ç¼ºå¤±                      |
| **å”®åè¡¥ä»¶**     | 0%     | æœªå®ç°è‡ªåŠ¨åˆ›å»ºè¡¥ä»¶PO                  |
| **UIç»„ä»¶**       | å¾…éªŒè¯ | éœ€é€ä¸€æ£€æŸ¥17ä¸ªç»„ä»¶                    |

---

## ç«‹å³è¡ŒåŠ¨å»ºè®® (P0)

### 1. æ•°æ®åº“Schemaä¿®æ­£ (1å¤©)

- [ ] æ·»åŠ ç¼ºå¤±çš„13ä¸ªå­—æ®µåˆ° `purchase_orders` è¡¨
- [ ] æ·»åŠ ç¼ºå¤±çš„6ä¸ªå­—æ®µåˆ° `purchase_order_items` è¡¨
- [ ] å®šä¹‰ POçŠ¶æ€æšä¸¾ (åŒºåˆ†æˆå“å’Œé¢æ–™)
- [ ] ç”Ÿæˆå¹¶è¿è¡Œ migration

### 2. å®ç°è®¢å•æ‹†å•é€»è¾‘ (2å¤©)

- [ ] åœ¨ `OrderService` ä¸­å®ç° `splitOrderToPOs`
- [ ] æŒ‰ä¾›åº”å•†å’Œå“ç±»åˆ†ç»„
- [ ] è‡ªåŠ¨åˆ¤æ–­ PO ç±»å‹ (FINISHED/FABRIC/STOCK)
- [ ] å…³è” `order_item_id` åˆ° `po_items`

### 3. å®ç°çŠ¶æ€è”åŠ¨ (1.5å¤©)

- [ ] POçŠ¶æ€å˜æ›´æ—¶è§¦å‘ webhook/event
- [ ] èšåˆåŒä¸€è®¢å•ä¸‹æ‰€æœ‰ PO çŠ¶æ€
- [ ] æ ¹æ®è§„åˆ™æ›´æ–°è®¢å•çŠ¶æ€

### 4. è¡¥å…¨ç‰©æµç®¡ç† (1å¤©)

- [ ] å‰ç«¯: ç‰©æµå¡«å†™å¼¹çª—ç»„ä»¶
- [ ] åç«¯: `addLogistics` API
- [ ] çŠ¶æ€è‡ªåŠ¨å˜æ›´ä¸º `SHIPPED`

---

## ä¸­æœŸä»»åŠ¡ (P1)

1. **å”®åè¡¥ä»¶åˆ›å»º** (1å¤©)
2. **ä»˜æ¬¾çŠ¶æ€ç®¡ç†** (ä¸è´¢åŠ¡æ¨¡å—è”åŠ¨, 1å¤©)
3. **ç‰©æµAPIé›†æˆ** (è‡ªåŠ¨æŸ¥è¯¢ç­¾æ”¶, 2å¤©)
4. **ç”Ÿäº§è¶…æ—¶é¢„è­¦** (å®šæ—¶ä»»åŠ¡, 0.5å¤©)

---

## æ‰§è¡Œæ—¶é—´è¡¨ (2å‘¨)

**ç¬¬ä¸€å‘¨**: Schema + æ‹†å• + çŠ¶æ€è”åŠ¨ â†’ å®Œæˆåº¦ 70%  
**ç¬¬äºŒå‘¨**: ç‰©æµ + å”®å + UIå®Œå–„ â†’ å®Œæˆåº¦ 85%+

**èµ„æºéœ€æ±‚**: åç«¯1äºº + å‰ç«¯1äºº (å…¨èŒ2å‘¨)

---

## é£é™©æç¤º

1. **ğŸ”´ ä¸¥é‡**: æ‹†å•é€»è¾‘ç¼ºå¤±å¯¼è‡´é‡‡è´­å•æ— æ³•è‡ªåŠ¨ç”Ÿæˆ - å½±å“æ•´ä¸ªä¾›åº”é“¾æµç¨‹
2. **ğŸ”´ ä¸¥é‡**: çŠ¶æ€è”åŠ¨ç¼ºå¤±å¯¼è‡´è®¢å•çŠ¶æ€ä¸å‡†ç¡® - å½±å“å®¢æˆ·ä½“éªŒ
3. **ğŸŸ¡ é«˜**: ç‰©æµå­—æ®µç¼ºå¤±å¯¼è‡´æ— æ³•è¿½è¸ªè´§ç‰© - å½±å“äº¤ä»˜ç®¡ç†

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-16 01:54:58  
**å»ºè®®å¤å®¡**: å®ŒæˆP0ä»»åŠ¡åé‡æ–°è¯„ä¼°
