# 用户角色说明书 (User Roles Guide)

## 概述

L2C 系统采用**基于角色的访问控制 (RBAC)** 模型。每个用户被分配一个角色，角色决定其可访问的模块和操作权限。

---

## 角色一览

| 角色代码     | 中文名称 | 定位          | 主要职责                       |
| ------------ | -------- | ------------- | ------------------------------ |
| `ADMIN`      | 管理员   | 系统全权管理  | 用户管理、系统配置、全业务可见 |
| `MANAGER`    | 经理     | 门店/区域管理 | 团队管理、审批、业绩监控       |
| `SALES`      | 销售     | 业务执行      | 线索跟进、报价、订单           |
| `FINANCE`    | 财务     | 财务管理      | 收付款、结算、财务报表         |
| `SUPPLY`     | 供应链   | 采购与库存    | 采购下单、库存管理、供应商     |
| `WORKER`     | 工人     | 服务执行      | 测量、安装任务执行             |
| `DISPATCHER` | 派单员   | 服务调度      | 测量/安装任务派单与调度        |

---

## 角色详解

### 1. ADMIN（管理员）

**定位**：系统的超级用户，拥有所有权限。

**权限范围**：

- ✅ 全部模块完整访问
- ✅ 用户管理（创建、禁用、重置密码）
- ✅ 角色与权限配置
- ✅ 系统设置（全局参数、审批流程）
- ✅ 数据分析（全渠道数据）
- ✅ 租户管理（平台管理员专属）

**典型操作**：

- 配置审批流程
- 管理员工账号
- 查看全公司经营数据

---

### 2. MANAGER（经理）

**定位**：门店级或区域级管理者，负责团队和业务监督。

**权限范围**：

- ✅ 客户管理（全员可见）
- ✅ 报价审批
- ✅ 订单管理
- ✅ 线索分配
- ✅ 团队业绩查看
- ⚠️ 财务模块（只读）
- ❌ 系统设置

**典型操作**：

- 审批销售报价
- 分配线索给销售
- 查看门店业绩报表

---

### 3. SALES（销售）

**定位**：一线业务人员，直接面对客户。

**权限范围**：

- ✅ 线索管理（仅自己归属）
- ✅ 客户管理（仅自己归属）
- ✅ 报价创建与编辑
- ✅ 订单查看（仅自己归属）
- ✅ 云展厅分享
- ❌ 线索分配
- ❌ 财务模块
- ❌ 系统设置

**典型操作**：

- 创建报价单
- 跟进客户线索
- 分享产品展厅链接

---

### 4. FINANCE（财务）

**定位**：财务专员，管理公司账务。

**权限范围**：

- ✅ 财务中心（完整）
- ✅ 收付款管理
- ✅ 结算单管理
- ✅ 财务报表
- ⚠️ 订单查看（只读）
- ❌ 客户管理
- ❌ 报价管理
- ❌ 系统设置

**典型操作**：

- 确认收款
- 生成供应商结算单
- 核对应收应付

---

### 5. SUPPLY（供应链）

**定位**：采购与库存管理专员。

**权限范围**：

- ✅ 供应链模块（完整）
- ✅ 采购订单管理
- ✅ 供应商管理
- ✅ 库存管理
- ⚠️ 订单查看（只读）
- ❌ 客户管理
- ❌ 财务模块
- ❌ 系统设置

**典型操作**：

- 创建采购订单
- 管理供应商信息
- 更新库存记录

---

### 6. WORKER（工人）

**定位**：服务执行人员（测量师、安装工）。

**权限范围**：

- ✅ 测量任务（仅分配给自己）
- ✅ 安装任务（仅分配给自己）
- ✅ 任务完成上传照片
- ❌ 订单管理
- ❌ 财务模块
- ❌ 客户完整信息

**典型操作**：

- 查看分配的测量/安装任务
- 填写测量数据
- 上传安装完成照片

---

### 7. DISPATCHER（派单员）

**定位**：服务调度人员，负责测量和安装任务的派单。

**权限范围**：

- ✅ 测量服务（派单、调度）
- ✅ 安装服务（派单、调度）
- ✅ 查看工人列表及状态
- ⚠️ 订单查看（只读）
- ❌ 客户管理
- ❌ 报价管理
- ❌ 财务模块

**典型操作**：

- 将测量任务分配给测量师
- 将安装任务分配给安装工
- 调整任务时间和优先级

---

## 权限矩阵

| 模块     | ADMIN | MANAGER | SALES | FINANCE | SUPPLY | WORKER | DISPATCHER |
| -------- | ----- | ------- | ----- | ------- | ------ | ------ | ---------- |
| 工作台   | ✅    | ✅      | ✅    | ✅      | ✅     | ✅     | ✅         |
| 线索管理 | ✅    | ✅      | ✅    | ❌      | ❌     | ❌     | ❌         |
| 客户管理 | ✅    | ✅      | ✅    | ❌      | ❌     | ❌     | ❌         |
| 报价管理 | ✅    | ✅      | ✅    | ❌      | ❌     | ❌     | ❌         |
| 订单管理 | ✅    | ✅      | 👁️    | 👁️      | 👁️     | ❌     | 👁️         |
| 云展厅   | ✅    | ✅      | ✅    | ❌      | ❌     | ❌     | ❌         |
| 测量服务 | ✅    | ✅      | ❌    | ❌      | ❌     | ✅     | ✅         |
| 安装服务 | ✅    | ✅      | ❌    | ❌      | ❌     | ✅     | ✅         |
| 供应链   | ✅    | ❌      | ❌    | ❌      | ✅     | ❌     | ❌         |
| 财务中心 | ✅    | 👁️      | ❌    | ✅      | ❌     | ❌     | ❌         |
| 审批中心 | ✅    | ✅      | ❌    | ✅      | ❌     | ❌     | ✅         |
| 售后服务 | ✅    | ✅      | 👁️    | ❌      | ❌     | ❌     | ❌         |
| 数据分析 | ✅    | ✅      | 👁️    | ✅      | ❌     | ❌     | ❌         |
| 系统设置 | ✅    | ❌      | ❌    | ❌      | ❌     | ❌     | ❌         |

**图例**：✅ 完整权限 | 👁️ 只读 | ❌ 无权限

---

## 角色分配

### 分配方式

1. **管理员手动分配**：在"系统设置 → 用户管理"中编辑用户角色
2. **邀请时指定**：发送邀请链接时选择角色

### 注意事项

- 每个用户只能有一个角色
- 角色变更立即生效
- 不支持自定义角色（目前）

---

## 技术实现

### 角色定义

```typescript
// drizzle/schema.ts
export const userRole = pgEnum('user_role', [
  'ADMIN',
  'SALES',
  'MANAGER',
  'WORKER',
  'FINANCE',
  'SUPPLY',
  'DISPATCHER',
]);
```

### 权限定义

```typescript
// src/shared/config/permissions.ts
export const PERMISSIONS = {
  ORDER: { VIEW, CREATE, EDIT, DELETE, MANAGE },
  CUSTOMER: { VIEW, CREATE, EDIT, DELETE, MANAGE },
  // ... 共 14 个模块
};
```

---

## 后续规划

- [ ] 实现精细化权限控制（按模块 + 操作）
- [ ] 支持自定义角色
- [ ] 角色继承机制
- [ ] 数据范围控制（本人/团队/全公司）
