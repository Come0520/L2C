# ç»è¥æ•°æ®åŒæ­¥åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å°†ç»è¥æ•°æ®è‡ªåŠ¨åŒæ­¥åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼çš„åŠŸèƒ½ï¼Œæ”¯æŒï¼š

- æ¯æ—¥å®šæ—¶åŒæ­¥ç»è¥æ•°æ®
- æ‰‹åŠ¨è§¦å‘æ•°æ®åŒæ­¥
- æ‰¹é‡åŒæ­¥å†å²æ•°æ®
- è‡ªåŠ¨åˆ›å»ºé£ä¹¦å¤šç»´è¡¨æ ¼
- æ•°æ®é‡å¤æ£€æŸ¥å’Œè·³è¿‡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»è¥æ•°æ®æœåŠ¡    â”‚     â”‚  æ•°æ®åŒæ­¥æœåŠ¡      â”‚     â”‚  é£ä¹¦å¤šç»´è¡¨æ ¼æœåŠ¡    â”‚
â”‚ businessData.ts â”‚â”€â”€â”€â”€â–¶â”‚   dataSync.ts      â”‚â”€â”€â”€â”€â–¶â”‚  feishuBitable.ts    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–²                         â–²                         â–²
          â”‚                         â”‚                         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   API è·¯ç”±         â”‚
                            â”‚ /api/sync/business-data â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–²
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   å®šæ—¶ä»»åŠ¡         â”‚
                            â”‚  Vercel Cron Jobs  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ é…ç½®è¯´æ˜

### 1. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```env
# é£ä¹¦è®¿é—®ä»¤ç‰Œ
FEISHU_ACCESS_TOKEN=your_feishu_access_token

# ç»è¥æ•°æ®é£ä¹¦åº”ç”¨é…ç½®
FEISHU_BUSINESS_DATA_APP_TOKEN=your_app_token
FEISHU_BUSINESS_DATA_TABLE_ID=your_table_id
```

### 2. é£ä¹¦åº”ç”¨é…ç½®

1. ç™»å½•é£ä¹¦å¼€æ”¾å¹³å° (https://open.feishu.cn/)
2. åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
3. å¼€å¯ã€Œå¤šç»´è¡¨æ ¼ã€API æƒé™
4. è·å–åº”ç”¨çš„ `App Token`
5. ç”Ÿæˆå¹¶ä¿å­˜ `Access Token`

### 3. å®šæ—¶ä»»åŠ¡é…ç½®

ç³»ç»Ÿä½¿ç”¨ Vercel Cron Jobs å®ç°å®šæ—¶ä»»åŠ¡ï¼Œé…ç½®æ–‡ä»¶ä½äº `vercel.json`ï¼š

```json
{
  "crons": [
    {
      "path": "/api/sync/business-data",
      "schedule": "0 8 * * *" // æ¯å¤©æ—©ä¸Š8ç‚¹æ‰§è¡Œï¼ˆUTCæ—¶é—´ï¼‰
    }
  ]
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆå§‹åŒ–ç»è¥æ•°æ®åŒæ­¥

```typescript
import { dataSyncService } from '@/services/dataSync'

// åˆå§‹åŒ–ç»è¥æ•°æ®åŒæ­¥
const result = await dataSyncService.setupBusinessDataSync(
  'your_feishu_app_token',
  'ç»è¥æ•°æ®æ—¥æŠ¥' // è¡¨æ ¼åç§°
)

if (result.success) {
  console.log('ç»è¥æ•°æ®åŒæ­¥è®¾ç½®æˆåŠŸ')
  console.log('è¡¨æ ¼ID:', result.tableId)
} else {
  console.error('ç»è¥æ•°æ®åŒæ­¥è®¾ç½®å¤±è´¥:', result.message)
}
```

### 2. æ‰‹åŠ¨è§¦å‘æ•°æ®åŒæ­¥

```typescript
import { dataSyncService } from '@/services/dataSync'

// æ‰‹åŠ¨è§¦å‘å½“å¤©æ•°æ®åŒæ­¥
const result = await dataSyncService.syncBusinessDataToFeishu(
  'your_feishu_app_token',
  'your_table_id'
)

// åŒæ­¥æŒ‡å®šæ—¥æœŸæ•°æ®
const result = await dataSyncService.syncBusinessDataToFeishu(
  'your_feishu_app_token',
  'your_table_id',
  '2024-01-15' // æŒ‡å®šæ—¥æœŸ
)
```

### 3. æ‰¹é‡åŒæ­¥å†å²æ•°æ®

```typescript
import { dataSyncService } from '@/services/dataSync'

// æ‰¹é‡åŒæ­¥å†å²æ•°æ®
const result = await dataSyncService.batchSyncBusinessDataToFeishu(
  'your_feishu_app_token',
  'your_table_id',
  '2024-01-01', // å¼€å§‹æ—¥æœŸ
  '2024-01-31'  // ç»“æŸæ—¥æœŸ
)

if (result.success) {
  console.log('æ‰¹é‡åŒæ­¥å®Œæˆ')
  console.log('ç»“æœ:', result.results)
} else {
  console.error('æ‰¹é‡åŒæ­¥å¤±è´¥:', result.message)
}
```

### 4. é€šè¿‡ API è§¦å‘åŒæ­¥

```bash
# è§¦å‘å½“å¤©æ•°æ®åŒæ­¥
curl -X GET "https://your-domain.com/api/sync/business-data?appToken=your_app_token&tableId=your_table_id"

# åŒæ­¥æŒ‡å®šæ—¥æœŸæ•°æ®
curl -X GET "https://your-domain.com/api/sync/business-data?appToken=your_app_token&tableId=your_table_id&date=2024-01-15"

# ä½¿ç”¨ POST è¯·æ±‚
curl -X POST "https://your-domain.com/api/sync/business-data" \
  -H "Content-Type: application/json" \
  -d '{"feishuAppToken": "your_app_token", "feishuTableId": "your_table_id", "date": "2024-01-15"}'
```

## ğŸ“Š ç»è¥æ•°æ®å­—æ®µè¯´æ˜

| å­—æ®µåç§° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| æ—¥æœŸ | æ—¥æœŸ | æ•°æ®ç»Ÿè®¡æ—¥æœŸ |
| æ€»é”€å”®é¢ | è´§å¸ | å½“æ—¥æ€»é”€å”®é¢ |
| æ€»è®¢å•æ•° | æ•°å­— | å½“æ—¥æ€»è®¢å•æ•°é‡ |
| æ–°å¢å®¢æˆ·æ•° | æ•°å­— | å½“æ—¥æ–°å¢å®¢æˆ·æ•°é‡ |
| å¾…å¤„ç†è®¢å•æ•° | æ•°å­— | å½“æ—¥å¾…å¤„ç†è®¢å•æ•°é‡ |
| å·²å®Œæˆè®¢å•æ•° | æ•°å­— | å½“æ—¥å·²å®Œæˆè®¢å•æ•°é‡ |
| æ€»çº¿ç´¢æ•° | æ•°å­— | å½“æ—¥æ€»çº¿ç´¢æ•°é‡ |
| åˆæ ¼çº¿ç´¢æ•° | æ•°å­— | å½“æ—¥åˆæ ¼çº¿ç´¢æ•°é‡ |
| çº¿ç´¢è½¬åŒ–ç‡ | ç™¾åˆ†æ¯” | å½“æ—¥çº¿ç´¢è½¬åŒ–ç‡ |
| å¹³å‡è®¢å•ä»·å€¼ | è´§å¸ | å½“æ—¥å¹³å‡è®¢å•ä»·å€¼ |
| åº“å­˜ä»·å€¼ | è´§å¸ | å½“æ—¥åº“å­˜æ€»ä»·å€¼ |
| ä½åº“å­˜å•†å“æ•° | æ•°å­— | å½“æ—¥ä½åº“å­˜å•†å“æ•°é‡ |

## ğŸ”§ ç»´æŠ¤å’Œç›‘æ§

### 1. æŸ¥çœ‹åŒæ­¥æ—¥å¿—

ç³»ç»Ÿä¼šåœ¨æ§åˆ¶å°è¾“å‡ºåŒæ­¥æ—¥å¿—ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

- æœ¬åœ°å¼€å‘ï¼šæŸ¥çœ‹ç»ˆç«¯è¾“å‡º
- ç”Ÿäº§ç¯å¢ƒï¼šæŸ¥çœ‹ Vercel æ—¥å¿—

### 2. å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|
| åŒæ­¥å¤±è´¥ | é£ä¹¦ Access Token è¿‡æœŸ | é‡æ–°ç”Ÿæˆå¹¶æ›´æ–°ç¯å¢ƒå˜é‡ |
| æ•°æ®é‡å¤ | æ—¥æœŸæ ¼å¼ä¸æ­£ç¡® | ç¡®ä¿æ—¥æœŸæ ¼å¼ä¸º YYYY-MM-DD |
| è¡¨æ ¼åˆ›å»ºå¤±è´¥ | é£ä¹¦åº”ç”¨æƒé™ä¸è¶³ | æ£€æŸ¥åº”ç”¨æ˜¯å¦å¼€å¯äº†å¤šç»´è¡¨æ ¼æƒé™ |
| å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ | Vercel é…ç½®é”™è¯¯ | æ£€æŸ¥ vercel.json ä¸­çš„ cron é…ç½® |

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ æ–°çš„ç»è¥æ•°æ®æŒ‡æ ‡

åœ¨ `businessData.ts` ä¸­æ‰©å±• `BusinessData` æ¥å£å’Œ `calculateBusinessData` æ–¹æ³•ã€‚

### 2. è‡ªå®šä¹‰åŒæ­¥æ—¶é—´

ä¿®æ”¹ `vercel.json` ä¸­çš„ cron è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š

```json
{
  "crons": [
    {
      "path": "/api/sync/business-data",
      "schedule": "0 0 * * *" // æ¯å¤©å‡Œæ™¨æ‰§è¡Œ
    }
  ]
}
```

### 3. é›†æˆå…¶ä»–æ•°æ®æº

åœ¨ `businessDataService` ä¸­æ·»åŠ æ–°çš„æ•°æ®æºè·å–æ–¹æ³•ã€‚

## ğŸ“ ä½¿ç”¨æ³¨æ„äº‹é¡¹

1. ç¡®ä¿é£ä¹¦åº”ç”¨å…·æœ‰è¶³å¤Ÿçš„æƒé™
2. å®šæœŸæ›´æ–°é£ä¹¦ Access Token
3. é¦–æ¬¡ä½¿ç”¨å»ºè®®æ‰‹åŠ¨è§¦å‘åŒæ­¥éªŒè¯
4. æ‰¹é‡åŒæ­¥å¤§é‡å†å²æ•°æ®æ—¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
5. æ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­è¯·å‹¿ä¿®æ”¹é£ä¹¦è¡¨æ ¼ç»“æ„

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
