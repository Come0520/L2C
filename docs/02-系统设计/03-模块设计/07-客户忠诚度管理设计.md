# 客户忠诚度管理设计

## 1. 模块概述

客户忠诚度管理模块 (Loyalty Program) 旨在通过积分、会员等级和权益体系，提升客户复购率和品牌粘性。该模块与订单系统深度集成，实现"消费即会员"的自动转化。

### 1.1 核心目标
- **提升复购**：通过积分抵现、会员专享价刺激二次消费。
- **增强互动**：通过签到、分享、评价等任务增加用户活跃度。
- **权益差异化**：为不同等级会员提供差异化服务 (如优先发货、专属客服)。

### 1.2 业务范围
- **积分系统**：积分获取 (Earn)、积分消耗 (Burn)、过期处理。
- **会员等级**：成长值计算、等级升降级。
- **积分商城**：积分兑换商品、优惠券。

---

## 2. 核心功能设计

### 2.1 积分规则
- **获取规则**：
    *   **消费**：每消费 1 元积 1 分。
    *   **签到**：每日签到 +5 分，连续签到奖励。
    *   **完善资料**：首次完善 +50 分。
    *   **推荐新客**：邀请好友注册 +100 分。
- **消耗规则**：
    *   **订单抵扣**：100 积分 = 1 元 (最高抵扣订单金额 10%)。
    *   **兑换商品**：全积分 或 积分+钱。
- **有效期**：每年 12 月 31 日清空上一年度积分。

### 2.2 会员等级体系
| 等级 | 名称 | 门槛 (成长值) | 权益 |
| :--- | :--- | :--- | :--- |
| **V1** | 普通会员 | 0 | 积分抵扣 |
| **V2** | 白银会员 | 5000 | 98折, 生日礼包 |
| **V3** | 黄金会员 | 20000 | 95折, 免费安装 |
| **V4** | 钻石会员 | 100000 | 88折, 专属客服 |

---

## 3. 数据库设计

### 3.1 积分账户 (Points Wallet)

```sql
create table user_points_wallet (
  user_id uuid primary key references auth.users(id),
  
  balance int default 0, -- 当前可用积分
  total_earned int default 0, -- 累计获取
  total_spent int default 0, -- 累计消耗
  
  level int default 1, -- 当前等级
  growth_value int default 0, -- 成长值
  
  updated_at timestamptz default now()
);

create table points_ledger (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id),
  
  type varchar(20), -- earn, burn
  amount int not null, -- 正数
  balance_after int not null,
  
  source_type varchar(50), -- order, sign_in, exchange
  source_id uuid, -- 关联订单ID
  description text,
  
  created_at timestamptz default now()
);
```

### 3.2 积分商城 (Mall)

```sql
create table point_goods (
  id uuid primary key default gen_random_uuid(),
  name varchar(100) not null,
  image_url text,
  
  points_price int not null, -- 所需积分
  cash_price decimal(10,2) default 0, -- 需补差价
  
  stock int default 0,
  is_virtual boolean default false, -- 虚拟商品(优惠券)
  
  status varchar(20) default 'active'
);

create table exchange_orders (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id),
  good_id uuid references point_goods(id),
  
  points_cost int not null,
  cash_cost decimal(10,2),
  
  status varchar(20) default 'completed',
  created_at timestamptz default now()
);
```

---

## 4. 前端界面规范

### 4.1 会员中心 (小程序/App)
- **卡片设计**：展示当前等级、进度条 (距离下一级还差多少)、可用积分。
- **金刚区**：积分明细、兑换记录、收货地址、联系客服。

### 4.2 积分商城
- **列表页**：瀑布流展示可兑换商品。
- **详情页**：
    *   **支付栏**：显示 "1000积分 + 10元"。
    *   **库存状态**：库存不足时按钮置灰。
