# ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ - è½¯ä»¶æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**é¡¹ç›®åç§°ï¼š** ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v3.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2024å¹´  
**è®¾è®¡ç›®æ ‡ï¼š** æ„å»ºé«˜æ€§èƒ½ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ  
**æ¶æ„ç†å¿µï¼š** æ¨¡å—åŒ–å•ä½“æ¶æ„ï¼Œæ¸è¿›å¼æ¼”è¿›  

---

## ğŸ—ï¸ æ€»ä½“æ¶æ„æ¦‚è¿°

### æ¶æ„è®¾è®¡åŸåˆ™

#### 1.1 æ¨¡å—åŒ–å•ä½“ä¼˜å…ˆåŸåˆ™
- **âœ… é‡‡ç”¨æ¨¡å—åŒ–å•ä½“æ¶æ„**ï¼šåˆæœŸé‡‡ç”¨æ¨¡å—åŒ–å•ä½“æ¶æ„ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
- **âœ… æ¸è¿›å¼æ¼”è¿›**ï¼šæ ¹æ®ä¸šåŠ¡å‘å±•éœ€è¦ï¼Œé€æ­¥å‘æ··åˆæ¶æ„æ¼”è¿›
- **âœ… é¢†åŸŸé©±åŠ¨è®¾è®¡**ï¼šåŸºäºDDDæ€æƒ³è¿›è¡Œæ¨¡å—åˆ’åˆ†ï¼Œç¡®ä¿ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°
- **âŒ ç›´æ¥é‡‡ç”¨å¾®æœåŠ¡**ï¼šåˆæœŸä¸é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé¿å…è¿‡åº¦è®¾è®¡

#### 1.2 å‰åç«¯åˆ†ç¦»åŸåˆ™
- **âœ… å®Œå…¨åˆ†ç¦»**ï¼šå‰ç«¯é‡‡ç”¨Next.jsï¼Œåç«¯é‡‡ç”¨NestJSï¼Œå®Œå…¨åˆ†ç¦»éƒ¨ç½²
- **âœ… ç»Ÿä¸€APIè§„èŒƒ**ï¼šé‡‡ç”¨RESTful APIè®¾è®¡è§„èŒƒï¼Œç¡®ä¿æ¥å£ä¸€è‡´æ€§
- **âœ… å¤šç«¯é€‚é…**ï¼šæ”¯æŒWebç«¯ã€å°ç¨‹åºç«¯ç­‰å¤šç«¯è®¿é—®
- **âœ… ç±»å‹å®‰å…¨**ï¼šå…¨æ ˆTypeScriptï¼Œç¡®ä¿ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨

#### 1.3 æ•°æ®ä¸€è‡´æ€§åŸåˆ™
- **âœ… äº‹åŠ¡ç®¡ç†**ï¼šæ ¸å¿ƒä¸šåŠ¡ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
- **âœ… æœ€ç»ˆä¸€è‡´æ€§**ï¼šéæ ¸å¿ƒä¸šåŠ¡é‡‡ç”¨å¼‚æ­¥æ¶ˆæ¯ä¿è¯æœ€ç»ˆä¸€è‡´
- **âœ… æ•°æ®å®Œæ•´æ€§**ï¼šé€šè¿‡çº¦æŸã€è§¦å‘å™¨ç­‰æœºåˆ¶ä¿è¯æ•°æ®å®Œæ•´æ€§
- **âœ… å®¡è®¡è¿½è¸ª**ï¼šå®Œæ•´çš„æ•°æ®å˜æ›´æ—¥å¿—å’Œå®¡è®¡è¿½è¸ª

#### 1.4 æŠ€æœ¯æ ˆç»Ÿä¸€åŸåˆ™
- **âœ… ç»Ÿä¸€æŠ€æœ¯æ ˆ**ï¼šå‰åç«¯ç»Ÿä¸€é‡‡ç”¨TypeScriptï¼Œæé«˜å¼€å‘æ•ˆç‡
- **âœ… ç°ä»£åŒ–æ¡†æ¶**ï¼šé‡‡ç”¨Next.js 15+ã€Taro 3.xã€NestJSç­‰ç°ä»£åŒ–æ¡†æ¶
- **âœ… äº‘åŸç”Ÿä¼˜å…ˆ**ï¼šä¼˜å…ˆé€‰æ‹©äº‘åŸç”ŸæŠ€æœ¯å’ŒæœåŠ¡ï¼ˆSupabaseã€Vercelï¼‰
- **âŒ å¤šè¯­è¨€æ··åˆ**ï¼šé¿å…å¤šè¯­è¨€æ··åˆå¼€å‘ï¼Œä¿æŒæŠ€æœ¯æ ˆç»Ÿä¸€

### æ¶æ„æ¼”è¿›ç­–ç•¥

#### é˜¶æ®µä¸€ï¼šæ¨¡å—åŒ–å•ä½“æ¶æ„ï¼ˆMVPé˜¶æ®µï¼‰
**æ—¶é—´èŒƒå›´**ï¼šé¡¹ç›®å¯åŠ¨-ç¬¬6ä¸ªæœˆ  
**æ¶æ„ç‰¹ç‚¹**ï¼š
- å•ä¸€åº”ç”¨ï¼Œæ¨¡å—åŒ–è®¾è®¡
- ç»Ÿä¸€æ•°æ®åº“ï¼Œè¡¨çº§åˆ«éš”ç¦»
- æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œæ€§èƒ½æœ€ä¼˜
- éƒ¨ç½²ç®€å•ï¼Œè¿ç»´æˆæœ¬ä½
- æŠ€æœ¯æ ˆï¼šNext.js 15+ + NestJS + PostgreSQL + Redis

#### é˜¶æ®µäºŒï¼šæ··åˆæ¶æ„ï¼ˆæ‰©å±•é˜¶æ®µï¼‰
**æ—¶é—´èŒƒå›´**ï¼šç¬¬7-18ä¸ªæœˆ  
**æ‹†åˆ†æ—¶æœº**ï¼š
- æŸä¸ªæ¨¡å—æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- å›¢é˜Ÿè§„æ¨¡æ‰©å¤§ï¼Œéœ€è¦ç‹¬ç«‹å¼€å‘
- ä¸šåŠ¡å¤æ‚åº¦å¢åŠ ï¼Œéœ€è¦æŠ€æœ¯å¼‚æ„

**æ‹†åˆ†ç­–ç•¥**ï¼š
- æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ï¼ˆç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€ç§¯åˆ†æœåŠ¡ç­‰ï¼‰
- ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…åˆ†å¸ƒå¼äº‹åŠ¡
- å¼•å…¥APIç½‘å…³ï¼Œç»Ÿä¸€æœåŠ¡æ²»ç†
- æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œå¼•å…¥ç¼“å­˜å±‚

#### é˜¶æ®µä¸‰ï¼šæ¨¡å—åŒ–æœåŠ¡æ¶æ„ï¼ˆæˆç†ŸæœŸï¼‰
**æ—¶é—´èŒƒå›´**ï¼šç¬¬18ä¸ªæœˆä»¥å  
**æ¶æ„ç‰¹ç‚¹**ï¼š
- æ ¸å¿ƒæ¨¡å—æœåŠ¡åŒ–ï¼Œä¿æŒæ¨¡å—åŒ–ç†å¿µ
- æ•°æ®åˆ†ç‰‡ï¼Œæ”¯æŒå¤§è§„æ¨¡å¹¶å‘
- äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå¼‚æ­¥è§£è€¦
- å®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¼¹æ€§ä¼¸ç¼©

## ğŸ¯ é¢†åŸŸé©±åŠ¨è®¾è®¡åˆ†æ

### æ ¸å¿ƒé¢†åŸŸè¯†åˆ«

#### 1. é”€å”®ç®¡ç†é¢†åŸŸï¼ˆCore Domainï¼‰
**ä¸šåŠ¡ä»·å€¼**ï¼šL2Cé”€å”®æµç¨‹çš„æ ¸å¿ƒç«äº‰åŠ›
**å¤æ‚åº¦**ï¼šé«˜
**å…³é”®æ¦‚å¿µ**ï¼š
- é”€å”®å•çŠ¶æ€æœºï¼šä»çº¿ç´¢åˆ°æˆäº¤çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- ä¸‰å•ä½“ç³»ï¼šé”€å”®å•ã€æœåŠ¡å•ã€ç»“ç®—å•çš„ååŒç®¡ç†
- é”€å”®æµç¨‹ï¼šæ ‡å‡†åŒ–çš„é”€å”®é˜¶æ®µå’Œé‡Œç¨‹ç¢‘

#### 2. ç§¯åˆ†æ¿€åŠ±é¢†åŸŸï¼ˆCore Domainï¼‰
**ä¸šåŠ¡ä»·å€¼**ï¼šé”€å”®å›¢é˜Ÿæ¿€åŠ±çš„æ ¸å¿ƒæœºåˆ¶
**å¤æ‚åº¦**ï¼šé«˜
**å…³é”®æ¦‚å¿µ**ï¼š
- ç§¯åˆ†è®¡ç®—å¼•æ“ï¼šå¤šç»´åº¦ç§¯åˆ†è®¡ç®—è§„åˆ™
- æ¿€åŠ±ç­–ç•¥ï¼šåŸºäºä¸šç»©ã€è¡Œä¸ºã€æŠ€èƒ½çš„æ¿€åŠ±æœºåˆ¶
- æ’è¡Œæ¦œç³»ç»Ÿï¼šå®æ—¶æ’åå’Œç«äº‰æœºåˆ¶

#### 3. æœåŠ¡åè°ƒé¢†åŸŸï¼ˆSupporting Domainï¼‰
**ä¸šåŠ¡ä»·å€¼**ï¼šå¤šå“ç±»æœåŠ¡çš„ç»Ÿä¸€ç®¡ç†
**å¤æ‚åº¦**ï¼šä¸­ç­‰
**å…³é”®æ¦‚å¿µ**ï¼š
- æœåŠ¡æä¾›å•†ç®¡ç†ï¼šèµ„è´¨ã€èƒ½åŠ›ã€è¯„ä»·ä½“ç³»
- æœåŠ¡åŒ¹é…ç®—æ³•ï¼šåŸºäºæŠ€èƒ½å’Œåœ°åŸŸçš„æ™ºèƒ½åŒ¹é…
- æœåŠ¡è´¨é‡ç›‘æ§ï¼šæœåŠ¡è¿‡ç¨‹å’Œç»“æœçš„è´¨é‡ä¿è¯

#### 4. ç”¨æˆ·ç®¡ç†é¢†åŸŸï¼ˆGeneric Domainï¼‰
**ä¸šåŠ¡ä»·å€¼**ï¼šåŸºç¡€æ”¯æ’‘åŠŸèƒ½
**å¤æ‚åº¦**ï¼šä½
**å…³é”®æ¦‚å¿µ**ï¼š
- ç”¨æˆ·èº«ä»½è®¤è¯ï¼šå¤šè§’è‰²æƒé™ç®¡ç†
- ç»„ç»‡æ¶æ„ï¼šé”€å”®å›¢é˜Ÿå±‚çº§ç»“æ„
- æƒé™æ§åˆ¶ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### é™ç•Œä¸Šä¸‹æ–‡è®¾è®¡

#### 1. é”€å”®ä¸Šä¸‹æ–‡ï¼ˆSales Contextï¼‰
**èŒè´£è¾¹ç•Œ**ï¼š
- çº¿ç´¢ç®¡ç†ï¼šçº¿ç´¢å½•å…¥ã€åˆ†é…ã€è·Ÿè¿›
- é”€å”®å•ç®¡ç†ï¼šé”€å”®æµç¨‹çŠ¶æ€æœº
- å®¢æˆ·å…³ç³»ï¼šå®¢æˆ·ä¿¡æ¯å’Œäº’åŠ¨å†å²
- é”€å”®é¢„æµ‹ï¼šåŸºäºå†å²æ•°æ®çš„é”€å”®é¢„æµ‹

**æ ¸å¿ƒèšåˆ**ï¼š
- é”€å”®å•èšåˆï¼ˆSalesOrder Aggregateï¼‰
- çº¿ç´¢èšåˆï¼ˆLead Aggregateï¼‰
- å®¢æˆ·èšåˆï¼ˆCustomer Aggregateï¼‰

#### 2. ç§¯åˆ†ä¸Šä¸‹æ–‡ï¼ˆPoints Contextï¼‰
**èŒè´£è¾¹ç•Œ**ï¼š
- ç§¯åˆ†è®¡ç®—ï¼šå¤šç»´åº¦ç§¯åˆ†è§„åˆ™å¼•æ“
- æ¿€åŠ±ç­–ç•¥ï¼šåŠ¨æ€æ¿€åŠ±è§„åˆ™é…ç½®
- æ’è¡Œæ¦œï¼šå®æ—¶æ’åè®¡ç®—å’Œå±•ç¤º
- å¥–åŠ±å‘æ”¾ï¼šç§¯åˆ†å…‘æ¢å’Œå¥–åŠ±ç®¡ç†

**æ ¸å¿ƒèšåˆ**ï¼š
- ç§¯åˆ†è´¦æˆ·èšåˆï¼ˆPointsAccount Aggregateï¼‰
- ç§¯åˆ†è§„åˆ™èšåˆï¼ˆPointsRule Aggregateï¼‰
- æ’è¡Œæ¦œèšåˆï¼ˆLeaderboard Aggregateï¼‰

#### 3. æœåŠ¡ä¸Šä¸‹æ–‡ï¼ˆService Contextï¼‰
**èŒè´£è¾¹ç•Œ**ï¼š
- æœåŠ¡å•†ç®¡ç†ï¼šèµ„è´¨è®¤è¯ã€èƒ½åŠ›è¯„ä¼°
- æœåŠ¡åŒ¹é…ï¼šæ™ºèƒ½åŒ¹é…ç®—æ³•
- æœåŠ¡ç›‘æ§ï¼šæœåŠ¡è´¨é‡è·Ÿè¸ª
- æœåŠ¡è¯„ä»·ï¼šå®¢æˆ·æ»¡æ„åº¦ç®¡ç†

**æ ¸å¿ƒèšåˆ**ï¼š
- æœåŠ¡æä¾›å•†èšåˆï¼ˆServiceProvider Aggregateï¼‰
- æœåŠ¡å•èšåˆï¼ˆServiceOrder Aggregateï¼‰
- æœåŠ¡è¯„ä»·èšåˆï¼ˆServiceEvaluation Aggregateï¼‰

#### 4. ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆUser Contextï¼‰
**èŒè´£è¾¹ç•Œ**ï¼š
- èº«ä»½è®¤è¯ï¼šç™»å½•ã€æƒé™éªŒè¯
- ç”¨æˆ·æ¡£æ¡ˆï¼šä¸ªäººä¿¡æ¯ç®¡ç†
- ç»„ç»‡ç®¡ç†ï¼šå›¢é˜Ÿç»“æ„ç»´æŠ¤
- æƒé™æ§åˆ¶ï¼šè§’è‰²æƒé™åˆ†é…

**æ ¸å¿ƒèšåˆ**ï¼š
- ç”¨æˆ·èšåˆï¼ˆUser Aggregateï¼‰
- ç»„ç»‡èšåˆï¼ˆOrganization Aggregateï¼‰
- æƒé™èšåˆï¼ˆPermission Aggregateï¼‰

### èšåˆè®¾è®¡åŸåˆ™

#### 1. é”€å”®å•èšåˆï¼ˆSalesOrder Aggregateï¼‰
**èšåˆæ ¹**ï¼šSalesOrder
**å®ä½“**ï¼š
- SalesOrderItemï¼ˆé”€å”®é¡¹ç›®ï¼‰
- SalesActivityï¼ˆé”€å”®æ´»åŠ¨ï¼‰
- SalesStageï¼ˆé”€å”®é˜¶æ®µï¼‰

**å€¼å¯¹è±¡**ï¼š
- Moneyï¼ˆé‡‘é¢ï¼‰
- SalesStatusï¼ˆé”€å”®çŠ¶æ€ï¼‰
- ContactInfoï¼ˆè”ç³»ä¿¡æ¯ï¼‰

**ä¸šåŠ¡è§„åˆ™**ï¼š
- çŠ¶æ€æœºè½¬æ¢è§„åˆ™
- é‡‘é¢è®¡ç®—è§„åˆ™
- æ—¶é—´çº¦æŸè§„åˆ™

#### 2. ç§¯åˆ†è´¦æˆ·èšåˆï¼ˆPointsAccount Aggregateï¼‰
**èšåˆæ ¹**ï¼šPointsAccount
**å®ä½“**ï¼š
- PointsTransactionï¼ˆç§¯åˆ†äº¤æ˜“ï¼‰
- PointsRuleï¼ˆç§¯åˆ†è§„åˆ™ï¼‰

**å€¼å¯¹è±¡**ï¼š
- Pointsï¼ˆç§¯åˆ†å€¼ï¼‰
- PointsTypeï¼ˆç§¯åˆ†ç±»å‹ï¼‰
- TransactionReasonï¼ˆäº¤æ˜“åŸå› ï¼‰

**ä¸šåŠ¡è§„åˆ™**ï¼š
- ç§¯åˆ†è®¡ç®—è§„åˆ™
- ç§¯åˆ†æœ‰æ•ˆæœŸè§„åˆ™
- ç§¯åˆ†è½¬æ¢è§„åˆ™

### ä¸Šä¸‹æ–‡æ˜ å°„å…³ç³»

#### 1. é”€å”®ä¸Šä¸‹æ–‡ â†” ç§¯åˆ†ä¸Šä¸‹æ–‡
**å…³ç³»ç±»å‹**ï¼šCustomer-Supplier
**é›†æˆæ–¹å¼**ï¼šé¢†åŸŸäº‹ä»¶
**æ•°æ®æµå‘**ï¼šé”€å”®äº‹ä»¶ â†’ ç§¯åˆ†è®¡ç®—

#### 2. é”€å”®ä¸Šä¸‹æ–‡ â†” æœåŠ¡ä¸Šä¸‹æ–‡
**å…³ç³»ç±»å‹**ï¼šPartnership
**é›†æˆæ–¹å¼**ï¼šå…±äº«å†…æ ¸
**æ•°æ®æµå‘**ï¼šåŒå‘æ•°æ®åŒæ­¥

#### 3. ç”¨æˆ·ä¸Šä¸‹æ–‡ â†’ å…¶ä»–ä¸Šä¸‹æ–‡
**å…³ç³»ç±»å‹**ï¼šUpstream-Downstream
**é›†æˆæ–¹å¼**ï¼šå¼€æ”¾ä¸»æœºæœåŠ¡
**æ•°æ®æµå‘**ï¼šç”¨æˆ·ä¿¡æ¯ â†’ ä¸šåŠ¡ä¸Šä¸‹æ–‡

## ğŸ”’ å®‰å…¨æ¶æ„è®¾è®¡

### STRIDEå¨èƒå»ºæ¨¡åˆ†æ

#### 1. å¨èƒè¯†åˆ«çŸ©é˜µ

| å¨èƒç±»å‹ | å…·ä½“å¨èƒ | å½±å“èµ„äº§ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|---------|---------|---------|---------|---------|
| **Spoofingï¼ˆæ¬ºéª—ï¼‰** | èº«ä»½ä¼ªé€ æ”»å‡» | ç”¨æˆ·è´¦æˆ·ã€APIæ¥å£ | é«˜ | å¤šå› ç´ è®¤è¯ã€JWTä»¤ç‰ŒéªŒè¯ |
| **Tamperingï¼ˆç¯¡æ”¹ï¼‰** | æ•°æ®å®Œæ•´æ€§ç ´å | é”€å”®æ•°æ®ã€ç§¯åˆ†è®°å½• | é«˜ | æ•°å­—ç­¾åã€æ•°æ®æ ¡éªŒå’Œ |
| **Repudiationï¼ˆæŠµèµ–ï¼‰** | æ“ä½œå¦è®¤ | ä¸šåŠ¡æ“ä½œè®°å½• | ä¸­ | å®Œæ•´å®¡è®¡æ—¥å¿—ã€æ•°å­—ç­¾å |
| **Information Disclosureï¼ˆä¿¡æ¯æ³„éœ²ï¼‰** | æ•æ„Ÿæ•°æ®æš´éœ² | å®¢æˆ·ä¿¡æ¯ã€é”€å”®æ•°æ® | é«˜ | æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ |
| **Denial of Serviceï¼ˆæ‹’ç»æœåŠ¡ï¼‰** | ç³»ç»Ÿå¯ç”¨æ€§æ”»å‡» | æ•´ä¸ªç³»ç»Ÿ | ä¸­ | é™æµã€ç†”æ–­ã€è´Ÿè½½å‡è¡¡ |
| **Elevation of Privilegeï¼ˆæƒé™æå‡ï¼‰** | éæˆæƒè®¿é—® | ç®¡ç†åŠŸèƒ½ã€æ•æ„Ÿæ•°æ® | é«˜ | æœ€å°æƒé™åŸåˆ™ã€æƒé™éªŒè¯ |

#### 2. æ”»å‡»é¢åˆ†æ

**å¤–éƒ¨æ”»å‡»é¢**ï¼š
- Webåº”ç”¨ç¨‹åºæ¥å£
- ç§»åŠ¨ç«¯APIæ¥å£
- ç¬¬ä¸‰æ–¹é›†æˆæ¥å£ï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰
- ç®¡ç†åå°æ¥å£

**å†…éƒ¨æ”»å‡»é¢**ï¼š
- æ•°æ®åº“è®¿é—®
- å†…éƒ¨æœåŠ¡é€šä¿¡
- æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- ç¼“å­˜ç³»ç»Ÿè®¿é—®

### é›¶ä¿¡ä»»å®‰å…¨æ¶æ„

#### 1. æ ¸å¿ƒåŸåˆ™
- **æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯**ï¼šæ‰€æœ‰è®¿é—®è¯·æ±‚éƒ½éœ€è¦éªŒè¯
- **æœ€å°æƒé™è®¿é—®**ï¼šç”¨æˆ·åªèƒ½è®¿é—®å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°èµ„æº
- **å‡è®¾è¿è§„**ï¼šå‡è®¾ç½‘ç»œå·²è¢«æ”»ç ´ï¼Œè®¾è®¡é˜²å¾¡ç­–ç•¥

#### 2. èº«ä»½è®¤è¯ä¸æˆæƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èº«ä»½è®¤è¯å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤šå› ç´ è®¤è¯  â”‚  OAuth 2.0  â”‚  JWTä»¤ç‰Œ  â”‚  ç”Ÿç‰©è¯†åˆ«      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æˆæƒå†³ç­–å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RBACæƒé™  â”‚  ABACå±æ€§  â”‚  åŠ¨æ€æƒé™  â”‚  ä¸Šä¸‹æ–‡æ„ŸçŸ¥     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç­–ç•¥æ‰§è¡Œå±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  APIç½‘å…³   â”‚  æœåŠ¡ç½‘æ ¼  â”‚  æ•°æ®åº“   â”‚  æ–‡ä»¶ç³»ç»Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. å¤šå±‚é˜²æŠ¤ä½“ç³»

**ç¬¬ä¸€å±‚ï¼šç½‘ç»œè¾¹ç•Œé˜²æŠ¤**
- Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰
- DDoSé˜²æŠ¤
- IPç™½åå•/é»‘åå•
- åœ°ç†ä½ç½®é™åˆ¶

**ç¬¬äºŒå±‚ï¼šåº”ç”¨å±‚é˜²æŠ¤**
- APIé™æµå’Œç†”æ–­
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- SQLæ³¨å…¥é˜²æŠ¤
- XSSæ”»å‡»é˜²æŠ¤

**ç¬¬ä¸‰å±‚ï¼šæ•°æ®å±‚é˜²æŠ¤**
- æ•°æ®åº“è®¿é—®æ§åˆ¶
- æ•æ„Ÿæ•°æ®åŠ å¯†
- æ•°æ®è„±æ•
- å¤‡ä»½åŠ å¯†

### å®‰å…¨æ§åˆ¶æªæ–½

#### 1. èº«ä»½è®¤è¯å®‰å…¨

**å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰**ï¼š
```typescript
interface MFAConfig {
  // å¯†ç è®¤è¯
  password: {
    minLength: 8
    complexity: 'high'
    expiration: 90 // å¤©
    history: 12 // è®°ä½æœ€è¿‘12ä¸ªå¯†ç 
  }
  
  // çŸ­ä¿¡éªŒè¯
  sms: {
    enabled: true
    expiration: 300 // 5åˆ†é’Ÿ
    maxAttempts: 3
  }
  
  // é‚®ç®±éªŒè¯
  email: {
    enabled: true
    expiration: 600 // 10åˆ†é’Ÿ
  }
  
  // ç”Ÿç‰©è¯†åˆ«ï¼ˆç§»åŠ¨ç«¯ï¼‰
  biometric: {
    fingerprint: true
    faceId: true
    fallbackToPassword: true
  }
}
```

**JWTä»¤ç‰Œå®‰å…¨**ï¼š
```typescript
interface JWTConfig {
  algorithm: 'RS256' // éå¯¹ç§°åŠ å¯†
  accessTokenExpiry: '15m' // è®¿é—®ä»¤ç‰Œ15åˆ†é’Ÿ
  refreshTokenExpiry: '7d' // åˆ·æ–°ä»¤ç‰Œ7å¤©
  issuer: 'l2c-system'
  audience: ['web-app', 'mobile-app']
  
  // ä»¤ç‰Œè½®æ¢
  rotation: {
    enabled: true
    gracePeriod: '5m' // 5åˆ†é’Ÿå®½é™æœŸ
  }
}
```

#### 2. æˆæƒæ§åˆ¶å®‰å…¨

**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰**ï¼š
```typescript
interface RBACModel {
  roles: {
    admin: {
      permissions: ['*'] // æ‰€æœ‰æƒé™
      restrictions: ['audit_log_access'] // å®¡è®¡æ—¥å¿—éœ€è¦é¢å¤–éªŒè¯
    }
    sales_manager: {
      permissions: [
        'sales:read', 'sales:write', 'sales:delete',
        'team:read', 'team:manage',
        'report:read'
      ]
      dataScope: 'team' // åªèƒ½è®¿é—®å›¢é˜Ÿæ•°æ®
    }
    sales_rep: {
      permissions: [
        'sales:read', 'sales:write',
        'customer:read', 'customer:write'
      ]
      dataScope: 'self' // åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
    }
  }
}
```

**åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰**ï¼š
```typescript
interface ABACPolicy {
  subject: {
    userId: string
    role: string
    department: string
    location: string
  }
  
  resource: {
    type: string // 'sales_order', 'customer', 'report'
    id: string
    owner: string
    sensitivity: 'public' | 'internal' | 'confidential' | 'secret'
  }
  
  action: 'create' | 'read' | 'update' | 'delete' | 'approve'
  
  environment: {
    time: Date
    location: string
    ipAddress: string
    deviceType: string
  }
  
  rules: PolicyRule[]
}
```

#### 3. æ•°æ®å®‰å…¨ä¿æŠ¤

**æ•°æ®åˆ†ç±»ä¸æ ‡è®°**ï¼š
```typescript
interface DataClassification {
  public: {
    description: 'å…¬å¼€æ•°æ®'
    examples: ['äº§å“ç›®å½•', 'å…¬å¸ä¿¡æ¯']
    protection: 'none'
  }
  
  internal: {
    description: 'å†…éƒ¨æ•°æ®'
    examples: ['å‘˜å·¥ä¿¡æ¯', 'å†…éƒ¨æµç¨‹']
    protection: 'access_control'
  }
  
  confidential: {
    description: 'æœºå¯†æ•°æ®'
    examples: ['å®¢æˆ·ä¿¡æ¯', 'é”€å”®æ•°æ®']
    protection: 'encryption + access_control'
  }
  
  secret: {
    description: 'ç»å¯†æ•°æ®'
    examples: ['è´¢åŠ¡æ•°æ®', 'æˆ˜ç•¥ä¿¡æ¯']
    protection: 'strong_encryption + strict_access_control + audit'
  }
}
```

**åŠ å¯†ç­–ç•¥**ï¼š
```typescript
interface EncryptionStrategy {
  // ä¼ è¾“åŠ å¯†
  transport: {
    protocol: 'TLS 1.3'
    cipherSuites: ['TLS_AES_256_GCM_SHA384']
    certificateValidation: true
    hsts: true // HTTP Strict Transport Security
  }
  
  // å­˜å‚¨åŠ å¯†
  storage: {
    database: {
      algorithm: 'AES-256-GCM'
      keyRotation: '90d'
      fieldLevel: ['password', 'phone', 'id_card']
    }
    
    files: {
      algorithm: 'AES-256-CBC'
      keyManagement: 'AWS KMS' // å¯†é’¥ç®¡ç†æœåŠ¡
    }
  }
  
  // åº”ç”¨å±‚åŠ å¯†
  application: {
    sensitiveFields: {
      algorithm: 'AES-256-GCM'
      keyDerivation: 'PBKDF2'
      saltLength: 32
    }
  }
}
```

### å®‰å…¨ç›‘æ§ä¸å“åº”

#### 1. å®‰å…¨äº‹ä»¶ç›‘æ§

**å®æ—¶ç›‘æ§æŒ‡æ ‡**ï¼š
```typescript
interface SecurityMetrics {
  authentication: {
    failedLogins: number
    suspiciousIPs: string[]
    bruteForceAttempts: number
    mfaBypassAttempts: number
  }
  
  authorization: {
    privilegeEscalationAttempts: number
    unauthorizedAccess: number
    suspiciousPermissionChanges: number
  }
  
  dataAccess: {
    massDataExport: number
    sensitiveDataAccess: number
    unusualAccessPatterns: number
  }
  
  systemSecurity: {
    malwareDetection: number
    vulnerabilityScans: number
    securityPatchStatus: string
  }
}
```

#### 2. å®‰å…¨äº‹ä»¶å“åº”

**äº‹ä»¶åˆ†çº§ä¸å“åº”**ï¼š
```typescript
interface SecurityIncidentResponse {
  critical: {
    examples: ['æ•°æ®æ³„éœ²', 'ç³»ç»Ÿå…¥ä¾µ', 'æ¶æ„è½¯ä»¶']
    responseTime: '15åˆ†é’Ÿ'
    actions: [
      'ç«‹å³éš”ç¦»å—å½±å“ç³»ç»Ÿ',
      'é€šçŸ¥å®‰å…¨å›¢é˜Ÿå’Œç®¡ç†å±‚',
      'å¯åŠ¨åº”æ€¥å“åº”è®¡åˆ’',
      'æ”¶é›†å’Œä¿æŠ¤è¯æ®'
    ]
  }
  
  high: {
    examples: ['æƒé™æå‡', 'å¼‚å¸¸è®¿é—®', 'å®‰å…¨ç­–ç•¥è¿è§„']
    responseTime: '1å°æ—¶'
    actions: [
      'è°ƒæŸ¥å®‰å…¨äº‹ä»¶',
      'è¯„ä¼°å½±å“èŒƒå›´',
      'å®æ–½ä¸´æ—¶ç¼“è§£æªæ–½',
      'é€šçŸ¥ç›¸å…³äººå‘˜'
    ]
  }
  
  medium: {
    examples: ['ç™»å½•å¼‚å¸¸', 'é…ç½®é”™è¯¯', 'ç­–ç•¥è¿è§„']
    responseTime: '4å°æ—¶'
    actions: [
      'è®°å½•å’Œåˆ†æäº‹ä»¶',
      'è¯„ä¼°é£é™©ç­‰çº§',
      'å®æ–½ä¿®å¤æªæ–½',
      'æ›´æ–°å®‰å…¨ç­–ç•¥'
    ]
  }
}
 ```

## âš¡ æ€§èƒ½æ¶æ„è®¾è®¡

### æ€§èƒ½ç›®æ ‡ä¸æŒ‡æ ‡

#### 1. é‡åŒ–æ€§èƒ½æŒ‡æ ‡

**å“åº”æ—¶é—´æŒ‡æ ‡**ï¼š
```typescript
interface PerformanceTargets {
  // APIå“åº”æ—¶é—´
  api: {
    p50: '200ms'    // 50%è¯·æ±‚åœ¨200mså†…å“åº”
    p95: '500ms'    // 95%è¯·æ±‚åœ¨500mså†…å“åº”
    p99: '1000ms'   // 99%è¯·æ±‚åœ¨1ç§’å†…å“åº”
    timeout: '30s'  // è¶…æ—¶æ—¶é—´30ç§’
  }
  
  // é¡µé¢åŠ è½½æ—¶é—´
  pageLoad: {
    fcp: '1.5s'     // First Contentful Paint
    lcp: '2.5s'     // Largest Contentful Paint
    fid: '100ms'    // First Input Delay
    cls: '0.1'      // Cumulative Layout Shift
  }
  
  // æ•°æ®åº“æŸ¥è¯¢æ—¶é—´
  database: {
    simple: '50ms'   // ç®€å•æŸ¥è¯¢
    complex: '200ms' // å¤æ‚æŸ¥è¯¢
    report: '5s'     // æŠ¥è¡¨æŸ¥è¯¢
  }
  
  // ç¼“å­˜å‘½ä¸­ç‡
  cache: {
    l1: '95%'       // åº”ç”¨çº§ç¼“å­˜
    l2: '85%'       // ä¸šåŠ¡çº§ç¼“å­˜
    l3: '75%'       // æ•°æ®çº§ç¼“å­˜
  }
}
```

**å¹¶å‘æ€§èƒ½æŒ‡æ ‡**ï¼š
```typescript
interface ConcurrencyTargets {
  // ç”¨æˆ·å¹¶å‘
  users: {
    peak: 1000      // å³°å€¼å¹¶å‘ç”¨æˆ·
    average: 300    // å¹³å‡å¹¶å‘ç”¨æˆ·
    growth: '50%'   // å¹´å¢é•¿ç‡
  }
  
  // APIå¹¶å‘
  api: {
    rps: 500        // æ¯ç§’è¯·æ±‚æ•°
    tps: 200        // æ¯ç§’äº‹åŠ¡æ•°
    connections: 2000 // æœ€å¤§è¿æ¥æ•°
  }
  
  // æ•°æ®åº“å¹¶å‘
  database: {
    connections: 100  // è¿æ¥æ± å¤§å°
    maxQueries: 1000  // æœ€å¤§æŸ¥è¯¢æ•°/ç§’
  }
}
```

#### 2. æ€§èƒ½ç›‘æ§æŒ‡æ ‡

**ç³»ç»Ÿèµ„æºæŒ‡æ ‡**ï¼š
```typescript
interface SystemMetrics {
  // CPUä½¿ç”¨ç‡
  cpu: {
    average: '60%'   // å¹³å‡ä½¿ç”¨ç‡
    peak: '80%'      // å³°å€¼ä½¿ç”¨ç‡
    alert: '85%'     // å‘Šè­¦é˜ˆå€¼
  }
  
  // å†…å­˜ä½¿ç”¨ç‡
  memory: {
    average: '70%'
    peak: '85%'
    alert: '90%'
  }
  
  // ç£ç›˜I/O
  disk: {
    iops: 1000       // æ¯ç§’I/Oæ“ä½œæ•°
    throughput: '100MB/s' // ååé‡
    latency: '10ms'  // å»¶è¿Ÿ
  }
  
  // ç½‘ç»œI/O
  network: {
    bandwidth: '1Gbps'
    latency: '5ms'
    packetLoss: '0.1%'
  }
}
```

### ä¸‰çº§ç¼“å­˜æ¶æ„è®¾è®¡

#### 1. ç¼“å­˜æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    L1 - åº”ç”¨çº§ç¼“å­˜                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  å†…å­˜ç¼“å­˜   â”‚ â”‚  æœ¬åœ°ç¼“å­˜   â”‚ â”‚  æµè§ˆå™¨ç¼“å­˜  â”‚        â”‚
â”‚  â”‚ (In-Memory) â”‚ â”‚ (Node.js)   â”‚ â”‚ (Browser)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    L2 - ä¸šåŠ¡çº§ç¼“å­˜                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Redisç¼“å­˜  â”‚ â”‚  ä¼šè¯ç¼“å­˜   â”‚ â”‚  æŸ¥è¯¢ç¼“å­˜   â”‚        â”‚
â”‚  â”‚ (Distributed)â”‚ â”‚ (Session)   â”‚ â”‚ (Query)     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    L3 - æ•°æ®çº§ç¼“å­˜                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  æ•°æ®åº“ç¼“å­˜  â”‚ â”‚  CDNç¼“å­˜    â”‚ â”‚  æ–‡ä»¶ç¼“å­˜   â”‚        â”‚
â”‚  â”‚ (Database)  â”‚ â”‚ (Content)   â”‚ â”‚ (Static)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. L1 åº”ç”¨çº§ç¼“å­˜

**å†…å­˜ç¼“å­˜ç­–ç•¥**ï¼š
```typescript
interface L1CacheStrategy {
  // çƒ­ç‚¹æ•°æ®ç¼“å­˜
  hotData: {
    type: 'LRU'
    maxSize: '100MB'
    ttl: '5m'
    items: [
      'user_permissions',
      'active_sessions',
      'frequent_queries'
    ]
  }
  
  // è®¡ç®—ç»“æœç¼“å­˜
  computation: {
    type: 'LFU'
    maxSize: '50MB'
    ttl: '10m'
    items: [
      'points_calculation',
      'report_aggregation',
      'search_results'
    ]
  }
  
  // é…ç½®æ•°æ®ç¼“å­˜
  config: {
    type: 'TTL'
    maxSize: '10MB'
    ttl: '1h'
    items: [
      'system_config',
      'business_rules',
      'ui_settings'
    ]
  }
}
```

**æµè§ˆå™¨ç¼“å­˜ç­–ç•¥**ï¼š
```typescript
interface BrowserCacheStrategy {
  // é™æ€èµ„æº
  static: {
    js: 'max-age=31536000, immutable'      // 1å¹´
    css: 'max-age=31536000, immutable'     // 1å¹´
    images: 'max-age=2592000'              // 30å¤©
    fonts: 'max-age=31536000, immutable'   // 1å¹´
  }
  
  // APIå“åº”
  api: {
    userInfo: 'max-age=300, must-revalidate'     // 5åˆ†é’Ÿ
    staticData: 'max-age=3600, must-revalidate'  // 1å°æ—¶
    dynamicData: 'no-cache, must-revalidate'     // ä¸ç¼“å­˜
  }
  
  // é¡µé¢ç¼“å­˜
  pages: {
    static: 'max-age=3600'                 // 1å°æ—¶
    dynamic: 'no-cache'                    // ä¸ç¼“å­˜
    spa: 'no-cache, must-revalidate'       // SPAé¡µé¢
  }
}
```

#### 3. L2 ä¸šåŠ¡çº§ç¼“å­˜

**Redisç¼“å­˜æ¶æ„**ï¼š
```typescript
interface L2CacheArchitecture {
  // ç¼“å­˜é›†ç¾¤é…ç½®
  cluster: {
    mode: 'cluster'
    nodes: 6
    replicas: 1
    sharding: 'consistent_hashing'
  }
  
  // ç¼“å­˜åˆ†åŒºç­–ç•¥
  partitioning: {
    user: {
      pattern: 'user:{userId}:*'
      ttl: '1h'
      eviction: 'allkeys-lru'
    }
    
    sales: {
      pattern: 'sales:{orderId}:*'
      ttl: '30m'
      eviction: 'volatile-ttl'
    }
    
    points: {
      pattern: 'points:{userId}:*'
      ttl: '15m'
      eviction: 'allkeys-lfu'
    }
    
    session: {
      pattern: 'session:{sessionId}'
      ttl: '24h'
      eviction: 'volatile-ttl'
    }
  }
}
```

**ç¼“å­˜æ›´æ–°ç­–ç•¥**ï¼š
```typescript
interface CacheUpdateStrategy {
  // Cache-Asideæ¨¡å¼
  cacheAside: {
    scenarios: ['ç”¨æˆ·ä¿¡æ¯', 'é”€å”®å•è¯¦æƒ…', 'å®¢æˆ·ä¿¡æ¯']
    flow: [
      '1. æŸ¥è¯¢ç¼“å­˜',
      '2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“',
      '3. æ›´æ–°ç¼“å­˜',
      '4. è¿”å›æ•°æ®'
    ]
  }
  
  // Write-Throughæ¨¡å¼
  writeThrough: {
    scenarios: ['ç§¯åˆ†ä½™é¢', 'åº“å­˜æ•°é‡', 'å®æ—¶çŠ¶æ€']
    flow: [
      '1. åŒæ—¶å†™å…¥ç¼“å­˜å’Œæ•°æ®åº“',
      '2. ç¡®ä¿æ•°æ®ä¸€è‡´æ€§',
      '3. è¿”å›å†™å…¥ç»“æœ'
    ]
  }
  
  // Write-Behindæ¨¡å¼
  writeBehind: {
    scenarios: ['æ—¥å¿—è®°å½•', 'ç»Ÿè®¡æ•°æ®', 'å®¡è®¡ä¿¡æ¯']
    flow: [
      '1. å…ˆå†™å…¥ç¼“å­˜',
      '2. å¼‚æ­¥å†™å…¥æ•°æ®åº“',
      '3. æé«˜å†™å…¥æ€§èƒ½'
    ]
  }
}
```

#### 4. L3 æ•°æ®çº§ç¼“å­˜

**æ•°æ®åº“ç¼“å­˜ä¼˜åŒ–**ï¼š
```typescript
interface DatabaseCacheOptimization {
  // PostgreSQLç¼“å­˜é…ç½®
  postgresql: {
    shared_buffers: '256MB'      // å…±äº«ç¼“å­˜
    effective_cache_size: '1GB'  // æœ‰æ•ˆç¼“å­˜å¤§å°
    work_mem: '4MB'              // å·¥ä½œå†…å­˜
    maintenance_work_mem: '64MB' // ç»´æŠ¤å·¥ä½œå†…å­˜
    
    // æŸ¥è¯¢è®¡åˆ’ç¼“å­˜
    plan_cache_mode: 'auto'
    max_prepared_transactions: 100
  }
  
  // è¿æ¥æ± ä¼˜åŒ–
  connectionPool: {
    min: 10          // æœ€å°è¿æ¥æ•°
    max: 100         // æœ€å¤§è¿æ¥æ•°
    idle: 30         // ç©ºé—²è¶…æ—¶(ç§’)
    acquire: 60      // è·å–è¶…æ—¶(ç§’)
    evict: 1000      // é©±é€é—´éš”(æ¯«ç§’)
  }
}
```

**CDNç¼“å­˜ç­–ç•¥**ï¼š
```typescript
interface CDNCacheStrategy {
  // é™æ€èµ„æºCDN
  static: {
    js: {
      ttl: '1y'
      compression: 'gzip, brotli'
      minify: true
    }
    
    css: {
      ttl: '1y'
      compression: 'gzip, brotli'
      minify: true
    }
    
    images: {
      ttl: '30d'
      compression: 'webp, avif'
      optimization: true
    }
  }
  
  // APIå“åº”CDN
  api: {
    public: {
      ttl: '1h'
      compression: 'gzip'
      cache_key: 'url + query'
    }
    
    private: {
      ttl: '5m'
      compression: 'gzip'
      cache_key: 'url + query + user'
    }
  }
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

**åŠ è½½æ€§èƒ½ä¼˜åŒ–**ï¼š
```typescript
interface FrontendOptimization {
  // ä»£ç åˆ†å‰²
  codeSplitting: {
    route: true          // è·¯ç”±çº§åˆ†å‰²
    component: true      // ç»„ä»¶çº§åˆ†å‰²
    vendor: true         // ç¬¬ä¸‰æ–¹åº“åˆ†å‰²
    dynamic: true        // åŠ¨æ€å¯¼å…¥
  }
  
  // èµ„æºä¼˜åŒ–
  assets: {
    images: {
      format: 'webp'     // ç°ä»£å›¾ç‰‡æ ¼å¼
      lazy: true         // æ‡’åŠ è½½
      responsive: true   // å“åº”å¼å›¾ç‰‡
    }
    
    fonts: {
      preload: true      // å­—ä½“é¢„åŠ è½½
      display: 'swap'    // å­—ä½“æ˜¾ç¤ºç­–ç•¥
      subset: true       // å­—ä½“å­é›†
    }
  }
  
  // é¢„åŠ è½½ç­–ç•¥
  preloading: {
    critical: 'preload'    // å…³é”®èµ„æºé¢„åŠ è½½
    important: 'prefetch'  // é‡è¦èµ„æºé¢„è·å–
    routes: 'prefetch'     // è·¯ç”±é¢„è·å–
  }
}
```

#### 2. åç«¯æ€§èƒ½ä¼˜åŒ–

**æ•°æ®åº“ä¼˜åŒ–**ï¼š
```typescript
interface DatabaseOptimization {
  // æŸ¥è¯¢ä¼˜åŒ–
  queries: {
    indexing: {
      strategy: 'composite_indexes'
      monitoring: 'slow_query_log'
      analysis: 'explain_analyze'
    }
    
    pagination: {
      method: 'cursor_based'
      limit: 50
      optimization: 'index_only_scan'
    }
    
    aggregation: {
      materialized_views: true
      partial_indexes: true
      expression_indexes: true
    }
  }
  
  // è¿æ¥ä¼˜åŒ–
  connections: {
    pooling: true
    prepared_statements: true
    connection_reuse: true
    idle_timeout: 30
  }
}
```

**APIæ€§èƒ½ä¼˜åŒ–**ï¼š
```typescript
interface APIOptimization {
  // å“åº”ä¼˜åŒ–
  response: {
    compression: 'gzip'
    minification: true
    field_selection: true    // GraphQLå­—æ®µé€‰æ‹©
    pagination: true
  }
  
  // å¹¶å‘æ§åˆ¶
  concurrency: {
    rate_limiting: '100/min'
    circuit_breaker: true
    bulkhead: true
    timeout: '30s'
  }
  
  // ç¼“å­˜ç­–ç•¥
  caching: {
    response_cache: true
    etag: true
    last_modified: true
    conditional_requests: true
  }
}
```

### æ€§èƒ½ç›‘æ§ä½“ç³»

#### 1. å®æ—¶æ€§èƒ½ç›‘æ§

**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š
```typescript
interface PerformanceMonitoring {
  // åº”ç”¨æ€§èƒ½ç›‘æ§
  apm: {
    response_time: true
    throughput: true
    error_rate: true
    apdex_score: true
  }
  
  // åŸºç¡€è®¾æ–½ç›‘æ§
  infrastructure: {
    cpu_usage: true
    memory_usage: true
    disk_io: true
    network_io: true
  }
  
  // ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
  business: {
    user_activity: true
    conversion_rate: true
    feature_usage: true
    performance_impact: true
  }
}
```

#### 2. æ€§èƒ½å‘Šè­¦æœºåˆ¶

**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```typescript
interface PerformanceAlerts {
  critical: {
    api_response_time: '>2s'
    error_rate: '>5%'
    cpu_usage: '>90%'
    memory_usage: '>95%'
    notification: ['email', 'sms', 'slack']
  }
  
  warning: {
    api_response_time: '>1s'
    error_rate: '>2%'
    cpu_usage: '>80%'
    memory_usage: '>85%'
    notification: ['email', 'slack']
  }
  
  info: {
    cache_hit_rate: '<70%'
    slow_queries: '>500ms'
    notification: ['slack']
  }
}
```

## ğŸ“Š å¯è§‚æµ‹æ€§ä½“ç³»è®¾è®¡

### å¯è§‚æµ‹æ€§æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¯è§‚æµ‹æ€§æ•°æ®æ”¶é›†å±‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æŒ‡æ ‡æ”¶é›†   â”‚ â”‚   æ—¥å¿—æ”¶é›†   â”‚ â”‚   é“¾è·¯è¿½è¸ª   â”‚ â”‚   äº‹ä»¶æ”¶é›†   â”‚ â”‚
â”‚  â”‚ (Metrics)   â”‚ â”‚  (Logs)     â”‚ â”‚  (Traces)   â”‚ â”‚  (Events)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®å¤„ç†ä¸å­˜å‚¨å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Prometheus  â”‚ â”‚ Elasticsearchâ”‚ â”‚   Jaeger    â”‚ â”‚ ClickHouse  â”‚ â”‚
â”‚  â”‚   (æŒ‡æ ‡)    â”‚ â”‚   (æ—¥å¿—)    â”‚ â”‚   (é“¾è·¯)    â”‚ â”‚   (äº‹ä»¶)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®åˆ†æä¸å¯è§†åŒ–å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Grafana   â”‚ â”‚   Kibana    â”‚ â”‚ Jaeger UI   â”‚ â”‚   è‡ªå®šä¹‰    â”‚ â”‚
â”‚  â”‚  (ç›‘æ§é¢æ¿)  â”‚ â”‚  (æ—¥å¿—åˆ†æ)  â”‚ â”‚  (é“¾è·¯åˆ†æ)  â”‚ â”‚  (ä¸šåŠ¡é¢æ¿)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        å‘Šè­¦ä¸å“åº”å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ AlertManagerâ”‚ â”‚   PagerDuty â”‚ â”‚    Slack    â”‚ â”‚   è‡ªåŠ¨ä¿®å¤   â”‚ â”‚
â”‚  â”‚  (å‘Šè­¦ç®¡ç†)  â”‚ â”‚  (äº‹ä»¶ç®¡ç†)  â”‚ â”‚   (é€šçŸ¥)    â”‚ â”‚ (Auto-heal) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›‘æ§ä½“ç³»è®¾è®¡

#### 1. åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰

**æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§**ï¼š
```typescript
interface APMMetrics {
  // é»„é‡‘ä¿¡å·æŒ‡æ ‡
  goldenSignals: {
    latency: {
      p50: 'histogram_quantile(0.5, http_request_duration_seconds)'
      p95: 'histogram_quantile(0.95, http_request_duration_seconds)'
      p99: 'histogram_quantile(0.99, http_request_duration_seconds)'
    }
    
    traffic: {
      rps: 'rate(http_requests_total[5m])'
      tps: 'rate(database_transactions_total[5m])'
      activeUsers: 'active_users_gauge'
    }
    
    errors: {
      errorRate: 'rate(http_requests_total{status=~"5.."}[5m])'
      errorCount: 'increase(http_requests_total{status=~"5.."}[1h])'
      errorRatio: 'rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m])'
    }
    
    saturation: {
      cpuUsage: '100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)'
      memoryUsage: '(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100'
      diskUsage: '(1 - (node_filesystem_avail_bytes / node_filesystem_size_bytes)) * 100'
    }
  }
  
  // ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
  business: {
    sales: {
      orderCreationRate: 'rate(orders_created_total[5m])'
      orderCompletionRate: 'rate(orders_completed_total[5m])'
      conversionRate: 'orders_completed_total / leads_created_total'
      averageOrderValue: 'avg(order_value_histogram)'
    }
    
    points: {
      pointsEarnedRate: 'rate(points_earned_total[5m])'
      pointsRedeemedRate: 'rate(points_redeemed_total[5m])'
      pointsBalance: 'sum(user_points_balance)'
    }
    
    users: {
      activeUsers: 'active_users_gauge'
      newRegistrations: 'rate(user_registrations_total[5m])'
      sessionDuration: 'avg(user_session_duration_seconds)'
    }
  }
}
```

**ç›‘æ§ä»ªè¡¨æ¿é…ç½®**ï¼š
```typescript
interface MonitoringDashboards {
  // ç³»ç»Ÿæ¦‚è§ˆä»ªè¡¨æ¿
  systemOverview: {
    panels: [
      'service_health_status',
      'request_rate_and_latency',
      'error_rate_trends',
      'resource_utilization',
      'active_alerts'
    ]
    refreshInterval: '30s'
    timeRange: '1h'
  }
  
  // ä¸šåŠ¡ç›‘æ§ä»ªè¡¨æ¿
  businessMetrics: {
    panels: [
      'sales_performance',
      'user_activity',
      'points_system_metrics',
      'conversion_funnels',
      'revenue_tracking'
    ]
    refreshInterval: '1m'
    timeRange: '24h'
  }
  
  // åŸºç¡€è®¾æ–½ä»ªè¡¨æ¿
  infrastructure: {
    panels: [
      'server_resources',
      'database_performance',
      'cache_metrics',
      'network_traffic',
      'storage_usage'
    ]
    refreshInterval: '15s'
    timeRange: '4h'
  }
}
```

#### 2. åŸºç¡€è®¾æ–½ç›‘æ§

**æœåŠ¡å™¨ç›‘æ§æŒ‡æ ‡**ï¼š
```typescript
interface InfrastructureMonitoring {
  // è®¡ç®—èµ„æºç›‘æ§
  compute: {
    cpu: {
      usage: 'node_cpu_seconds_total'
      loadAverage: 'node_load1, node_load5, node_load15'
      processes: 'node_procs_running, node_procs_blocked'
    }
    
    memory: {
      usage: 'node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes'
      available: 'node_memory_MemAvailable_bytes'
      swap: 'node_memory_SwapTotal_bytes - node_memory_SwapFree_bytes'
      buffers: 'node_memory_Buffers_bytes'
      cached: 'node_memory_Cached_bytes'
    }
    
    disk: {
      usage: 'node_filesystem_size_bytes - node_filesystem_avail_bytes'
      iops: 'rate(node_disk_io_time_seconds_total[5m])'
      throughput: 'rate(node_disk_read_bytes_total[5m]) + rate(node_disk_written_bytes_total[5m])'
      latency: 'rate(node_disk_io_time_weighted_seconds_total[5m])'
    }
  }
  
  // ç½‘ç»œç›‘æ§
  network: {
    traffic: 'rate(node_network_receive_bytes_total[5m]), rate(node_network_transmit_bytes_total[5m])'
    packets: 'rate(node_network_receive_packets_total[5m]), rate(node_network_transmit_packets_total[5m])'
    errors: 'rate(node_network_receive_errs_total[5m]), rate(node_network_transmit_errs_total[5m])'
    connections: 'node_netstat_Tcp_CurrEstab'
  }
  
  // æ•°æ®åº“ç›‘æ§
  database: {
    postgresql: {
      connections: 'pg_stat_database_numbackends'
      queries: 'rate(pg_stat_database_xact_commit[5m]) + rate(pg_stat_database_xact_rollback[5m])'
      locks: 'pg_locks_count'
      replication: 'pg_replication_lag'
      cacheHitRatio: 'pg_stat_database_blks_hit / (pg_stat_database_blks_hit + pg_stat_database_blks_read)'
    }
    
    redis: {
      memory: 'redis_memory_used_bytes'
      connections: 'redis_connected_clients'
      operations: 'rate(redis_commands_processed_total[5m])'
      hitRate: 'redis_keyspace_hits / (redis_keyspace_hits + redis_keyspace_misses)'
      evictions: 'rate(redis_evicted_keys_total[5m])'
    }
  }
}
```

### æ—¥å¿—ç®¡ç†ä½“ç³»

#### 1. æ—¥å¿—æ”¶é›†æ¶æ„

**æ—¥å¿—åˆ†ç±»ä¸æ ¼å¼**ï¼š
```typescript
interface LoggingArchitecture {
  // åº”ç”¨æ—¥å¿—
  application: {
    format: 'structured_json'
    levels: ['ERROR', 'WARN', 'INFO', 'DEBUG']
    fields: [
      'timestamp',
      'level',
      'service',
      'traceId',
      'spanId',
      'userId',
      'requestId',
      'message',
      'metadata'
    ]
    
    categories: {
      business: {
        events: ['order_created', 'payment_processed', 'points_earned']
        retention: '90d'
        indexing: 'full_text'
      }
      
      security: {
        events: ['login_attempt', 'permission_denied', 'suspicious_activity']
        retention: '1y'
        indexing: 'full_text'
        alerting: true
      }
      
      performance: {
        events: ['slow_query', 'high_latency', 'resource_exhaustion']
        retention: '30d'
        indexing: 'metrics'
        alerting: true
      }
      
      error: {
        events: ['exception', 'api_error', 'validation_failure']
        retention: '180d'
        indexing: 'full_text'
        alerting: true
      }
    }
  }
  
  // ç³»ç»Ÿæ—¥å¿—
  system: {
    sources: ['nginx', 'postgresql', 'redis', 'kubernetes']
    format: 'mixed'
    retention: '30d'
    parsing: 'grok_patterns'
  }
  
  // å®¡è®¡æ—¥å¿—
  audit: {
    events: ['data_access', 'configuration_change', 'user_action']
    format: 'structured_json'
    retention: '7y'
    immutable: true
    encryption: true
  }
}
```

**æ—¥å¿—å¤„ç†æµæ°´çº¿**ï¼š
```typescript
interface LogProcessingPipeline {
  // æ”¶é›†é˜¶æ®µ
  collection: {
    agents: ['filebeat', 'fluentd', 'vector']
    sources: ['files', 'syslog', 'containers', 'apis']
    buffering: {
      type: 'memory_and_disk'
      size: '100MB'
      flush_interval: '5s'
    }
  }
  
  // å¤„ç†é˜¶æ®µ
  processing: {
    parsing: {
      json: 'automatic'
      multiline: 'stack_traces'
      grok: 'custom_patterns'
    }
    
    enrichment: {
      geo_ip: true
      user_agent: true
      kubernetes_metadata: true
      custom_fields: ['environment', 'version', 'region']
    }
    
    filtering: {
      drop_debug_in_prod: true
      sample_high_volume: '10%'
      redact_sensitive: ['password', 'token', 'ssn']
    }
  }
  
  // å­˜å‚¨é˜¶æ®µ
  storage: {
    elasticsearch: {
      indices: 'daily_rotation'
      shards: 3
      replicas: 1
      compression: 'best_compression'
    }
    
    retention: {
      hot: '7d'
      warm: '30d'
      cold: '90d'
      delete: '1y'
    }
  }
}
```

#### 2. æ—¥å¿—åˆ†æä¸æŸ¥è¯¢

**æ—¥å¿—æŸ¥è¯¢æ¨¡å¼**ï¼š
```typescript
interface LogQueryPatterns {
  // é”™è¯¯åˆ†ææŸ¥è¯¢
  errorAnalysis: {
    recentErrors: 'level:ERROR AND @timestamp:[now-1h TO now]'
    errorTrends: 'level:ERROR | timechart span=5m count by service'
    topErrors: 'level:ERROR | top 10 message.keyword'
    errorsByUser: 'level:ERROR | stats count by userId'
  }
  
  // æ€§èƒ½åˆ†ææŸ¥è¯¢
  performanceAnalysis: {
    slowRequests: 'duration:>1000 AND @timestamp:[now-1h TO now]'
    latencyTrends: 'duration:* | timechart span=1m avg(duration) by endpoint'
    topSlowEndpoints: 'duration:>500 | top 10 endpoint.keyword by avg(duration)'
  }
  
  // ä¸šåŠ¡åˆ†ææŸ¥è¯¢
  businessAnalysis: {
    orderFlow: 'event:(order_created OR order_completed) | transaction orderId'
    userJourney: 'userId:* | transaction userId | sort @timestamp'
    conversionFunnel: 'event:(lead_created OR order_created OR payment_completed)'
  }
  
  // å®‰å…¨åˆ†ææŸ¥è¯¢
  securityAnalysis: {
    failedLogins: 'event:login_attempt AND status:failed'
    suspiciousActivity: 'event:suspicious_activity OR (failed_attempts:>5)'
    privilegeEscalation: 'event:permission_denied AND level:WARN'
  }
}
```

### åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

#### 1. é“¾è·¯è¿½è¸ªæ¶æ„

**è¿½è¸ªæ•°æ®æ¨¡å‹**ï¼š
```typescript
interface TracingDataModel {
  // Traceç»“æ„
  trace: {
    traceId: string          // å…¨å±€å”¯ä¸€è¿½è¸ªID
    spans: Span[]            // åŒ…å«çš„æ‰€æœ‰Span
    duration: number         // æ€»è€—æ—¶
    services: string[]       // æ¶‰åŠçš„æœåŠ¡
    errors: boolean          // æ˜¯å¦åŒ…å«é”™è¯¯
  }
  
  // Spanç»“æ„
  span: {
    spanId: string           // Spanå”¯ä¸€ID
    parentSpanId?: string    // çˆ¶Span ID
    traceId: string          // æ‰€å±Trace ID
    operationName: string    // æ“ä½œåç§°
    serviceName: string      // æœåŠ¡åç§°
    startTime: number        // å¼€å§‹æ—¶é—´
    duration: number         // æŒç»­æ—¶é—´
    tags: Record<string, any> // æ ‡ç­¾
    logs: LogEntry[]         // æ—¥å¿—æ¡ç›®
    status: 'ok' | 'error'   // çŠ¶æ€
  }
  
  // å…³é”®æ ‡ç­¾å®šä¹‰
  standardTags: {
    'http.method': string    // HTTPæ–¹æ³•
    'http.url': string       // è¯·æ±‚URL
    'http.status_code': number // HTTPçŠ¶æ€ç 
    'db.statement': string   // æ•°æ®åº“è¯­å¥
    'db.type': string        // æ•°æ®åº“ç±»å‹
    'user.id': string        // ç”¨æˆ·ID
    'error': boolean         // æ˜¯å¦é”™è¯¯
    'component': string      // ç»„ä»¶åç§°
  }
}
```

**è¿½è¸ªé‡‡æ ·ç­–ç•¥**ï¼š
```typescript
interface TracingSamplingStrategy {
  // é‡‡æ ·è§„åˆ™
  sampling: {
    // åŸºç¡€é‡‡æ ·ç‡
    default: 0.1             // 10%é‡‡æ ·ç‡
    
    // é”™è¯¯è¯·æ±‚å…¨é‡é‡‡æ ·
    error: 1.0               // 100%é‡‡æ ·ç‡
    
    // æ…¢è¯·æ±‚å…¨é‡é‡‡æ ·
    slow: {
      threshold: 1000        // è¶…è¿‡1ç§’çš„è¯·æ±‚
      rate: 1.0              // 100%é‡‡æ ·ç‡
    }
    
    // å…³é”®ä¸šåŠ¡è·¯å¾„
    critical: {
      paths: ['/api/orders', '/api/payments', '/api/points']
      rate: 0.5              // 50%é‡‡æ ·ç‡
    }
    
    // å¥åº·æ£€æŸ¥ä½é‡‡æ ·
    health: {
      paths: ['/health', '/metrics', '/ready']
      rate: 0.01             // 1%é‡‡æ ·ç‡
    }
  }
  
  // åŠ¨æ€é‡‡æ ·
  adaptive: {
    enabled: true
    target_tps: 100          // ç›®æ ‡æ¯ç§’è¿½è¸ªæ•°
    max_rate: 1.0            // æœ€å¤§é‡‡æ ·ç‡
    min_rate: 0.001          // æœ€å°é‡‡æ ·ç‡
    adjustment_interval: 60  // è°ƒæ•´é—´éš”(ç§’)
  }
}
```

#### 2. é“¾è·¯åˆ†æèƒ½åŠ›

**æ€§èƒ½åˆ†æè§†å›¾**ï¼š
```typescript
interface TraceAnalysisViews {
  // æœåŠ¡ä¾èµ–å›¾
  serviceDependency: {
    nodes: ServiceNode[]     // æœåŠ¡èŠ‚ç‚¹
    edges: ServiceEdge[]     // æœåŠ¡é—´è°ƒç”¨å…³ç³»
    metrics: {
      callRate: number       // è°ƒç”¨é¢‘ç‡
      errorRate: number      // é”™è¯¯ç‡
      avgLatency: number     // å¹³å‡å»¶è¿Ÿ
    }
  }
  
  // è°ƒç”¨é“¾ç€‘å¸ƒå›¾
  traceWaterfall: {
    spans: SpanView[]        // Spanè§†å›¾
    timeline: Timeline       // æ—¶é—´è½´
    criticalPath: Span[]     // å…³é”®è·¯å¾„
    bottlenecks: Span[]      // æ€§èƒ½ç“¶é¢ˆ
  }
  
  // æœåŠ¡æ€§èƒ½åˆ†æ
  servicePerformance: {
    latencyDistribution: Histogram    // å»¶è¿Ÿåˆ†å¸ƒ
    throughputTrends: TimeSeries     // ååé‡è¶‹åŠ¿
    errorAnalysis: ErrorBreakdown    // é”™è¯¯åˆ†æ
    dependencyImpact: ImpactAnalysis // ä¾èµ–å½±å“åˆ†æ
  }
  
  // ä¸šåŠ¡æµç¨‹è¿½è¸ª
  businessFlow: {
    userJourney: TraceFlow           // ç”¨æˆ·æ—…ç¨‹
    orderProcessing: TraceFlow       // è®¢å•å¤„ç†æµç¨‹
    pointsCalculation: TraceFlow     // ç§¯åˆ†è®¡ç®—æµç¨‹
  }
}
```

### å‘Šè­¦ä¸äº‹ä»¶å“åº”

#### 1. å‘Šè­¦è§„åˆ™é…ç½®

**åˆ†çº§å‘Šè­¦ä½“ç³»**ï¼š
```typescript
interface AlertingSystem {
  // å‘Šè­¦çº§åˆ«å®šä¹‰
  severity: {
    critical: {
      description: 'ç³»ç»Ÿä¸å¯ç”¨æˆ–ä¸¥é‡åŠŸèƒ½æ•…éšœ'
      response_time: '5m'
      escalation: '15m'
      notification: ['sms', 'call', 'slack', 'email']
      auto_actions: ['scale_up', 'failover']
    }
    
    warning: {
      description: 'æ€§èƒ½ä¸‹é™æˆ–æ½œåœ¨é—®é¢˜'
      response_time: '15m'
      escalation: '1h'
      notification: ['slack', 'email']
      auto_actions: ['collect_diagnostics']
    }
    
    info: {
      description: 'ä¿¡æ¯æ€§äº‹ä»¶æˆ–è½»å¾®å¼‚å¸¸'
      response_time: '1h'
      escalation: '4h'
      notification: ['slack']
      auto_actions: []
    }
  }
  
  // æ ¸å¿ƒå‘Šè­¦è§„åˆ™
  rules: {
    // å¯ç”¨æ€§å‘Šè­¦
    availability: {
      service_down: {
        condition: 'up == 0'
        duration: '1m'
        severity: 'critical'
        description: 'æœåŠ¡ä¸å¯ç”¨'
      }
      
      high_error_rate: {
        condition: 'rate(http_requests_total{status=~"5.."}[5m]) > 0.05'
        duration: '2m'
        severity: 'critical'
        description: 'é”™è¯¯ç‡è¶…è¿‡5%'
      }
    }
    
    // æ€§èƒ½å‘Šè­¦
    performance: {
      high_latency: {
        condition: 'histogram_quantile(0.95, http_request_duration_seconds) > 2'
        duration: '5m'
        severity: 'warning'
        description: 'P95å»¶è¿Ÿè¶…è¿‡2ç§’'
      }
      
      low_throughput: {
        condition: 'rate(http_requests_total[5m]) < 10'
        duration: '10m'
        severity: 'warning'
        description: 'è¯·æ±‚é‡å¼‚å¸¸ä½'
      }
    }
    
    // èµ„æºå‘Šè­¦
    resources: {
      high_cpu: {
        condition: 'cpu_usage > 85'
        duration: '5m'
        severity: 'warning'
        description: 'CPUä½¿ç”¨ç‡è¿‡é«˜'
      }
      
      high_memory: {
        condition: 'memory_usage > 90'
        duration: '3m'
        severity: 'critical'
        description: 'å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜'
      }
      
      disk_space: {
        condition: 'disk_usage > 85'
        duration: '1m'
        severity: 'warning'
        description: 'ç£ç›˜ç©ºé—´ä¸è¶³'
      }
    }
    
    // ä¸šåŠ¡å‘Šè­¦
    business: {
      order_processing_delay: {
        condition: 'avg(order_processing_duration) > 300'
        duration: '5m'
        severity: 'warning'
        description: 'è®¢å•å¤„ç†å»¶è¿Ÿ'
      }
      
      payment_failure_spike: {
        condition: 'rate(payment_failures_total[5m]) > 0.1'
        duration: '2m'
        severity: 'critical'
        description: 'æ”¯ä»˜å¤±è´¥ç‡æ¿€å¢'
      }
    }
  }
}
```

#### 2. äº‹ä»¶å“åº”æµç¨‹

**è‡ªåŠ¨åŒ–å“åº”æœºåˆ¶**ï¼š
```typescript
interface IncidentResponse {
  // è‡ªåŠ¨ä¿®å¤åŠ¨ä½œ
  autoHealing: {
    service_restart: {
      triggers: ['service_down', 'memory_leak']
      conditions: ['failure_count < 3', 'last_restart > 10m']
      actions: ['graceful_restart', 'health_check', 'notify']
    }
    
    auto_scaling: {
      triggers: ['high_cpu', 'high_memory', 'high_latency']
      conditions: ['load_trend_increasing', 'scale_cooldown_expired']
      actions: ['scale_out', 'monitor_metrics', 'notify']
    }
    
    circuit_breaker: {
      triggers: ['high_error_rate', 'dependency_failure']
      conditions: ['error_threshold_exceeded']
      actions: ['open_circuit', 'fallback_response', 'notify']
    }
  }
  
  // äº‹ä»¶å‡çº§æµç¨‹
  escalation: {
    level1: {
      duration: '15m'
      assignee: 'on_call_engineer'
      actions: ['acknowledge', 'initial_investigation']
    }
    
    level2: {
      duration: '30m'
      assignee: 'senior_engineer'
      actions: ['deep_investigation', 'coordinate_response']
    }
    
    level3: {
      duration: '1h'
      assignee: 'engineering_manager'
      actions: ['incident_commander', 'external_communication']
    }
  }
  
  // äº‹ä»¶æ²Ÿé€šæœºåˆ¶
  communication: {
    internal: {
      channels: ['slack_alerts', 'incident_room', 'status_page']
      frequency: 'every_15m'
      stakeholders: ['engineering', 'product', 'support']
    }
    
    external: {
      channels: ['status_page', 'customer_email', 'social_media']
      triggers: ['customer_impact', 'sla_breach']
      approval: 'incident_commander'
    }
  }
}
```

### å¯è§‚æµ‹æ€§æ•°æ®æ²»ç†

#### 1. æ•°æ®ä¿ç•™ç­–ç•¥

**åˆ†å±‚å­˜å‚¨ç­–ç•¥**ï¼š
```typescript
interface DataRetentionStrategy {
  // æŒ‡æ ‡æ•°æ®ä¿ç•™
  metrics: {
    raw: {
      resolution: '15s'
      retention: '7d'
      storage: 'hot_storage'
    }
    
    downsampled_5m: {
      resolution: '5m'
      retention: '30d'
      storage: 'warm_storage'
    }
    
    downsampled_1h: {
      resolution: '1h'
      retention: '1y'
      storage: 'cold_storage'
    }
    
    downsampled_1d: {
      resolution: '1d'
      retention: '5y'
      storage: 'archive_storage'
    }
  }
  
  // æ—¥å¿—æ•°æ®ä¿ç•™
  logs: {
    application: {
      hot: '7d'
      warm: '30d'
      cold: '90d'
      archive: '1y'
    }
    
    security: {
      hot: '30d'
      warm: '90d'
      cold: '1y'
      archive: '7y'
    }
    
    audit: {
      hot: '90d'
      warm: '1y'
      cold: '3y'
      archive: 'æ°¸ä¹…'
    }
  }
  
  // è¿½è¸ªæ•°æ®ä¿ç•™
  traces: {
    detailed: '7d'
    sampled: '30d'
    aggregated: '1y'
  }
}
```

#### 2. æˆæœ¬ä¼˜åŒ–ç­–ç•¥

**å­˜å‚¨æˆæœ¬ä¼˜åŒ–**ï¼š
```typescript
interface CostOptimization {
  // æ•°æ®å‹ç¼©
  compression: {
    metrics: 'snappy'
    logs: 'gzip'
    traces: 'lz4'
  }
  
  // æ™ºèƒ½é‡‡æ ·
  intelligentSampling: {
    normal_traffic: 0.1
    error_traffic: 1.0
    slow_traffic: 1.0
    business_critical: 0.5
  }
  
  // å­˜å‚¨åˆ†å±‚
  storageTiering: {
    hot: 'ssd_local'
    warm: 'ssd_network'
    cold: 'hdd_network'
    archive: 'object_storage'
  }
  
  // æŸ¥è¯¢ä¼˜åŒ–
  queryOptimization: {
    index_strategy: 'time_based_partitioning'
    cache_frequently_used: true
    limit_query_range: '30d'
    optimize_aggregations: true
  }
}
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- å®Œæ•´å¾®æœåŠ¡æ¶æ„ï¼ŒæœåŠ¡ç‹¬ç«‹éƒ¨ç½²
- åˆ†åº“åˆ†è¡¨ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®å­˜å‚¨
- æœåŠ¡ç½‘æ ¼ç®¡ç†ï¼Œæµé‡æ§åˆ¶å’Œå®‰å…¨ç­–ç•¥
- å®¹å™¨åŒ–éƒ¨ç½²ï¼ŒKubernetesç¼–æ’
- å®Œæ•´ç›‘æ§ä½“ç³»ï¼Œå®æ—¶æ€§èƒ½åˆ†æ

## ğŸ—„ï¸ æ•°æ®æ¶æ„è®¾è®¡

### æ•°æ®æ²»ç†ä½“ç³»

#### 1. æ•°æ®æ²»ç†æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æ²»ç†æ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®æ²»ç†å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ•°æ®æ ‡å‡†   â”‚ â”‚  æ•°æ®è´¨é‡   â”‚ â”‚  æ•°æ®å®‰å…¨   â”‚ â”‚  æ•°æ®ç”Ÿå‘½å‘¨æœŸ â”‚ â”‚
â”‚  â”‚   ç®¡ç†      â”‚ â”‚   ç®¡ç†      â”‚ â”‚   ç®¡ç†      â”‚ â”‚    ç®¡ç†      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®ç®¡ç†å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å…ƒæ•°æ®     â”‚ â”‚  ä¸»æ•°æ®     â”‚ â”‚  æ•°æ®è¡€ç¼˜   â”‚ â”‚  æ•°æ®ç›®å½•   â”‚ â”‚
â”‚  â”‚  ç®¡ç†       â”‚ â”‚  ç®¡ç†       â”‚ â”‚  ç®¡ç†       â”‚ â”‚  ç®¡ç†       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        æ•°æ®å­˜å‚¨å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä¸šåŠ¡æ•°æ®åº“  â”‚ â”‚  æ•°æ®ä»“åº“   â”‚ â”‚  æ•°æ®æ¹–     â”‚ â”‚  ç¼“å­˜å­˜å‚¨   â”‚ â”‚
â”‚  â”‚(PostgreSQL) â”‚ â”‚(ClickHouse) â”‚ â”‚(MinIO/S3)   â”‚ â”‚  (Redis)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ•°æ®æ ‡å‡†ç®¡ç†

**æ•°æ®æ¨¡å‹æ ‡å‡†**ï¼š
```typescript
interface DataStandard {
  // å‘½åè§„èŒƒ
  naming: {
    tables: 'snake_case'           // è¡¨åï¼šusers, sales_orders
    columns: 'snake_case'          // å­—æ®µåï¼šuser_id, created_at
    indexes: 'idx_table_column'    // ç´¢å¼•åï¼šidx_users_email
    constraints: 'fk_table_ref'    // çº¦æŸåï¼šfk_orders_user_id
  }
  
  // æ•°æ®ç±»å‹æ ‡å‡†
  dataTypes: {
    id: 'UUID'                     // ä¸»é”®ç»Ÿä¸€ä½¿ç”¨UUID
    timestamp: 'TIMESTAMPTZ'       // æ—¶é—´æˆ³å¸¦æ—¶åŒº
    money: 'DECIMAL(15,2)'         // é‡‘é¢å­—æ®µ
    status: 'VARCHAR(50)'          // çŠ¶æ€å­—æ®µ
    description: 'TEXT'            // æè¿°å­—æ®µ
  }
  
  // å­—æ®µæ ‡å‡†
  commonFields: {
    id: 'UUID PRIMARY KEY DEFAULT gen_random_uuid()'
    created_at: 'TIMESTAMPTZ NOT NULL DEFAULT NOW()'
    updated_at: 'TIMESTAMPTZ NOT NULL DEFAULT NOW()'
    created_by: 'UUID REFERENCES users(id)'
    updated_by: 'UUID REFERENCES users(id)'
    version: 'INTEGER NOT NULL DEFAULT 1'
    is_deleted: 'BOOLEAN NOT NULL DEFAULT FALSE'
  }
}
```

**æ•°æ®å­—å…¸ç®¡ç†**ï¼š
```sql
-- æ•°æ®å­—å…¸è¡¨
CREATE TABLE data_dictionary (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  table_name VARCHAR(100) NOT NULL,
  column_name VARCHAR(100) NOT NULL,
  data_type VARCHAR(50) NOT NULL,
  is_nullable BOOLEAN NOT NULL,
  default_value TEXT,
  description TEXT NOT NULL,
  business_rules TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- æšä¸¾å€¼ç®¡ç†è¡¨
CREATE TABLE enum_values (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  enum_type VARCHAR(100) NOT NULL,
  enum_value VARCHAR(100) NOT NULL,
  display_name VARCHAR(200) NOT NULL,
  description TEXT,
  sort_order INTEGER DEFAULT 0,
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

#### 3. æ•°æ®è´¨é‡ç®¡ç†

**æ•°æ®è´¨é‡ç›‘æ§**ï¼š
```typescript
interface DataQualityRules {
  // å®Œæ•´æ€§æ£€æŸ¥
  completeness: {
    required_fields: ['user_id', 'created_at', 'status']
    null_threshold: 0.05  // ç©ºå€¼ç‡ä¸è¶…è¿‡5%
    missing_threshold: 0.02  // ç¼ºå¤±ç‡ä¸è¶…è¿‡2%
  }
  
  // å‡†ç¡®æ€§æ£€æŸ¥
  accuracy: {
    format_validation: {
      email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
      phone: /^1[3-9]\d{9}$/
      id_card: /^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/
    }
    range_validation: {
      age: { min: 0, max: 150 }
      amount: { min: 0, max: 999999999.99 }
      percentage: { min: 0, max: 100 }
    }
  }
  
  // ä¸€è‡´æ€§æ£€æŸ¥
  consistency: {
    reference_integrity: true
    cross_table_validation: {
      'orders.user_id': 'users.id'
      'order_items.order_id': 'orders.id'
    }
    business_rules: [
      'order_amount = SUM(order_items.amount)',
      'user.total_points >= 0',
      'order.created_at <= order.updated_at'
    ]
  }
  
  // åŠæ—¶æ€§æ£€æŸ¥
  timeliness: {
    data_freshness: {
      real_time: '< 1min'
      near_real_time: '< 5min'
      batch: '< 1hour'
    }
    update_frequency: {
      user_profile: 'daily'
      order_status: 'real_time'
      analytics: 'hourly'
    }
  }
}
```

**æ•°æ®è´¨é‡ç›‘æ§å®ç°**ï¼š
```typescript
class DataQualityMonitor {
  async checkDataQuality(tableName: string): Promise<QualityReport> {
    const report: QualityReport = {
      table: tableName,
      timestamp: new Date(),
      scores: {},
      issues: []
    }
    
    // å®Œæ•´æ€§æ£€æŸ¥
    const completenessScore = await this.checkCompleteness(tableName)
    report.scores.completeness = completenessScore
    
    // å‡†ç¡®æ€§æ£€æŸ¥
    const accuracyScore = await this.checkAccuracy(tableName)
    report.scores.accuracy = accuracyScore
    
    // ä¸€è‡´æ€§æ£€æŸ¥
    const consistencyScore = await this.checkConsistency(tableName)
    report.scores.consistency = consistencyScore
    
    // è®¡ç®—æ€»åˆ†
    report.overallScore = this.calculateOverallScore(report.scores)
    
    // ç”Ÿæˆå‘Šè­¦
    if (report.overallScore < 0.8) {
      await this.generateAlert(report)
    }
    
    return report
  }
  
  private async checkCompleteness(tableName: string): Promise<number> {
    const query = `
      SELECT 
        COUNT(*) as total_rows,
        COUNT(CASE WHEN user_id IS NULL THEN 1 END) as null_user_id,
        COUNT(CASE WHEN created_at IS NULL THEN 1 END) as null_created_at
      FROM ${tableName}
    `
    
    const result = await this.db.query(query)
    const nullRate = (result.null_user_id + result.null_created_at) / (result.total_rows * 2)
    
    return Math.max(0, 1 - nullRate / 0.05) // 5%ä¸ºé˜ˆå€¼
  }
}
```

### æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶

#### 1. åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†

**Sagaæ¨¡å¼å®ç°**ï¼š
```typescript
interface SagaStep {
  name: string
  execute: () => Promise<any>
  compensate: () => Promise<any>
  timeout?: number
}

class SagaOrchestrator {
  private steps: SagaStep[] = []
  private executedSteps: string[] = []
  
  addStep(step: SagaStep): void {
    this.steps.push(step)
  }
  
  async execute(): Promise<SagaResult> {
    try {
      // æ­£å‘æ‰§è¡Œæ‰€æœ‰æ­¥éª¤
      for (const step of this.steps) {
        await this.executeStep(step)
        this.executedSteps.push(step.name)
      }
      
      return { success: true, completedSteps: this.executedSteps }
    } catch (error) {
      // æ‰§è¡Œè¡¥å¿æ“ä½œ
      await this.compensate()
      return { success: false, error, compensatedSteps: this.executedSteps }
    }
  }
  
  private async executeStep(step: SagaStep): Promise<void> {
    const timeout = step.timeout || 30000
    
    return Promise.race([
      step.execute(),
      new Promise((_, reject) => 
        setTimeout(() => reject(new Error('Step timeout')), timeout)
      )
    ])
  }
  
  private async compensate(): Promise<void> {
    // é€†åºæ‰§è¡Œè¡¥å¿æ“ä½œ
    for (let i = this.executedSteps.length - 1; i >= 0; i--) {
      const stepName = this.executedSteps[i]
      const step = this.steps.find(s => s.name === stepName)
      
      if (step) {
        try {
          await step.compensate()
        } catch (error) {
          console.error(`Compensation failed for step ${stepName}:`, error)
        }
      }
    }
  }
}

// è®¢å•åˆ›å»ºSagaç¤ºä¾‹
class OrderCreationSaga {
  async createOrder(orderData: CreateOrderRequest): Promise<SagaResult> {
    const saga = new SagaOrchestrator()
    
    // æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•
    saga.addStep({
      name: 'create_order',
      execute: async () => {
        return await this.orderService.createOrder(orderData)
      },
      compensate: async () => {
        await this.orderService.cancelOrder(orderData.orderId)
      }
    })
    
    // æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜
    saga.addStep({
      name: 'reduce_inventory',
      execute: async () => {
        return await this.inventoryService.reduceStock(orderData.items)
      },
      compensate: async () => {
        await this.inventoryService.restoreStock(orderData.items)
      }
    })
    
    // æ­¥éª¤3ï¼šæ‰£å‡ç§¯åˆ†
    saga.addStep({
      name: 'deduct_points',
      execute: async () => {
        return await this.pointService.deductPoints(orderData.userId, orderData.pointsUsed)
      },
      compensate: async () => {
        await this.pointService.addPoints(orderData.userId, orderData.pointsUsed)
      }
    })
    
    // æ­¥éª¤4ï¼šå‘é€é€šçŸ¥
    saga.addStep({
      name: 'send_notification',
      execute: async () => {
        return await this.notificationService.sendOrderConfirmation(orderData)
      },
      compensate: async () => {
        await this.notificationService.sendOrderCancellation(orderData)
      }
    })
    
    return await saga.execute()
  }
}
```

#### 2. äº‹ä»¶é©±åŠ¨æ¶æ„

**é¢†åŸŸäº‹ä»¶è®¾è®¡**ï¼š
```typescript
interface DomainEvent {
  id: string
  aggregateId: string
  aggregateType: string
  eventType: string
  eventData: any
  version: number
  timestamp: Date
  userId?: string
}

class EventStore {
  async saveEvent(event: DomainEvent): Promise<void> {
    // ä¿å­˜äº‹ä»¶åˆ°äº‹ä»¶å­˜å‚¨
    await this.db.query(`
      INSERT INTO event_store (
        id, aggregate_id, aggregate_type, event_type, 
        event_data, version, timestamp, user_id
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
    `, [
      event.id, event.aggregateId, event.aggregateType,
      event.eventType, JSON.stringify(event.eventData),
      event.version, event.timestamp, event.userId
    ])
    
    // å‘å¸ƒäº‹ä»¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—
    await this.messageQueue.publish(event.eventType, event)
  }
  
  async getEvents(aggregateId: string, fromVersion?: number): Promise<DomainEvent[]> {
    const query = `
      SELECT * FROM event_store 
      WHERE aggregate_id = $1 
      ${fromVersion ? 'AND version > $2' : ''}
      ORDER BY version ASC
    `
    
    const params = fromVersion ? [aggregateId, fromVersion] : [aggregateId]
    const rows = await this.db.query(query, params)
    
    return rows.map(row => ({
      id: row.id,
      aggregateId: row.aggregate_id,
      aggregateType: row.aggregate_type,
      eventType: row.event_type,
      eventData: JSON.parse(row.event_data),
      version: row.version,
      timestamp: row.timestamp,
      userId: row.user_id
    }))
  }
}

// äº‹ä»¶å¤„ç†å™¨
class OrderEventHandler {
  @EventHandler('OrderCreated')
  async handleOrderCreated(event: DomainEvent): Promise<void> {
    const orderData = event.eventData
    
    // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡
    await this.userService.updateOrderStats(orderData.userId)
    
    // æ›´æ–°å•†å“é”€é‡
    await this.productService.updateSalesCount(orderData.items)
    
    // ç”Ÿæˆç§¯åˆ†å¥–åŠ±
    await this.pointService.awardPoints(orderData.userId, orderData.pointsEarned)
  }
  
  @EventHandler('OrderCancelled')
  async handleOrderCancelled(event: DomainEvent): Promise<void> {
    const orderData = event.eventData
    
    // æ¢å¤åº“å­˜
    await this.inventoryService.restoreStock(orderData.items)
    
    // é€€è¿˜ç§¯åˆ†
    if (orderData.pointsUsed > 0) {
      await this.pointService.refundPoints(orderData.userId, orderData.pointsUsed)
    }
  }
}
```

#### 3. æ•°æ®åŒæ­¥æœºåˆ¶

**CDCï¼ˆChange Data Captureï¼‰å®ç°**ï¼š
```typescript
class ChangeDataCapture {
  private readonly debeziumConnector: DebeziumConnector
  
  async setupCDC(tables: string[]): Promise<void> {
    for (const table of tables) {
      await this.debeziumConnector.createConnector({
        name: `${table}-cdc-connector`,
        config: {
          'connector.class': 'io.debezium.connector.postgresql.PostgresConnector',
          'database.hostname': process.env.DB_HOST,
          'database.port': process.env.DB_PORT,
          'database.user': process.env.DB_USER,
          'database.password': process.env.DB_PASSWORD,
          'database.dbname': process.env.DB_NAME,
          'database.server.name': 'l2c-db',
          'table.include.list': `public.${table}`,
          'plugin.name': 'pgoutput',
          'slot.name': `debezium_${table}`,
          'publication.name': `dbz_publication_${table}`
        }
      })
    }
  }
  
  async handleChangeEvent(event: ChangeEvent): Promise<void> {
    const { operation, before, after, source } = event
    
    switch (operation) {
      case 'c': // CREATE
        await this.handleInsert(source.table, after)
        break
      case 'u': // UPDATE
        await this.handleUpdate(source.table, before, after)
        break
      case 'd': // DELETE
        await this.handleDelete(source.table, before)
        break
    }
  }
  
  private async handleInsert(table: string, data: any): Promise<void> {
    // åŒæ­¥åˆ°ç¼“å­˜
    await this.cacheService.set(`${table}:${data.id}`, data)
    
    // åŒæ­¥åˆ°æœç´¢å¼•æ“
    if (this.isSearchableTable(table)) {
      await this.searchService.index(table, data)
    }
    
    // åŒæ­¥åˆ°æ•°æ®ä»“åº“
    await this.dataWarehouse.insert(table, data)
  }
  
  private async handleUpdate(table: string, before: any, after: any): Promise<void> {
    // æ›´æ–°ç¼“å­˜
    await this.cacheService.set(`${table}:${after.id}`, after)
    
    // æ›´æ–°æœç´¢å¼•æ“
    if (this.isSearchableTable(table)) {
      await this.searchService.update(table, after)
    }
    
    // åŒæ­¥åˆ°æ•°æ®ä»“åº“
    await this.dataWarehouse.update(table, before, after)
  }
}
```

#### 4. æ•°æ®ç‰ˆæœ¬æ§åˆ¶

**æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†**ï¼š
```typescript
interface DataMigration {
  version: string
  description: string
  up: () => Promise<void>
  down: () => Promise<void>
  checksum: string
}

class DatabaseMigrator {
  async migrate(): Promise<void> {
    const currentVersion = await this.getCurrentVersion()
    const pendingMigrations = await this.getPendingMigrations(currentVersion)
    
    for (const migration of pendingMigrations) {
      await this.executeMigration(migration)
    }
  }
  
  async rollback(targetVersion: string): Promise<void> {
    const currentVersion = await this.getCurrentVersion()
    const rollbackMigrations = await this.getRollbackMigrations(currentVersion, targetVersion)
    
    for (const migration of rollbackMigrations.reverse()) {
      await this.executeRollback(migration)
    }
  }
  
  private async executeMigration(migration: DataMigration): Promise<void> {
    const transaction = await this.db.beginTransaction()
    
    try {
      // æ‰§è¡Œè¿ç§»
      await migration.up()
      
      // è®°å½•è¿ç§»å†å²
      await this.recordMigration(migration)
      
      await transaction.commit()
      console.log(`Migration ${migration.version} completed successfully`)
    } catch (error) {
      await transaction.rollback()
      console.error(`Migration ${migration.version} failed:`, error)
      throw error
    }
  }
}

// è¿ç§»ç¤ºä¾‹
const migration_20250101_001: DataMigration = {
  version: '20250101_001',
  description: 'Add user preferences table',
  checksum: 'abc123def456',
  
  up: async () => {
    await db.query(`
      CREATE TABLE user_preferences (
        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
        user_id UUID NOT NULL REFERENCES users(id),
        preference_key VARCHAR(100) NOT NULL,
        preference_value JSONB NOT NULL,
        created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
        updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
        UNIQUE(user_id, preference_key)
      )
    `)
    
    await db.query(`
      CREATE INDEX idx_user_preferences_user_id 
      ON user_preferences(user_id)
    `)
  },
  
  down: async () => {
    await db.query('DROP TABLE IF EXISTS user_preferences')
  }
}
```

### æ•°æ®å¤‡ä»½ä¸æ¢å¤

#### 1. å¤‡ä»½ç­–ç•¥

**å¤šå±‚å¤‡ä»½æ¶æ„**ï¼š
```typescript
interface BackupStrategy {
  // å®æ—¶å¤‡ä»½
  realtime: {
    method: 'WAL-E/WAL-G'
    frequency: 'continuous'
    retention: '7d'
    storage: 's3://backup-bucket/wal/'
  }
  
  // å¢é‡å¤‡ä»½
  incremental: {
    method: 'pg_basebackup'
    frequency: 'hourly'
    retention: '30d'
    storage: 's3://backup-bucket/incremental/'
  }
  
  // å…¨é‡å¤‡ä»½
  full: {
    method: 'pg_dump'
    frequency: 'daily'
    retention: '90d'
    storage: 's3://backup-bucket/full/'
    compression: 'gzip'
  }
  
  // å½’æ¡£å¤‡ä»½
  archive: {
    method: 'pg_dump'
    frequency: 'monthly'
    retention: '7y'
    storage: 's3://archive-bucket/monthly/'
    encryption: 'AES-256'
  }
}

class BackupManager {
  async createBackup(type: 'full' | 'incremental'): Promise<BackupResult> {
    const timestamp = new Date().toISOString()
    const backupId = `${type}_${timestamp}`
    
    try {
      let backupPath: string
      
      if (type === 'full') {
        backupPath = await this.createFullBackup(backupId)
      } else {
        backupPath = await this.createIncrementalBackup(backupId)
      }
      
      // ä¸Šä¼ åˆ°äº‘å­˜å‚¨
      const cloudPath = await this.uploadToCloud(backupPath, type)
      
      // è®°å½•å¤‡ä»½ä¿¡æ¯
      await this.recordBackup({
        id: backupId,
        type,
        path: cloudPath,
        size: await this.getFileSize(backupPath),
        checksum: await this.calculateChecksum(backupPath),
        created_at: new Date()
      })
      
      // æ¸…ç†æœ¬åœ°æ–‡ä»¶
      await this.cleanupLocalFile(backupPath)
      
      return { success: true, backupId, path: cloudPath }
    } catch (error) {
      console.error(`Backup failed:`, error)
      return { success: false, error: error.message }
    }
  }
  
  async restoreBackup(backupId: string): Promise<RestoreResult> {
    const backup = await this.getBackupInfo(backupId)
    
    if (!backup) {
      throw new Error(`Backup ${backupId} not found`)
    }
    
    try {
      // ä¸‹è½½å¤‡ä»½æ–‡ä»¶
      const localPath = await this.downloadFromCloud(backup.path)
      
      // éªŒè¯å¤‡ä»½å®Œæ•´æ€§
      const isValid = await this.validateBackup(localPath, backup.checksum)
      if (!isValid) {
        throw new Error('Backup file is corrupted')
      }
      
      // æ‰§è¡Œæ¢å¤
      await this.executeRestore(localPath, backup.type)
      
      // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      await this.cleanupLocalFile(localPath)
      
      return { success: true, restoredAt: new Date() }
    } catch (error) {
      console.error(`Restore failed:`, error)
      return { success: false, error: error.message }
    }
  }
}
```

## ğŸ–¥ï¸ å‰ç«¯æ¶æ„è®¾è®¡

### Webç«¯æ¶æ„ï¼ˆNext.js 15+ + TypeScriptï¼‰

#### æŠ€æœ¯æ ˆé€‰æ‹©
```
Next.js 15+           - Reactå…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒApp Router
TypeScript 5.0+       - ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†
Tailwind CSS 4.1+     - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
Zustand 4.4+          - è½»é‡çº§çŠ¶æ€ç®¡ç†åº“
Axios 1.6+            - åŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯
SWR 2.2+              - æ•°æ®è·å–åº“
React Hook Form 7.48+ - é«˜æ€§èƒ½è¡¨å•åº“
ECharts 5.4+          - ç™¾åº¦å¼€æºæ•°æ®å¯è§†åŒ–åº“
```

#### æ¶æ„åˆ†å±‚è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é¡µé¢å±‚ï¼ˆPagesï¼‰            â”‚
â”‚  çº¿ç´¢ç®¡ç†ã€é”€å”®å•ç®¡ç†ã€æ•°æ®åˆ†æç­‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ä¸šåŠ¡ç»„ä»¶å±‚ï¼ˆComponentsï¼‰     â”‚
â”‚  è¡¨å•ç»„ä»¶ã€è¡¨æ ¼ç»„ä»¶ã€å›¾è¡¨ç»„ä»¶ç­‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          åŸºç¡€ç»„ä»¶å±‚ï¼ˆUI Componentsï¼‰  â”‚
â”‚  æŒ‰é’®ã€è¾“å…¥æ¡†ã€é€‰æ‹©å™¨ç­‰åŸºç¡€UIç»„ä»¶      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          çŠ¶æ€ç®¡ç†å±‚ï¼ˆStoreï¼‰         â”‚
â”‚  ç”¨æˆ·çŠ¶æ€ã€è®¢å•çŠ¶æ€ã€å…¨å±€çŠ¶æ€ç®¡ç†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æœåŠ¡å±‚ï¼ˆServicesï¼‰          â”‚
â”‚  APIè°ƒç”¨ã€æ•°æ®å¤„ç†ã€ä¸šåŠ¡é€»è¾‘å°è£…       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          å·¥å…·å±‚ï¼ˆUtilsï¼‰             â”‚
â”‚  æ—¥æœŸå¤„ç†ã€æ•°æ®æ ¼å¼åŒ–ã€éªŒè¯è§„åˆ™ç­‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ¨¡å—è®¾è®¡

##### 1. ç”¨æˆ·è®¤è¯æ¨¡å—
```typescript
// è®¤è¯æœåŠ¡
interface AuthService {
  login(credentials: LoginCredentials): Promise<AuthResult>
  logout(): Promise<void>
  refreshToken(): Promise<string>
  getCurrentUser(): Promise<UserInfo>
  updatePassword(data: PasswordUpdate): Promise<void>
}

// æƒé™ç®¡ç†
interface PermissionService {
  hasPermission(permission: string): boolean
  hasRole(role: string): boolean
  getUserPermissions(): string[]
  getUserRoles(): string[]
}
```

##### 2. çº¿ç´¢ç®¡ç†æ¨¡å—
```typescript
// çº¿ç´¢æœåŠ¡
interface LeadService {
  getLeads(params: LeadQueryParams): Promise<PaginatedResult<Lead>>
  createLead(data: LeadCreateData): Promise<Lead>
  updateLead(id: number, data: LeadUpdateData): Promise<Lead>
  deleteLead(id: number): Promise<void>
  importLeads(file: File): Promise<ImportResult>
  assignLead(id: number, userId: number): Promise<void>
  changeLeadStatus(id: number, status: string): Promise<void>
}

// çº¿ç´¢çŠ¶æ€ç®¡ç†
interface LeadStatusService {
  getStatusFlow(): LeadStatusFlow[]
  validateStatusTransition(current: string, target: string): boolean
  getNextAvailableStatuses(current: string): string[]
}
```

##### 3. è®¢å•ç®¡ç†æ¨¡å—
```typescript
// é”€å”®å•æœåŠ¡
interface SalesOrderService {
  getOrders(params: OrderQueryParams): Promise<PaginatedResult<SalesOrder>>
  createOrder(data: OrderCreateData): Promise<SalesOrder>
  updateOrder(id: number, data: OrderUpdateData): Promise<SalesOrder>
  updateOrderStatus(id: number, status: string): Promise<void>
  getOrderContent(orderId: number): Promise<OrderContent>
  updateOrderContent(orderId: number, data: OrderContentData): Promise<void>
}

// ä¸‰å•çŠ¶æ€æœº
interface OrderStateMachine {
  getCurrentState(orderId: number): Promise<OrderState>
  transition(orderId: number, event: string, data?: any): Promise<void>
  getAvailableTransitions(state: string): string[]
  validateTransition(orderId: number, targetState: string): ValidationResult
}
```

##### 4. æµ‹é‡ç®¡ç†æ¨¡å—
```typescript
// æµ‹é‡æœåŠ¡
interface MeasurementService {
  getMeasurements(params: MeasurementQueryParams): Promise<PaginatedResult<Measurement>>
  createMeasurement(data: MeasurementCreateData): Promise<Measurement>
  updateMeasurement(id: number, data: MeasurementUpdateData): Promise<Measurement>
  uploadMeasurementPhotos(id: number, photos: File[]): Promise<void>
  assignMeasurer(id: number, measurerUserId: number): Promise<void>
  completeMeasurement(id: number, data: MeasurementResultData): Promise<void>
}

// æµ‹é‡æ•°æ®ç®¡ç†
interface MeasurementDataService {
  saveMeasurementData(measurementId: number, data: MeasurementData): Promise<void>
  getMeasurementData(measurementId: number): Promise<MeasurementData>
  validateMeasurementData(data: MeasurementData): ValidationResult
}
```

##### 5. å®‰è£…ç®¡ç†æ¨¡å—
```typescript
// å®‰è£…æœåŠ¡
interface InstallationService {
  getInstallations(params: InstallationQueryParams): Promise<PaginatedResult<Installation>>
  createInstallation(data: InstallationCreateData): Promise<Installation>
  updateInstallation(id: number, data: InstallationUpdateData): Promise<Installation>
  assignInstaller(id: number, installerUserId: number): Promise<void>
  updateInstallationProgress(id: number, progress: InstallationProgress): Promise<void>
  completeInstallation(id: number, data: InstallationResultData): Promise<void>
}

// å®‰è£…è¿›åº¦è·Ÿè¸ª
interface InstallationTrackingService {
  trackProgress(installationId: number, progress: ProgressData): Promise<void>
  uploadProgressPhotos(installationId: number, photos: File[]): Promise<void>
  recordWorkTime(installationId: number, timeData: WorkTimeData): Promise<void>
}
```

##### 6. äº§å“ç®¡ç†æ¨¡å—
```typescript
// äº§å“æœåŠ¡
interface ProductService {
  getProducts(params: ProductQueryParams): Promise<PaginatedResult<Product>>
  createProduct(data: ProductCreateData): Promise<Product>
  updateProduct(id: number, data: ProductUpdateData): Promise<Product>
  updateProductStatus(id: number, status: ProductStatus): Promise<void>
  getProductCategories(): Promise<ProductCategory[]>
  manageProductInventory(id: number, inventory: InventoryData): Promise<void>
}

// äº§å“åº“å­˜ç®¡ç†
interface ProductInventoryService {
  getInventory(productId: number): Promise<InventoryInfo>
  updateInventory(productId: number, quantity: number, type: 'increase' | 'decrease'): Promise<void>
  setInventoryAlert(productId: number, threshold: number): Promise<void>
  getInventoryAlerts(): Promise<InventoryAlert[]>
}
```

##### 7. æŠ¥ä»·ç®¡ç†æ¨¡å—
```typescript
// æŠ¥ä»·æœåŠ¡
interface QuotationService {
  getQuotations(params: QuotationQueryParams): Promise<PaginatedResult<Quotation>>
  createQuotation(data: QuotationCreateData): Promise<Quotation>
  updateQuotation(id: number, data: QuotationUpdateData): Promise<Quotation>
  generateQuotationPDF(id: number): Promise<Buffer>
  submitForApproval(id: number): Promise<void>
  approveQuotation(id: number, approvalData: ApprovalData): Promise<void>
}

// æŠ¥ä»·è®¡ç®—å¼•æ“
interface QuotationCalculationService {
  calculateQuotation(items: QuotationItem[], discounts: DiscountRule[]): Promise<QuotationResult>
  validateDiscount(userId: number, discountPercent: number): Promise<boolean>
  applyDiscountRules(quotation: Quotation, rules: DiscountRule[]): Promise<Quotation>
}
```

##### 8. ç§¯åˆ†å•†åŸæ¨¡å—
```typescript
// ç§¯åˆ†å•†åŸæœåŠ¡
interface PointsMallService {
  getMallItems(params: MallItemQueryParams): Promise<PaginatedResult<MallItem>>
  createMallItem(data: MallItemCreateData): Promise<MallItem>
  updateMallItem(id: number, data: MallItemUpdateData): Promise<MallItem>
  exchangeItem(userId: number, itemId: number, quantity: number): Promise<ExchangeOrder>
  getExchangeOrders(userId: number): Promise<ExchangeOrder[]>
}

// ç§¯åˆ†å…‘æ¢æœåŠ¡
interface PointsExchangeService {
  validateExchange(userId: number, itemId: number, quantity: number): Promise<ValidationResult>
  processExchange(userId: number, itemId: number, quantity: number): Promise<ExchangeResult>
  transferPoints(fromUserId: number, toUserId: number, points: number): Promise<void>
  getPointsHistory(userId: number): Promise<PointsTransaction[]>
}
```

##### 9. æ–‡ä»¶ç®¡ç†æ¨¡å—
```typescript
// æ–‡ä»¶ç®¡ç†æœåŠ¡
interface FileManagerService {
  uploadFile(file: File, category: FileCategory, metadata: FileMetadata): Promise<FileInfo>
  getFiles(params: FileQueryParams): Promise<PaginatedResult<FileInfo>>
  downloadFile(fileId: number): Promise<Buffer>
  deleteFile(fileId: number): Promise<void>
  getFileVersions(fileId: number): Promise<FileVersion[]>
  shareFile(fileId: number, shareConfig: ShareConfig): Promise<ShareLink>
}

// æ–‡ä»¶åˆ†ç±»ç®¡ç†
interface FileCategoryService {
  getCategories(): Promise<FileCategory[]>
  createCategory(data: CategoryCreateData): Promise<FileCategory>
  updateCategory(id: number, data: CategoryUpdateData): Promise<FileCategory>
  deleteCategory(id: number): Promise<void>
}
```

##### 10. å®¡æ‰¹æµç¨‹æ¨¡å—
```typescript
// å®¡æ‰¹æµç¨‹æœåŠ¡
interface ApprovalService {
  getApprovals(params: ApprovalQueryParams): Promise<PaginatedResult<Approval>>
  createApproval(data: ApprovalCreateData): Promise<Approval>
  processApproval(id: number, action: ApprovalAction, comment?: string): Promise<void>
  getApprovalFlow(type: ApprovalType): Promise<ApprovalFlow>
  configureApprovalFlow(type: ApprovalType, flow: ApprovalFlowConfig): Promise<void>
}

// å®¡æ‰¹æµç¨‹å¼•æ“
interface ApprovalFlowEngine {
  startFlow(type: ApprovalType, data: any): Promise<ApprovalInstance>
  processStep(instanceId: number, stepId: number, action: ApprovalAction): Promise<void>
  getNextApprovers(instanceId: number): Promise<User[]>
  isFlowCompleted(instanceId: number): Promise<boolean>
}
```

##### 11. ç³»ç»Ÿç®¡ç†æ¨¡å—
```typescript
// ç³»ç»Ÿé…ç½®æœåŠ¡
interface SystemConfigService {
  getConfigs(module?: string): Promise<SystemConfig[]>
  updateConfig(key: string, value: any): Promise<void>
  getSystemInfo(): Promise<SystemInfo>
  getSystemLogs(params: LogQueryParams): Promise<PaginatedResult<SystemLog>>
}

// ç³»ç»Ÿç›‘æ§æœåŠ¡
interface SystemMonitorService {
  getSystemMetrics(): Promise<SystemMetrics>
  getPerformanceStats(): Promise<PerformanceStats>
  getHealthCheck(): Promise<HealthCheckResult>
  getErrorLogs(params: ErrorLogQueryParams): Promise<PaginatedResult<ErrorLog>>
}
```

### å¾®ä¿¡å°ç¨‹åºæ¶æ„

#### æŠ€æœ¯æ ˆé€‰æ‹©
```
Taro 3.x + React     - è·¨å¹³å°å°ç¨‹åºå¼€å‘æ¡†æ¶
TypeScript 5.0+      - ç±»å‹å®‰å…¨çš„å¼€å‘è¯­è¨€
Taro UI 3.x          - Taroå®˜æ–¹UIç»„ä»¶åº“
Zustand 4.4+         - è½»é‡çº§çŠ¶æ€ç®¡ç†åº“
å¾®ä¿¡åŸç”ŸAPI           - å¾®ä¿¡æ”¯ä»˜ã€ç™»å½•ã€åˆ†äº«ç­‰
```

#### æ¶æ„è®¾è®¡ç‰¹ç‚¹
- **ç»„ä»¶åŒ–å¼€å‘**ï¼šå¤ç”¨Webç«¯ç»„ä»¶è®¾è®¡æ€æƒ³
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€æ•°æ®åˆ†é¡µã€ç¼“å­˜ç­–ç•¥
- **ç¦»çº¿æ”¯æŒ**ï¼šæœ¬åœ°æ•°æ®ç¼“å­˜ï¼Œå¼±ç½‘ç»œç¯å¢ƒå¯ç”¨
- **å¾®ä¿¡ç”Ÿæ€**ï¼šæ·±åº¦é›†æˆå¾®ä¿¡æ”¯ä»˜ã€åˆ†äº«ã€é€šçŸ¥ç­‰åŠŸèƒ½

## âš™ï¸ åç«¯æ¶æ„è®¾è®¡

### æœåŠ¡ç«¯æ¶æ„ï¼ˆNext.js BFF + Supabaseï¼‰

#### æŠ€æœ¯æ ˆé€‰æ‹©
```
Node.js 20.x LTS     - é«˜æ€§èƒ½JavaScriptè¿è¡Œæ—¶
Next.js 15+          - App Router Route Handlers ä½œä¸º BFF å±‚
TypeScript 5.0+      - ç±»å‹å®‰å…¨çš„å¼€å‘è¯­è¨€
Supabase (Postgres)  - æ‰˜ç®¡ä¸»æ•°æ®åº“ä¸è®¤è¯ã€RLS
Redis 7.0+           - é«˜æ€§èƒ½ç¼“å­˜ä¸é™æµ
Supabase Auth        - å®¢æˆ·ç«¯è®¤è¯ï¼ŒæœåŠ¡ç«¯ä¼šè¯æ¡¥æ¥
Supabase RLS         - è¡Œçº§å®‰å…¨ç­–ç•¥ï¼Œé»˜è®¤æ‹’ç»/æœ¬äººå¯è¯»/ç®¡ç†å‘˜æ”¾é€š
Winston 3.11+        - æ—¥å¿—ï¼ˆæŒ‰éœ€ï¼‰
Swagger/OpenAPI      - è‡ªåŠ¨åŒ–æ–‡æ¡£ï¼ˆæ‰©å±•é˜¶æ®µï¼‰
```

#### æ¶æ„åˆ†å±‚è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          APIç½‘å…³å±‚ï¼ˆAPI Gatewayï¼‰    â”‚
â”‚  è·¯ç”±è½¬å‘ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ§åˆ¶å™¨å±‚ï¼ˆControllersï¼‰    â”‚
â”‚  è¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”å°è£…ç­‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æœåŠ¡å±‚ï¼ˆServicesï¼‰          â”‚
â”‚  ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€å¤–éƒ¨è°ƒç”¨ç­‰       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ•°æ®è®¿é—®å±‚ï¼ˆRepositoriesï¼‰   â”‚
â”‚  æ•°æ®åº“æ“ä½œã€ç¼“å­˜ç®¡ç†ã€æ•°æ®è½¬æ¢ç­‰      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          å®ä½“å±‚ï¼ˆEntities/Modelsï¼‰  â”‚
â”‚  æ•°æ®å®ä½“å®šä¹‰ã€å…³ç³»æ˜ å°„ã€çº¦æŸéªŒè¯ç­‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructureï¼‰ â”‚
â”‚  æ•°æ®åº“è¿æ¥ã€ç¼“å­˜è¿æ¥ã€æ—¥å¿—é…ç½®ç­‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ¨¡å—æ¶æ„

##### 1. æ¨¡å—åŒ–å•ä½“æ¶æ„
```
src/
â”œâ”€â”€ modules/                    # ä¸šåŠ¡æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ auth/                   # ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ leads/                  # çº¿ç´¢ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ orders/                 # è®¢å•ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ measurement/            # æµ‹é‡ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ installation/           # å®‰è£…ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ product/                # äº§å“ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ quotation/              # æŠ¥ä»·ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ points/                 # ç§¯åˆ†ç³»ç»Ÿæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ points-mall/            # ç§¯åˆ†å•†åŸæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ file-manager/           # æ–‡ä»¶ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ notification/           # æ¶ˆæ¯é€šçŸ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ analytics/              # æŠ¥è¡¨åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”œâ”€â”€ approval/               # å®¡æ‰¹æµç¨‹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â””â”€â”€ system/                 # ç³»ç»Ÿç®¡ç†æ¨¡å—
â”‚       â”œâ”€â”€ controllers/
â”‚       â”œâ”€â”€ services/
â”‚       â”œâ”€â”€ repositories/
â”‚       â””â”€â”€ entities/
â”œâ”€â”€ shared/                     # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ middlewares/           # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ constants/             # å¸¸é‡å®šä¹‰
â””â”€â”€ app.ts                     # åº”ç”¨ä¸»æ–‡ä»¶
```

##### 2. çŠ¶æ€æœºå¼•æ“è®¾è®¡
```typescript
// çŠ¶æ€æœºæ¥å£
interface IStateMachine {
  getCurrentState(entityId: number): Promise<string>
  canTransition(entityId: number, targetState: string): Promise<boolean>
  transition(entityId: number, targetState: string, context?: any): Promise<void>
  getAvailableTransitions(state: string): string[]
}

// é”€å”®å•çŠ¶æ€æœºå®ç°
class SalesOrderStateMachine implements IStateMachine {
  private stateTransitions: Map<string, string[]> = new Map([
    ['INITIAL', ['BUDGETING', 'CANCELLED']],
    ['BUDGETING', ['PRE_SIGNED_PENDING', 'CANCELLED', 'PAUSED', 'EXCEPTION']],
    ['PRE_SIGNED_PENDING', ['MEASURING', 'CANCELLED']],
    ['MEASURING', ['QUOTE_PREPARING', 'EXCEPTION']],
    ['QUOTE_PREPARING', ['CONFIRMATION_PENDING', 'EXCEPTION']],
    ['CONFIRMATION_PENDING', ['ORDER_TRANSFER_PENDING', 'EXCEPTION']],
    ['ORDER_TRANSFER_PENDING', ['ORDERING_PENDING', 'EXCEPTION']],
    ['ORDERING_PENDING', ['PRODUCTION_PENDING', 'EXCEPTION']],
    ['PRODUCTION_PENDING', ['INSTALLATION_PENDING', 'EXCEPTION']],
    ['INSTALLATION_PENDING', ['RECONCILIATION_PENDING', 'EXCEPTION']],
    ['RECONCILIATION_PENDING', ['PAYMENT_PENDING', 'EXCEPTION']],
    ['PAYMENT_PENDING', ['COMPLETED', 'EXCEPTION']],
    ['PAUSED', ['BUDGETING', 'CANCELLED']],
    ['EXCEPTION', ['BUDGETING', 'CANCELLED', 'PAUSED']]
  ])

  async transition(orderId: number, targetState: string, context?: any): Promise<void> {
    const currentState = await this.getCurrentState(orderId)
    
    // éªŒè¯çŠ¶æ€æµè½¬åˆæ³•æ€§
    if (!this.validateTransition(currentState, targetState)) {
      throw new InvalidStateTransitionException(currentState, targetState)
    }

    // æ‰§è¡ŒçŠ¶æ€å˜æ›´
    await this.executeTransition(orderId, currentState, targetState, context)
    
    // è§¦å‘ç›¸å…³ä¸šåŠ¡äº‹ä»¶
    await this.publishStateChangeEvent(orderId, currentState, targetState, context)
  }
}
```

##### 3. ç§¯åˆ†è®¡ç®—å¼•æ“
```typescript
// ç§¯åˆ†è®¡ç®—å™¨æ¥å£
interface IPointCalculator {
  calculate(context: PointCalculationContext): Promise<number>
  validate(context: PointCalculationContext): Promise<ValidationResult>
}

// å¤šèŠ‚ç‚¹ç§¯åˆ†è®¡ç®—
class MultiNodePointCalculator implements IPointCalculator {
  private nodeCalculators: Map<string, IPointCalculator> = new Map()

  constructor() {
    this.nodeCalculators.set('LEAD_CREATED', new LeadCreatedCalculator())
    this.nodeCalculators.set('LEAD_FOLLOWED', new LeadFollowedCalculator())
    this.nodeCalculators.set('ORDER_SIGNED', new OrderSignedCalculator())
    this.nodeCalculators.set('ORDER_COMPLETED', new OrderCompletedCalculator())
  }

  async calculate(context: PointCalculationContext): Promise<number> {
    const calculator = this.nodeCalculators.get(context.nodeType)
    if (!calculator) {
      throw new UnsupportedPointNodeException(context.nodeType)
    }

    // åŸºç¡€ç§¯åˆ†è®¡ç®—
    const basePoints = await calculator.calculate(context)
    
    // åº”ç”¨è°ƒèŠ‚ç³»æ•°
    const adjustedPoints = await this.applyAdjustmentFactors(basePoints, context)
    
    return Math.round(adjustedPoints)
  }

  private async applyAdjustmentFactors(points: number, context: PointCalculationContext): Promise<number> {
    let result = points
    
    // äº§å“å“ç±»ç³»æ•°
    result *= context.productCategoryFactor || 1.0
    
    // æ—¶é—´æ®µç³»æ•°
    result *= context.timePeriodFactor || 1.0
    
    // é—¨åº—ç³»æ•°
    result *= context.storeFactor || 1.0
    
    return result
  }
}
```

## ğŸ—„ï¸ æ•°æ®æ¶æ„è®¾è®¡

### æ•°æ®åº“æ¶æ„ï¼ˆPostgreSQL + Redisï¼‰

#### PostgreSQLæ•°æ®åº“è®¾è®¡

##### 1. åˆ†åº“åˆ†è¡¨ç­–ç•¥
```sql
-- æŒ‰ä¸šåŠ¡æ¨¡å—å‚ç›´åˆ†è¡¨
-- ç”¨æˆ·ç›¸å…³è¡¨
users_basic (ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ - é«˜é¢‘æŸ¥è¯¢)
users_auth (ç”¨æˆ·è®¤è¯ä¿¡æ¯ - ä½é¢‘æŸ¥è¯¢)
users_profile (ç”¨æˆ·æ‰©å±•ä¿¡æ¯ - ä¸­é¢‘æŸ¥è¯¢)

-- è®¢å•ç›¸å…³è¡¨
sales_orders (é”€å”®å•ä¸»è¡¨)
sales_order_items (é”€å”®å•é¡¹è¡¨)
sales_order_status_logs (çŠ¶æ€å˜æ›´æ—¥å¿—)

-- æŒ‰æ—¶é—´ç»´åº¦æ°´å¹³åˆ†è¡¨
-- ç§¯åˆ†æµæ°´è¡¨ï¼ˆæŒ‰æœˆåˆ†è¡¨ï¼‰
point_logs_202501
point_logs_202502
point_logs_202503

-- æ“ä½œæ—¥å¿—è¡¨ï¼ˆæŒ‰å‘¨åˆ†è¡¨ï¼‰
operation_logs_2025w01
operation_logs_2025w02
operation_logs_2025w03
```

##### 2. ç´¢å¼•ä¼˜åŒ–ç­–ç•¥
```sql
-- å¤åˆç´¢å¼•è®¾è®¡
-- é”€å”®å•æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_sales_orders_query ON sales_orders(
  status, created_at, customer_name, sales_id
);

-- çº¿ç´¢æŸ¥è¯¢ä¼˜åŒ–  
CREATE INDEX idx_leads_query ON leads(
  status, assigned_to, created_at, city
);

-- ç§¯åˆ†æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_point_logs_user_time ON point_logs(
  user_id, created_at
);

-- ä½¿ç”¨PostgreSQLéƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_sales_orders ON sales_orders(created_at) 
WHERE status NOT IN ('CANCELLED', 'COMPLETED');
```

##### 3. æ•°æ®åº“æ¶æ„æ¼”è¿›
- **MVPé˜¶æ®µ**ï¼šå•ä¸€PostgreSQLå®ä¾‹ï¼Œä½¿ç”¨Prisma ORMç®¡ç†æ•°æ®æ¨¡å‹
- **æ‰©å±•é˜¶æ®µ**ï¼šè¯»å†™åˆ†ç¦»ï¼Œå¼•å…¥Redisç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œä½¿ç”¨è¿æ¥æ± ä¼˜åŒ–
- **æˆç†ŸæœŸ**ï¼šåˆ†åº“åˆ†è¡¨ï¼Œæ ¹æ®ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†æ•°æ®åº“ï¼Œæ”¯æŒå¾®æœåŠ¡ç‹¬ç«‹æ•°æ®å­˜å‚¨

#### Redisç¼“å­˜è®¾è®¡

##### 1. ç¼“å­˜ç­–ç•¥
```typescript
// ç¼“å­˜é”®å‘½åè§„èŒƒ
const CacheKeys = {
  USER: (id: number) => `user:${id}`,
  USER_PERMISSIONS: (id: number) => `user:${id}:permissions`,
  SALES_ORDER: (id: number) => `sales_order:${id}`,
  LEADS_LIST: (params: string) => `leads:list:${params}`,
  POINT_BALANCE: (userId: number) => `points:balance:${userId}`,
  PRODUCT_CATALOG: 'catalog:products',
  SYSTEM_CONFIG: 'system:config'
}

// ç¼“å­˜ç­–ç•¥
const CacheStrategies = {
  // ç”¨æˆ·ä¿¡æ¯ - é•¿æœŸç¼“å­˜ï¼Œä¸»åŠ¨å¤±æ•ˆ
  USER_INFO: { ttl: 3600 * 24, strategy: 'write-through' },
  
  // æƒé™ä¿¡æ¯ - ä¸­æœŸç¼“å­˜ï¼Œä¸»åŠ¨å¤±æ•ˆ
  PERMISSIONS: { ttl: 3600 * 2, strategy: 'write-through' },
  
  // é”€å”®å• - çŸ­æœŸç¼“å­˜ï¼Œè¢«åŠ¨å¤±æ•ˆ
  SALES_ORDER: { ttl: 3600, strategy: 'cache-aside' },
  
  // åˆ—è¡¨æŸ¥è¯¢ - çŸ­æœŸç¼“å­˜ï¼Œè¢«åŠ¨å¤±æ•ˆ
  LIST_QUERY: { ttl: 300, strategy: 'cache-aside' },
  
  // ç§¯åˆ†ä½™é¢ - å®æ—¶ç¼“å­˜ï¼Œä¸»åŠ¨å¤±æ•ˆ
  POINT_BALANCE: { ttl: 60, strategy: 'write-through' },
  
  // äº§å“ç›®å½• - é•¿æœŸç¼“å­˜ï¼Œå®šæ—¶åˆ·æ–°
  PRODUCT_CATALOG: { ttl: 3600 * 12, strategy: 'refresh-ahead' }
}
```
CREATE INDEX idx_point_logs_query ON point_logs(
  user_id, created_at, transaction_type, status
);

-- å…¨æ–‡ç´¢å¼•è®¾è®¡
-- å®¢æˆ·ä¿¡æ¯æœç´¢
CREATE FULLTEXT INDEX idx_customer_search ON customers(
  name, phone, address, company
);

-- å•†å“ä¿¡æ¯æœç´¢
CREATE FULLTEXT INDEX idx_product_search ON products(
  name, description, specifications
);
```

#### Redisç¼“å­˜æ¶æ„

##### 1. ç¼“å­˜åˆ†å±‚ç­–ç•¥
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         L1 - åº”ç”¨çº§ç¼“å­˜              â”‚
â”‚  ç”¨æˆ·ä¼šè¯ã€çƒ­ç‚¹æ•°æ®ã€é…ç½®ä¿¡æ¯ç­‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         L2 - ä¸šåŠ¡çº§ç¼“å­˜              â”‚
â”‚  è®¢å•çŠ¶æ€ã€ç”¨æˆ·æƒé™ã€å•†å“ä¿¡æ¯ç­‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         L3 - æ•°æ®çº§ç¼“å­˜              â”‚
â”‚  æ•°æ®åº“æŸ¥è¯¢ç»“æœã€è®¡ç®—ç»“æœã€ç»Ÿè®¡ä¿¡æ¯ç­‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 2. ç¼“å­˜åº”ç”¨åœºæ™¯
```typescript
// ç”¨æˆ·ä¼šè¯ç¼“å­˜
const sessionCache = {
  key: 'session:${userId}',
  ttl: 1800, // 30åˆ†é’Ÿ
  data: {
    userId,
    token,
    permissions,
    roles,
    loginTime
  }
}

// çƒ­ç‚¹æ•°æ®ç¼“å­˜
const hotDataCache = {
  key: 'hotdata:${type}',
  ttl: 300, // 5åˆ†é’Ÿ
  data: {
    todayOrders,
    todayPoints,
    activeUsers,
    conversionRate
  }
}

// ä¸šåŠ¡é…ç½®ç¼“å­˜
const configCache = {
  key: 'config:${module}',
  ttl: 3600, // 1å°æ—¶
  data: {
    pointRules,
    statusFlow,
    notificationSettings,
    businessParams
  }
}
```

## ğŸ”§ éƒ¨ç½²æ¶æ„è®¾è®¡

### å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker + Docker Composeï¼‰

#### Dockerå®¹å™¨è®¾è®¡
```dockerfile
# åç«¯æœåŠ¡å®¹å™¨
FROM node:20-alpine AS base
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "run", "start:prod"]

# å‰ç«¯å®¹å™¨
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/public /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### Docker Composeé…ç½®
```yaml
version: '3.8'

services:
  # åç«¯APIæœåŠ¡
  api:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://crm_user:crm_password@postgres:5432/crm_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  # å‰ç«¯WebæœåŠ¡
  web:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - api
    restart: unless-stopped

  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=crm_db
      - POSTGRES_USER=crm_user
      - POSTGRES_PASSWORD=crm_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    restart: unless-stopped

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    command: redis-server --requirepass redis_password
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
```

### éƒ¨ç½²ä¸æ¼”è¿›

#### éƒ¨ç½²æ¶æ„æ¼”è¿›
- **MVPé˜¶æ®µ**ï¼šDocker Compose éƒ¨ç½²ï¼ˆå¤–éƒ¨ Supabase æ‰˜ç®¡ Postgresï¼ŒRedis æŒ‰éœ€ï¼‰
- **æ‰©å±•é˜¶æ®µ**ï¼šæ ¹æ®è´Ÿè½½å¼•å…¥ Kubernetes ä¸æœåŠ¡ç½‘æ ¼
- **æˆç†ŸæœŸ**ï¼šKubernetes é›†ç¾¤ä¸å®Œæ•´è§‚æµ‹æ€§

#### Kubernetesé…ç½®ç¤ºä¾‹
```yaml
# APIæœåŠ¡éƒ¨ç½²
apiVersion: apps/v1
kind: Deployment
metadata:
  name: l2c-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: l2c-api
  template:
    metadata:
      labels:
        app: l2c-api
    spec:
      containers:
      - name: api
        image: l2c/api:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: l2c-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: l2c-secrets
              key: redis-url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 3000
          initialDelaySeconds: 5
          periodSeconds: 5
---
# APIæœåŠ¡è´Ÿè½½å‡è¡¡
apiVersion: v1
kind: Service
metadata:
  name: l2c-api-service
spec:
  selector:
    app: l2c-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```

### ç›‘æ§ä¸æ—¥å¿—æ¶æ„

#### åº”ç”¨ç›‘æ§
```typescript
// æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
class PerformanceMonitor {
  trackAPIPerformance(req: Request, res: Response, next: NextFunction) {
    const startTime = Date.now()
    
    res.on('finish', () => {
      const duration = Date.now() - startTime
      const metrics = {
        method: req.method,
        url: req.url,
        statusCode: res.statusCode,
        duration,
        timestamp: new Date().toISOString()
      }
      
      // è®°å½•æ€§èƒ½æŒ‡æ ‡
      this.recordMetrics(metrics)
      
      // æ…¢æŸ¥è¯¢å‘Šè­¦
      if (duration > 1000) {
        this.sendSlowQueryAlert(metrics)
      }
    })
    
    next()
  }
}

// ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
class BusinessMetricsMonitor {
  trackBusinessMetrics() {
    const metrics = {
      dailyActiveUsers: this.getDailyActiveUsers(),
      orderConversionRate: this.getOrderConversionRate(),
      averageOrderValue: this.getAverageOrderValue(),
      customerSatisfaction: this.getCustomerSatisfaction(),
      serviceProviderRating: this.getServiceProviderRating()
    }
    
    // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
    this.sendToGrafana(metrics)
  }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**ï¼šæŒ‰è·¯ç”±å’Œç»„ä»¶è¿›è¡Œä»£ç åˆ†å‰²ï¼Œä½¿ç”¨Next.jsåŠ¨æ€å¯¼å…¥
- **æ‡’åŠ è½½**ï¼šå›¾ç‰‡ã€ç»„ä»¶ã€è·¯ç”±çš„æ‡’åŠ è½½ï¼Œå‡å°‘åˆå§‹åŠ è½½æ—¶é—´
- **ç¼“å­˜ç­–ç•¥**ï¼šHTTPç¼“å­˜ã€æµè§ˆå™¨ç¼“å­˜ã€CDNç¼“å­˜ï¼Œåˆç†è®¾ç½®ç¼“å­˜ç­–ç•¥
- **æ‰“åŒ…ä¼˜åŒ–**ï¼šTree Shakingã€å‹ç¼©ã€åˆå¹¶ï¼Œä¼˜åŒ–èµ„æºå¤§å°
- **å›¾ç‰‡ä¼˜åŒ–**ï¼šä½¿ç”¨WebPæ ¼å¼ï¼Œå“åº”å¼å›¾ç‰‡ï¼Œæ‡’åŠ è½½
- **SSR/SSG**ï¼šæœåŠ¡ç«¯æ¸²æŸ“å’Œé™æ€ç”Ÿæˆï¼Œæé«˜é¦–å±åŠ è½½é€Ÿåº¦

### åç«¯æ€§èƒ½ä¼˜åŒ–
- **æ•°æ®åº“ä¼˜åŒ–**ï¼šç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€è¿æ¥æ± ç®¡ç†
- **ç¼“å­˜ç­–ç•¥**ï¼šRedisç¼“å­˜ã€åº”ç”¨ç¼“å­˜ã€æŸ¥è¯¢ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
- **å¼‚æ­¥å¤„ç†**ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥ä»»åŠ¡ã€äº‹ä»¶é©±åŠ¨ï¼Œæé«˜ç³»ç»Ÿååé‡
- **è´Ÿè½½å‡è¡¡**ï¼šæ°´å¹³æ‰©å±•ã€è´Ÿè½½åˆ†å‘ã€æ•…éšœè½¬ç§»ï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§
- **APIä¼˜åŒ–**ï¼šGraphQLå‡å°‘è¿‡åº¦è·å–ï¼Œåˆ†é¡µæŸ¥è¯¢ï¼Œå­—æ®µé€‰æ‹©
- **è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥æ± ï¼ŒRedisè¿æ¥æ± ï¼Œå‡å°‘è¿æ¥å¼€é”€

### æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
- **ç´¢å¼•ç­–ç•¥**ï¼šå¤åˆç´¢å¼•ã€è¦†ç›–ç´¢å¼•ã€éƒ¨åˆ†ç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
- **åˆ†è¡¨åˆ†åº“**ï¼šæ°´å¹³åˆ†è¡¨ã€å‚ç›´åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ï¼Œæé«˜æ•°æ®å¤„ç†èƒ½åŠ›
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šSQLä¼˜åŒ–ã€æ‰§è¡Œè®¡åˆ’åˆ†æã€æ…¢æŸ¥è¯¢ç›‘æ§
- **è¿æ¥ä¼˜åŒ–**ï¼šè¿æ¥æ± ã€é•¿è¿æ¥ã€è¿æ¥å¤ç”¨ï¼Œå‡å°‘è¿æ¥å¼€é”€
- **PostgreSQLç‰¹æ€§**ï¼šåˆ©ç”¨PostgreSQLçš„é«˜çº§ç‰¹æ€§å¦‚JSONBæ”¯æŒã€å…¨æ–‡æœç´¢ç­‰

## ğŸš€ å¾®æœåŠ¡æ¶æ„æ¼”è¿›

### å¾®æœåŠ¡æ¼”è¿›è·¯çº¿å›¾

#### é˜¶æ®µä¸€ï¼šæ¨¡å—åŒ–å•ä½“ï¼ˆ0-6ä¸ªæœˆï¼‰
**ç›®æ ‡**ï¼šå¿«é€ŸMVPäº¤ä»˜ï¼ŒéªŒè¯ä¸šåŠ¡æ¨¡å¼
**æ¶æ„ç‰¹ç‚¹**ï¼š
- å•ä¸€åº”ç”¨ï¼Œæ¨¡å—åŒ–è®¾è®¡
- ç»Ÿä¸€æ•°æ®åº“ï¼Œè¡¨çº§åˆ«éš”ç¦»
- æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œæ€§èƒ½æœ€ä¼˜
- éƒ¨ç½²ç®€å•ï¼Œè¿ç»´æˆæœ¬ä½

**æŠ€æœ¯æ ˆ**ï¼š
```typescript
// åº”ç”¨æ¶æ„
const monolithArchitecture = {
  frontend: 'Next.js 15+ (App Router)',
  backend: 'NestJS (Modular Monolith)',
  database: 'PostgreSQL 15+',
  cache: 'Redis 7+',
  deployment: 'Docker + Docker Compose'
}

// æ¨¡å—åˆ’åˆ† - 14ä¸ªæ ¸å¿ƒä¸šåŠ¡æ¨¡å—
const modules = {
  auth: 'ç”¨æˆ·è®¤è¯æ¨¡å— (Auth)',
  leads: 'çº¿ç´¢ç®¡ç†æ¨¡å— (Lead)',
  orders: 'è®¢å•ç®¡ç†æ¨¡å— (Order)',
  measurement: 'æµ‹é‡ç®¡ç†æ¨¡å— (Measurement)',
  installation: 'å®‰è£…ç®¡ç†æ¨¡å— (Installation)',
  product: 'äº§å“ç®¡ç†æ¨¡å— (Product)',
  quotation: 'æŠ¥ä»·ç®¡ç†æ¨¡å— (Quotation)',
  points: 'ç§¯åˆ†ç³»ç»Ÿæ¨¡å— (Points)',
  pointsMall: 'ç§¯åˆ†å•†åŸæ¨¡å— (PointsMall)',
  fileManager: 'æ–‡ä»¶ç®¡ç†æ¨¡å— (FileManager)',
  notification: 'æ¶ˆæ¯é€šçŸ¥æ¨¡å— (Notification)',
  analytics: 'æŠ¥è¡¨åˆ†ææ¨¡å— (Analytics)',
  approval: 'å®¡æ‰¹æµç¨‹æ¨¡å— (Approval)',
  system: 'ç³»ç»Ÿç®¡ç†æ¨¡å— (System)'
}
```

**æ‹†åˆ†å‡†å¤‡**ï¼š
- æ¨¡å—é—´æ¥å£æ ‡å‡†åŒ–
- æ•°æ®åº“è¡¨æŒ‰æ¨¡å—åˆ†ç»„
- é…ç½®å¤–éƒ¨åŒ–
- ç›‘æ§æŒ‡æ ‡æ”¶é›†

#### é˜¶æ®µäºŒï¼šæ··åˆæ¶æ„ï¼ˆ6-18ä¸ªæœˆï¼‰
**ç›®æ ‡**ï¼šæ ¸å¿ƒæœåŠ¡ç‹¬ç«‹ï¼Œæ”¯æŒä¸šåŠ¡å¿«é€Ÿå¢é•¿
**æ‹†åˆ†è§¦å‘æ¡ä»¶**ï¼š
- æŸæ¨¡å—æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼ˆQPS > 1000ï¼‰
- å›¢é˜Ÿè§„æ¨¡æ‰©å¤§ï¼ˆ> 15äººï¼‰
- ä¸šåŠ¡å¤æ‚åº¦å¢åŠ ï¼ˆéœ€è¦æŠ€æœ¯å¼‚æ„ï¼‰

**æ‹†åˆ†ä¼˜å…ˆçº§**ï¼š
```typescript
interface ServicePriority {
  high: {
    services: ['auth-service', 'user-service']
    reason: 'é«˜é¢‘è®¿é—®ï¼Œç‹¬ç«‹æ‰©å±•éœ€æ±‚'
    timeline: 'ç¬¬6-9ä¸ªæœˆ'
  }
  
  medium: {
    services: ['order-service', 'points-service']
    reason: 'ä¸šåŠ¡æ ¸å¿ƒï¼Œå¤æ‚åº¦é«˜'
    timeline: 'ç¬¬9-12ä¸ªæœˆ'
  }
  
  low: {
    services: ['notification-service', 'report-service']
    reason: 'æ”¯æ’‘æœåŠ¡ï¼Œå¯å»¶åæ‹†åˆ†'
    timeline: 'ç¬¬12-18ä¸ªæœˆ'
  }
}
```

**æ¶æ„æ¼”è¿›ç­–ç•¥**ï¼š
```typescript
class MigrationStrategy {
  // ç»æ€è€…æ¨¡å¼ï¼ˆStrangler Fig Patternï¼‰
  async migrateService(serviceName: string): Promise<void> {
    // 1. åˆ›å»ºæ–°æœåŠ¡
    await this.createNewService(serviceName)
    
    // 2. æ•°æ®åŒæ­¥
    await this.setupDataSync(serviceName)
    
    // 3. æµé‡åˆ‡æ¢
    await this.gradualTrafficShift(serviceName, {
      week1: 10,   // 10%æµé‡
      week2: 30,   // 30%æµé‡
      week3: 70,   // 70%æµé‡
      week4: 100   // 100%æµé‡
    })
    
    // 4. æ¸…ç†æ—§ä»£ç 
    await this.cleanupLegacyCode(serviceName)
  }
  
  // æ•°æ®åº“æ‹†åˆ†ç­–ç•¥
  async splitDatabase(serviceName: string): Promise<void> {
    // 1. åˆ›å»ºç‹¬ç«‹æ•°æ®åº“
    await this.createServiceDatabase(serviceName)
    
    // 2. æ•°æ®è¿ç§»
    await this.migrateData(serviceName)
    
    // 3. åŒå†™éªŒè¯
    await this.enableDualWrite(serviceName)
    
    // 4. åˆ‡æ¢è¯»å–
    await this.switchReads(serviceName)
    
    // 5. åœæ­¢åŒå†™
    await this.stopDualWrite(serviceName)
  }
}
```

#### é˜¶æ®µä¸‰ï¼šå®Œæ•´å¾®æœåŠ¡ï¼ˆ18ä¸ªæœˆ+ï¼‰
**ç›®æ ‡**ï¼šå®Œæ•´å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒå¤§è§„æ¨¡ä¸šåŠ¡
**æ¶æ„ç‰¹ç‚¹**ï¼š
- å®Œå…¨ç‹¬ç«‹çš„å¾®æœåŠ¡
- æœåŠ¡ç½‘æ ¼ç®¡ç†
- å®¹å™¨åŒ–éƒ¨ç½²
- è‡ªåŠ¨åŒ–è¿ç»´

### æœåŠ¡æ‹†åˆ†ç­–ç•¥

#### 1. æ‹†åˆ†åŸåˆ™

**ä¸šåŠ¡è¾¹ç•Œæ‹†åˆ†**ï¼š
```typescript
interface ServiceBoundary {
  // æŒ‰èšåˆæ ¹æ‹†åˆ†
  aggregateRoot: {
    userService: 'Userèšåˆæ ¹'
    orderService: 'Orderèšåˆæ ¹'
    pointsService: 'Pointsèšåˆæ ¹'
  }
  
  // æŒ‰æ•°æ®ä¸€è‡´æ€§æ‹†åˆ†
  dataConsistency: {
    strongConsistency: ['user-profile', 'order-payment']
    eventualConsistency: ['points-calculation', 'notifications']
  }
  
  // æŒ‰å›¢é˜Ÿç»„ç»‡æ‹†åˆ†
  teamOwnership: {
    userTeam: ['user-service', 'auth-service']
    salesTeam: ['lead-service', 'order-service']
    operationsTeam: ['notification-service', 'report-service']
  }
}
```

**æŠ€æœ¯è¾¹ç•Œæ‹†åˆ†**ï¼š
```typescript
interface TechnicalBoundary {
  // æŒ‰æ€§èƒ½è¦æ±‚æ‹†åˆ†
  performance: {
    highThroughput: ['auth-service', 'user-service']
    lowLatency: ['points-service', 'notification-service']
    batchProcessing: ['report-service', 'analytics-service']
  }
  
  // æŒ‰æŠ€æœ¯æ ˆæ‹†åˆ†
  technology: {
    nodejs: ['api-gateway', 'user-service', 'order-service']
    golang: ['auth-service', 'points-service']  // é«˜æ€§èƒ½è®¡ç®—
    python: ['ml-service', 'analytics-service']  // æ•°æ®åˆ†æ
  }
  
  // æŒ‰æ‰©å±•éœ€æ±‚æ‹†åˆ†
  scaling: {
    horizontal: ['stateless-services']
    vertical: ['database-intensive-services']
    auto: ['variable-load-services']
  }
}
```

#### 2. æœåŠ¡è®¾è®¡æ¨¡å¼

**å•ä¸€èŒè´£æœåŠ¡**ï¼š
```typescript
class ServiceDesignPrinciples {
  // æœåŠ¡èŒè´£å®šä¹‰
  defineServiceResponsibility(serviceName: string): ServiceSpec {
    return {
      name: serviceName,
      purpose: 'å•ä¸€æ˜ç¡®çš„ä¸šåŠ¡èŒè´£',
      boundaries: 'æ¸…æ™°çš„æœåŠ¡è¾¹ç•Œ',
      interfaces: 'ç¨³å®šçš„APIæ¥å£',
      data: 'ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨',
      team: 'æ˜ç¡®çš„å›¢é˜Ÿæ‰€æœ‰æƒ'
    }
  }
  
  // æœåŠ¡å¤§å°æ§åˆ¶
  controlServiceSize(): SizeGuidelines {
    return {
      codebase: '< 100k LOC',
      team: '2-8 developers',
      database: '< 50 tables',
      apis: '< 20 endpoints',
      buildTime: '< 10 minutes',
      deployTime: '< 5 minutes'
    }
  }
}
```

**é¢†åŸŸé©±åŠ¨æœåŠ¡**ï¼š
```typescript
interface DomainDrivenService {
  // æ ¸å¿ƒé¢†åŸŸæœåŠ¡
  coreServices: {
    'sales-service': {
      aggregates: ['SalesOrder', 'Lead', 'Customer']
      valueObjects: ['Money', 'Address', 'ContactInfo']
      domainServices: ['SalesCalculator', 'LeadAssigner']
      repositories: ['SalesOrderRepo', 'LeadRepo']
    }
    
    'points-service': {
      aggregates: ['PointsAccount', 'PointsRule', 'Leaderboard']
      valueObjects: ['Points', 'Rank', 'Achievement']
      domainServices: ['PointsCalculator', 'RankingEngine']
      repositories: ['PointsRepo', 'RuleRepo']
    }
  }
  
  // æ”¯æ’‘é¢†åŸŸæœåŠ¡
  supportingServices: {
    'notification-service': {
      purpose: 'æ¶ˆæ¯é€šçŸ¥æ”¯æ’‘'
      capabilities: ['email', 'sms', 'push', 'in-app']
    }
    
    'file-service': {
      purpose: 'æ–‡ä»¶ç®¡ç†æ”¯æ’‘'
      capabilities: ['upload', 'download', 'preview', 'convert']
    }
  }
  
  // é€šç”¨é¢†åŸŸæœåŠ¡
  genericServices: {
    'user-service': {
      purpose: 'ç”¨æˆ·èº«ä»½ç®¡ç†'
      capabilities: ['authentication', 'authorization', 'profile']
    }
  }
}
```

### APIç½‘å…³è®¾è®¡

#### 1. ç½‘å…³æ¶æ„

**åˆ†å±‚ç½‘å…³æ¶æ„**ï¼š
```typescript
interface GatewayArchitecture {
  // è¾¹ç¼˜ç½‘å…³ï¼ˆEdge Gatewayï¼‰
  edgeGateway: {
    purpose: 'å¤–éƒ¨æµé‡å…¥å£'
    responsibilities: [
      'SSLç»ˆæ­¢',
      'DDoSé˜²æŠ¤', 
      'åœ°ç†è·¯ç”±',
      'CDNé›†æˆ'
    ]
    technology: 'Cloudflare / AWS CloudFront'
  }
  
  // APIç½‘å…³ï¼ˆAPI Gatewayï¼‰
  apiGateway: {
    purpose: 'ä¸šåŠ¡APIç»Ÿä¸€å…¥å£'
    responsibilities: [
      'è·¯ç”±è½¬å‘',
      'è®¤è¯æˆæƒ',
      'é™æµç†”æ–­',
      'APIç‰ˆæœ¬ç®¡ç†',
      'è¯·æ±‚å“åº”è½¬æ¢',
      'ç›‘æ§æ—¥å¿—'
    ]
    technology: 'Kong / Traefik / NestJS Gateway'
  }
  
  // æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰
  serviceMesh: {
    purpose: 'æœåŠ¡é—´é€šä¿¡æ²»ç†'
    responsibilities: [
      'æœåŠ¡å‘ç°',
      'è´Ÿè½½å‡è¡¡',
      'æ•…éšœæ³¨å…¥',
      'å®‰å…¨ç­–ç•¥',
      'æµé‡ç®¡ç†'
    ]
    technology: 'Istio / Linkerd'
  }
}
```

#### 2. ç½‘å…³åŠŸèƒ½è®¾è®¡

**è·¯ç”±ç®¡ç†**ï¼š
```typescript
class GatewayRouting {
  // è·¯ç”±é…ç½®
  private routes: RouteConfig[] = [
    {
      path: '/api/v1/auth/*',
      service: 'auth-service',
      methods: ['POST', 'GET'],
      middleware: ['cors', 'rateLimit'],
      timeout: 5000
    },
    {
      path: '/api/v1/users/*',
      service: 'user-service', 
      methods: ['GET', 'POST', 'PUT', 'DELETE'],
      middleware: ['cors', 'auth', 'rateLimit'],
      timeout: 10000
    },
    {
      path: '/api/v1/orders/*',
      service: 'order-service',
      methods: ['GET', 'POST', 'PUT'],
      middleware: ['cors', 'auth', 'rateLimit', 'cache'],
      timeout: 15000
    }
  ]
  
  // åŠ¨æ€è·¯ç”±
  async updateRoutes(newRoutes: RouteConfig[]): Promise<void> {
    // çƒ­æ›´æ–°è·¯ç”±é…ç½®
    await this.validateRoutes(newRoutes)
    await this.deployRoutes(newRoutes)
    await this.healthCheck()
  }
  
  // ç°åº¦å‘å¸ƒè·¯ç”±
  async canaryRouting(serviceName: string, canaryWeight: number): Promise<void> {
    const canaryRoute = {
      path: `/api/v1/${serviceName}/*`,
      upstreams: [
        { service: `${serviceName}-stable`, weight: 100 - canaryWeight },
        { service: `${serviceName}-canary`, weight: canaryWeight }
      ]
    }
    
    await this.updateRoute(canaryRoute)
  }
}
```

**è®¤è¯æˆæƒ**ï¼š
```typescript
class GatewayAuth {
  // JWTéªŒè¯ä¸­é—´ä»¶
  async jwtMiddleware(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const token = this.extractToken(req)
      const payload = await this.verifyToken(token)
      
      // æ·»åŠ ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¤´
      req.headers['x-user-id'] = payload.userId
      req.headers['x-user-roles'] = JSON.stringify(payload.roles)
      req.headers['x-tenant-id'] = payload.tenantId
      
      next()
    } catch (error) {
      res.status(401).json({ error: 'Unauthorized' })
    }
  }
  
  // RBACæƒé™æ£€æŸ¥
  async rbacMiddleware(requiredPermissions: string[]) {
    return async (req: Request, res: Response, next: NextFunction) => {
      const userRoles = JSON.parse(req.headers['x-user-roles'] as string)
      const hasPermission = await this.checkPermissions(userRoles, requiredPermissions)
      
      if (hasPermission) {
        next()
      } else {
        res.status(403).json({ error: 'Forbidden' })
      }
    }
  }
  
  // APIå¯†é’¥éªŒè¯
  async apiKeyMiddleware(req: Request, res: Response, next: NextFunction): Promise<void> {
    const apiKey = req.headers['x-api-key'] as string
    const isValid = await this.validateApiKey(apiKey)
    
    if (isValid) {
      next()
    } else {
      res.status(401).json({ error: 'Invalid API Key' })
    }
  }
}
```

**é™æµç†”æ–­**ï¼š
```typescript
class GatewayResilience {
  // é™æµç­–ç•¥
  private rateLimitConfig = {
    global: { requests: 10000, window: '1m' },
    perUser: { requests: 100, window: '1m' },
    perIP: { requests: 1000, window: '1m' },
    perService: {
      'auth-service': { requests: 5000, window: '1m' },
      'user-service': { requests: 3000, window: '1m' },
      'order-service': { requests: 2000, window: '1m' }
    }
  }
  
  // ç†”æ–­å™¨é…ç½®
  private circuitBreakerConfig = {
    failureThreshold: 50,      // å¤±è´¥ç‡é˜ˆå€¼50%
    timeout: 60000,            // ç†”æ–­è¶…æ—¶60ç§’
    monitoringPeriod: 10000,   // ç›‘æ§å‘¨æœŸ10ç§’
    expectedResponse: 200      // æœŸæœ›å“åº”ç 
  }
  
  // é™æµå®ç°
  async rateLimit(key: string, limit: RateLimit): Promise<boolean> {
    const current = await this.redis.incr(key)
    
    if (current === 1) {
      await this.redis.expire(key, this.parseWindow(limit.window))
    }
    
    return current <= limit.requests
  }
  
  // ç†”æ–­å™¨å®ç°
  async circuitBreaker(serviceName: string): Promise<CircuitState> {
    const stats = await this.getServiceStats(serviceName)
    const failureRate = stats.failures / stats.total
    
    if (failureRate > this.circuitBreakerConfig.failureThreshold / 100) {
      return CircuitState.OPEN
    }
    
    return CircuitState.CLOSED
  }
}
```

#### 3. ç½‘å…³ç›‘æ§ä¸è¿ç»´

**ç›‘æ§æŒ‡æ ‡**ï¼š
```typescript
interface GatewayMetrics {
  // æµé‡æŒ‡æ ‡
  traffic: {
    totalRequests: Counter
    requestsPerSecond: Gauge
    responseTime: Histogram
    errorRate: Gauge
  }
  
  // æœåŠ¡æŒ‡æ ‡
  services: {
    serviceHealth: Gauge
    serviceLatency: Histogram
    serviceErrors: Counter
    circuitBreakerState: Gauge
  }
  
  // èµ„æºæŒ‡æ ‡
  resources: {
    cpuUsage: Gauge
    memoryUsage: Gauge
    connectionCount: Gauge
    queueLength: Gauge
  }
}

class GatewayMonitoring {
  // å¥åº·æ£€æŸ¥
  async healthCheck(): Promise<HealthStatus> {
    const services = await this.checkAllServices()
    const gateway = await this.checkGatewayHealth()
    
    return {
      status: this.calculateOverallHealth(services, gateway),
      services,
      gateway,
      timestamp: new Date()
    }
  }
  
  // æ€§èƒ½ç›‘æ§
  async performanceMonitoring(): Promise<PerformanceReport> {
    return {
      avgResponseTime: await this.getAverageResponseTime(),
      p95ResponseTime: await this.getP95ResponseTime(),
      errorRate: await this.getErrorRate(),
      throughput: await this.getThroughput(),
      topSlowEndpoints: await this.getTopSlowEndpoints()
    }
  }
  
  // å‘Šè­¦è§„åˆ™
  private alertRules = [
    {
      name: 'High Error Rate',
      condition: 'error_rate > 5%',
      severity: 'critical',
      action: 'page_oncall'
    },
    {
      name: 'High Response Time',
      condition: 'p95_response_time > 2s',
      severity: 'warning',
      action: 'send_slack'
    },
    {
      name: 'Service Down',
      condition: 'service_health == 0',
      severity: 'critical',
      action: 'page_oncall'
    }
  ]
}
```

### æœåŠ¡æ²»ç†

#### 1. é…ç½®ç®¡ç†

**é…ç½®ä¸­å¿ƒæ¶æ„**ï¼š
```typescript
interface ConfigManagement {
  // é…ç½®åˆ†å±‚
  configLayers: {
    global: 'å…¨å±€é…ç½®ï¼ˆæ•°æ®åº“è¿æ¥ã€ç¼“å­˜é…ç½®ï¼‰'
    service: 'æœåŠ¡é…ç½®ï¼ˆä¸šåŠ¡å‚æ•°ã€åŠŸèƒ½å¼€å…³ï¼‰'
    environment: 'ç¯å¢ƒé…ç½®ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰'
    runtime: 'è¿è¡Œæ—¶é…ç½®ï¼ˆåŠ¨æ€å‚æ•°ã€A/Bæµ‹è¯•ï¼‰'
  }
  
  // é…ç½®æ ¼å¼
  configFormats: {
    yaml: 'ç»“æ„åŒ–é…ç½®'
    json: 'APIé…ç½®'
    properties: 'ç®€å•é”®å€¼å¯¹'
    env: 'ç¯å¢ƒå˜é‡'
  }
  
  // é…ç½®æ›´æ–°ç­–ç•¥
  updateStrategy: {
    hotReload: 'çƒ­æ›´æ–°ï¼ˆæ— éœ€é‡å¯ï¼‰'
    gracefulRestart: 'ä¼˜é›…é‡å¯'
    rollingUpdate: 'æ»šåŠ¨æ›´æ–°'
    blueGreen: 'è“ç»¿éƒ¨ç½²'
  }
}

class ConfigCenter {
  // é…ç½®è·å–
  async getConfig(serviceName: string, environment: string): Promise<ServiceConfig> {
    const globalConfig = await this.getGlobalConfig()
    const serviceConfig = await this.getServiceConfig(serviceName)
    const envConfig = await this.getEnvironmentConfig(environment)
    
    return this.mergeConfigs(globalConfig, serviceConfig, envConfig)
  }
  
  // é…ç½®ç›‘å¬
  async watchConfig(serviceName: string, callback: ConfigChangeCallback): Promise<void> {
    const watcher = await this.createWatcher(serviceName)
    
    watcher.on('change', async (newConfig) => {
      await this.validateConfig(newConfig)
      await callback(newConfig)
    })
  }
  
  // é…ç½®éªŒè¯
  async validateConfig(config: ServiceConfig): Promise<ValidationResult> {
    const schema = await this.getConfigSchema(config.serviceName)
    return this.validator.validate(config, schema)
  }
}
```

#### 2. æœåŠ¡å‘ç°

**æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼š
```typescript
class ServiceDiscovery {
  // æœåŠ¡æ³¨å†Œ
  async registerService(serviceInfo: ServiceInfo): Promise<void> {
    const registration = {
      id: serviceInfo.id,
      name: serviceInfo.name,
      address: serviceInfo.address,
      port: serviceInfo.port,
      tags: serviceInfo.tags,
      health: {
        http: `http://${serviceInfo.address}:${serviceInfo.port}/health`,
        interval: '10s',
        timeout: '3s'
      },
      metadata: serviceInfo.metadata
    }
    
    await this.consul.agent.service.register(registration)
  }
  
  // æœåŠ¡å‘ç°
  async discoverServices(serviceName: string): Promise<ServiceInstance[]> {
    const services = await this.consul.health.service({
      service: serviceName,
      passing: true  // åªè¿”å›å¥åº·çš„æœåŠ¡å®ä¾‹
    })
    
    return services.map(service => ({
      id: service.Service.ID,
      address: service.Service.Address,
      port: service.Service.Port,
      tags: service.Service.Tags,
      metadata: service.Service.Meta
    }))
  }
  
  // è´Ÿè½½å‡è¡¡
  async loadBalance(serviceName: string, strategy: LoadBalanceStrategy): Promise<ServiceInstance> {
    const instances = await this.discoverServices(serviceName)
    
    switch (strategy) {
      case 'round_robin':
        return this.roundRobinBalance(instances)
      case 'weighted_round_robin':
        return this.weightedRoundRobinBalance(instances)
      case 'least_connections':
        return this.leastConnectionsBalance(instances)
      case 'consistent_hash':
        return this.consistentHashBalance(instances)
      default:
        return this.randomBalance(instances)
    }
  }
}
```

#### 3. ç›‘æ§å‘Šè­¦

**å…¨é“¾è·¯ç›‘æ§**ï¼š
```typescript
interface DistributedMonitoring {
  // é“¾è·¯è¿½è¸ª
  tracing: {
    tracer: 'Jaeger / Zipkin'
    sampling: {
      production: 0.1,    // ç”Ÿäº§ç¯å¢ƒ10%é‡‡æ ·
      staging: 0.5,       // æµ‹è¯•ç¯å¢ƒ50%é‡‡æ ·
      development: 1.0    // å¼€å‘ç¯å¢ƒ100%é‡‡æ ·
    }
    retention: '7d'
  }
  
  // æŒ‡æ ‡ç›‘æ§
  metrics: {
    collector: 'Prometheus'
    storage: 'InfluxDB'
    visualization: 'Grafana'
    alerting: 'AlertManager'
  }
  
  // æ—¥å¿—èšåˆ
  logging: {
    collector: 'Fluentd / Logstash'
    storage: 'Elasticsearch'
    analysis: 'Kibana'
    retention: '30d'
  }
}

class MonitoringSystem {
  // SLAç›‘æ§
  async monitorSLA(): Promise<SLAReport> {
    const slaTargets = {
      availability: 99.9,      // 99.9%å¯ç”¨æ€§
      responseTime: 200,       // 200mså“åº”æ—¶é—´
      errorRate: 0.1,          // 0.1%é”™è¯¯ç‡
      throughput: 1000         // 1000 QPS
    }
    
    const current = await this.getCurrentMetrics()
    
    return {
      availability: {
        target: slaTargets.availability,
        current: current.availability,
        status: current.availability >= slaTargets.availability ? 'OK' : 'BREACH'
      },
      responseTime: {
        target: slaTargets.responseTime,
        current: current.p95ResponseTime,
        status: current.p95ResponseTime <= slaTargets.responseTime ? 'OK' : 'BREACH'
      },
      errorRate: {
        target: slaTargets.errorRate,
        current: current.errorRate,
        status: current.errorRate <= slaTargets.errorRate ? 'OK' : 'BREACH'
      }
    }
  }
  
  // å¼‚å¸¸æ£€æµ‹
  async anomalyDetection(): Promise<AnomalyReport[]> {
    const metrics = await this.getTimeSeriesMetrics()
    const anomalies: AnomalyReport[] = []
    
    // åŸºäºç»Ÿè®¡çš„å¼‚å¸¸æ£€æµ‹
    for (const metric of metrics) {
      const zscore = this.calculateZScore(metric.values)
      if (Math.abs(zscore) > 3) {  // 3ÏƒåŸåˆ™
        anomalies.push({
          metric: metric.name,
          value: metric.currentValue,
          expected: metric.expectedValue,
          severity: this.calculateSeverity(zscore),
          timestamp: new Date()
        })
      }
    }
    
    return anomalies
  }
}

---
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**æœ€åæ›´æ–°**ï¼š2025å¹´6æœˆ21æ—¥  
**ä¸‹æ¬¡è¯„å®¡**ï¼š2025å¹´7æœˆ21æ—¥
