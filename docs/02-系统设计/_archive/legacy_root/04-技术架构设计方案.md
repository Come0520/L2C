# ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ - æŠ€æœ¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**é¡¹ç›®åç§°ï¼š** ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»ŸæŠ€æœ¯æ¶æ„  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v2.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2025å¹´11æœˆ23æ—¥  
**æ¶æ„ç›®æ ‡ï¼š** è®¾è®¡ä¸€å¥—æ¨¡å—åŒ–å•ä½“æ¶æ„ï¼Œæ”¯æŒL2Cå…¨æµç¨‹æ•°å­—åŒ–ç®¡ç†  
**æ ¸å¿ƒç†å¿µï¼š** æ¨¡å—åŒ–å•ä½“ä¼˜å…ˆï¼Œæ¸è¿›å¼æ¼”è¿›ï¼Œé¿å…è¿‡åº¦è®¾è®¡  

---

## ğŸ¯ æ¶æ„è®¾è®¡ç›®æ ‡

### 1. ä¸šåŠ¡ç›®æ ‡æ”¯æŒ
- **L2Cå…¨æµç¨‹æ•°å­—åŒ–**ï¼šæ”¯æŒä»çº¿ç´¢åˆ°ç°é‡‘çš„å®Œæ•´ä¸šåŠ¡é“¾æ¡
- **å¤šå“ç±»é”€å”®æœåŠ¡**ï¼šæ”¯æŒçª—å¸˜ã€å¢™å¸ƒã€å¢™å’”ç­‰å¤šå“ç±»ä¸šåŠ¡
- **ä¸‰å•ä½“ç³»çŠ¶æ€æœº**ï¼šé”€å”®å•ã€æµ‹é‡å•ã€å®‰è£…å•çš„çŠ¶æ€æµè½¬ç®¡ç†
- **ç§¯åˆ†æ¿€åŠ±ä½“ç³»**ï¼šå¤šèŠ‚ç‚¹ç§¯åˆ†å‘æ”¾ä¸å•†åŸå…‘æ¢ç³»ç»Ÿ
- **æœåŠ¡å•†ç”Ÿæ€**ï¼šæµ‹é‡å¸ˆã€å®‰è£…å¸ˆç­‰å¤–éƒ¨æœåŠ¡å•†ç®¡ç†
- **ç½—è±å¥½ä¼™ä¼´ç”Ÿæ€**ï¼šå¤–éƒ¨åˆä½œä¼™ä¼´ååŒä¸ç§¯åˆ†æ¿€åŠ±

### 2. æŠ€æœ¯ç›®æ ‡
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ”¯æŒä¸šåŠ¡æ¨¡å—ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡è§„æ¨¡æ‰©å¤§å’ŒåŠŸèƒ½æ¨¡å—å¢åŠ 
- **é«˜æ€§èƒ½**ï¼šæ”¯æŒ1000+å¹¶å‘ç”¨æˆ·ï¼ŒAPIå“åº”æ—¶é—´<1ç§’
- **é«˜å¯ç”¨æ€§**ï¼šç³»ç»Ÿå¯ç”¨æ€§è¾¾åˆ°99.5%+
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæ•°æ®ä¸€è‡´æ€§è¾¾åˆ°99.9%+
- **å®‰å…¨æ€§**ï¼šæ•°æ®åŠ å¯†å­˜å‚¨å’Œä¼ è¾“ï¼Œæƒé™æ§åˆ¶ï¼Œæ“ä½œå®¡è®¡

### 3. æœªæ¥æ‰©å±•éœ€æ±‚
- **ä¸šåŠ¡è§„æ¨¡æ‰©å±•**ï¼šæ”¯æŒæ›´å¤šåŸå¸‚ã€é—¨åº—å’Œç”¨æˆ·è§„æ¨¡æ‰©å¤§
- **ä¸šåŠ¡å“ç±»æ‰©å±•**ï¼šæ”¯æŒæ–°å¢å®¶å±…è½¯è£…å“ç±»
- **ç”Ÿæ€ä¼™ä¼´æ‰©å±•**ï¼šæ”¯æŒæ›´å¤šç±»å‹çš„å¤–éƒ¨åˆä½œä¼™ä¼´
- **æ™ºèƒ½åŒ–åŠŸèƒ½**ï¼šAIè¾…åŠ©é”€å”®å†³ç­–ã€æ™ºèƒ½æ´¾å•ç­‰
- **å¤–éƒ¨ç³»ç»Ÿé›†æˆ**ï¼šä¸VSSç³»ç»Ÿã€è´¢åŠ¡ç³»ç»Ÿç­‰æ·±åº¦é›†æˆ

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### 1. æ¶æ„æ¨¡å¼é€‰æ‹©

#### 1.1 æ¨¡å—åŒ–å•ä½“æ¶æ„
é‡‡ç”¨**æ¨¡å—åŒ–å•ä½“ä¼˜å…ˆï¼Œæ¸è¿›å¼æ¶æ„æ¼”è¿›**çš„æ¶æ„æ¨¡å¼ï¼š

- **åˆæœŸï¼ˆMVPé˜¶æ®µï¼‰**ï¼šé‡‡ç”¨æ¨¡å—åŒ–å•ä½“æ¶æ„ï¼Œå¿«é€Ÿå¼€å‘å’Œéƒ¨ç½²
- **ä¸­æœŸï¼ˆæ‰©å±•é˜¶æ®µï¼‰**ï¼šæ ¹æ®ä¸šåŠ¡è´Ÿè½½å’Œå›¢é˜Ÿè§„æ¨¡ï¼Œé€æ­¥æ‹†åˆ†æ ¸å¿ƒæ¨¡å—
- **æˆç†ŸæœŸï¼ˆä¼˜åŒ–é˜¶æ®µï¼‰**ï¼šå½¢æˆæ¨¡å—åŒ–æœåŠ¡æ¶æ„ï¼Œæ”¯æŒç‹¬ç«‹æ‰©å±•å’Œéƒ¨ç½²

**æ¶æ„ä¼˜åŠ¿**ï¼š
- é¿å…å¾®æœåŠ¡å¤æ‚åº¦ï¼Œé™ä½åˆæœŸå¼€å‘å’Œè¿ç»´æˆæœ¬
- æ”¯æŒæ¨¡å—åŒ–å¼€å‘ï¼Œä¿æŒä»£ç ç»“æ„æ¸…æ™°
- ä¾¿äºæµ‹è¯•å’Œéƒ¨ç½²ï¼Œæé«˜å¼€å‘æ•ˆç‡
- ä¸ºåç»­æ¼”è¿›é¢„ç•™ç©ºé—´ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€è¦çµæ´»è°ƒæ•´

#### 1.2 æ¶æ„åˆ†å±‚
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨å±‚ (Frontend)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APIç½‘å…³å±‚ (API Gateway)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å¾®æœåŠ¡å±‚ (Microservices)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”‚  çº¿ç´¢æœåŠ¡   â”‚ â”‚  è®¢å•æœåŠ¡   â”‚ â”‚ ç§¯åˆ†æœåŠ¡â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å•†å“æœåŠ¡   â”‚ â”‚  æŠ¥è¡¨æœåŠ¡   â”‚ â”‚  é€šçŸ¥æœåŠ¡   â”‚ â”‚ æ–‡ä»¶æœåŠ¡â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å­˜å‚¨å±‚ (Data Storage)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å…³ç³»æ•°æ®åº“ â”‚ â”‚   æ–‡æ¡£æ•°æ®åº“ â”‚ â”‚   ç¼“å­˜æ•°æ®åº“ â”‚ â”‚ å¯¹è±¡å­˜å‚¨â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚ (Infrastructure)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å®¹å™¨ç¼–æ’   â”‚ â”‚  æœåŠ¡å‘ç°   â”‚ â”‚  é…ç½®ä¸­å¿ƒ   â”‚ â”‚ ç›‘æ§å‘Šè­¦â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æŠ€æœ¯æ ˆé€‰æ‹©

#### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ
- **Webç®¡ç†ç«¯**ï¼šNext.js 15+ (App Router) + TypeScript + Tailwind CSS
- **ç§»åŠ¨ç«¯å°ç¨‹åº**ï¼šTaro 3.x + React + TypeScript
- **çŠ¶æ€ç®¡ç†**ï¼šZustand (è½»é‡çº§çŠ¶æ€ç®¡ç†)
- **UIç»„ä»¶åº“**ï¼šAnt Design (Webç«¯) + Taro UI (å°ç¨‹åºç«¯)
- **å›¾è¡¨å¯è§†åŒ–**ï¼šECharts / Apache ECharts
- **HTTPå®¢æˆ·ç«¯**ï¼šAxios + SWR (æ•°æ®è·å–)

#### 2.2 åç«¯æŠ€æœ¯æ ˆï¼ˆæ¨¡å—åŒ–å•ä½“ï¼‰
- **è¿è¡Œæ—¶**ï¼šNode.js 20+ (LTS)
- **æ¡†æ¶**ï¼šNestJS 10+ (æ¨¡å—åŒ–æ¶æ„)
- **è¯­è¨€**ï¼šTypeScript 5.0+
- **èº«ä»½éªŒè¯**ï¼šSupabase Auth + JWT
- **æ•°æ®è®¿é—®**ï¼šTypeORM + PostgreSQL
- **æƒé™æ§åˆ¶**ï¼šRBAC + Supabase RLS
- **ç¼“å­˜ä¸é™æµ**ï¼šRedis 7+ï¼ˆæ¥å£çº§ç¼“å­˜ä¸é™æµï¼‰
- **APIæ–‡æ¡£**ï¼šSwagger/OpenAPI 3.0

#### 2.3 æ•°æ®å­˜å‚¨æŠ€æœ¯æ ˆ
- **ä¸»æ•°æ®åº“**ï¼šSupabaseï¼ˆæ‰˜ç®¡ PostgreSQL 15+ï¼‰
- **ç¼“å­˜æ•°æ®åº“**ï¼šRedis 7+ï¼ˆç¼“å­˜ã€ä¼šè¯ã€ä»»åŠ¡é˜Ÿåˆ—ï¼‰
- **æœç´¢ä¸æ–‡æ¡£å­˜å‚¨**ï¼šPostgreSQLå…¨æ–‡æœç´¢ï¼ˆåˆæœŸï¼‰
- **å¯¹è±¡å­˜å‚¨**ï¼šSupabase Storageï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰

#### 2.4 åŸºç¡€è®¾æ–½æŠ€æœ¯æ ˆ
- **å®¹å™¨åŒ–**ï¼šDocker + Docker Composeï¼ˆMVPé˜¶æ®µï¼‰
- **éƒ¨ç½²å¹³å°**ï¼šVercelï¼ˆå‰ç«¯ï¼‰ + Supabaseï¼ˆåç«¯+æ•°æ®åº“ï¼‰
- **ç›‘æ§ä¸æ—¥å¿—**ï¼šSentryï¼ˆé”™è¯¯ç›‘æ§ï¼‰ + è‡ªå»ºæ—¥å¿—æœåŠ¡
- **å¯†é’¥ç®¡ç†**ï¼šç¯å¢ƒå˜é‡æ³¨å…¥ï¼ŒæœåŠ¡ç«¯æŒæœ‰ Supabase Service Role Key

---

## ğŸ”§ æ¨¡å—åŒ–æ¶æ„è®¾è®¡

### 1. å‰ç«¯æ¨¡å—åŒ–è®¾è®¡

#### 1.1 å¤šåº”ç”¨æ¶æ„
é‡‡ç”¨**å¤šåº”ç”¨æ¶æ„**ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²å’ŒåŠŸèƒ½é¢†åŸŸåˆ’åˆ†åº”ç”¨ï¼š

```
l2c-frontend/
â”œâ”€â”€ apps/                          # åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ admin/                     # ç®¡ç†åå°åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/               # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ components/        # å…±äº«ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ features/          # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/     # ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ leads/         # çº¿ç´¢ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ orders/        # è®¢å•ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ points/        # ç§¯åˆ†ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ reports/       # æŠ¥è¡¨åˆ†æ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ system/        # ç³»ç»Ÿç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ public/                # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ mobile/                    # ç§»åŠ¨ç«¯åº”ç”¨(å°ç¨‹åº)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/               # Taroåº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ components/        # å…±äº«ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ features/          # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ leads/         # çº¿ç´¢ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ orders/        # è®¢å•ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ points/        # ç§¯åˆ†ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ profile/       # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ project.config.json    # Taroé…ç½®
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ partner/                   # ç½—è±å¥½ä¼™ä¼´åº”ç”¨(å°ç¨‹åº)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/               # Taroåº”ç”¨å…¥å£
â”‚       â”‚   â”œâ”€â”€ components/        # å…±äº«ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ features/          # åŠŸèƒ½æ¨¡å—
â”‚       â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯æ¨¡å—
â”‚       â”‚   â”‚   â”œâ”€â”€ points/        # ç§¯åˆ†ç®¡ç†
â”‚       â”‚   â”‚   â”œâ”€â”€ mall/          # ç§¯åˆ†å•†åŸ
â”‚       â”‚   â”‚   â””â”€â”€ profile/       # ä¸ªäººä¸­å¿ƒ
â”‚       â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hooks
â”‚       â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚       â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚       â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ project.config.json    # Taroé…ç½®
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/                      # å…±äº«åŒ…
â”‚   â”œâ”€â”€ ui/                        # UIç»„ä»¶åº“
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ types/                     # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ constants/                 # å¸¸é‡å®šä¹‰
â”œâ”€â”€ tools/                         # å·¥å…·è„šæœ¬
â””â”€â”€ package.json                   # æ ¹package.json
```

#### 1.2 æ¨¡å—åŒ–è®¾è®¡åŸåˆ™
- **åŠŸèƒ½æ¨¡å—åŒ–**ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†åŠŸèƒ½æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—åŒ…å«ç»„ä»¶ã€æœåŠ¡ã€çŠ¶æ€ç­‰
- **ç»„ä»¶åŸå­åŒ–**ï¼šé‡‡ç”¨åŸå­è®¾è®¡ç†å¿µï¼Œæ„å»ºå¯å¤ç”¨çš„ç»„ä»¶åº“
- **çŠ¶æ€å±€éƒ¨åŒ–**ï¼šä½¿ç”¨Zustandè¿›è¡Œå±€éƒ¨çŠ¶æ€ç®¡ç†ï¼Œé¿å…å…¨å±€çŠ¶æ€æ»¥ç”¨
- **æœåŠ¡æŠ½è±¡åŒ–**ï¼šAPIæœåŠ¡å±‚æŠ½è±¡ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚ã€å“åº”å’Œé”™è¯¯
- **ç±»å‹å®‰å…¨**ï¼šå…¨é¢ä½¿ç”¨TypeScriptï¼Œç¡®ä¿ç±»å‹å®‰å…¨

### 2. åç«¯æ¨¡å—åŒ–è®¾è®¡

#### 2.1 æ¨¡å—åŒ–æ¶æ„è®¾è®¡
æ ¹æ®ä¸šåŠ¡é¢†åŸŸå’ŒDDD(é¢†åŸŸé©±åŠ¨è®¾è®¡)åŸåˆ™åˆ’åˆ†æ¨¡å—ï¼š

```
l2c-backend/
â”œâ”€â”€ src/                           # æºç ç›®å½•
â”‚   â”œâ”€â”€ modules/                   # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth/                  # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ users/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ leads/                 # çº¿ç´¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ orders/                # è®¢å•æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ points/                # ç§¯åˆ†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ services/              # æœåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ products/              # äº§å“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ notifications/         # é€šçŸ¥æ¨¡å—
â”‚   â”‚   â””â”€â”€ reports/               # æŠ¥è¡¨æ¨¡å—
â”‚   â”œâ”€â”€ common/                    # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ decorators/
â”‚   â”‚   â”œâ”€â”€ filters/
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â””â”€â”€ pipes/
â”‚   â”œâ”€â”€ config/                    # é…ç½®æ¨¡å—
â”‚   â””â”€â”€ main.ts                    # åº”ç”¨å…¥å£
â”œâ”€â”€ test/                          # æµ‹è¯•ç›®å½•
â””â”€â”€ package.json
â”‚   â”œâ”€â”€ lead-service/              # çº¿ç´¢æœåŠ¡
â”‚   â”œâ”€â”€ order-service/             # è®¢å•æœåŠ¡
â”‚   â”œâ”€â”€ product-service/           # å•†å“æœåŠ¡
â”‚   â”œâ”€â”€ points-service/            # ç§¯åˆ†æœåŠ¡
â”‚   â”œâ”€â”€ notification-service/      # é€šçŸ¥æœåŠ¡
â”‚   â”œâ”€â”€ file-service/              # æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ report-service/            # æŠ¥è¡¨æœåŠ¡
â”œâ”€â”€ libs/                          # å…±äº«åº“
â”‚   â”œâ”€â”€ common/                    # é€šç”¨åº“
â”‚   â”œâ”€â”€ database/                  # æ•°æ®åº“åº“
â”‚   â”œâ”€â”€ cache/                     # ç¼“å­˜åº“
â”‚   â”œâ”€â”€ messaging/                 # æ¶ˆæ¯é˜Ÿåˆ—åº“
â”‚   â”œâ”€â”€ logger/                    # æ—¥å¿—åº“
â”‚   â””â”€â”€ types/                     # ç±»å‹å®šä¹‰
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ scripts/                       # è„šæœ¬æ–‡ä»¶
â””â”€â”€ package.json                   # æ ¹package.json
```

#### 2.2 æœåŠ¡èŒè´£åˆ’åˆ†

##### 2.2.1 APIç½‘å…³ (api-gateway)
- **èŒè´£**ï¼šè¯·æ±‚è·¯ç”±ã€èº«ä»½éªŒè¯ã€é™æµã€æ—¥å¿—è®°å½•
- **æŠ€æœ¯**ï¼šKong / Traefik / NestJS Gateway
- **åŠŸèƒ½**ï¼š
  - ç»Ÿä¸€å…¥å£ç‚¹ï¼Œè·¯ç”±åˆ°å„å¾®æœåŠ¡
  - JWTéªŒè¯å’ŒOAuth 2.0æˆæƒ
  - è¯·æ±‚é™æµå’Œç†”æ–­
  - è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
  - APIç‰ˆæœ¬ç®¡ç†

##### 2.2.2 è®¤è¯æœåŠ¡ (auth-service)
- **èŒè´£**ï¼šç”¨æˆ·èº«ä»½è®¤è¯ã€æˆæƒã€ä»¤ç‰Œç®¡ç†
- **æŠ€æœ¯**ï¼šNestJS + JWT + OAuth 2.0
- **åŠŸèƒ½**ï¼š
  - ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€å¯†ç é‡ç½®
  - JWTä»¤ç‰Œç”Ÿæˆã€éªŒè¯ã€åˆ·æ–°
  - OAuth 2.0æˆæƒæµç¨‹
  - æƒé™éªŒè¯å’Œè§’è‰²ç®¡ç†
  - å•ç‚¹ç™»å½•(SSO)æ”¯æŒ

##### 2.2.3 ç”¨æˆ·æœåŠ¡ (user-service)
- **èŒè´£**ï¼šç”¨æˆ·ä¿¡æ¯ç®¡ç†ã€è§’è‰²æƒé™ç®¡ç†
- **æŠ€æœ¯**ï¼šNestJS + Prisma + PostgreSQL
- **åŠŸèƒ½**ï¼š
  - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç®¡ç†
  - è§’è‰²å’Œæƒé™ç®¡ç†
  - ç»„ç»‡æ¶æ„ç®¡ç†
  - ç”¨æˆ·åå¥½è®¾ç½®
  - ç”¨æˆ·è¡Œä¸ºæ—¥å¿—

##### 2.2.4 çº¿ç´¢æœåŠ¡ (lead-service)
- **èŒè´£**ï¼šçº¿ç´¢ç®¡ç†ã€åˆ†é…ã€è·Ÿè¿›
- **æŠ€æœ¯**ï¼šNestJS + Prisma + PostgreSQL + Elasticsearch
- **åŠŸèƒ½**ï¼š
  - çº¿ç´¢åˆ›å»ºã€å¯¼å…¥ã€ç¼–è¾‘
  - çº¿ç´¢åˆ†é…å’Œé‡æ–°åˆ†é…
  - çº¿ç´¢è·Ÿè¿›å’ŒçŠ¶æ€ç®¡ç†
  - çº¿ç´¢é¢„è­¦å’Œæé†’
  - çº¿ç´¢æ•°æ®åˆ†æå’ŒæŠ¥è¡¨

##### 2.2.5 é”€å”®å•æœåŠ¡ (order-service)
- **èŒè´£**ï¼šé”€å”®å•ã€æµ‹é‡å•ã€å®‰è£…å•ç®¡ç†
- **æŠ€æœ¯**ï¼šNestJS + Prisma + PostgreSQL + Redis
- **åŠŸèƒ½**ï¼š
  - é”€å”®å•åˆ›å»ºã€çŠ¶æ€æµè½¬
  - æµ‹é‡å•å’Œå®‰è£…å•ç®¡ç†(ç¬¬äºŒé˜¶æ®µ)
  - é”€å”®å•çŠ¶æ€æœºç®¡ç†
  - é”€å”®å•æ•°æ®åˆ†æå’ŒæŠ¥è¡¨
  - é”€å”®å•å¼‚å¸¸å¤„ç†

##### 2.2.6 å•†å“æœåŠ¡ (product-service)
- **èŒè´£**ï¼šå•†å“ä¿¡æ¯ç®¡ç†ã€åº“å­˜ç®¡ç†
- **æŠ€æœ¯**ï¼šNestJS + Prisma + PostgreSQL + Redis
- **åŠŸèƒ½**ï¼š
  - å•†å“ä¿¡æ¯ç®¡ç†
  - å•†å“åˆ†ç±»å’Œå±æ€§ç®¡ç†
  - åº“å­˜ç®¡ç†å’Œé¢„è­¦
  - ä»·æ ¼ç­–ç•¥ç®¡ç†
  - å•†å“æœç´¢å’Œæ¨è

##### 2.2.7 ç§¯åˆ†æœåŠ¡ (points-service)
- **èŒè´£**ï¼šç§¯åˆ†è®¡ç®—ã€å‘æ”¾ã€æ¶ˆè´¹
- **æŠ€æœ¯**ï¼šNestJS + Prisma + PostgreSQL + Redis
- **åŠŸèƒ½**ï¼š
  - ç§¯åˆ†è§„åˆ™ç®¡ç†
  - ç§¯åˆ†è®¡ç®—å’Œå‘æ”¾
  - ç§¯åˆ†å•†åŸç®¡ç†
  - ç§¯åˆ†æ¶ˆè´¹è®°å½•
  - ç§¯åˆ†ç»Ÿè®¡åˆ†æ

##### 2.2.8 é€šçŸ¥æœåŠ¡ (notification-service)
- **èŒè´£**ï¼šæ¶ˆæ¯é€šçŸ¥ã€æ¨é€
- **æŠ€æœ¯**ï¼šNestJS + Redis + RabbitMQ
- **åŠŸèƒ½**ï¼š
  - ç³»ç»Ÿå†…æ¶ˆæ¯é€šçŸ¥
  - é‚®ä»¶é€šçŸ¥
  - çŸ­ä¿¡é€šçŸ¥
  - å¾®ä¿¡å°ç¨‹åºé€šçŸ¥
  - é€šçŸ¥æ¨¡æ¿ç®¡ç†

##### 2.2.9 æ–‡ä»¶æœåŠ¡ (file-service)
- **èŒè´£**ï¼šæ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ã€è®¿é—®
- **æŠ€æœ¯**ï¼šNestJS + MinIO / AWS S3
- **åŠŸèƒ½**ï¼š
  - æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
  - å›¾ç‰‡å¤„ç†å’Œç¼©ç•¥å›¾ç”Ÿæˆ
  - æ–‡ä»¶è®¿é—®æƒé™æ§åˆ¶
  - æ–‡ä»¶å­˜å‚¨ç®¡ç†
  - æ–‡ä»¶åˆ†äº«å’Œé¢„è§ˆ

##### 2.2.10 æŠ¥è¡¨æœåŠ¡ (report-service)
- **èŒè´£**ï¼šæ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆ
- **æŠ€æœ¯**ï¼šNestJS + PostgreSQL + Elasticsearch + Redis
- **åŠŸèƒ½**ï¼š
  - é”€å”®æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
  - L2Cæ¼æ–—åˆ†æ
  - ç”¨æˆ·è¡Œä¸ºåˆ†æ
  - è‡ªå®šä¹‰æŠ¥è¡¨ç”Ÿæˆ
  - æ•°æ®å¯è§†åŒ–æ¥å£

---

## ğŸ”„ æ¨¡å—é—´è¡”æ¥æœºåˆ¶

### 1. å‰åç«¯äº¤äº’æœºåˆ¶

#### 1.1 APIè®¾è®¡è§„èŒƒ
- **RESTful API**ï¼šéµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼Œä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•
- **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šæ‰€æœ‰APIå“åº”é‡‡ç”¨ç»Ÿä¸€æ ¼å¼
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {},
    "timestamp": "2024-01-01T00:00:00.000Z"
  }
  ```
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯
- **åˆ†é¡µè§„èŒƒ**ï¼šç»Ÿä¸€çš„åˆ†é¡µå‚æ•°å’Œå“åº”æ ¼å¼
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šAPIç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒå‘åå…¼å®¹

#### 1.2 æ•°æ®äº¤äº’æœºåˆ¶
- **æ•°æ®è·å–**ï¼šä½¿ç”¨SWRè¿›è¡Œæ•°æ®è·å–ï¼Œæ”¯æŒç¼“å­˜ã€é‡æ–°éªŒè¯ã€ç„¦ç‚¹è·Ÿè¸ªã€é—´éš”é‡æ–°è·å–
- **çŠ¶æ€åŒæ­¥**ï¼šä½¿ç”¨WebSocketå®ç°å®æ—¶çŠ¶æ€åŒæ­¥
- **ç¦»çº¿æ”¯æŒ**ï¼šä½¿ç”¨Service Workerå®ç°ç¦»çº¿æ•°æ®ç¼“å­˜å’ŒåŒæ­¥
- **è¯·æ±‚æ‹¦æˆª**ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚å¤´ã€è®¤è¯ã€é”™è¯¯ç­‰

### 2. å¾®æœåŠ¡é—´é€šä¿¡æœºåˆ¶

#### 2.1 åŒæ­¥é€šä¿¡
- **HTTP/REST**ï¼šç”¨äºå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯
- **gRPC**ï¼šç”¨äºé«˜æ€§èƒ½å†…éƒ¨æœåŠ¡é€šä¿¡
- **GraphQL**ï¼šç”¨äºå¤æ‚æŸ¥è¯¢åœºæ™¯

#### 2.2 å¼‚æ­¥é€šä¿¡
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä½¿ç”¨RabbitMQ/Redis Streamså®ç°å¼‚æ­¥æ¶ˆæ¯ä¼ é€’
- **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºé¢†åŸŸäº‹ä»¶çš„æ¾è€¦åˆæ¶æ„
- **å‘å¸ƒ/è®¢é˜…**ï¼šä½¿ç”¨Redis Pub/Subå®ç°å®æ—¶é€šçŸ¥

#### 2.3 æœåŠ¡å‘ç°ä¸æ³¨å†Œ
- **æœåŠ¡æ³¨å†Œ**ï¼šæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒ
- **æœåŠ¡å‘ç°**ï¼šé€šè¿‡æœåŠ¡åç§°åŠ¨æ€è·å–æœåŠ¡å®ä¾‹
- **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- **è´Ÿè½½å‡è¡¡**ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡

### 3. æ¶ˆæ¯é˜Ÿåˆ—è¯¦ç»†è®¾è®¡

#### 3.1 æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„é€‰å‹

##### 3.1.1 æŠ€æœ¯é€‰å‹å¯¹æ¯”
| æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| **Redis Streams** | é«˜æ€§èƒ½ã€å†…å­˜å­˜å‚¨ã€æ”¯æŒæ¶ˆè´¹è€…ç»„ã€æŒä¹…åŒ– | å†…å­˜é™åˆ¶ã€å•ç‚¹æ•…éšœé£é™© | é«˜é¢‘æ¶ˆæ¯ã€å®æ—¶æ€§è¦æ±‚é«˜ |
| **RabbitMQ** | åŠŸèƒ½ä¸°å¯Œã€å¯é æ€§é«˜ã€æ”¯æŒå¤šç§åè®® | æ€§èƒ½ç›¸å¯¹è¾ƒä½ã€é…ç½®å¤æ‚ | å¤æ‚è·¯ç”±ã€å¯é æ€§è¦æ±‚é«˜ |
| **Bull Queue** | åŸºäºRedisã€ç®€å•æ˜“ç”¨ã€æ”¯æŒå»¶è¿Ÿä»»åŠ¡ | åŠŸèƒ½ç›¸å¯¹ç®€å• | ä»»åŠ¡é˜Ÿåˆ—ã€å®šæ—¶ä»»åŠ¡ |

##### 3.1.2 æ··åˆæ¶æ„è®¾è®¡
é‡‡ç”¨**åˆ†å±‚æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„**ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©åˆé€‚çš„æŠ€æœ¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆæ¯é˜Ÿåˆ—åˆ†å±‚æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº”ç”¨å±‚ (Application Layer)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è®¢å•æœåŠ¡   â”‚ â”‚  ç§¯åˆ†æœåŠ¡   â”‚ â”‚  é€šçŸ¥æœåŠ¡   â”‚ â”‚ æŠ¥è¡¨æœåŠ¡â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¶ˆæ¯è·¯ç”±å±‚ (Message Router Layer)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              æ¶ˆæ¯è·¯ç”±å™¨ (Message Router)                â”‚ â”‚
â”‚  â”‚  - æ¶ˆæ¯åˆ†ç±»è·¯ç”±                                         â”‚ â”‚
â”‚  â”‚  - è´Ÿè½½å‡è¡¡                                             â”‚ â”‚
â”‚  â”‚  - æ•…éšœè½¬ç§»                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜Ÿåˆ—å±‚ (Queue Layer)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Redis Streamsâ”‚ â”‚  RabbitMQ   â”‚ â”‚ Bull Queue  â”‚ â”‚ æœ¬åœ°é˜Ÿåˆ—â”‚ â”‚
â”‚  â”‚(å®æ—¶æ¶ˆæ¯)   â”‚ â”‚(å¯é æ¶ˆæ¯)   â”‚ â”‚(ä»»åŠ¡é˜Ÿåˆ—)   â”‚ â”‚(ç¼“å†²)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨å±‚ (Storage Layer)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Redis    â”‚ â”‚ PostgreSQL  â”‚ â”‚   MongoDB   â”‚ â”‚ æ–‡ä»¶å­˜å‚¨â”‚ â”‚
â”‚  â”‚(å†…å­˜å­˜å‚¨)   â”‚ â”‚(äº‹åŠ¡å­˜å‚¨)   â”‚ â”‚(æ—¥å¿—å­˜å‚¨)   â”‚ â”‚(å¤‡ä»½)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 æ¶ˆæ¯é˜Ÿåˆ—åˆ†ç±»è®¾è®¡

##### 3.2.1 å®æ—¶æ¶ˆæ¯é˜Ÿåˆ— (Redis Streams)
**ç”¨é€”**ï¼šé«˜é¢‘ã€å®æ—¶æ€§è¦æ±‚é«˜çš„æ¶ˆæ¯å¤„ç†

```typescript
// å®æ—¶æ¶ˆæ¯é˜Ÿåˆ—é…ç½®
interface RealtimeQueueConfig {
  // è®¢å•çŠ¶æ€å˜æ›´
  ORDER_STATUS_CHANGE: {
    stream: 'order:status:stream',
    maxLength: 10000,
    consumers: ['order-service', 'notification-service', 'analytics-service']
  },
  
  // ç§¯åˆ†å˜æ›´
  POINTS_CHANGE: {
    stream: 'points:change:stream',
    maxLength: 50000,
    consumers: ['points-service', 'notification-service', 'analytics-service']
  },
  
  // å®æ—¶é€šçŸ¥
  REALTIME_NOTIFICATION: {
    stream: 'notification:realtime:stream',
    maxLength: 20000,
    consumers: ['notification-service', 'websocket-service']
  },
  
  // åº“å­˜å˜æ›´
  INVENTORY_CHANGE: {
    stream: 'inventory:change:stream',
    maxLength: 30000,
    consumers: ['inventory-service', 'order-service', 'analytics-service']
  }
}

// Redis Streams ç”Ÿäº§è€…
class RealtimeMessageProducer {
  async publishOrderStatusChange(orderId: string, status: string, metadata: any) {
    const message = {
      orderId,
      status,
      timestamp: Date.now(),
      metadata: JSON.stringify(metadata)
    };
    
    await this.redis.xadd(
      'order:status:stream',
      '*',
      'data', JSON.stringify(message)
    );
  }
  
  async publishPointsChange(userId: string, points: number, reason: string) {
    const message = {
      userId,
      points,
      reason,
      timestamp: Date.now()
    };
    
    await this.redis.xadd(
      'points:change:stream',
      '*',
      'data', JSON.stringify(message)
    );
  }
}

// Redis Streams æ¶ˆè´¹è€…
class RealtimeMessageConsumer {
  async startConsumer(streamName: string, consumerGroup: string) {
    // åˆ›å»ºæ¶ˆè´¹è€…ç»„
    try {
      await this.redis.xgroup('CREATE', streamName, consumerGroup, '$', 'MKSTREAM');
    } catch (error) {
      // æ¶ˆè´¹è€…ç»„å·²å­˜åœ¨
    }
    
    // æŒç»­æ¶ˆè´¹æ¶ˆæ¯
    while (true) {
      try {
        const messages = await this.redis.xreadgroup(
          'GROUP', consumerGroup, 'consumer-1',
          'COUNT', 10,
          'BLOCK', 1000,
          'STREAMS', streamName, '>'
        );
        
        for (const [stream, streamMessages] of messages) {
          for (const [messageId, fields] of streamMessages) {
            await this.processMessage(messageId, fields);
            // ç¡®è®¤æ¶ˆæ¯å¤„ç†å®Œæˆ
            await this.redis.xack(streamName, consumerGroup, messageId);
          }
        }
      } catch (error) {
        console.error('æ¶ˆè´¹æ¶ˆæ¯å¤±è´¥:', error);
        await new Promise(resolve => setTimeout(resolve, 5000));
      }
    }
  }
}
```

##### 3.2.2 å¯é æ¶ˆæ¯é˜Ÿåˆ— (RabbitMQ)
**ç”¨é€”**ï¼šé‡è¦ä¸šåŠ¡æ¶ˆæ¯ï¼Œè¦æ±‚é«˜å¯é æ€§å’Œå¤æ‚è·¯ç”±

```typescript
// RabbitMQ é˜Ÿåˆ—é…ç½®
interface ReliableQueueConfig {
  // è®¢å•å¤„ç†
  ORDER_PROCESSING: {
    exchange: 'order.exchange',
    routingKey: 'order.processing',
    queue: 'order.processing.queue',
    durable: true,
    persistent: true
  },
  
  // æ”¯ä»˜å¤„ç†
  PAYMENT_PROCESSING: {
    exchange: 'payment.exchange',
    routingKey: 'payment.processing',
    queue: 'payment.processing.queue',
    durable: true,
    persistent: true
  },
  
  // è´¢åŠ¡å¯¹è´¦
  FINANCIAL_RECONCILIATION: {
    exchange: 'financial.exchange',
    routingKey: 'financial.reconciliation',
    queue: 'financial.reconciliation.queue',
    durable: true,
    persistent: true
  },
  
  // æ•°æ®åŒæ­¥
  DATA_SYNC: {
    exchange: 'sync.exchange',
    routingKey: 'sync.data',
    queue: 'sync.data.queue',
    durable: true,
    persistent: true
  }
}

// RabbitMQ ç”Ÿäº§è€…
class ReliableMessageProducer {
  async publishOrderProcessing(orderData: any) {
    const message = {
      orderId: orderData.id,
      action: 'process',
      data: orderData,
      timestamp: Date.now(),
      retryCount: 0
    };
    
    await this.channel.publish(
      'order.exchange',
      'order.processing',
      Buffer.from(JSON.stringify(message)),
      {
        persistent: true,
        messageId: `order-${orderData.id}-${Date.now()}`,
        timestamp: Date.now(),
        headers: {
          'x-retry-count': 0,
          'x-max-retries': 3
        }
      }
    );
  }
  
  async publishPaymentProcessing(paymentData: any) {
    const message = {
      paymentId: paymentData.id,
      orderId: paymentData.orderId,
      amount: paymentData.amount,
      action: 'process',
      timestamp: Date.now()
    };
    
    await this.channel.publish(
      'payment.exchange',
      'payment.processing',
      Buffer.from(JSON.stringify(message)),
      {
        persistent: true,
        messageId: `payment-${paymentData.id}-${Date.now()}`,
        timestamp: Date.now()
      }
    );
  }
}

// RabbitMQ æ¶ˆè´¹è€…
class ReliableMessageConsumer {
  async startConsumer(queueName: string) {
    await this.channel.consume(queueName, async (msg) => {
      if (msg) {
        try {
          const content = JSON.parse(msg.content.toString());
          await this.processMessage(content);
          
          // ç¡®è®¤æ¶ˆæ¯å¤„ç†å®Œæˆ
          this.channel.ack(msg);
        } catch (error) {
          console.error('å¤„ç†æ¶ˆæ¯å¤±è´¥:', error);
          
          // æ£€æŸ¥é‡è¯•æ¬¡æ•°
          const retryCount = msg.properties.headers['x-retry-count'] || 0;
          const maxRetries = msg.properties.headers['x-max-retries'] || 3;
          
          if (retryCount < maxRetries) {
            // é‡æ–°å‘å¸ƒåˆ°é‡è¯•é˜Ÿåˆ—
            await this.republishWithDelay(msg, retryCount + 1);
            this.channel.ack(msg);
          } else {
            // å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
            await this.sendToDeadLetterQueue(msg);
            this.channel.ack(msg);
          }
        }
      }
    });
  }
}
```

##### 3.2.3 ä»»åŠ¡é˜Ÿåˆ— (Bull Queue)
**ç”¨é€”**ï¼šå®šæ—¶ä»»åŠ¡ã€å»¶è¿Ÿä»»åŠ¡ã€æ‰¹é‡å¤„ç†ä»»åŠ¡

```typescript
// Bull Queue ä»»åŠ¡é…ç½®
interface TaskQueueConfig {
  // å®šæ—¶æŠ¥è¡¨ç”Ÿæˆ
  REPORT_GENERATION: {
    name: 'report-generation',
    concurrency: 2,
    attempts: 3,
    backoff: 'exponential'
  },
  
  // æ•°æ®æ¸…ç†
  DATA_CLEANUP: {
    name: 'data-cleanup',
    concurrency: 1,
    attempts: 2,
    backoff: 'fixed'
  },
  
  // é‚®ä»¶å‘é€
  EMAIL_SENDING: {
    name: 'email-sending',
    concurrency: 5,
    attempts: 3,
    backoff: 'exponential'
  },
  
  // æ–‡ä»¶å¤„ç†
  FILE_PROCESSING: {
    name: 'file-processing',
    concurrency: 3,
    attempts: 2,
    backoff: 'fixed'
  }
}

// Bull Queue ä»»åŠ¡ç”Ÿäº§è€…
class TaskQueueProducer {
  async scheduleReportGeneration(reportConfig: any, scheduleTime?: Date) {
    const job = await this.reportQueue.add(
      'generate-report',
      {
        reportType: reportConfig.type,
        parameters: reportConfig.parameters,
        userId: reportConfig.userId
      },
      {
        delay: scheduleTime ? scheduleTime.getTime() - Date.now() : 0,
        attempts: 3,
        backoff: {
          type: 'exponential',
          delay: 2000
        },
        removeOnComplete: 10,
        removeOnFail: 5
      }
    );
    
    return job.id;
  }
  
  async scheduleDataCleanup(cleanupConfig: any) {
    const job = await this.cleanupQueue.add(
      'cleanup-data',
      {
        tables: cleanupConfig.tables,
        retentionDays: cleanupConfig.retentionDays,
        batchSize: cleanupConfig.batchSize || 1000
      },
      {
        repeat: { cron: '0 2 * * *' }, // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
        attempts: 2,
        backoff: {
          type: 'fixed',
          delay: 5000
        }
      }
    );
    
    return job.id;
  }
}

// Bull Queue ä»»åŠ¡æ¶ˆè´¹è€…
class TaskQueueConsumer {
  async processReportGeneration(job: any) {
    const { reportType, parameters, userId } = job.data;
    
    try {
      // æ›´æ–°ä»»åŠ¡è¿›åº¦
      await job.progress(10);
      
      // ç”ŸæˆæŠ¥è¡¨æ•°æ®
      const reportData = await this.generateReportData(reportType, parameters);
      await job.progress(50);
      
      // ç”ŸæˆæŠ¥è¡¨æ–‡ä»¶
      const reportFile = await this.generateReportFile(reportData);
      await job.progress(80);
      
      // å‘é€é€šçŸ¥
      await this.notifyReportReady(userId, reportFile);
      await job.progress(100);
      
      return { success: true, reportFile };
    } catch (error) {
      console.error('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥:', error);
      throw error;
    }
  }
  
  async processDataCleanup(job: any) {
    const { tables, retentionDays, batchSize } = job.data;
    
    try {
      let totalCleaned = 0;
      
      for (const table of tables) {
        const cleaned = await this.cleanupTable(table, retentionDays, batchSize);
        totalCleaned += cleaned;
        
        // æ›´æ–°è¿›åº¦
        const progress = (tables.indexOf(table) + 1) / tables.length * 100;
        await job.progress(progress);
      }
      
      return { success: true, totalCleaned };
    } catch (error) {
      console.error('æ•°æ®æ¸…ç†å¤±è´¥:', error);
      throw error;
    }
  }
}
```

#### 3.3 æ¶ˆæ¯é˜Ÿåˆ—ä¸šåŠ¡åœºæ™¯è®¾è®¡

##### 3.3.1 è®¢å•å¤„ç†æµç¨‹
```typescript
// è®¢å•å¤„ç†æ¶ˆæ¯æµ
class OrderProcessingFlow {
  async processNewOrder(orderData: any) {
    // 1. å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶ (Redis Streams - å®æ—¶)
    await this.realtimeProducer.publishOrderStatusChange(
      orderData.id,
      'CREATED',
      { source: 'order-service' }
    );
    
    // 2. å‘å¸ƒè®¢å•å¤„ç†ä»»åŠ¡ (RabbitMQ - å¯é )
    await this.reliableProducer.publishOrderProcessing(orderData);
    
    // 3. å®‰æ’åº“å­˜æ£€æŸ¥ä»»åŠ¡ (Bull Queue - ä»»åŠ¡)
    await this.taskProducer.scheduleInventoryCheck(orderData.items);
    
    // 4. å®‰æ’æ”¯ä»˜è¶…æ—¶æ£€æŸ¥ (Bull Queue - å»¶è¿Ÿä»»åŠ¡)
    await this.taskProducer.schedulePaymentTimeout(
      orderData.id,
      new Date(Date.now() + 30 * 60 * 1000) // 30åˆ†é’Ÿå
    );
  }
  
  async processOrderPayment(paymentData: any) {
    // 1. å‘å¸ƒæ”¯ä»˜æˆåŠŸäº‹ä»¶ (Redis Streams - å®æ—¶)
    await this.realtimeProducer.publishOrderStatusChange(
      paymentData.orderId,
      'PAID',
      { paymentId: paymentData.id, amount: paymentData.amount }
    );
    
    // 2. å‘å¸ƒæ”¯ä»˜å¤„ç†ä»»åŠ¡ (RabbitMQ - å¯é )
    await this.reliableProducer.publishPaymentProcessing(paymentData);
    
    // 3. å–æ¶ˆæ”¯ä»˜è¶…æ—¶ä»»åŠ¡
    await this.taskProducer.cancelPaymentTimeout(paymentData.orderId);
    
    // 4. å®‰æ’å‘è´§å‡†å¤‡ä»»åŠ¡
    await this.taskProducer.scheduleShippingPreparation(paymentData.orderId);
  }
}
```

##### 3.3.2 ç§¯åˆ†ç³»ç»Ÿæµç¨‹
```typescript
// ç§¯åˆ†ç³»ç»Ÿæ¶ˆæ¯æµ
class PointsSystemFlow {
  async processPointsEarning(userId: string, action: string, metadata: any) {
    // 1. å‘å¸ƒç§¯åˆ†å˜æ›´äº‹ä»¶ (Redis Streams - å®æ—¶)
    const points = await this.calculatePoints(action, metadata);
    await this.realtimeProducer.publishPointsChange(userId, points, action);
    
    // 2. å‘å¸ƒç§¯åˆ†å¤„ç†ä»»åŠ¡ (RabbitMQ - å¯é )
    await this.reliableProducer.publishPointsProcessing({
      userId,
      points,
      action,
      metadata
    });
    
    // 3. æ£€æŸ¥ç­‰çº§å‡çº§ (Bull Queue - ä»»åŠ¡)
    await this.taskProducer.scheduleUserLevelCheck(userId);
    
    // 4. å®‰æ’ç§¯åˆ†è¿‡æœŸæ£€æŸ¥ (Bull Queue - å®šæ—¶ä»»åŠ¡)
    await this.taskProducer.schedulePointsExpiryCheck(userId);
  }
  
  async processPointsRedemption(userId: string, points: number, itemId: string) {
    // 1. å‘å¸ƒç§¯åˆ†æ¶ˆè´¹äº‹ä»¶ (Redis Streams - å®æ—¶)
    await this.realtimeProducer.publishPointsChange(userId, -points, 'REDEMPTION');
    
    // 2. å‘å¸ƒå…‘æ¢å¤„ç†ä»»åŠ¡ (RabbitMQ - å¯é )
    await this.reliableProducer.publishRedemptionProcessing({
      userId,
      points,
      itemId,
      timestamp: Date.now()
    });
    
    // 3. å®‰æ’å…‘æ¢å•†å“å‘è´§ (Bull Queue - ä»»åŠ¡)
    await this.taskProducer.scheduleRedemptionShipping(userId, itemId);
  }
}
```

#### 3.4 æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§ä¸ç®¡ç†

##### 3.4.1 ç›‘æ§æŒ‡æ ‡è®¾è®¡
```typescript
// æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§æŒ‡æ ‡
interface QueueMetrics {
  // é˜Ÿåˆ—åŸºç¡€æŒ‡æ ‡
  queueLength: number;           // é˜Ÿåˆ—é•¿åº¦
  processingRate: number;        // å¤„ç†é€Ÿç‡ (æ¶ˆæ¯/ç§’)
  errorRate: number;             // é”™è¯¯ç‡
  averageProcessingTime: number; // å¹³å‡å¤„ç†æ—¶é—´
  
  // æ¶ˆè´¹è€…æŒ‡æ ‡
  activeConsumers: number;       // æ´»è·ƒæ¶ˆè´¹è€…æ•°é‡
  consumerLag: number;          // æ¶ˆè´¹è€…å»¶è¿Ÿ
  
  // ç³»ç»ŸæŒ‡æ ‡
  memoryUsage: number;          // å†…å­˜ä½¿ç”¨ç‡
  cpuUsage: number;             // CPUä½¿ç”¨ç‡
  diskUsage: number;            // ç£ç›˜ä½¿ç”¨ç‡
  networkIO: number;            // ç½‘ç»œIO
}

// ç›‘æ§æœåŠ¡
class QueueMonitoringService {
  async collectMetrics() {
    const metrics = {
      redis: await this.collectRedisMetrics(),
      rabbitmq: await this.collectRabbitMQMetrics(),
      bull: await this.collectBullMetrics()
    };
    
    // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
    await this.sendToPrometheus(metrics);
    
    // æ£€æŸ¥å‘Šè­¦æ¡ä»¶
    await this.checkAlerts(metrics);
    
    return metrics;
  }
  
  async checkAlerts(metrics: any) {
    // é˜Ÿåˆ—é•¿åº¦å‘Šè­¦
    if (metrics.redis.queueLength > 10000) {
      await this.sendAlert('Redisé˜Ÿåˆ—ç§¯å‹', metrics.redis.queueLength);
    }
    
    // é”™è¯¯ç‡å‘Šè­¦
    if (metrics.rabbitmq.errorRate > 0.05) {
      await this.sendAlert('RabbitMQé”™è¯¯ç‡è¿‡é«˜', metrics.rabbitmq.errorRate);
    }
    
    // å¤„ç†å»¶è¿Ÿå‘Šè­¦
    if (metrics.bull.averageProcessingTime > 30000) {
      await this.sendAlert('ä»»åŠ¡å¤„ç†å»¶è¿Ÿè¿‡é«˜', metrics.bull.averageProcessingTime);
    }
  }
}
```

##### 3.4.2 æ•…éšœæ¢å¤æœºåˆ¶
```typescript
// æ•…éšœæ¢å¤æœåŠ¡
class QueueRecoveryService {
  async handleRedisFailure() {
    // 1. åˆ‡æ¢åˆ°å¤‡ç”¨Rediså®ä¾‹
    await this.switchToBackupRedis();
    
    // 2. é‡æ–°å‘å¸ƒæœªç¡®è®¤çš„æ¶ˆæ¯
    await this.republishUnackedMessages();
    
    // 3. é€šçŸ¥ç›¸å…³æœåŠ¡
    await this.notifyServicesOfFailover();
  }
  
  async handleRabbitMQFailure() {
    // 1. å¯ç”¨æ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“
    await this.enableDatabasePersistence();
    
    // 2. åˆ‡æ¢åˆ°å¤‡ç”¨RabbitMQé›†ç¾¤
    await this.switchToBackupCluster();
    
    // 3. é‡æ”¾æŒä¹…åŒ–çš„æ¶ˆæ¯
    await this.replayPersistedMessages();
  }
  
  async handleConsumerFailure(consumerId: string) {
    // 1. é‡å¯æ¶ˆè´¹è€…
    await this.restartConsumer(consumerId);
    
    // 2. é‡æ–°åˆ†é…æœªå¤„ç†çš„æ¶ˆæ¯
    await this.redistributeMessages(consumerId);
    
    // 3. æ›´æ–°æ¶ˆè´¹è€…å¥åº·çŠ¶æ€
    await this.updateConsumerHealth(consumerId, 'RECOVERING');
  }
}
```

#### 3.5 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

##### 3.5.1 æ‰¹é‡å¤„ç†ä¼˜åŒ–
```typescript
// æ‰¹é‡æ¶ˆæ¯å¤„ç†
class BatchMessageProcessor {
  async processBatch(messages: any[], batchSize: number = 100) {
    const batches = this.chunkArray(messages, batchSize);
    
    for (const batch of batches) {
      try {
        // å¹¶è¡Œå¤„ç†æ‰¹æ¬¡å†…çš„æ¶ˆæ¯
        await Promise.all(
          batch.map(message => this.processMessage(message))
        );
        
        // æ‰¹é‡ç¡®è®¤æ¶ˆæ¯
        await this.batchAckMessages(batch);
      } catch (error) {
        // å•ç‹¬å¤„ç†å¤±è´¥çš„æ¶ˆæ¯
        await this.handleBatchFailure(batch, error);
      }
    }
  }
  
  private chunkArray(array: any[], size: number): any[][] {
    const chunks = [];
    for (let i = 0; i < array.length; i += size) {
      chunks.push(array.slice(i, i + size));
    }
    return chunks;
  }
}
```

##### 3.5.2 æ¶ˆæ¯å‹ç¼©ä¼˜åŒ–
```typescript
// æ¶ˆæ¯å‹ç¼©æœåŠ¡
class MessageCompressionService {
  async compressMessage(message: any): Promise<Buffer> {
    const jsonString = JSON.stringify(message);
    
    // ä½¿ç”¨gzipå‹ç¼©
    return new Promise((resolve, reject) => {
      zlib.gzip(jsonString, (err, compressed) => {
        if (err) reject(err);
        else resolve(compressed);
      });
    });
  }
  
  async decompressMessage(compressedData: Buffer): Promise<any> {
    return new Promise((resolve, reject) => {
      zlib.gunzip(compressedData, (err, decompressed) => {
        if (err) reject(err);
        else resolve(JSON.parse(decompressed.toString()));
      });
    });
  }
}
```

### 4. æ•°æ®ä¸€è‡´æ€§æœºåˆ¶

#### 3.1 åˆ†å¸ƒå¼äº‹åŠ¡
- **Sagaæ¨¡å¼**ï¼šç”¨äºé•¿äº‹åŠ¡çš„ä¸šåŠ¡æµç¨‹
- **TCCæ¨¡å¼**ï¼šç”¨äºéœ€è¦èµ„æºé¢„ç•™çš„åœºæ™¯
- **æœ¬åœ°æ¶ˆæ¯è¡¨**ï¼šç¡®ä¿æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§
- **äº‹åŠ¡æ€§å‘ä»¶ç®±**ï¼šå¯é çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶

#### 3.2 æ•°æ®åŒæ­¥
- **äº‹ä»¶æº¯æº**ï¼šè®°å½•æ‰€æœ‰çŠ¶æ€å˜æ›´äº‹ä»¶
- **CQRS**ï¼šå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»
- **æ•°æ®ç¼“å­˜**ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥

---

## ğŸ“Š æ•°æ®å­˜å‚¨è®¾è®¡

### 1. æ•°æ®åº“é€‰å‹ä¸è®¾è®¡

#### 1.1 å…³ç³»å‹æ•°æ®åº“ (PostgreSQL)
- **ç”¨é€”**ï¼šæ ¸å¿ƒä¸šåŠ¡æ•°æ®å­˜å‚¨
- **ç‰¹ç‚¹**ï¼šACIDäº‹åŠ¡ã€JSONæ”¯æŒã€å…¨æ–‡æœç´¢ã€åœ°ç†ç©ºé—´æ•°æ®
- **è¡¨è®¾è®¡**ï¼š
  ```sql
  -- æšä¸¾ç±»å‹å®šä¹‰
  CREATE TYPE user_role AS ENUM ('admin', 'sales_manager', 'sales_rep', 'designer', 'installer', 'customer_service', 'store_sales', 'remote_sales', 'order_service', 'dispatcher', 'measurer');
  CREATE TYPE user_status AS ENUM ('active', 'inactive', 'locked', 'deleted');
  CREATE TYPE lead_status AS ENUM ('new', 'assigned', 'following', 'converted', 'invalid');
  CREATE TYPE order_status AS ENUM ('draft', 'confirmed', 'measuring', 'production', 'delivery', 'installing', 'completed', 'cancelled');
  CREATE TYPE product_category AS ENUM ('curtain', 'blind', 'shutter', 'accessory');
  
  -- ç”¨æˆ·è¡¨
  CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(15),
    password_hash VARCHAR(255) NOT NULL,
    role user_role NOT NULL,
    status user_status NOT NULL DEFAULT 'active',
    profile JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  
  -- çº¿ç´¢è¡¨
  CREATE TABLE leads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    customer_name VARCHAR(100) NOT NULL,
    customer_address VARCHAR(200),
    designer_id UUID REFERENCES users(id),
    salesperson_id UUID REFERENCES users(id),
    store_id UUID REFERENCES stores(id),
    city VARCHAR(50),
    contract_date DATE,
    area DECIMAL(10,2),
    package_name VARCHAR(100),
    status lead_status NOT NULL DEFAULT 'new',
    tags TEXT[],
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  
  -- é”€å”®å•è¡¨
  CREATE TABLE sales_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_no VARCHAR(50) UNIQUE NOT NULL,
    lead_id UUID REFERENCES leads(id),
    customer_name VARCHAR(100) NOT NULL,
    customer_address VARCHAR(200),
    agreement_amount DECIMAL(10,2),
    transaction_amount DECIMAL(10,2),
    payment_amount DECIMAL(10,2),
    service_fee DECIMAL(10,2),
    status order_status NOT NULL DEFAULT 'draft',
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  
  -- é”€å”®å†…å®¹è¡¨
  CREATE TABLE sales_order_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID REFERENCES sales_orders(id) ON DELETE CASCADE,
    product_id UUID REFERENCES products(id),
    product_name VARCHAR(100) NOT NULL,
    category product_category NOT NULL,
    quantity DECIMAL(10,2) NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    discount_rate DECIMAL(5,2) DEFAULT 0,
    total_price DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  
  -- ç§¯åˆ†è®°å½•è¡¨
  CREATE TABLE point_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    order_id UUID REFERENCES sales_orders(id),
    type point_type NOT NULL,
    points INTEGER NOT NULL,
    reason TEXT,
    status point_status NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
  );
  ```

#### 1.2 æ–‡æ¡£æ•°æ®åº“ (MongoDB)
- **ç”¨é€”**ï¼šæ—¥å¿—ã€éç»“æ„åŒ–æ•°æ®å­˜å‚¨
- **ç‰¹ç‚¹**ï¼šçµæ´»çš„æ–‡æ¡£æ¨¡å‹ã€æ°´å¹³æ‰©å±•ã€ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€
- **é›†åˆè®¾è®¡**ï¼š
  ```javascript
  // æ“ä½œæ—¥å¿—é›†åˆ
  db.createCollection("operation_logs", {
    validator: {
      $jsonSchema: {
        bsonType: "object",
        required: ["userId", "action", "resource", "timestamp"],
        properties: {
          userId: { bsonType: "string" },
          action: { bsonType: "string" },
          resource: { bsonType: "string" },
          details: { bsonType: "object" },
          ip: { bsonType: "string" },
          userAgent: { bsonType: "string" },
          timestamp: { bsonType: "date" }
        }
      }
    }
  });
  
  // ç³»ç»Ÿé…ç½®é›†åˆ
  db.createCollection("system_configs", {
    validator: {
      $jsonSchema: {
        bsonType: "object",
        required: ["key", "value", "category"],
        properties: {
          key: { bsonType: "string" },
          value: { bsonType: "object" },
          category: { bsonType: "string" },
          description: { bsonType: "string" },
          updatedBy: { bsonType: "string" },
          updatedAt: { bsonType: "date" }
        }
      }
    }
  });
  ```

#### 1.3 ç¼“å­˜æ•°æ®åº“ (Redis)
- **ç”¨é€”**ï¼šç¼“å­˜ã€ä¼šè¯ã€ä»»åŠ¡é˜Ÿåˆ—
- **ç‰¹ç‚¹**ï¼šå†…å­˜å­˜å‚¨ã€å¤šç§æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€é«˜å¯ç”¨
- **æ•°æ®ç»“æ„è®¾è®¡**ï¼š
  ```redis
  # ç”¨æˆ·ä¼šè¯
  SET session:{sessionId} {userId, role, permissions} EX 3600
  
  # ç”¨æˆ·æƒé™ç¼“å­˜
  HSET user:permissions:{userId} permission1 true permission2 false
  
  # çº¿ç´¢åˆ†é…ç¼“å­˜
  ZADD lead:assignment:load {salespersonId} {leadCount}
  
  # ç§¯åˆ†è®¡ç®—ç¼“å­˜
  SET points:calculation:{orderId} {points} EX 86400
  
  # å•†å“åº“å­˜ç¼“å­˜
  HSET product:stock:{productId} available 100 reserved 10
  
  # APIé™æµ
  SET rate:limit:{userId}:{apiEndpoint} 1 EX 60 NX
  ```

#### 1.4 æœç´¢å¼•æ“ (Elasticsearch)
- **ç”¨é€”**ï¼šå…¨æ–‡æœç´¢ã€æ•°æ®åˆ†æ
- **ç‰¹ç‚¹**ï¼šåˆ†å¸ƒå¼æœç´¢ã€å®æ—¶åˆ†æã€å¤æ‚æŸ¥è¯¢
- **ç´¢å¼•è®¾è®¡**ï¼š
  ```json
  // çº¿ç´¢æœç´¢ç´¢å¼•
  {
    "mappings": {
      "properties": {
        "id": { "type": "keyword" },
        "customerName": {
          "type": "text",
          "analyzer": "ik_max_word",
          "search_analyzer": "ik_smart"
        },
        "customerAddress": {
          "type": "text",
          "analyzer": "ik_max_word",
          "search_analyzer": "ik_smart"
        },
        "designer": { "type": "keyword" },
        "salesperson": { "type": "keyword" },
        "store": { "type": "keyword" },
        "city": { "type": "keyword" },
        "status": { "type": "keyword" },
        "tags": { "type": "keyword" },
        "createdAt": { "type": "date" },
        "updatedAt": { "type": "date" }
      }
    }
  }
  
  // å•†å“æœç´¢ç´¢å¼•
  {
    "mappings": {
      "properties": {
        "id": { "type": "keyword" },
        "name": {
          "type": "text",
          "analyzer": "ik_max_word",
          "search_analyzer": "ik_smart"
        },
        "category": { "type": "keyword" },
        "tags": { "type": "keyword" },
        "price": { "type": "double" },
        "stock": { "type": "integer" },
        "description": {
          "type": "text",
          "analyzer": "ik_max_word",
          "search_analyzer": "ik_smart"
        },
        "attributes": { "type": "object" },
        "createdAt": { "type": "date" },
        "updatedAt": { "type": "date" }
      }
    }
  }
  ```

### 2. æ•°æ®è®¿é—®å±‚è®¾è®¡

#### 2.1 ORMè®¾è®¡ (Prisma)
- **æ¨¡å‹å®šä¹‰**ï¼šä½¿ç”¨Prisma Schemaå®šä¹‰æ•°æ®æ¨¡å‹
- **ç±»å‹å®‰å…¨**ï¼šè‡ªåŠ¨ç”ŸæˆTypeScriptç±»å‹
- **æ•°æ®åº“è¿ç§»**ï¼šç‰ˆæœ¬åŒ–æ•°æ®åº“ç»“æ„å˜æ›´
- **æŸ¥è¯¢æ„å»º**ï¼šç±»å‹å®‰å…¨çš„æŸ¥è¯¢æ„å»ºå™¨

#### 2.2 æ•°æ®åº“è¿æ¥ç®¡ç†
- **è¿æ¥æ± **ï¼šé…ç½®åˆé€‚çš„è¿æ¥æ± å¤§å°
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»æ•°æ®åº“è¯»å†™åˆ†ç¦»
- **äº‹åŠ¡ç®¡ç†**ï¼šå£°æ˜å¼äº‹åŠ¡ç®¡ç†
- **æ•°æ®åº“å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ•°æ®åº“è¿æ¥çŠ¶æ€

---

## ğŸš€ å¯æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•èƒ½åŠ›

#### 1.1 æ— çŠ¶æ€æœåŠ¡è®¾è®¡
- **ä¼šè¯å¤–éƒ¨åŒ–**ï¼šä½¿ç”¨Rediså­˜å‚¨ä¼šè¯ä¿¡æ¯
- **çŠ¶æ€åˆ†ç¦»**ï¼šå°†ä¸šåŠ¡çŠ¶æ€ä¸è¿è¡Œæ—¶çŠ¶æ€åˆ†ç¦»
- **å¹‚ç­‰æ€§è®¾è®¡**ï¼šAPIè®¾è®¡æ”¯æŒå¹‚ç­‰æ€§
- **è¯·æ±‚è¿½è¸ª**ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

#### 1.2 æ•°æ®åº“æ‰©å±•
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»
- **åˆ†åº“åˆ†è¡¨**ï¼šæŒ‰ä¸šåŠ¡åŸŸæˆ–æ•°æ®é‡åˆ†åº“åˆ†è¡¨
- **æ•°æ®å½’æ¡£**ï¼šå†å²æ•°æ®å½’æ¡£ç­–ç•¥
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤šçº§ç¼“å­˜ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›

#### 1.3 ç¼“å­˜æ‰©å±•
- **åˆ†å¸ƒå¼ç¼“å­˜**ï¼šRedisé›†ç¾¤æ¨¡å¼
- **ç¼“å­˜é¢„çƒ­**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
- **ç¼“å­˜æ›´æ–°**ï¼šç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°ç­–ç•¥
- **ç¼“å­˜ç©¿é€ä¿æŠ¤**ï¼šå¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€

### 2. å‚ç›´æ‰©å±•èƒ½åŠ›

#### 2.1 æ¨¡å—åŒ–éƒ¨ç½²
- **ç‹¬ç«‹éƒ¨ç½²**ï¼šå„å¾®æœåŠ¡å¯ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- **èµ„æºéš”ç¦»**ï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œèµ„æºéš”ç¦»
- **å¼¹æ€§ä¼¸ç¼©**ï¼šåŸºäºè´Ÿè½½è‡ªåŠ¨æ‰©ç¼©å®¹
- **è“ç»¿éƒ¨ç½²**ï¼šé›¶åœæœºæ—¶é—´éƒ¨ç½²ç­–ç•¥

#### 2.2 æ’ä»¶åŒ–æ¶æ„
- **åŠŸèƒ½æ’ä»¶**ï¼šæ ¸å¿ƒåŠŸèƒ½æ’ä»¶åŒ–ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½
- **æ‰©å±•ç‚¹**ï¼šå®šä¹‰æ‰©å±•ç‚¹ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ§åˆ¶åŠŸèƒ½å¼€å…³
- **ç‰ˆæœ¬å…¼å®¹**ï¼šæ’ä»¶ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†

### 3. ä¸šåŠ¡æ‰©å±•èƒ½åŠ›

#### 3.1 å¤šç§Ÿæˆ·æ”¯æŒ
- **æ•°æ®éš”ç¦»**ï¼šç§Ÿæˆ·æ•°æ®éš”ç¦»ç­–ç•¥
- **é…ç½®éš”ç¦»**ï¼šç§Ÿæˆ·é…ç½®éš”ç¦»
- **èµ„æºéš”ç¦»**ï¼šç§Ÿæˆ·èµ„æºé…é¢ç®¡ç†
- **æ‰©å±•æ€§**ï¼šæ”¯æŒç§Ÿæˆ·è‡ªå®šä¹‰å­—æ®µå’Œæµç¨‹

#### 3.2 å¤šå“ç±»æ”¯æŒ
- **å“ç±»æ¨¡å‹**ï¼šå¯é…ç½®çš„å•†å“å“ç±»æ¨¡å‹
- **å±æ€§æ‰©å±•**ï¼šæ”¯æŒå“ç±»è‡ªå®šä¹‰å±æ€§
- **æµç¨‹æ‰©å±•**ï¼šæ”¯æŒå“ç±»ç‰¹å®šä¸šåŠ¡æµç¨‹
- **è§„åˆ™å¼•æ“**ï¼šå¯é…ç½®çš„ä¸šåŠ¡è§„åˆ™å¼•æ“

#### 3.3 å¤šæ¸ é“æ”¯æŒ
- **æ¸ é“é€‚é…**ï¼šå¤šæ¸ é“æ¥å…¥é€‚é…å™¨
- **æ•°æ®è½¬æ¢**ï¼šæ¸ é“æ•°æ®æ ¼å¼è½¬æ¢
- **æµç¨‹é€‚é…**ï¼šæ¸ é“ç‰¹å®šæµç¨‹é€‚é…
- **ç»Ÿä¸€æ¥å£**ï¼šç»Ÿä¸€çš„æ¸ é“æœåŠ¡æ¥å£

---

## ğŸ”’ å®‰å…¨æ¶æ„è®¾è®¡

### 1. èº«ä»½è®¤è¯ä¸æˆæƒ

#### 1.1 å¤šå› ç´ è®¤è¯
- **å¯†ç è®¤è¯**ï¼šå¼ºå¯†ç ç­–ç•¥ï¼Œå¯†ç åŠ å¯†å­˜å‚¨
- **çŸ­ä¿¡éªŒè¯**ï¼šçŸ­ä¿¡éªŒè¯ç äºŒæ¬¡éªŒè¯
- **é‚®ç®±éªŒè¯**ï¼šé‚®ç®±éªŒè¯ç äºŒæ¬¡éªŒè¯
- **ç”Ÿç‰©è¯†åˆ«**ï¼šæŒ‡çº¹ã€é¢éƒ¨è¯†åˆ«(ç§»åŠ¨ç«¯)

#### 1.2 å•ç‚¹ç™»å½•(SSO)
- **OAuth 2.0**ï¼šæ ‡å‡†OAuth 2.0æˆæƒæµç¨‹
- **JWTä»¤ç‰Œ**ï¼šJWTä»¤ç‰Œè®¤è¯å’Œæˆæƒ
- **ä»¤ç‰Œåˆ·æ–°**ï¼šè‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°æœºåˆ¶
- **ç™»å‡ºåŒæ­¥**ï¼šå¤šåº”ç”¨åŒæ­¥ç™»å‡º

#### 1.3 æƒé™æ§åˆ¶
- **RBACæ¨¡å‹**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **ç»†ç²’åº¦æƒé™**ï¼šèµ„æºçº§æƒé™æ§åˆ¶
- **åŠ¨æ€æƒé™**ï¼šåŸºäºä¸šåŠ¡è§„åˆ™çš„åŠ¨æ€æƒé™
- **æƒé™ç»§æ‰¿**ï¼šè§’è‰²æƒé™ç»§æ‰¿æœºåˆ¶

### 2. æ•°æ®å®‰å…¨

#### 2.1 æ•°æ®åŠ å¯†
- **ä¼ è¾“åŠ å¯†**ï¼šHTTPS/TLSä¼ è¾“åŠ å¯†
- **å­˜å‚¨åŠ å¯†**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **å­—æ®µåŠ å¯†**ï¼šå…³é”®å­—æ®µåŠ å¯†å­˜å‚¨
- **å¯†é’¥ç®¡ç†**ï¼šå¯†é’¥è½®æ¢å’Œç®¡ç†

#### 2.2 æ•°æ®è„±æ•
- **æ•æ„Ÿæ•°æ®**ï¼šæ‰‹æœºå·ã€èº«ä»½è¯ç­‰æ•æ„Ÿæ•°æ®è„±æ•
- **æ—¥å¿—è„±æ•**ï¼šæ—¥å¿—ä¸­æ•æ„Ÿä¿¡æ¯è„±æ•
- **å¯¼å‡ºè„±æ•**ï¼šæ•°æ®å¯¼å‡ºæ—¶æ•æ„Ÿä¿¡æ¯è„±æ•
- **å±•ç¤ºè„±æ•**ï¼šç•Œé¢å±•ç¤ºæ—¶æ•æ„Ÿä¿¡æ¯è„±æ•

#### 2.3 æ•°æ®å¤‡ä»½ä¸æ¢å¤
- **å®šæœŸå¤‡ä»½**ï¼šå®šæœŸè‡ªåŠ¨æ•°æ®å¤‡ä»½
- **å¼‚åœ°å¤‡ä»½**ï¼šå¼‚åœ°æ•°æ®å¤‡ä»½
- **å¤‡ä»½éªŒè¯**ï¼šå¤‡ä»½æ•°æ®å®Œæ•´æ€§éªŒè¯
- **æ¢å¤æ¼”ç»ƒ**ï¼šå®šæœŸæ•°æ®æ¢å¤æ¼”ç»ƒ

### 3. ç³»ç»Ÿå®‰å…¨

#### 3.1 ç½‘ç»œå®‰å…¨
- **é˜²ç«å¢™**ï¼šç½‘ç»œé˜²ç«å¢™é…ç½®
- **DDoSé˜²æŠ¤**ï¼šDDoSæ”»å‡»é˜²æŠ¤
- **å…¥ä¾µæ£€æµ‹**ï¼šå…¥ä¾µæ£€æµ‹ç³»ç»Ÿ
- **å®‰å…¨ç»„**ï¼šäº‘å¹³å°å®‰å…¨ç»„é…ç½®

#### 3.2 åº”ç”¨å®‰å…¨
- **è¾“å…¥éªŒè¯**ï¼šä¸¥æ ¼çš„è¾“å…¥æ•°æ®éªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤**ï¼šå‚æ•°åŒ–æŸ¥è¯¢ï¼Œé˜²æ­¢SQLæ³¨å…¥
- **XSSé˜²æŠ¤**ï¼šè·¨ç«™è„šæœ¬æ”»å‡»é˜²æŠ¤
- **CSRFé˜²æŠ¤**ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ é˜²æŠ¤

#### 3.3 å®‰å…¨å®¡è®¡
- **æ“ä½œæ—¥å¿—**ï¼šç”¨æˆ·æ“ä½œæ—¥å¿—è®°å½•
- **å®‰å…¨äº‹ä»¶**ï¼šå®‰å…¨äº‹ä»¶è®°å½•å’Œå‘Šè­¦
- **å®¡è®¡æŠ¥å‘Š**ï¼šå®šæœŸå®‰å…¨å®¡è®¡æŠ¥å‘Š
- **åˆè§„æ£€æŸ¥**ï¼šå®‰å…¨åˆè§„æ€§æ£€æŸ¥

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 1.1 åŠ è½½æ€§èƒ½ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**ï¼šè·¯ç”±çº§å’Œç»„ä»¶çº§ä»£ç åˆ†å‰²
- **æ‡’åŠ è½½**ï¼šå›¾ç‰‡å’Œç»„ä»¶æ‡’åŠ è½½
- **é¢„åŠ è½½**ï¼šå…³é”®èµ„æºé¢„åŠ è½½
- **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºCDNåŠ é€Ÿ

#### 1.2 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
- **è™šæ‹Ÿåˆ—è¡¨**ï¼šé•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
- **React.memo**ï¼šç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
- **useMemo/useCallback**ï¼šè®¡ç®—å’Œå‡½æ•°ç¼“å­˜
- **æœåŠ¡ç«¯æ¸²æŸ“**ï¼šå…³é”®é¡µé¢æœåŠ¡ç«¯æ¸²æŸ“

#### 1.3 ç½‘ç»œæ€§èƒ½ä¼˜åŒ–
- **è¯·æ±‚åˆå¹¶**ï¼šå¤šä¸ªè¯·æ±‚åˆå¹¶
- **è¯·æ±‚ç¼“å­˜**ï¼šAPIå“åº”ç¼“å­˜
- **æ•°æ®å‹ç¼©**ï¼šè¯·æ±‚å“åº”æ•°æ®å‹ç¼©
- **HTTP/2**ï¼šHTTP/2åè®®æ”¯æŒ

### 2. åç«¯æ€§èƒ½ä¼˜åŒ–

#### 2.1 åº”ç”¨æ€§èƒ½ä¼˜åŒ–
- **è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**ï¼šè€—æ—¶æ“ä½œå¼‚æ­¥å¤„ç†
- **æ‰¹é‡å¤„ç†**ï¼šæ‰¹é‡æ“ä½œä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥

#### 2.2 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**ï¼šåˆç†åˆ›å»ºç´¢å¼•
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šSQLæŸ¥è¯¢ä¼˜åŒ–
- **åˆ†é¡µä¼˜åŒ–**ï¼šå¤§æ•°æ®é‡åˆ†é¡µä¼˜åŒ–
- **æ•°æ®åº“è°ƒä¼˜**ï¼šæ•°æ®åº“å‚æ•°è°ƒä¼˜

#### 2.3 ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–
- **JVMè°ƒä¼˜**ï¼šJavaè™šæ‹Ÿæœºå‚æ•°è°ƒä¼˜
- **å®¹å™¨ä¼˜åŒ–**ï¼šDockerå®¹å™¨èµ„æºä¼˜åŒ–
- **è´Ÿè½½å‡è¡¡**ï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥ä¼˜åŒ–
- **èµ„æºç›‘æ§**ï¼šç³»ç»Ÿèµ„æºç›‘æ§å’Œå‘Šè­¦

---

## ğŸ”§ è¿ç»´ä¸ç›‘æ§è®¾è®¡

### 1. å®¹å™¨åŒ–ä¸ç¼–æ’

#### 1.1 å®¹å™¨åŒ–è®¾è®¡
- **å¤šé˜¶æ®µæ„å»º**ï¼šDockerå¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
- **é•œåƒä»“åº“**ï¼šç§æœ‰é•œåƒä»“åº“ç®¡ç†
- **å¥åº·æ£€æŸ¥**ï¼šå®¹å™¨å¥åº·æ£€æŸ¥é…ç½®
- **èµ„æºé™åˆ¶**ï¼šå®¹å™¨èµ„æºé™åˆ¶é…ç½®

#### 1.2 å®¹å™¨ç¼–æ’
- **Kubernetes**ï¼šç”Ÿäº§ç¯å¢ƒKubernetesç¼–æ’
- **æœåŠ¡éƒ¨ç½²**ï¼šKuberneteséƒ¨ç½²é…ç½®
- **æœåŠ¡å‘ç°**ï¼šKubernetesæœåŠ¡å‘ç°
- **é…ç½®ç®¡ç†**ï¼šKubernetes ConfigMapå’ŒSecret

### 2. ç›‘æ§ä¸å‘Šè­¦

#### 2.1 åº”ç”¨ç›‘æ§
- **APM**ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šå…³é”®ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
- **é”™è¯¯è¿½è¸ª**ï¼šåº”ç”¨é”™è¯¯è¿½è¸ªå’Œå‘Šè­¦
- **æ€§èƒ½åˆ†æ**ï¼šåº”ç”¨æ€§èƒ½åˆ†æå’Œä¼˜åŒ–

#### 2.2 åŸºç¡€è®¾æ–½ç›‘æ§
- **æœåŠ¡å™¨ç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç›‘æ§
- **æ•°æ®åº“ç›‘æ§**ï¼šæ•°æ®åº“æ€§èƒ½å’Œè¿æ¥ç›‘æ§
- **å®¹å™¨ç›‘æ§**ï¼šå®¹å™¨èµ„æºä½¿ç”¨ç›‘æ§
- **ç½‘ç»œç›‘æ§**ï¼šç½‘ç»œæµé‡å’Œå»¶è¿Ÿç›‘æ§

#### 2.3 æ—¥å¿—ç®¡ç†
- **æ—¥å¿—æ”¶é›†**ï¼šé›†ä¸­å¼æ—¥å¿—æ”¶é›†
- **æ—¥å¿—åˆ†æ**ï¼šæ—¥å¿—åˆ†æå’ŒæŸ¥è¯¢
- **æ—¥å¿—å‘Šè­¦**ï¼šåŸºäºæ—¥å¿—çš„å‘Šè­¦
- **æ—¥å¿—å½’æ¡£**ï¼šæ—¥å¿—é•¿æœŸå½’æ¡£ç­–ç•¥

### 3. è‡ªåŠ¨åŒ–è¿ç»´

#### 3.1 CI/CDæµæ°´çº¿
- **ä»£ç æ„å»º**ï¼šè‡ªåŠ¨åŒ–ä»£ç æ„å»º
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2Eæµ‹è¯•
- **é•œåƒæ„å»º**ï¼šè‡ªåŠ¨åŒ–Dockeré•œåƒæ„å»º
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°å„ç¯å¢ƒ

#### 3.2 è‡ªåŠ¨åŒ–è¿ç»´
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šåŸºäºè´Ÿè½½è‡ªåŠ¨æ‰©ç¼©å®¹
- **è‡ªåŠ¨æ•…éšœæ¢å¤**ï¼šæ•…éšœè‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤
- **è‡ªåŠ¨å¤‡ä»½**ï¼šæ•°æ®è‡ªåŠ¨å¤‡ä»½
- **è‡ªåŠ¨å·¡æ£€**ï¼šç³»ç»Ÿè‡ªåŠ¨å·¡æ£€

---

## ğŸ“‹ æŠ€æœ¯é€‰å‹å¯¹æ¯”

### 1. å‰ç«¯æŠ€æœ¯é€‰å‹å¯¹æ¯”

| æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| Next.js | SSR/SSGæ”¯æŒã€æ€§èƒ½ä¼˜ç§€ã€ç”Ÿæ€ä¸°å¯Œ | å­¦ä¹ æ›²çº¿è¾ƒé™¡ | ä¼ä¸šçº§Webåº”ç”¨ |
| React + CRA | ç®€å•æ˜“ç”¨ã€ç”Ÿæ€ä¸°å¯Œ | ä¸æ”¯æŒSSRã€æ€§èƒ½ä¸€èˆ¬ | ç®€å•Webåº”ç”¨ |
| Vue.js | å­¦ä¹ æ›²çº¿å¹³ç¼“ã€æ–‡æ¡£ä¼˜ç§€ | ç”Ÿæ€ç›¸å¯¹è¾ƒå° | ä¸­å°å‹Webåº”ç”¨ |
| Angular | åŠŸèƒ½å®Œæ•´ã€ä¼ä¸šçº§æ”¯æŒ | å­¦ä¹ æ›²çº¿é™¡å³­ã€æ€§èƒ½ä¸€èˆ¬ | å¤§å‹ä¼ä¸šåº”ç”¨ |

### 2. åç«¯æŠ€æœ¯é€‰å‹å¯¹æ¯”

| æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| NestJS | TypeScriptåŸç”Ÿã€æ¨¡å—åŒ–ã€è£…é¥°å™¨ | æ€§èƒ½ç•¥ä½äºExpress | ä¼ä¸šçº§Node.jsåº”ç”¨ |
| Express.js | ç®€å•çµæ´»ã€æ€§èƒ½ä¼˜ç§€ | ç¼ºä¹ç»“æ„ã€éœ€è¦è‡ªè¡Œç»„ç»‡ | ç®€å•Node.jsåº”ç”¨ |
| Spring Boot | ç”Ÿæ€ä¸°å¯Œã€ä¼ä¸šçº§æ”¯æŒ | èµ„æºæ¶ˆè€—å¤§ã€å¯åŠ¨æ…¢ | å¤§å‹ä¼ä¸šJavaåº”ç”¨ |
| Go | æ€§èƒ½ä¼˜ç§€ã€å¹¶å‘æ”¯æŒå¥½ | ç”Ÿæ€ç›¸å¯¹è¾ƒå° | é«˜æ€§èƒ½åç«¯æœåŠ¡ |

### 3. æ•°æ®åº“æŠ€æœ¯é€‰å‹å¯¹æ¯”

| æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| PostgreSQL | åŠŸèƒ½ä¸°å¯Œã€ACIDæ”¯æŒã€JSONæ”¯æŒ | æ€§èƒ½ç•¥ä½äºMySQL | å¤æ‚ä¸šåŠ¡åœºæ™¯ |
| MySQL | æ€§èƒ½ä¼˜ç§€ã€ç”Ÿæ€ä¸°å¯Œ | åŠŸèƒ½ç›¸å¯¹ç®€å• | ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ |
| MongoDB | çµæ´»æ–‡æ¡£æ¨¡å‹ã€æ°´å¹³æ‰©å±• | äº‹åŠ¡æ”¯æŒè¾ƒå¼± | éç»“æ„åŒ–æ•°æ® |
| Redis | é«˜æ€§èƒ½ã€ä¸°å¯Œæ•°æ®ç»“æ„ | å†…å­˜é™åˆ¶ã€æŒä¹…åŒ–æ€§èƒ½ | ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ |

---

## ğŸ›£ï¸ å®æ–½è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€å¹³å°æ­å»º (MVP) - 8å‘¨

#### ç¬¬1-2å‘¨ï¼šåŸºç¡€æ¶æ„æ­å»º
- é¡¹ç›®åˆå§‹åŒ–å’Œç¯å¢ƒæ­å»º
- å‰åç«¯åŸºç¡€æ¡†æ¶æ­å»º
- æ•°æ®åº“è®¾è®¡å’Œåˆå§‹åŒ–
- CI/CDæµæ°´çº¿æ­å»º

#### ç¬¬3-4å‘¨ï¼šæ ¸å¿ƒæœåŠ¡å¼€å‘
- ç”¨æˆ·è®¤è¯æœåŠ¡å¼€å‘
- çº¿ç´¢ç®¡ç†æœåŠ¡å¼€å‘
- é”€å”®å•ç®¡ç†æœåŠ¡å¼€å‘
- å‰ç«¯æ ¸å¿ƒé¡µé¢å¼€å‘

#### ç¬¬5-6å‘¨ï¼šç§¯åˆ†ç³»ç»Ÿå¼€å‘
- ç§¯åˆ†è®¡ç®—å’Œå‘æ”¾æœåŠ¡å¼€å‘
- ç§¯åˆ†å•†åŸå‰ç«¯å¼€å‘
- ç§¯åˆ†æŸ¥è¯¢å’Œç®¡ç†åŠŸèƒ½å¼€å‘
- ç§¯åˆ†ç³»ç»Ÿè”è°ƒæµ‹è¯•

#### ç¬¬7-8å‘¨ï¼šç³»ç»Ÿé›†æˆä¸æµ‹è¯•
- ç³»ç»Ÿé›†æˆæµ‹è¯•
- æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- å®‰å…¨æµ‹è¯•å’ŒåŠ å›º
- éƒ¨ç½²ä¸Šçº¿å‡†å¤‡

### é˜¶æ®µäºŒï¼šæœåŠ¡ç”Ÿæ€æ‰©å±• - 6å‘¨

#### ç¬¬9-10å‘¨ï¼šæœåŠ¡å•†ç®¡ç†
- æœåŠ¡å•†ç®¡ç†æœåŠ¡å¼€å‘
- æµ‹é‡å•ç®¡ç†ç³»ç»Ÿå¼€å‘
- å®‰è£…å•ç®¡ç†ç³»ç»Ÿå¼€å‘
- æ™ºèƒ½æ´¾å•ç®—æ³•å®ç°

#### ç¬¬11-12å‘¨ï¼šç§»åŠ¨ç«¯å¼€å‘
- ç§»åŠ¨ç«¯å°ç¨‹åºå¼€å‘
- æ–½å·¥å‘˜ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘
- ç½—è±å¥½ä¼™ä¼´ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘
- ç§»åŠ¨ç«¯ä¸åç«¯é›†æˆ

#### ç¬¬13-14å‘¨ï¼šç³»ç»Ÿé›†æˆä¸ä¼˜åŒ–
- æœåŠ¡å•†ç³»ç»Ÿé›†æˆæµ‹è¯•
- ç§»åŠ¨ç«¯åŠŸèƒ½æµ‹è¯•
- ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–
- éƒ¨ç½²å’Œä¸Šçº¿

### é˜¶æ®µä¸‰ï¼šæ•°æ®æ™ºèƒ½ä¼˜åŒ– - 4å‘¨

#### ç¬¬15-16å‘¨ï¼šæ•°æ®åˆ†æç³»ç»Ÿ
- æ•°æ®åˆ†ææœåŠ¡å¼€å‘
- æŠ¥è¡¨ç³»ç»Ÿå¼€å‘
- æ•°æ®å¯è§†åŒ–å¼€å‘
- ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

#### ç¬¬17-18å‘¨ï¼šæ™ºèƒ½åŒ–åŠŸèƒ½
- AIè¾…åŠ©é”€å”®å†³ç­–
- æ™ºèƒ½é¢„è­¦ç³»ç»Ÿ
- æ™ºèƒ½æ¨èç³»ç»Ÿ
- ç³»ç»Ÿä¼˜åŒ–å’Œä¸Šçº¿

### é˜¶æ®µå››ï¼šç”Ÿæ€æ•´åˆæˆç†Ÿ - æŒç»­è¿­ä»£

#### å¤–éƒ¨ç³»ç»Ÿå¯¹æ¥
- VSSç³»ç»Ÿå¯¹æ¥
- è´¢åŠ¡ç³»ç»Ÿå¯¹æ¥
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- å¼€æ”¾APIå¹³å°

#### æŒç»­ä¼˜åŒ–
- æ€§èƒ½ä¼˜åŒ–
- åŠŸèƒ½æ‰©å±•
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æŠ€æœ¯æ¶æ„å‡çº§

---

## ğŸ“Š æ€»ç»“

æœ¬æŠ€æœ¯æ¶æ„è®¾è®¡æ–¹æ¡ˆåŸºäºç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿçš„ä¸šåŠ¡éœ€æ±‚å’Œæœªæ¥æ‰©å±•éœ€æ±‚ï¼Œé‡‡ç”¨æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„æ¶æ„è®¾è®¡ï¼Œæ”¯æŒæ¸è¿›å¼å¾®æœåŠ¡æ¼”è¿›ã€‚æ–¹æ¡ˆé€‰æ‹©äº†ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬Next.jsã€NestJSã€PostgreSQLã€Redisç­‰ï¼Œç¡®ä¿ç³»ç»Ÿçš„æ€§èƒ½ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ã€å¾®æœåŠ¡æ¶æ„ã€åˆ†å¸ƒå¼å­˜å‚¨ã€å®¹å™¨åŒ–éƒ¨ç½²ç­‰æŠ€æœ¯æ‰‹æ®µï¼Œç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒä¸šåŠ¡è§„æ¨¡æ‰©å¤§å’ŒåŠŸèƒ½æ¨¡å—å¢åŠ ï¼Œæ»¡è¶³æœªæ¥ä¸šåŠ¡å˜åŒ–çš„éœ€æ±‚ã€‚åŒæ—¶ï¼Œé€šè¿‡å®‰å…¨æ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡ã€è¿ç»´ç›‘æ§è®¾è®¡ç­‰ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§ã€æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

è¯¥æ¶æ„æ–¹æ¡ˆä¸ä»…æ»¡è¶³å½“å‰MVPé˜¶æ®µçš„å¼€å‘éœ€æ±‚ï¼Œä¹Ÿä¸ºæœªæ¥çš„ç³»ç»Ÿæ‰©å±•å’Œä¼˜åŒ–æä¾›äº†åšå®çš„åŸºç¡€ï¼Œæ”¯æŒç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿæˆä¸ºå®¶å±…è½¯è£…è¡Œä¸šæ•°å­—åŒ–è½¬å‹çš„æ ‡æ†é¡¹ç›®ã€‚
