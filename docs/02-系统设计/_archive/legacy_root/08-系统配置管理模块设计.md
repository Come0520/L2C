# ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ - ç³»ç»Ÿé…ç½®ç®¡ç†æ¨¡å—è®¾è®¡

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**é¡¹ç›®åç§°ï¼š** ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿé…ç½®ç®¡ç†æ¨¡å—  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2024å¹´  
**è®¾è®¡ç›®æ ‡ï¼š** æ„å»ºçµæ´»ã€å®‰å…¨ã€æ˜“ç”¨çš„ç³»ç»Ÿé…ç½®ç®¡ç†å¹³å°ï¼Œæ”¯æŒåŠ¨æ€é…ç½®å’Œå¤šç¯å¢ƒç®¡ç†  

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### 1. æ¨¡å—ç›®æ ‡
- **é…ç½®é›†ä¸­ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†ç³»ç»Ÿæ‰€æœ‰é…ç½®å‚æ•°
- **åŠ¨æ€é…ç½®æ›´æ–°**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°ï¼Œæ— éœ€é‡å¯ç³»ç»Ÿ
- **å¤šç¯å¢ƒæ”¯æŒ**ï¼šæ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰å¤šç¯å¢ƒé…ç½®
- **é…ç½®ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®å˜æ›´å†å²è®°å½•å’Œç‰ˆæœ¬å›æ»š
- **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„é…ç½®è®¿é—®å’Œä¿®æ”¹æƒé™
- **é…ç½®éªŒè¯**ï¼šé…ç½®å‚æ•°æ ¼å¼éªŒè¯å’Œä¾èµ–æ£€æŸ¥

### 2. é…ç½®åˆ†ç±»
- **ç³»ç»Ÿé…ç½®**ï¼šç³»ç»ŸåŸºç¡€å‚æ•°ã€æ•°æ®åº“è¿æ¥ã€ç¼“å­˜é…ç½®ç­‰
- **ä¸šåŠ¡é…ç½®**ï¼šä¸šåŠ¡è§„åˆ™ã€æµç¨‹å‚æ•°ã€è®¡ç®—å…¬å¼ç­‰
- **ç•Œé¢é…ç½®**ï¼šå‰ç«¯ç•Œé¢æ˜¾ç¤ºã€ä¸»é¢˜ã€å¸ƒå±€ç­‰é…ç½®
- **é›†æˆé…ç½®**ï¼šç¬¬ä¸‰æ–¹æœåŠ¡æ¥å£ã€APIå¯†é’¥ç­‰é…ç½®
- **å®‰å…¨é…ç½®**ï¼šå®‰å…¨ç­–ç•¥ã€åŠ å¯†å‚æ•°ã€è®¿é—®æ§åˆ¶ç­‰

---

## ğŸ—ï¸ æ•°æ®åº“è®¾è®¡

### 1. é…ç½®ç®¡ç†è¡¨

#### 1.1 config_categoriesï¼ˆé…ç½®åˆ†ç±»è¡¨ï¼‰
```sql
CREATE TABLE config_categories (
  id BIGSERIAL PRIMARY KEY,
  category_code VARCHAR(50) UNIQUE NOT NULL COMMENT 'åˆ†ç±»ç¼–ç ',
  category_name VARCHAR(100) NOT NULL COMMENT 'åˆ†ç±»åç§°',
  parent_id BIGINT COMMENT 'çˆ¶åˆ†ç±»ID',
  description TEXT COMMENT 'åˆ†ç±»æè¿°',
  icon VARCHAR(100) COMMENT 'å›¾æ ‡',
  sort_order INTEGER DEFAULT 0 COMMENT 'æ’åº',
  is_system BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç³»ç»Ÿåˆ†ç±»',
  is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (parent_id) REFERENCES config_categories(id),
  INDEX idx_category_code (category_code),
  INDEX idx_parent_id (parent_id),
  INDEX idx_sort_order (sort_order),
  INDEX idx_is_active (is_active)
) COMMENT 'é…ç½®åˆ†ç±»è¡¨';
```

#### 1.2 config_itemsï¼ˆé…ç½®é¡¹è¡¨ï¼‰
```sql
CREATE TABLE config_items (
  id BIGSERIAL PRIMARY KEY,
  config_key VARCHAR(100) UNIQUE NOT NULL COMMENT 'é…ç½®é”®',
  config_name VARCHAR(200) NOT NULL COMMENT 'é…ç½®åç§°',
  category_id BIGINT NOT NULL COMMENT 'åˆ†ç±»ID',
  config_type ENUM('string', 'number', 'boolean', 'json', 'array', 'file', 'password') NOT NULL COMMENT 'é…ç½®ç±»å‹',
  config_value TEXT COMMENT 'é…ç½®å€¼',
  default_value TEXT COMMENT 'é»˜è®¤å€¼',
  description TEXT COMMENT 'é…ç½®æè¿°',
  validation_rule JSON COMMENT 'éªŒè¯è§„åˆ™',
  options JSON COMMENT 'é€‰é¡¹é…ç½®ï¼ˆä¸‹æ‹‰æ¡†ç­‰ï¼‰',
  is_required BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å¿…å¡«',
  is_encrypted BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åŠ å¯†å­˜å‚¨',
  is_system BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç³»ç»Ÿé…ç½®',
  is_readonly BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åªè¯»',
  is_visible BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯è§',
  environment VARCHAR(20) DEFAULT 'all' COMMENT 'ç¯å¢ƒï¼ˆall/dev/test/prodï¼‰',
  sort_order INTEGER DEFAULT 0 COMMENT 'æ’åº',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (category_id) REFERENCES config_categories(id),
  INDEX idx_config_key (config_key),
  INDEX idx_category_id (category_id),
  INDEX idx_config_type (config_type),
  INDEX idx_environment (environment),
  INDEX idx_is_system (is_system),
  INDEX idx_sort_order (sort_order)
) COMMENT 'é…ç½®é¡¹è¡¨';
```

#### 1.3 config_historyï¼ˆé…ç½®å†å²è¡¨ï¼‰
```sql
CREATE TABLE config_history (
  id BIGSERIAL PRIMARY KEY,
  config_id BIGINT NOT NULL COMMENT 'é…ç½®é¡¹ID',
  old_value TEXT COMMENT 'æ—§å€¼',
  new_value TEXT COMMENT 'æ–°å€¼',
  change_type ENUM('create', 'update', 'delete') NOT NULL COMMENT 'å˜æ›´ç±»å‹',
  change_reason VARCHAR(500) COMMENT 'å˜æ›´åŸå› ',
  operator_id BIGINT COMMENT 'æ“ä½œäººID',
  operator_name VARCHAR(100) COMMENT 'æ“ä½œäººå§“å',
  operator_ip VARCHAR(45) COMMENT 'æ“ä½œIP',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (config_id) REFERENCES config_items(id),
  INDEX idx_config_id (config_id),
  INDEX idx_change_type (change_type),
  INDEX idx_operator_id (operator_id),
  INDEX idx_created_at (created_at)
) COMMENT 'é…ç½®å†å²è¡¨';
```

#### 1.4 config_environmentsï¼ˆç¯å¢ƒé…ç½®è¡¨ï¼‰
```sql
CREATE TABLE config_environments (
  id BIGSERIAL PRIMARY KEY,
  env_code VARCHAR(20) UNIQUE NOT NULL COMMENT 'ç¯å¢ƒç¼–ç ',
  env_name VARCHAR(50) NOT NULL COMMENT 'ç¯å¢ƒåç§°',
  description TEXT COMMENT 'ç¯å¢ƒæè¿°',
  is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
  sort_order INTEGER DEFAULT 0 COMMENT 'æ’åº',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_env_code (env_code),
  INDEX idx_is_active (is_active),
  INDEX idx_sort_order (sort_order)
) COMMENT 'ç¯å¢ƒé…ç½®è¡¨';
```

#### 1.5 config_permissionsï¼ˆé…ç½®æƒé™è¡¨ï¼‰
```sql
CREATE TABLE config_permissions (
  id BIGSERIAL PRIMARY KEY,
  config_id BIGINT NOT NULL COMMENT 'é…ç½®é¡¹ID',
  role_id BIGINT COMMENT 'è§’è‰²ID',
  user_id BIGINT COMMENT 'ç”¨æˆ·ID',
  permission_type ENUM('read', 'write', 'admin') NOT NULL COMMENT 'æƒé™ç±»å‹',
  granted_by BIGINT COMMENT 'æˆæƒäººID',
  granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP COMMENT 'è¿‡æœŸæ—¶é—´',
  
  FOREIGN KEY (config_id) REFERENCES config_items(id),
  INDEX idx_config_id (config_id),
  INDEX idx_role_id (role_id),
  INDEX idx_user_id (user_id),
  INDEX idx_permission_type (permission_type),
  INDEX idx_expires_at (expires_at)
) COMMENT 'é…ç½®æƒé™è¡¨';
```

#### 1.6 config_templatesï¼ˆé…ç½®æ¨¡æ¿è¡¨ï¼‰
```sql
CREATE TABLE config_templates (
  id BIGSERIAL PRIMARY KEY,
  template_name VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
  template_type ENUM('system', 'business', 'integration') NOT NULL COMMENT 'æ¨¡æ¿ç±»å‹',
  description TEXT COMMENT 'æ¨¡æ¿æè¿°',
  template_data JSON NOT NULL COMMENT 'æ¨¡æ¿æ•°æ®',
  is_active BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
  creator_id BIGINT COMMENT 'åˆ›å»ºäººID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_template_type (template_type),
  INDEX idx_is_active (is_active),
  INDEX idx_creator_id (creator_id)
) COMMENT 'é…ç½®æ¨¡æ¿è¡¨';
```

#### 1.7 config_cacheï¼ˆé…ç½®ç¼“å­˜è¡¨ï¼‰
```sql
CREATE TABLE config_cache (
  id BIGSERIAL PRIMARY KEY,
  cache_key VARCHAR(200) UNIQUE NOT NULL COMMENT 'ç¼“å­˜é”®',
  cache_value TEXT NOT NULL COMMENT 'ç¼“å­˜å€¼',
  environment VARCHAR(20) NOT NULL COMMENT 'ç¯å¢ƒ',
  version_hash VARCHAR(64) NOT NULL COMMENT 'ç‰ˆæœ¬å“ˆå¸Œ',
  expires_at TIMESTAMP NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_cache_key (cache_key),
  INDEX idx_environment (environment),
  INDEX idx_expires_at (expires_at)
) COMMENT 'é…ç½®ç¼“å­˜è¡¨';
```

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### 1. é…ç½®åˆ†ç±»ç®¡ç†

#### 1.1 åˆ›å»ºé…ç½®åˆ†ç±»
```http
POST /v1/config/categories
Content-Type: application/json
Authorization: Bearer {token}

{
  "category_name": "æ•°æ®åº“é…ç½®",
  "category_code": "database",
  "parent_id": null,
  "description": "æ•°æ®åº“è¿æ¥å’Œé…ç½®å‚æ•°",
  "icon": "database",
  "sort_order": 1
}
```

#### 1.2 è·å–é…ç½®åˆ†ç±»æ ‘
```http
GET /v1/config/categories/tree?include_inactive=false
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "category_code": "system",
      "category_name": "ç³»ç»Ÿé…ç½®",
      "description": "ç³»ç»ŸåŸºç¡€é…ç½®",
      "icon": "settings",
      "sort_order": 1,
      "is_system": true,
      "children": [
        {
          "id": 2,
          "category_code": "database",
          "category_name": "æ•°æ®åº“é…ç½®",
          "description": "æ•°æ®åº“è¿æ¥é…ç½®",
          "icon": "database",
          "sort_order": 1,
          "children": []
        }
      ]
    }
  ]
}
```

### 2. é…ç½®é¡¹ç®¡ç†

#### 2.1 åˆ›å»ºé…ç½®é¡¹
```http
POST /v1/config/items
Content-Type: application/json
Authorization: Bearer {token}

{
  "config_key": "database.host",
  "config_name": "æ•°æ®åº“ä¸»æœºåœ°å€",
  "category_id": 2,
  "config_type": "string",
  "config_value": "localhost",
  "default_value": "localhost",
  "description": "æ•°æ®åº“æœåŠ¡å™¨ä¸»æœºåœ°å€",
  "validation_rule": {
    "required": true,
    "pattern": "^[a-zA-Z0-9.-]+$",
    "min_length": 1,
    "max_length": 255
  },
  "is_required": true,
  "environment": "all"
}
```

#### 2.2 è·å–é…ç½®é¡¹åˆ—è¡¨
```http
GET /v1/config/items?category_id=2&environment=prod&page=1&page_size=20&search=database
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "config_key": "database.host",
        "config_name": "æ•°æ®åº“ä¸»æœºåœ°å€",
        "category_name": "æ•°æ®åº“é…ç½®",
        "config_type": "string",
        "config_value": "localhost",
        "default_value": "localhost",
        "description": "æ•°æ®åº“æœåŠ¡å™¨ä¸»æœºåœ°å€",
        "is_required": true,
        "is_encrypted": false,
        "is_system": true,
        "is_readonly": false,
        "environment": "all",
        "updated_at": "2024-01-01T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "page_size": 20,
      "total": 1,
      "total_pages": 1
    }
  }
}
```

#### 2.3 æ›´æ–°é…ç½®é¡¹
```http
PUT /v1/config/items/{config_id}
Content-Type: application/json
Authorization: Bearer {token}

{
  "config_value": "192.168.1.100",
  "change_reason": "æ›´æ–°æ•°æ®åº“æœåŠ¡å™¨åœ°å€"
}
```

#### 2.4 æ‰¹é‡æ›´æ–°é…ç½®
```http
PUT /v1/config/items/batch
Content-Type: application/json
Authorization: Bearer {token}

{
  "items": [
    {
      "config_key": "database.host",
      "config_value": "192.168.1.100"
    },
    {
      "config_key": "database.port",
      "config_value": "3306"
    }
  ],
  "change_reason": "æ‰¹é‡æ›´æ–°æ•°æ®åº“é…ç½®"
}
```

### 3. é…ç½®è·å–æ¥å£

#### 3.1 è·å–å•ä¸ªé…ç½®
```http
GET /v1/config/items/{config_key}/value?environment=prod
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "config_key": "database.host",
    "config_value": "192.168.1.100",
    "config_type": "string",
    "last_updated": "2024-01-01T10:30:00Z"
  }
}
```

#### 3.2 æ‰¹é‡è·å–é…ç½®
```http
POST /v1/config/items/batch-get
Content-Type: application/json
Authorization: Bearer {token}

{
  "config_keys": ["database.host", "database.port", "database.name"],
  "environment": "prod"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "database.host": "192.168.1.100",
    "database.port": "3306",
    "database.name": "l2c_prod"
  }
}
```

#### 3.3 è·å–åˆ†ç±»ä¸‹æ‰€æœ‰é…ç½®
```http
GET /v1/config/categories/{category_id}/items?environment=prod&include_children=true
Authorization: Bearer {token}
```

### 4. é…ç½®å†å²ç®¡ç†

#### 4.1 è·å–é…ç½®å˜æ›´å†å²
```http
GET /v1/config/items/{config_id}/history?page=1&page_size=20&start_date=2024-01-01&end_date=2024-01-31
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "old_value": "localhost",
        "new_value": "192.168.1.100",
        "change_type": "update",
        "change_reason": "æ›´æ–°æ•°æ®åº“æœåŠ¡å™¨åœ°å€",
        "operator_name": "å¼ ä¸‰",
        "operator_ip": "192.168.1.50",
        "created_at": "2024-01-01T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "page_size": 20,
      "total": 1,
      "total_pages": 1
    }
  }
}
```

#### 4.2 é…ç½®å›æ»š
```http
POST /v1/config/items/{config_id}/rollback
Content-Type: application/json
Authorization: Bearer {token}

{
  "history_id": 1,
  "change_reason": "å›æ»šåˆ°ä¹‹å‰çš„é…ç½®"
}
```

### 5. é…ç½®æ¨¡æ¿ç®¡ç†

#### 5.1 åˆ›å»ºé…ç½®æ¨¡æ¿
```http
POST /v1/config/templates
Content-Type: application/json
Authorization: Bearer {token}

{
  "template_name": "æ ‡å‡†æ•°æ®åº“é…ç½®æ¨¡æ¿",
  "template_type": "system",
  "description": "æ ‡å‡†çš„æ•°æ®åº“è¿æ¥é…ç½®æ¨¡æ¿",
  "template_data": {
    "categories": [
      {
        "category_code": "database",
        "category_name": "æ•°æ®åº“é…ç½®",
        "items": [
          {
            "config_key": "database.host",
            "config_name": "æ•°æ®åº“ä¸»æœº",
            "config_type": "string",
            "default_value": "localhost",
            "is_required": true
          },
          {
            "config_key": "database.port",
            "config_name": "æ•°æ®åº“ç«¯å£",
            "config_type": "number",
            "default_value": "3306",
            "is_required": true
          }
        ]
      }
    ]
  }
}
```

#### 5.2 åº”ç”¨é…ç½®æ¨¡æ¿
```http
POST /v1/config/templates/{template_id}/apply
Content-Type: application/json
Authorization: Bearer {token}

{
  "environment": "dev",
  "override_existing": false,
  "value_mappings": {
    "database.host": "dev-db.example.com",
    "database.port": "3306"
  }
}
```

### 6. é…ç½®å¯¼å…¥å¯¼å‡º

#### 6.1 å¯¼å‡ºé…ç½®
```http
POST /v1/config/export
Content-Type: application/json
Authorization: Bearer {token}

{
  "category_ids": [1, 2],
  "environment": "prod",
  "format": "json",
  "include_sensitive": false
}
```

#### 6.2 å¯¼å…¥é…ç½®
```http
POST /v1/config/import
Content-Type: multipart/form-data
Authorization: Bearer {token}

file: config_export.json
environment: dev
merge_strategy: override
```

---

## ğŸ¢ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### 1. é…ç½®ç®¡ç†æœåŠ¡

```typescript
// config-management.service.ts
export class ConfigManagementService {
  constructor(
    private readonly configRepository: Repository<ConfigItem>,
    private readonly historyRepository: Repository<ConfigHistory>,
    private readonly cacheService: CacheService,
    private readonly encryptionService: EncryptionService,
    private readonly validationService: ValidationService,
    private readonly eventBus: EventBus
  ) {}

  // è·å–é…ç½®å€¼
  async getConfigValue(
    configKey: string,
    environment: string = 'all'
  ): Promise<any> {
    // 1. æ£€æŸ¥ç¼“å­˜
    const cacheKey = `config:${environment}:${configKey}`;
    const cachedValue = await this.cacheService.get(cacheKey);
    
    if (cachedValue !== null) {
      return this.deserializeValue(cachedValue);
    }
    
    // 2. ä»æ•°æ®åº“è·å–
    const config = await this.configRepository.findOne({
      where: [
        { config_key: configKey, environment },
        { config_key: configKey, environment: 'all' }
      ],
      order: { environment: 'DESC' } // ä¼˜å…ˆä½¿ç”¨ç‰¹å®šç¯å¢ƒçš„é…ç½®
    });
    
    if (!config) {
      throw new NotFoundException(`é…ç½®é¡¹ä¸å­˜åœ¨: ${configKey}`);
    }
    
    // 3. è§£å¯†æ•æ„Ÿé…ç½®
    let value = config.config_value;
    if (config.is_encrypted && value) {
      value = await this.encryptionService.decrypt(value);
    }
    
    // 4. ç±»å‹è½¬æ¢
    const typedValue = this.convertValueByType(value, config.config_type);
    
    // 5. ç¼“å­˜ç»“æœ
    await this.cacheService.set(cacheKey, typedValue, 300); // ç¼“å­˜5åˆ†é’Ÿ
    
    return typedValue;
  }

  // æ‰¹é‡è·å–é…ç½®
  async getBatchConfigs(
    configKeys: string[],
    environment: string = 'all'
  ): Promise<Record<string, any>> {
    const result: Record<string, any> = {};
    
    // 1. æ£€æŸ¥ç¼“å­˜
    const cacheKeys = configKeys.map(key => `config:${environment}:${key}`);
    const cachedValues = await this.cacheService.mget(cacheKeys);
    
    const uncachedKeys: string[] = [];
    configKeys.forEach((key, index) => {
      if (cachedValues[index] !== null) {
        result[key] = this.deserializeValue(cachedValues[index]);
      } else {
        uncachedKeys.push(key);
      }
    });
    
    // 2. è·å–æœªç¼“å­˜çš„é…ç½®
    if (uncachedKeys.length > 0) {
      const configs = await this.configRepository.find({
        where: uncachedKeys.map(key => [
          { config_key: key, environment },
          { config_key: key, environment: 'all' }
        ]).flat()
      });
      
      // 3. å¤„ç†é…ç½®å€¼
      for (const config of configs) {
        if (!result[config.config_key]) {
          let value = config.config_value;
          
          // è§£å¯†
          if (config.is_encrypted && value) {
            value = await this.encryptionService.decrypt(value);
          }
          
          // ç±»å‹è½¬æ¢
          const typedValue = this.convertValueByType(value, config.config_type);
          result[config.config_key] = typedValue;
          
          // ç¼“å­˜
          const cacheKey = `config:${environment}:${config.config_key}`;
          await this.cacheService.set(cacheKey, typedValue, 300);
        }
      }
    }
    
    return result;
  }

  // æ›´æ–°é…ç½®å€¼
  async updateConfigValue(
    configKey: string,
    newValue: any,
    operatorId: number,
    changeReason?: string,
    environment?: string
  ): Promise<void> {
    // 1. è·å–é…ç½®é¡¹
    const config = await this.configRepository.findOne({
      where: { config_key: configKey }
    });
    
    if (!config) {
      throw new NotFoundException(`é…ç½®é¡¹ä¸å­˜åœ¨: ${configKey}`);
    }
    
    // 2. æƒé™æ£€æŸ¥
    await this.checkUpdatePermission(config.id, operatorId);
    
    // 3. éªŒè¯æ–°å€¼
    await this.validateConfigValue(config, newValue);
    
    // 4. è®°å½•å†å²
    const oldValue = config.config_value;
    await this.recordConfigHistory(
      config.id,
      oldValue,
      newValue,
      'update',
      operatorId,
      changeReason
    );
    
    // 5. åŠ å¯†æ•æ„Ÿé…ç½®
    let valueToStore = newValue;
    if (config.is_encrypted && newValue) {
      valueToStore = await this.encryptionService.encrypt(String(newValue));
    }
    
    // 6. æ›´æ–°é…ç½®
    await this.configRepository.update(config.id, {
      config_value: valueToStore,
      updated_at: new Date()
    });
    
    // 7. æ¸…é™¤ç¼“å­˜
    await this.clearConfigCache(configKey, environment);
    
    // 8. å‘å¸ƒé…ç½®å˜æ›´äº‹ä»¶
    await this.eventBus.publish('config.updated', {
      config_key: configKey,
      old_value: oldValue,
      new_value: newValue,
      operator_id: operatorId,
      environment
    });
  }

  // æ‰¹é‡æ›´æ–°é…ç½®
  async updateBatchConfigs(
    updates: Array<{
      config_key: string;
      config_value: any;
    }>,
    operatorId: number,
    changeReason?: string,
    environment?: string
  ): Promise<void> {
    const transaction = await this.configRepository.manager.transaction(
      async (manager) => {
        for (const update of updates) {
          await this.updateConfigValueInTransaction(
            manager,
            update.config_key,
            update.config_value,
            operatorId,
            changeReason,
            environment
          );
        }
      }
    );
    
    // æ‰¹é‡æ¸…é™¤ç¼“å­˜
    const cacheKeys = updates.map(update => 
      `config:${environment || 'all'}:${update.config_key}`
    );
    await this.cacheService.del(cacheKeys);
    
    // å‘å¸ƒæ‰¹é‡æ›´æ–°äº‹ä»¶
    await this.eventBus.publish('config.batch_updated', {
      updates,
      operator_id: operatorId,
      environment
    });
  }

  // é…ç½®éªŒè¯
  private async validateConfigValue(
    config: ConfigItem,
    value: any
  ): Promise<void> {
    // 1. å¿…å¡«éªŒè¯
    if (config.is_required && (value === null || value === undefined || value === '')) {
      throw new BadRequestException(`é…ç½®é¡¹ ${config.config_key} ä¸ºå¿…å¡«é¡¹`);
    }
    
    // 2. ç±»å‹éªŒè¯
    if (!this.validateValueType(value, config.config_type)) {
      throw new BadRequestException(`é…ç½®é¡¹ ${config.config_key} ç±»å‹ä¸åŒ¹é…`);
    }
    
    // 3. è‡ªå®šä¹‰éªŒè¯è§„åˆ™
    if (config.validation_rule) {
      await this.validationService.validate(value, config.validation_rule);
    }
    
    // 4. ä¾èµ–éªŒè¯
    await this.validateConfigDependencies(config.config_key, value);
  }

  // ç±»å‹è½¬æ¢
  private convertValueByType(value: string, type: string): any {
    if (value === null || value === undefined) {
      return null;
    }
    
    switch (type) {
      case 'boolean':
        return value === 'true' || value === '1';
      
      case 'number':
        const num = Number(value);
        if (isNaN(num)) {
          throw new Error(`æ— æ³•å°† "${value}" è½¬æ¢ä¸ºæ•°å­—`);
        }
        return num;
      
      case 'json':
        try {
          return JSON.parse(value);
        } catch (error) {
          throw new Error(`æ— æ³•è§£æJSON: ${value}`);
        }
      
      case 'array':
        try {
          const parsed = JSON.parse(value);
          if (!Array.isArray(parsed)) {
            throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„æ•°ç»„æ ¼å¼');
          }
          return parsed;
        } catch (error) {
          throw new Error(`æ— æ³•è§£ææ•°ç»„: ${value}`);
        }
      
      default:
        return value;
    }
  }

  // æ¸…é™¤é…ç½®ç¼“å­˜
  private async clearConfigCache(
    configKey: string,
    environment?: string
  ): Promise<void> {
    const patterns = [
      `config:all:${configKey}`,
      `config:${environment || '*'}:${configKey}`
    ];
    
    for (const pattern of patterns) {
      await this.cacheService.del(pattern);
    }
  }

  // è®°å½•é…ç½®å†å²
  private async recordConfigHistory(
    configId: number,
    oldValue: string,
    newValue: any,
    changeType: string,
    operatorId: number,
    changeReason?: string
  ): Promise<void> {
    const history = this.historyRepository.create({
      config_id: configId,
      old_value: oldValue,
      new_value: String(newValue),
      change_type: changeType,
      change_reason: changeReason,
      operator_id: operatorId
    });
    
    await this.historyRepository.save(history);
  }
}
```

### 2. é…ç½®ç¼“å­˜æœåŠ¡

```typescript
// config-cache.service.ts
export class ConfigCacheService {
  constructor(
    private readonly redisService: RedisService,
    private readonly configRepository: Repository<ConfigItem>,
    private readonly cacheRepository: Repository<ConfigCache>
  ) {}

  // é¢„çƒ­é…ç½®ç¼“å­˜
  async warmupCache(environment: string): Promise<void> {
    console.log(`å¼€å§‹é¢„çƒ­ç¯å¢ƒ ${environment} çš„é…ç½®ç¼“å­˜`);
    
    // 1. è·å–æ‰€æœ‰é…ç½®
    const configs = await this.configRepository.find({
      where: [
        { environment },
        { environment: 'all' }
      ]
    });
    
    // 2. æ‰¹é‡è®¾ç½®ç¼“å­˜
    const pipeline = this.redisService.pipeline();
    
    for (const config of configs) {
      const cacheKey = `config:${environment}:${config.config_key}`;
      let value = config.config_value;
      
      // å¤„ç†åŠ å¯†é…ç½®
      if (config.is_encrypted && value) {
        // åŠ å¯†é…ç½®ä¸ç¼“å­˜æ˜æ–‡ï¼Œåªç¼“å­˜æ ‡è¯†
        value = '__ENCRYPTED__';
      }
      
      pipeline.setex(cacheKey, 3600, JSON.stringify({
        value,
        type: config.config_type,
        encrypted: config.is_encrypted
      }));
    }
    
    await pipeline.exec();
    
    // 3. æ›´æ–°ç¼“å­˜ç‰ˆæœ¬
    await this.updateCacheVersion(environment);
    
    console.log(`ç¯å¢ƒ ${environment} é…ç½®ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œå…± ${configs.length} ä¸ªé…ç½®é¡¹`);
  }

  // è·å–ç¼“å­˜ç‰ˆæœ¬
  async getCacheVersion(environment: string): Promise<string> {
    const version = await this.redisService.get(`config:version:${environment}`);
    return version || '0';
  }

  // æ›´æ–°ç¼“å­˜ç‰ˆæœ¬
  async updateCacheVersion(environment: string): Promise<string> {
    const version = Date.now().toString();
    await this.redisService.set(`config:version:${environment}`, version);
    return version;
  }

  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
  async isCacheValid(environment: string): Promise<boolean> {
    const cacheVersion = await this.getCacheVersion(environment);
    const dbVersion = await this.getDbVersion(environment);
    
    return cacheVersion === dbVersion;
  }

  // è·å–æ•°æ®åº“ç‰ˆæœ¬
  private async getDbVersion(environment: string): Promise<string> {
    const result = await this.configRepository
      .createQueryBuilder('config')
      .select('MAX(config.updated_at)', 'max_updated')
      .where('config.environment = :env OR config.environment = :all', {
        env: environment,
        all: 'all'
      })
      .getRawOne();
    
    return result.max_updated ? new Date(result.max_updated).getTime().toString() : '0';
  }

  // æ¸…é™¤ç¯å¢ƒç¼“å­˜
  async clearEnvironmentCache(environment: string): Promise<void> {
    const pattern = `config:${environment}:*`;
    const keys = await this.redisService.keys(pattern);
    
    if (keys.length > 0) {
      await this.redisService.del(keys);
    }
    
    await this.redisService.del(`config:version:${environment}`);
  }

  // é…ç½®å˜æ›´é€šçŸ¥
  async notifyConfigChange(
    configKey: string,
    environment: string,
    newValue: any
  ): Promise<void> {
    // 1. æ›´æ–°æœ¬åœ°ç¼“å­˜
    const cacheKey = `config:${environment}:${configKey}`;
    await this.redisService.setex(cacheKey, 3600, JSON.stringify({
      value: newValue,
      updated_at: new Date().toISOString()
    }));
    
    // 2. å‘å¸ƒå˜æ›´é€šçŸ¥
    await this.redisService.publish('config:change', JSON.stringify({
      config_key: configKey,
      environment,
      new_value: newValue,
      timestamp: Date.now()
    }));
    
    // 3. æ›´æ–°ç‰ˆæœ¬å·
    await this.updateCacheVersion(environment);
  }

  // ç›‘å¬é…ç½®å˜æ›´
  async subscribeConfigChanges(
    callback: (change: ConfigChangeEvent) => void
  ): Promise<void> {
    await this.redisService.subscribe('config:change', (message) => {
      try {
        const change = JSON.parse(message);
        callback(change);
      } catch (error) {
        console.error('è§£æé…ç½®å˜æ›´æ¶ˆæ¯å¤±è´¥:', error);
      }
    });
  }
}
```

### 3. é…ç½®æ¨¡æ¿æœåŠ¡

```typescript
// config-template.service.ts
export class ConfigTemplateService {
  constructor(
    private readonly templateRepository: Repository<ConfigTemplate>,
    private readonly configService: ConfigManagementService,
    private readonly categoryService: ConfigCategoryService
  ) {}

  // åº”ç”¨é…ç½®æ¨¡æ¿
  async applyTemplate(
    templateId: number,
    options: ApplyTemplateOptions
  ): Promise<ApplyTemplateResult> {
    // 1. è·å–æ¨¡æ¿
    const template = await this.templateRepository.findOne({
      where: { id: templateId, is_active: true }
    });
    
    if (!template) {
      throw new NotFoundException('é…ç½®æ¨¡æ¿ä¸å­˜åœ¨');
    }
    
    const result: ApplyTemplateResult = {
      created: [],
      updated: [],
      skipped: [],
      errors: []
    };
    
    try {
      // 2. è§£ææ¨¡æ¿æ•°æ®
      const templateData = template.template_data;
      
      // 3. åˆ›å»ºåˆ†ç±»
      if (templateData.categories) {
        for (const categoryData of templateData.categories) {
          await this.createCategoryIfNotExists(categoryData);
        }
      }
      
      // 4. åˆ›å»ºé…ç½®é¡¹
      if (templateData.categories) {
        for (const categoryData of templateData.categories) {
          if (categoryData.items) {
            for (const itemData of categoryData.items) {
              try {
                await this.createConfigItemFromTemplate(
                  itemData,
                  categoryData.category_code,
                  options,
                  result
                );
              } catch (error) {
                result.errors.push({
                  config_key: itemData.config_key,
                  error: error.message
                });
              }
            }
          }
        }
      }
      
      return result;
      
    } catch (error) {
      throw new Error(`åº”ç”¨æ¨¡æ¿å¤±è´¥: ${error.message}`);
    }
  }

  // ä»ç°æœ‰é…ç½®åˆ›å»ºæ¨¡æ¿
  async createTemplateFromConfigs(
    templateName: string,
    templateType: string,
    categoryIds: number[],
    description?: string
  ): Promise<ConfigTemplate> {
    // 1. è·å–åˆ†ç±»å’Œé…ç½®é¡¹
    const categories = await this.categoryService.getCategoriesWithItems(categoryIds);
    
    // 2. æ„å»ºæ¨¡æ¿æ•°æ®
    const templateData = {
      categories: categories.map(category => ({
        category_code: category.category_code,
        category_name: category.category_name,
        description: category.description,
        items: category.items.map(item => ({
          config_key: item.config_key,
          config_name: item.config_name,
          config_type: item.config_type,
          default_value: item.default_value,
          description: item.description,
          validation_rule: item.validation_rule,
          options: item.options,
          is_required: item.is_required,
          is_encrypted: item.is_encrypted
        }))
      }))
    };
    
    // 3. åˆ›å»ºæ¨¡æ¿
    const template = this.templateRepository.create({
      template_name: templateName,
      template_type: templateType,
      description,
      template_data: templateData
    });
    
    return await this.templateRepository.save(template);
  }

  // å¯¼å‡ºé…ç½®ä¸ºæ¨¡æ¿
  async exportConfigsAsTemplate(
    exportOptions: ExportTemplateOptions
  ): Promise<ConfigTemplateExport> {
    const { category_ids, environment, include_values, include_sensitive } = exportOptions;
    
    // 1. è·å–é…ç½®æ•°æ®
    const categories = await this.categoryService.getCategoriesWithItems(
      category_ids,
      environment
    );
    
    // 2. è¿‡æ»¤æ•æ„Ÿé…ç½®
    if (!include_sensitive) {
      categories.forEach(category => {
        category.items = category.items.filter(item => !item.is_encrypted);
      });
    }
    
    // 3. æ„å»ºå¯¼å‡ºæ•°æ®
    const exportData: ConfigTemplateExport = {
      export_info: {
        exported_at: new Date().toISOString(),
        environment,
        include_values,
        include_sensitive
      },
      categories: categories.map(category => ({
        category_code: category.category_code,
        category_name: category.category_name,
        description: category.description,
        items: category.items.map(item => ({
          config_key: item.config_key,
          config_name: item.config_name,
          config_type: item.config_type,
          config_value: include_values ? item.config_value : undefined,
          default_value: item.default_value,
          description: item.description,
          validation_rule: item.validation_rule,
          options: item.options,
          is_required: item.is_required,
          is_encrypted: item.is_encrypted,
          is_system: item.is_system
        }))
      }))
    };
    
    return exportData;
  }

  // å¯¼å…¥é…ç½®æ¨¡æ¿
  async importConfigTemplate(
    importData: ConfigTemplateExport,
    importOptions: ImportTemplateOptions
  ): Promise<ImportTemplateResult> {
    const { environment, merge_strategy, override_existing } = importOptions;
    
    const result: ImportTemplateResult = {
      created: [],
      updated: [],
      skipped: [],
      errors: []
    };
    
    try {
      // 1. éªŒè¯å¯¼å…¥æ•°æ®
      this.validateImportData(importData);
      
      // 2. åˆ›å»ºåˆ†ç±»
      for (const categoryData of importData.categories) {
        await this.createCategoryIfNotExists(categoryData);
      }
      
      // 3. å¯¼å…¥é…ç½®é¡¹
      for (const categoryData of importData.categories) {
        for (const itemData of categoryData.items) {
          try {
            await this.importConfigItem(
              itemData,
              categoryData.category_code,
              environment,
              merge_strategy,
              override_existing,
              result
            );
          } catch (error) {
            result.errors.push({
              config_key: itemData.config_key,
              error: error.message
            });
          }
        }
      }
      
      return result;
      
    } catch (error) {
      throw new Error(`å¯¼å…¥é…ç½®å¤±è´¥: ${error.message}`);
    }
  }

  // åˆ›å»ºé…ç½®é¡¹ï¼ˆä»æ¨¡æ¿ï¼‰
  private async createConfigItemFromTemplate(
    itemData: any,
    categoryCode: string,
    options: ApplyTemplateOptions,
    result: ApplyTemplateResult
  ): Promise<void> {
    const { environment, override_existing, value_mappings } = options;
    
    // 1. è·å–åˆ†ç±»ID
    const category = await this.categoryService.getCategoryByCode(categoryCode);
    if (!category) {
      throw new Error(`åˆ†ç±»ä¸å­˜åœ¨: ${categoryCode}`);
    }
    
    // 2. æ£€æŸ¥é…ç½®æ˜¯å¦å·²å­˜åœ¨
    const existingConfig = await this.configService.getConfigByKey(itemData.config_key);
    
    if (existingConfig) {
      if (!override_existing) {
        result.skipped.push(itemData.config_key);
        return;
      }
      
      // æ›´æ–°ç°æœ‰é…ç½®
      const newValue = value_mappings?.[itemData.config_key] || itemData.default_value;
      await this.configService.updateConfigValue(
        itemData.config_key,
        newValue,
        options.operator_id,
        'ä»æ¨¡æ¿æ›´æ–°é…ç½®',
        environment
      );
      
      result.updated.push(itemData.config_key);
    } else {
      // åˆ›å»ºæ–°é…ç½®
      const configValue = value_mappings?.[itemData.config_key] || itemData.default_value;
      
      await this.configService.createConfig({
        config_key: itemData.config_key,
        config_name: itemData.config_name,
        category_id: category.id,
        config_type: itemData.config_type,
        config_value: configValue,
        default_value: itemData.default_value,
        description: itemData.description,
        validation_rule: itemData.validation_rule,
        options: itemData.options,
        is_required: itemData.is_required,
        is_encrypted: itemData.is_encrypted,
        environment
      });
      
      result.created.push(itemData.config_key);
    }
  }

  // éªŒè¯å¯¼å…¥æ•°æ®
  private validateImportData(importData: ConfigTemplateExport): void {
    if (!importData.categories || !Array.isArray(importData.categories)) {
      throw new Error('å¯¼å…¥æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘categorieså­—æ®µ');
    }
    
    for (const category of importData.categories) {
      if (!category.category_code || !category.category_name) {
        throw new Error('åˆ†ç±»æ•°æ®ä¸å®Œæ•´ï¼šç¼ºå°‘category_codeæˆ–category_name');
      }
      
      if (category.items) {
        for (const item of category.items) {
          if (!item.config_key || !item.config_name || !item.config_type) {
            throw new Error(`é…ç½®é¡¹æ•°æ®ä¸å®Œæ•´ï¼š${item.config_key}`);
          }
        }
      }
    }
  }
}
```

---

## ğŸ“± å‰ç«¯ç•Œé¢è®¾è®¡

### 1. é…ç½®ç®¡ç†ä¸»ç•Œé¢

#### 1.1 é…ç½®åˆ†ç±»æ ‘
- **æ ‘å½¢ç»“æ„**ï¼šå·¦ä¾§æ˜¾ç¤ºé…ç½®åˆ†ç±»çš„æ ‘å½¢ç»“æ„
- **æœç´¢åŠŸèƒ½**ï¼šæ”¯æŒåˆ†ç±»åç§°æœç´¢å’Œå¿«é€Ÿå®šä½
- **æ“ä½œæŒ‰é’®**ï¼šæ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤åˆ†ç±»çš„æ“ä½œæŒ‰é’®
- **æ‹–æ‹½æ’åº**ï¼šæ”¯æŒæ‹–æ‹½è°ƒæ•´åˆ†ç±»é¡ºåº

#### 1.2 é…ç½®é¡¹åˆ—è¡¨
- **è¡¨æ ¼å±•ç¤º**ï¼šå³ä¾§æ˜¾ç¤ºé€‰ä¸­åˆ†ç±»ä¸‹çš„é…ç½®é¡¹åˆ—è¡¨
- **ç­›é€‰åŠŸèƒ½**ï¼šæŒ‰ç¯å¢ƒã€ç±»å‹ã€çŠ¶æ€ç­‰æ¡ä»¶ç­›é€‰
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡ç¼–è¾‘ã€å¯¼å‡ºã€åˆ é™¤ç­‰æ“ä½œ
- **å¿«é€Ÿç¼–è¾‘**ï¼šæ”¯æŒè¡Œå†…ç¼–è¾‘é…ç½®å€¼

### 2. é…ç½®ç¼–è¾‘ç•Œé¢

#### 2.1 é…ç½®é¡¹ç¼–è¾‘å™¨
- **è¡¨å•éªŒè¯**ï¼šå®æ—¶éªŒè¯é…ç½®å€¼çš„æ ¼å¼å’Œè§„åˆ™
- **ç±»å‹æ”¯æŒ**ï¼šé’ˆå¯¹ä¸åŒç±»å‹æä¾›ä¸“é—¨çš„è¾“å…¥ç»„ä»¶
- **é¢„è§ˆåŠŸèƒ½**ï¼šJSONç±»å‹é…ç½®æä¾›æ ¼å¼åŒ–é¢„è§ˆ
- **å†å²å¯¹æ¯”**ï¼šæ˜¾ç¤ºé…ç½®çš„å†å²å˜æ›´è®°å½•

#### 2.2 æ‰¹é‡ç¼–è¾‘å™¨
- **Excelå¼ç¼–è¾‘**ï¼šç±»ä¼¼Excelçš„æ‰¹é‡ç¼–è¾‘ç•Œé¢
- **å˜æ›´é¢„è§ˆ**ï¼šç¼–è¾‘å‰é¢„è§ˆæ‰€æœ‰å˜æ›´å†…å®¹
- **å†²çªæ£€æµ‹**ï¼šæ£€æµ‹å¹¶æç¤ºé…ç½®å†²çª
- **å›æ»šåŠŸèƒ½**ï¼šæ”¯æŒæ‰¹é‡å›æ»šæ“ä½œ

### 3. é…ç½®æ¨¡æ¿ç®¡ç†

#### 3.1 æ¨¡æ¿è®¾è®¡å™¨
- **å¯è§†åŒ–è®¾è®¡**ï¼šæ‹–æ‹½å¼çš„æ¨¡æ¿è®¾è®¡ç•Œé¢
- **åˆ†ç±»ç®¡ç†**ï¼šæ¨¡æ¿ä¸­çš„åˆ†ç±»å’Œé…ç½®é¡¹ç®¡ç†
- **é¢„è§ˆåŠŸèƒ½**ï¼šå®æ—¶é¢„è§ˆæ¨¡æ¿åº”ç”¨æ•ˆæœ
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¨¡æ¿çš„ç‰ˆæœ¬æ§åˆ¶å’Œå†å²è®°å½•

#### 3.2 æ¨¡æ¿åº”ç”¨å‘å¯¼
- **æ­¥éª¤å¼•å¯¼**ï¼šåˆ†æ­¥éª¤çš„æ¨¡æ¿åº”ç”¨å‘å¯¼
- **å‚æ•°æ˜ å°„**ï¼šé…ç½®å‚æ•°çš„æ˜ å°„å’Œæ›¿æ¢
- **å†²çªå¤„ç†**ï¼šå¤„ç†é…ç½®å†²çªçš„ç­–ç•¥é€‰æ‹©
- **åº”ç”¨ç»“æœ**ï¼šæ˜¾ç¤ºæ¨¡æ¿åº”ç”¨çš„è¯¦ç»†ç»“æœ

### 4. é…ç½®ç›‘æ§ç•Œé¢

#### 4.1 é…ç½®çŠ¶æ€ç›‘æ§
- **å®æ—¶çŠ¶æ€**ï¼šæ˜¾ç¤ºå„ç¯å¢ƒé…ç½®çš„å®æ—¶çŠ¶æ€
- **å˜æ›´ç›‘æ§**ï¼šå®æ—¶ç›‘æ§é…ç½®å˜æ›´æƒ…å†µ
- **å¼‚å¸¸å‘Šè­¦**ï¼šé…ç½®å¼‚å¸¸å’Œé”™è¯¯çš„å‘Šè­¦æç¤º
- **æ€§èƒ½ç›‘æ§**ï¼šé…ç½®è¯»å–æ€§èƒ½å’Œç¼“å­˜çŠ¶æ€

#### 4.2 é…ç½®åˆ†ææŠ¥è¡¨
- **ä½¿ç”¨ç»Ÿè®¡**ï¼šé…ç½®é¡¹çš„ä½¿ç”¨é¢‘ç‡ç»Ÿè®¡
- **å˜æ›´åˆ†æ**ï¼šé…ç½®å˜æ›´çš„è¶‹åŠ¿åˆ†æ
- **ä¾èµ–å…³ç³»**ï¼šé…ç½®é¡¹ä¹‹é—´çš„ä¾èµ–å…³ç³»å›¾
- **å®‰å…¨å®¡è®¡**ï¼šé…ç½®è®¿é—®å’Œä¿®æ”¹çš„å®‰å…¨å®¡è®¡

---

## ğŸ”’ å®‰å…¨ä¸æƒé™æ§åˆ¶

### 1. é…ç½®è®¿é—®æ§åˆ¶
- **è§’è‰²æƒé™**ï¼šåŸºäºè§’è‰²çš„é…ç½®è®¿é—®æƒé™æ§åˆ¶
- **å­—æ®µçº§æƒé™**ï¼šç»†ç²’åº¦çš„é…ç½®é¡¹è®¿é—®æ§åˆ¶
- **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒé…ç½®çš„ä¸¥æ ¼éš”ç¦»
- **æ“ä½œå®¡è®¡**ï¼šæ‰€æœ‰é…ç½®æ“ä½œçš„è¯¦ç»†å®¡è®¡æ—¥å¿—

### 2. æ•æ„Ÿé…ç½®ä¿æŠ¤
- **åŠ å¯†å­˜å‚¨**ï¼šæ•æ„Ÿé…ç½®çš„åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
- **è„±æ•æ˜¾ç¤º**ï¼šæ•æ„Ÿé…ç½®åœ¨ç•Œé¢ä¸Šçš„è„±æ•æ˜¾ç¤º
- **è®¿é—®é™åˆ¶**ï¼šæ•æ„Ÿé…ç½®çš„ç‰¹æ®Šè®¿é—®é™åˆ¶
- **å®šæœŸè½®æ¢**ï¼šæ•æ„Ÿé…ç½®çš„å®šæœŸè½®æ¢æœºåˆ¶

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜ä¼˜åŒ–
- **å¤šçº§ç¼“å­˜**ï¼šåº”ç”¨ç¼“å­˜ + Redisç¼“å­˜çš„å¤šçº§ç¼“å­˜ç­–ç•¥
- **æ™ºèƒ½é¢„çƒ­**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶çš„é…ç½®ç¼“å­˜é¢„çƒ­
- **å¢é‡æ›´æ–°**ï¼šé…ç½®å˜æ›´æ—¶çš„å¢é‡ç¼“å­˜æ›´æ–°
- **ç¼“å­˜ç©¿é€ä¿æŠ¤**ï¼šé˜²æ­¢ç¼“å­˜ç©¿é€çš„ä¿æŠ¤æœºåˆ¶

### 2. æŸ¥è¯¢ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**ï¼šé’ˆå¯¹å¸¸ç”¨æŸ¥è¯¢çš„æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**ï¼šé…ç½®çš„æ‰¹é‡è¯»å–å’Œæ›´æ–°æ“ä½œ
- **è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥æ± çš„ä¼˜åŒ–é…ç½®
- **è¯»å†™åˆ†ç¦»**ï¼šé…ç½®è¯»å†™æ“ä½œçš„åˆ†ç¦»ä¼˜åŒ–

---

## ğŸ“ æ€»ç»“

ç³»ç»Ÿé…ç½®ç®¡ç†æ¨¡å—æ˜¯L2Cç³»ç»Ÿçš„åŸºç¡€è®¾æ–½ï¼Œä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›çµæ´»ã€å®‰å…¨ã€é«˜æ•ˆçš„é…ç½®ç®¡ç†èƒ½åŠ›ã€‚æœ¬è®¾è®¡æ–‡æ¡£æ¶µç›–äº†ï¼š

1. **å®Œæ•´çš„é…ç½®ä½“ç³»**ï¼šä»åˆ†ç±»ç®¡ç†åˆ°é…ç½®é¡¹çš„å®Œæ•´ç®¡ç†ä½“ç³»
2. **åŠ¨æ€é…ç½®èƒ½åŠ›**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°çš„åŠ¨æ€é…ç½®æœºåˆ¶
3. **å¤šç¯å¢ƒæ”¯æŒ**ï¼šå®Œå–„çš„å¤šç¯å¢ƒé…ç½®ç®¡ç†å’Œéš”ç¦»æœºåˆ¶
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®å˜æ›´çš„ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šèƒ½åŠ›
5. **æ¨¡æ¿ç³»ç»Ÿ**ï¼šçµæ´»çš„é…ç½®æ¨¡æ¿å’Œæ‰¹é‡åº”ç”¨æœºåˆ¶
6. **å®‰å…¨ä¿éšœ**ï¼šå…¨é¢çš„é…ç½®å®‰å…¨å’Œæƒé™æ§åˆ¶æœºåˆ¶
7. **æ€§èƒ½ä¼˜åŒ–**ï¼šé«˜æ•ˆçš„ç¼“å­˜å’ŒæŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥
8. **ç”¨æˆ·ä½“éªŒ**ï¼šç›´è§‚æ˜“ç”¨çš„é…ç½®ç®¡ç†ç•Œé¢

é€šè¿‡è¿™ä¸ªå®Œæ•´çš„é…ç½®ç®¡ç†æ¨¡å—ï¼ŒL2Cç³»ç»Ÿèƒ½å¤Ÿå®ç°çµæ´»çš„é…ç½®ç®¡ç†ï¼Œæ”¯æŒå¿«é€Ÿçš„ç¯å¢ƒéƒ¨ç½²å’Œé…ç½®è°ƒæ•´ï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’Œå¿«é€Ÿè¿­ä»£æä¾›å¼ºæœ‰åŠ›çš„æ”¯æ’‘ã€‚
