# 供应商管理模块设计

## 1. 模块概述

### 1.1 功能目标
供应商管理模块旨在建立完整的供应商生态体系，规范供应商准入、评估、合作和退出流程，确保供应链稳定性和产品质量，降低采购成本和风险。

### 1.2 核心功能
- **供应商档案管理**：基础信息、资质证书、联系人管理
- **供应商准入管理**：准入流程、资质审核、能力评估
- **供应商评估管理**：定期评估、绩效考核、等级管理
- **采购协议管理**：框架协议、价格管理、交期管理
- **供应商绩效管理**：质量监控、交期跟踪、成本分析
- **风险管理**：风险识别、预警机制、应急预案

### 1.3 业务价值
- **降低采购成本**：优化供应商结构，提升议价能力
- **保证产品质量**：严格供应商管理，确保质量标准
- **提升交付效率**：优化供应链，缩短交期
- **降低供应风险**：多元化供应商，建立风险预警

## 2. 业务流程设计

### 2.1 供应商准入流程
```
申请提交 → 资质审核 → 现场审核 → 样品测试 → 能力评估 → 准入决策 → 合同签署
```

### 2.2 供应商评估流程
```
评估计划 → 数据收集 → 综合评估 → 结果审核 → 等级调整 → 改进计划 → 跟踪执行
```

### 2.3 采购协议流程
```
需求分析 → 供应商选择 → 商务谈判 → 协议签署 → 执行监控 → 绩效评估
```

### 2.4 风险管理流程
```
风险识别 → 风险评估 → 预警触发 → 应急响应 → 风险处置 → 总结改进
```

## 3. 数据库设计

### 3.1 供应商主表 (suppliers)
```sql
CREATE TABLE suppliers (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_code VARCHAR(32) UNIQUE NOT NULL COMMENT '供应商编码',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    supplier_type ENUM('manufacturer', 'trader', 'service_provider', 'logistics') NOT NULL COMMENT '供应商类型',
    business_license VARCHAR(50) NOT NULL COMMENT '营业执照号',
    tax_number VARCHAR(50) COMMENT '税号',
    legal_representative VARCHAR(50) COMMENT '法定代表人',
    registered_capital DECIMAL(15,2) COMMENT '注册资本',
    established_date DATE COMMENT '成立日期',
    business_scope TEXT COMMENT '经营范围',
    supplier_level ENUM('strategic', 'preferred', 'qualified', 'probation', 'blacklist') DEFAULT 'probation' COMMENT '供应商等级',
    supplier_status ENUM('active', 'inactive', 'suspended', 'terminated') DEFAULT 'active' COMMENT '供应商状态',
    cooperation_start_date DATE COMMENT '合作开始日期',
    last_evaluation_date DATE COMMENT '最后评估日期',
    next_evaluation_date DATE COMMENT '下次评估日期',
    payment_terms VARCHAR(50) COMMENT '付款条件',
    credit_limit DECIMAL(15,2) COMMENT '信用额度',
    risk_level ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium' COMMENT '风险等级',
    quality_certification JSON COMMENT '质量认证',
    main_products TEXT COMMENT '主要产品',
    annual_capacity VARCHAR(100) COMMENT '年产能',
    website VARCHAR(200) COMMENT '官网',
    remarks TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by BIGINT NOT NULL,
    updated_by BIGINT,
    INDEX idx_supplier_code (supplier_code),
    INDEX idx_supplier_level (supplier_level),
    INDEX idx_supplier_status (supplier_status),
    INDEX idx_risk_level (risk_level),
    
    FOREIGN KEY (created_by) REFERENCES users(id),
    FOREIGN KEY (updated_by) REFERENCES users(id)
);
```

### 3.2 供应商联系人表 (supplier_contacts)
```sql
CREATE TABLE supplier_contacts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    contact_name VARCHAR(50) NOT NULL COMMENT '联系人姓名',
    contact_title VARCHAR(50) COMMENT '职位',
    department VARCHAR(50) COMMENT '部门',
    contact_phone VARCHAR(15) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '邮箱',
    contact_wechat VARCHAR(50) COMMENT '微信号',
    is_primary BOOLEAN DEFAULT FALSE COMMENT '是否主要联系人',
    contact_type ENUM('sales', 'technical', 'quality', 'finance', 'management') COMMENT '联系人类型',
    contact_status ENUM('active', 'inactive') DEFAULT 'active',
    remarks TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_contact_type (contact_type)
);
```

### 3.3 供应商地址表 (supplier_addresses)
```sql
CREATE TABLE supplier_addresses (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    address_type ENUM('registered', 'office', 'factory', 'warehouse') NOT NULL,
    province VARCHAR(20) NOT NULL,
    city VARCHAR(20) NOT NULL,
    district VARCHAR(20),
    detailed_address VARCHAR(200) NOT NULL,
    postal_code VARCHAR(10),
    is_default BOOLEAN DEFAULT FALSE COMMENT '是否默认地址',
    contact_name VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(15) COMMENT '联系电话',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_address_type (address_type)
);
```

### 3.4 供应商资质表 (supplier_qualifications)
```sql
CREATE TABLE supplier_qualifications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    qualification_type ENUM('business_license', 'tax_registration', 'quality_cert', 'safety_cert', 'environmental_cert', 'other') NOT NULL,
    qualification_name VARCHAR(100) NOT NULL COMMENT '资质名称',
    certificate_number VARCHAR(100) COMMENT '证书编号',
    issuing_authority VARCHAR(100) COMMENT '发证机关',
    issue_date DATE COMMENT '发证日期',
    expiry_date DATE COMMENT '到期日期',
    qualification_status ENUM('valid', 'expired', 'suspended', 'revoked') DEFAULT 'valid',
    file_path VARCHAR(500) COMMENT '证书文件路径',
    verification_status ENUM('pending', 'verified', 'rejected') DEFAULT 'pending',
    verification_date DATE COMMENT '验证日期',
    verification_remarks TEXT COMMENT '验证备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_qualification_type (qualification_type),
    INDEX idx_expiry_date (expiry_date)
);
```

### 3.5 供应商评估表 (supplier_evaluations)
```sql
CREATE TABLE supplier_evaluations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    evaluation_period VARCHAR(20) NOT NULL COMMENT '评估周期',
    evaluation_type ENUM('annual', 'quarterly', 'monthly', 'project', 'ad_hoc') NOT NULL,
    evaluation_date DATE NOT NULL,
    evaluator_id BIGINT NOT NULL COMMENT '评估人ID',
    quality_score DECIMAL(5,2) COMMENT '质量评分',
    delivery_score DECIMAL(5,2) COMMENT '交期评分',
    service_score DECIMAL(5,2) COMMENT '服务评分',
    price_score DECIMAL(5,2) COMMENT '价格评分',
    innovation_score DECIMAL(5,2) COMMENT '创新评分',
    total_score DECIMAL(5,2) NOT NULL COMMENT '总评分',
    evaluation_level ENUM('excellent', 'good', 'average', 'poor', 'unacceptable') COMMENT '评估等级',
    strengths TEXT COMMENT '优势',
    weaknesses TEXT COMMENT '不足',
    improvement_suggestions TEXT COMMENT '改进建议',
    action_plan TEXT COMMENT '行动计划',
    next_evaluation_date DATE COMMENT '下次评估日期',
    evaluation_status ENUM('draft', 'submitted', 'approved', 'rejected') DEFAULT 'draft',
    approved_by BIGINT COMMENT '审批人ID',
    approved_date DATE COMMENT '审批日期',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_evaluation_date (evaluation_date),
    INDEX idx_evaluation_level (evaluation_level)
);
```

### 3.6 供应商产品表 (supplier_products)
```sql
CREATE TABLE supplier_products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    product_category VARCHAR(50) NOT NULL COMMENT '产品类别',
    product_name VARCHAR(100) NOT NULL COMMENT '产品名称',
    product_model VARCHAR(50) COMMENT '产品型号',
    product_specification TEXT COMMENT '产品规格',
    unit_price DECIMAL(10,2) COMMENT '单价',
    currency VARCHAR(10) DEFAULT 'CNY' COMMENT '币种',
    min_order_quantity INT COMMENT '最小起订量',
    lead_time_days INT COMMENT '交期(天)',
    quality_standard VARCHAR(100) COMMENT '质量标准',
    product_status ENUM('active', 'inactive', 'discontinued') DEFAULT 'active',
    price_valid_from DATE COMMENT '价格生效日期',
    price_valid_to DATE COMMENT '价格失效日期',
    remarks TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_product_category (product_category),
    INDEX idx_product_status (product_status)
);
```

### 3.7 供应商绩效表 (supplier_performance)
```sql
CREATE TABLE supplier_performance (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    supplier_id BIGINT NOT NULL,
    performance_period VARCHAR(20) NOT NULL COMMENT '绩效周期',
    total_orders INT DEFAULT 0 COMMENT '总订单数',
    total_amount DECIMAL(15,2) DEFAULT 0 COMMENT '总采购金额',
    on_time_delivery_rate DECIMAL(5,4) COMMENT '准时交货率',
    quality_pass_rate DECIMAL(5,4) COMMENT '质量合格率',
    defect_rate DECIMAL(5,4) COMMENT '缺陷率',
    return_rate DECIMAL(5,4) COMMENT '退货率',
    complaint_count INT DEFAULT 0 COMMENT '投诉次数',
    response_time_hours DECIMAL(8,2) COMMENT '平均响应时间(小时)',
    cost_reduction_amount DECIMAL(10,2) DEFAULT 0 COMMENT '成本降低金额',
    innovation_contributions INT DEFAULT 0 COMMENT '创新贡献次数',
    sustainability_score DECIMAL(5,2) COMMENT '可持续发展评分',
    overall_rating ENUM('excellent', 'good', 'average', 'poor') COMMENT '综合评级',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    UNIQUE KEY uk_supplier_period (supplier_id, performance_period),
    INDEX idx_performance_period (performance_period),
    INDEX idx_overall_rating (overall_rating)
);
```

## 4. API接口设计

### 4.1 供应商管理接口

#### 4.1.1 供应商查询
```http
GET /api/v1/suppliers
GET /api/v1/suppliers/{id}
GET /api/v1/suppliers/search?keyword={keyword}&level={level}&status={status}
GET /api/v1/suppliers/by_category/{category}
```

#### 4.1.2 供应商操作
```http
POST /api/v1/suppliers
PUT /api/v1/suppliers/{id}
DELETE /api/v1/suppliers/{id}
PUT /api/v1/suppliers/{id}/status
PUT /api/v1/suppliers/{id}/level
```

### 4.2 供应商准入接口

#### 4.2.1 准入申请
```http
POST /api/v1/suppliers/applications
GET /api/v1/suppliers/applications
PUT /api/v1/suppliers/applications/{id}/review
POST /api/v1/suppliers/applications/{id}/approve
POST /api/v1/suppliers/applications/{id}/reject
```

### 4.3 供应商评估接口

#### 4.3.1 评估管理
```http
GET /api/v1/suppliers/{id}/evaluations
POST /api/v1/suppliers/{id}/evaluations
PUT /api/v1/suppliers/evaluations/{id}
POST /api/v1/suppliers/evaluations/{id}/submit
POST /api/v1/suppliers/evaluations/{id}/approve
```

#### 4.3.2 绩效分析
```http
GET /api/v1/suppliers/{id}/performance
GET /api/v1/suppliers/{id}/performance/trends
GET /api/v1/suppliers/performance/ranking
POST /api/v1/suppliers/{id}/performance/refresh
```

### 4.4 供应商产品接口

#### 4.4.1 产品管理
```http
GET /api/v1/suppliers/{id}/products
POST /api/v1/suppliers/{id}/products
PUT /api/v1/suppliers/products/{id}
DELETE /api/v1/suppliers/products/{id}
GET /api/v1/suppliers/products/price_comparison
```

### 4.5 风险管理接口

#### 4.5.1 风险监控
```http
GET /api/v1/suppliers/risk_assessment
GET /api/v1/suppliers/{id}/risk_profile
POST /api/v1/suppliers/{id}/risk_alerts
GET /api/v1/suppliers/risk_dashboard
```

## 5. 业务规则

### 5.1 供应商分级规则
- **战略供应商**：年采购额≥500万，合作≥3年，评估优秀
- **优选供应商**：年采购额≥100万，合作≥2年，评估良好
- **合格供应商**：通过准入评估，正常合作
- **试用供应商**：新准入供应商，试用期6个月

### 5.2 评估规则
- **年度评估**：所有合作供应商必须参与
- **季度评估**：战略和优选供应商
- **项目评估**：重大项目完成后
- **临时评估**：出现质量或交期问题时

### 5.3 风险预警规则
- **高风险**：质量合格率<95%或准时交货率<90%
- **中风险**：连续2次评估为一般或出现重大投诉
- **低风险**：偶发质量问题或轻微交期延误

## 6. 集成设计

### 6.1 与采购管理集成
- 采购订单自动关联供应商信息
- 供应商绩效数据实时更新
- 采购价格与供应商产品价格联动

### 6.2 与质量管理集成
- 质量检验结果自动更新供应商绩效
- 不合格品处理流程关联供应商
- 质量问题追溯到供应商

### 6.3 与财务管理集成
- 供应商付款条件影响财务流程
- 应付账款管理关联供应商信息
- 成本分析包含供应商数据

### 6.4 与库存管理集成
- 供应商交期影响库存计划
- 库存短缺触发供应商沟通
- 供应商产能影响采购策略

## 7. 性能优化

### 7.1 缓存策略
- **供应商基础信息**：Redis缓存，TTL 2小时
- **供应商产品价格**：Redis缓存，TTL 1小时
- **绩效统计数据**：Redis缓存，TTL 6小时

### 7.2 数据库优化
- 供应商表按地区分区
- 绩效表按时间分区
- 评估表定期归档历史数据

### 7.3 查询优化
- 供应商搜索使用Elasticsearch
- 复杂报表查询使用数据仓库
- 绩效计算使用异步任务

## 8. 监控告警

### 8.1 业务监控
- 供应商准时交货率监控
- 质量合格率预警
- 供应商风险等级变化告警
- 资质证书到期提醒

### 8.2 系统监控
- API响应时间监控
- 数据同步状态监控
- 批量处理任务监控
- 文件上传下载监控

## 9. 安全设计

### 9.1 数据权限
- 供应商信息按采购员权限控制
- 敏感商务信息需特殊权限
- 评估结果分级查看权限

### 9.2 操作审计
- 供应商信息修改全程记录
- 评估结果修改需要审批
- 敏感操作行为监控

### 9.3 数据保护
- 商务敏感信息加密存储
- 供应商资质文件安全存储
- 定期数据备份和恢复测试

## 10. 扩展性设计

### 10.1 多组织支持
- 支持集团化供应商管理
- 跨组织供应商共享
- 分级授权管理

### 10.2 国际化支持
- 多语言界面支持
- 多币种价格管理
- 跨国供应商管理

### 10.3 智能化功能
- AI辅助供应商选择
- 智能风险预警
- 自动化绩效分析
- 供应商推荐算法
