<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据库表关系可视化网络图</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4a6fa5;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .description {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background-color: #f0f0f0;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 1.5rem;
            color: #4a6fa5;
            margin: 0;
        }

        .section-content {
            padding: 20px;
        }

        .mermaid-container {
            background-color: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        /* 标签页样式 */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            background-color: #f0f0f0;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background-color: #e0e0e0;
        }

        .tab.active {
            background-color: white;
            color: #4a6fa5;
            border-bottom-color: #4a6fa5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表格样式 */
        .table-info {
            margin-bottom: 20px;
        }

        .table-info h3 {
            font-size: 1.2rem;
            color: #4a6fa5;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #f0f0f0;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                text-align: left;
            }
        }

        /* 图表标题 */
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>数据库表关系可视化网络图</h1>
            <p class="description">销售管理系统完整数据库表结构关系图，包含整体视图和局部视图</p>
        </header>

        <!-- 整体关系视图 -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">整体关系视图</h2>
            </div>
            <div class="section-content">
                <div class="chart-title">所有表之间的完整关联关系</div>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TB
                            O[渠道表<br>channel_channels] --> F[门店表<br>store_stores]
                            F --> E[用户表<br>usr_users]
                            P[商品表<br>products] --> M[套餐商品表<br>package_items]
                            L[套餐表<br>packages] --> M
                            A[潜在客户表<br>lead_leads] --> B[客户表<br>customer_customers]
                            B --> N[B端客户表<br>business_customers]
                            A --> C[销售订单表<br>sales_orders]
                            B --> C
                            F --> C
                            E --> C
                            C --> D[销售订单金额表<br>sales_order_amounts]
                            C --> G[销售订单套餐表<br>sales_order_packages]
                            C --> H[销售订单商品表<br>sales_order_items]
                            L --> G
                            M --> H
                            P --> H
                            C --> I[测量订单表<br>measurement_orders]
                            C --> J[安装订单表<br>installation_orders]
                            C --> K[对账订单表<br>reconciliation_orders]
                            E --> I
                            E --> J
                    </div>
                </div>
            </div>
        </div>

        <!-- 局部关系视图 -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">局部关系视图</h2>
            </div>
            <div class="section-content">
                <div class="tabs">
                    <button class="tab active" data-tab="tab1">以销售订单为主视角</button>
                    <button class="tab" data-tab="tab2">以用户表为主视角</button>
                    <button class="tab" data-tab="tab3">以门店表为主视角</button>
                    <button class="tab" data-tab="tab4">销售团队与门店关系</button>
                    <button class="tab" data-tab="tab5">后续服务执行关系</button>
                    <button class="tab" data-tab="tab6">以潜在客户为主视角</button>
                </div>

                <!-- 以销售订单为主视角 -->
                <div id="tab1" class="tab-content active">
                    <div class="chart-title">销售订单与相关表的关联关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            A[潜在客户表<br>lead_leads] --> C[销售订单表<br>sales_orders]
                            B[客户表<br>customer_customers] --> C
                            B --> N[B端客户表<br>business_customers]
                            O[渠道表<br>channel_channels] --> F[门店表<br>store_stores]
                            F --> C
                            E[用户表<br>usr_users] --> C
                            C --> D[销售订单金额表<br>sales_order_amounts]
                            C --> G[销售订单套餐表<br>sales_order_packages]
                            C --> H[销售订单商品表<br>sales_order_items]
                            C --> I[测量订单表<br>measurement_orders]
                            C --> J[安装订单表<br>installation_orders]
                            C --> K[对账订单表<br>reconciliation_orders]
                            L[套餐表<br>packages] --> G
                            L --> M[套餐商品表<br>package_items]
                            P[商品表<br>products] --> M
                            P --> H
                            M --> H
                            E --> I
                            E --> J
                        </div>
                    </div>
                </div>

                <!-- 以用户表为主视角 -->
                <div id="tab2" class="tab-content">
                    <div class="chart-title">用户与相关表的关联关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            F[门店表<br>store_stores] --> E[用户表<br>usr_users]
                            E --> C[销售订单表<br>sales_orders]
                            E --> I[测量订单表<br>measurement_orders]
                            E --> J[安装订单表<br>installation_orders]
                            C --> I
                            C --> J
                        </div>
                    </div>
                </div>

                <!-- 以门店表为主视角 -->
                <div id="tab3" class="tab-content">
                    <div class="chart-title">门店与相关表的关联关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            O[渠道表<br>channel_channels] --> F[门店表<br>store_stores]
                            F --> E[用户表<br>usr_users]
                            F --> C[销售订单表<br>sales_orders]
                            E --> C
                        </div>
                    </div>
                </div>

                <!-- 销售团队与门店关系 -->
                <div id="tab4" class="tab-content">
                    <div class="chart-title">销售团队与门店的组织关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            F[门店表<br>store_stores] --> E[用户表<br>usr_users]
                            E --> C[销售订单表<br>sales_orders]
                            F --> C
                        </div>
                    </div>
                </div>

                <!-- 后续服务执行关系 -->
                <div id="tab5" class="tab-content">
                    <div class="chart-title">后续服务的执行关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            C[销售订单表<br>sales_orders] --> I[测量订单表<br>measurement_orders]
                            C --> J[安装订单表<br>installation_orders]
                            C --> K[对账订单表<br>reconciliation_orders]
                            E[用户表<br>usr_users] --> I
                            E --> J
                        </div>
                    </div>
                </div>

                <!-- 以潜在客户为主视角 -->
                <div id="tab6" class="tab-content">
                    <div class="chart-title">潜在客户与相关表的关联关系</div>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                            A[潜在客户表<br>lead_leads] --> B[客户表<br>customer_customers]
                            A --> C[销售订单表<br>sales_orders]
                            B --> N[B端客户表<br>business_customers]
                            B --> C
                            C --> D[销售订单金额表<br>sales_order_amounts]
                            C --> G[销售订单套餐表<br>sales_order_packages]
                            C --> H[销售订单商品表<br>sales_order_items]
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 表信息说明 -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">表信息说明</h2>
            </div>
            <div class="section-content">
                <div class="table-info">
                    <h3>核心表中文名称</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>英文表名</th>
                                <th>中文名称</th>
                                <th>主要作用</th>
                                <th>关联字段</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>leads</td>
                                <td>潜在客户表</td>
                                <td>存储尚未转化为正式客户的潜在销售线索</td>
                                <td>id</td>
                            </tr>
                            <tr>
                                <td>customers</td>
                                <td>客户表</td>
                                <td>存储正式客户的基本信息</td>
                                <td>id, lead_id</td>
                            </tr>
                            <tr>
                                <td>sales_orders</td>
                                <td>销售订单表</td>
                                <td>存储销售订单的核心信息</td>
                                <td>id, lead_id, customer_id, salesperson_id, store_id</td>
                            </tr>
                            <tr>
                                <td>users</td>
                                <td>用户表</td>
                                <td>存储销售人员信息（远程销售、驻店销售等）</td>
                                <td>id, store_id</td>
                            </tr>
                            <tr>
                                <td>stores</td>
                                <td>门店表</td>
                                <td>存储门店基本信息（店名、地址、城市等）</td>
                                <td>id</td>
                            </tr>
                            <tr>
                                <td>sales_order_amounts</td>
                                <td>销售订单金额表</td>
                                <td>存储销售订单的金额明细</td>
                                <td>id, sales_order_id, customer_id</td>
                            </tr>
                            <tr>
                                <td>sales_order_packages</td>
                                <td>销售订单套餐表</td>
                                <td>存储销售订单中包含的套餐信息</td>
                                <td>id, sales_order_id, package_id</td>
                            </tr>
                            <tr>
                                <td>sales_order_items</td>
                                <td>销售订单商品表</td>
                                <td>存储销售订单中包含的具体商品信息</td>
                                <td>id, sales_order_id, item_id</td>
                            </tr>
                            <tr>
                                <td>packages</td>
                                <td>套餐表</td>
                                <td>存储系统中可销售的套餐定义</td>
                                <td>id</td>
                            </tr>
                            <tr>
                                <td>package_items</td>
                                <td>套餐商品表</td>
                                <td>存储套餐包含的具体商品明细</td>
                                <td>id, package_id, item_id</td>
                            </tr>
                            <tr>
                                <td>measurement_orders</td>
                                <td>测量订单表</td>
                                <td>存储与销售订单相关的测量服务信息</td>
                                <td>id, sales_order_id, technician_id</td>
                            </tr>
                            <tr>
                                <td>installation_orders</td>
                                <td>安装订单表</td>
                                <td>存储与销售订单相关的安装服务信息</td>
                                <td>id, sales_order_id, technician_id</td>
                            </tr>
                            <tr>
                                <td>reconciliation_orders</td>
                                <td>对账订单表</td>
                                <td>存储与销售订单相关的对账信息</td>
                                <td>id, sales_order_id</td>
                            </tr>
                            <tr>
                                <td>business_customers</td>
                                <td>B端客户表</td>
                                <td>存储B端客户（如装企）的详细企业信息</td>
                                <td>id, customer_id</td>
                            </tr>
                            <tr>
                                <td>channels</td>
                                <td>渠道表</td>
                                <td>管理公司的各类销售渠道和渠道商</td>
                                <td>id, channel_manager_id, channel_key_person_id</td>
                            </tr>
                            <tr>
                                <td>products</td>
                                <td>商品表</td>
                                <td>存储系统中的商品信息，包括窗帘、墙布、墙咔等</td>
                                <td>id, product_code, category, supplier_id</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                diagramPadding: 20,
                layoutDirection: 'TB',
                nodeSpacing: 50,
                rankSpacing: 50
            },
            securityLevel: 'loose'
        });

        // 标签页切换功能
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // 移除所有active类
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // 添加当前tab的active类
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');

                // 重新渲染Mermaid图表
                mermaid.init();
            });
        });
    </script>
</body>
</html>
