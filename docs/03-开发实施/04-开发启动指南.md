# ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿ - å¼€å‘å¯åŠ¨æŒ‡å— v2.0

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### ç³»ç»Ÿç®€ä»‹
ç½—è±L2Cé”€å”®ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªé›†æˆçº¿ç´¢ç®¡ç†ã€è®¢å•å¤„ç†ã€ç§¯åˆ†æ¿€åŠ±ã€å·¥ä½œé‡æ ¸ç®—äºä¸€ä½“çš„ç»¼åˆæ€§é”€å”®ç®¡ç†å¹³å°ï¼Œæ—¨åœ¨æå‡é”€å”®æ•ˆç‡å’Œå®¢æˆ·æœåŠ¡è´¨é‡ã€‚

### æ ¸å¿ƒæ¨¡å—
- **çº¿ç´¢ç®¡ç†**ï¼šå®¢æˆ·çº¿ç´¢å½•å…¥ã€è·Ÿè¿›ã€è½¬åŒ–ç®¡ç†
- **è®¢å•ç®¡ç†**ï¼šè®¢å•åˆ›å»ºã€çŠ¶æ€è·Ÿè¸ªã€æµç¨‹ç®¡ç†
- **ç§¯åˆ†ç³»ç»Ÿ**ï¼šé”€å”®æ¿€åŠ±ã€ç§¯åˆ†è®¡ç®—ã€å¥–åŠ±å‘æ”¾
- **æ–½å·¥å‘˜å·¥ä½œé‡æ ¸ç®—**ï¼šå·¥ä½œé‡ç»Ÿè®¡ã€ç»“ç®—ç®¡ç†
- **å¤šè§’è‰²æƒé™**ï¼šåŸºäº RLS çš„ä¸¥æ ¼æ•°æ®éš”ç¦»

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„ (BaaS Oriented)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨ (Frontend)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç®¡ç†åå°      â”‚   é”€å”®ç«¯å°ç¨‹åº   â”‚   æ–½å·¥å‘˜ç«¯å°ç¨‹åº     â”‚
â”‚   (Next.js 15+) â”‚   (Taro 3.x)    â”‚   (Taro 3.x)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Server Actions  â”‚ Supabase SDK      â”‚
         â–¼                 â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯æœåŠ¡ (Supabase BaaS)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Auth (GoTrue)  |  Database (Postgres) |  Realtime      â”‚
â”‚  Storage        |  Edge Functions      |  Vector        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆé€‰å‹
- **å…¨æ ˆæ¡†æ¶**ï¼šNext.js 15+ (App Router, Server Actions)
- **å°ç¨‹åºæ¡†æ¶**ï¼šTaro 3.x (React)
- **BaaS å¹³å°**ï¼šSupabase (PostgreSQL, Auth, Realtime, Storage)
- **è¯­è¨€**ï¼šTypeScript (Strict Mode)
- **éƒ¨ç½²**ï¼šVercel (Frontend/Edge) + Supabase Cloud (Backend)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Node.js**ï¼š>= 20.0.0
- **pnpm**ï¼š>= 8.0.0
- **Docker Desktop**ï¼šä»…ç”¨äºè¿è¡Œ Supabase Local (æ— éœ€é…ç½® docker-compose)
- **Supabase CLI**ï¼šæœ€æ–°ç‰ˆ

### 1. å…‹éš†é¡¹ç›®
```bash
# å…‹éš†ä»£ç ä»“åº“
git clone https://github.com/luolai/l2c-system.git
cd l2c-system
```

### 2. å®‰è£…ä¾èµ–
```bash
# å®‰è£…æ ¹ç›®å½•ä¾èµ– (å« ESLint, Prettier, Husky)
pnpm install
```

### 3. å¯åŠ¨æœ¬åœ°ç¯å¢ƒ (Supabase Local)
```bash
# 1. ç™»å½• Supabase CLI
npx supabase login

# 2. å¯åŠ¨æœ¬åœ°æœåŠ¡ (é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨æ‹‰å– Docker é•œåƒ)
npx supabase start

# 3. æŸ¥çœ‹æœ¬åœ°æœåŠ¡çŠ¶æ€ (åŒ…å« Studio URL, API Keys)
npx supabase status
```

### 4. å¯åŠ¨å‰ç«¯åº”ç”¨
```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env.local

# 2. å¡«å…¥ Supabase Local çš„ URL å’Œ Anon Key (ä»ä¸Šä¸€æ­¥è·å–)
# NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
# NEXT_PUBLIC_SUPABASE_ANON_KEY=...

# 3. å¯åŠ¨ Next.js
pnpm dev
```

### 5. æ•°æ®åº“å¼€å‘å·¥ä½œæµ
- **ä¿®æ”¹ Schema**ï¼šæ¨èç›´æ¥ç¼–è¾‘ `supabase/migrations/*.sql` æˆ–ä½¿ç”¨ Studio UI åŸå‹åŒ–å `db diff`ã€‚
- **ç”Ÿæˆç±»å‹**ï¼š`npx supabase gen types typescript --local > src/types/supabase.ts`ã€‚
- **é‡ç½®æ•°æ®**ï¼š`npx supabase db reset` (ä¼šé‡æ–°åº”ç”¨è¿ç§»å’Œ Seed æ•°æ®)ã€‚

## ğŸ“š å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| ä»»åŠ¡ | å‘½ä»¤ | è¯´æ˜ |
| :--- | :--- | :--- |
| **å¯åŠ¨æ•°æ®åº“** | `npx supabase start` | å¯åŠ¨æœ¬åœ° Postgres/Auth/Storage |
| **åœæ­¢æ•°æ®åº“** | `npx supabase stop` | åœæ­¢å¹¶ä¿ç•™æ•°æ® |
| **åº”ç”¨è¿ç§»** | `npx supabase migration up` | æ‰§è¡Œæœªè¿è¡Œçš„ SQL è¿ç§» |
| **åˆ›å»ºè¿ç§»** | `npx supabase migration new <name>` | åˆ›å»ºæ–°çš„ SQL è¿ç§»æ–‡ä»¶ |
| **ç”Ÿæˆç±»å‹** | `npm run update-types` | åŒæ­¥ DB Schema åˆ° TypeScript |
| **è¿è¡Œæµ‹è¯•** | `npm run test` | æ‰§è¡Œ Vitest å•å…ƒ/é›†æˆæµ‹è¯• |

## âš ï¸ æ³¨æ„äº‹é¡¹
1.  **ä¸è¦åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ Service Role Key**ï¼š`NEXT_PUBLIC_` å˜é‡ä»…é™ Anon Keyã€‚
2.  **RLS æ˜¯ç¬¬ä¸€é“é˜²çº¿**ï¼šæ‰€æœ‰è¡¨å¿…é¡»å¼€å¯ RLS (`alter table x enable row level security`)ã€‚
3.  **Server Actions å®‰å…¨**ï¼šåœ¨ Server Action ä¸­å¿…é¡»å†æ¬¡éªŒè¯ `auth.getUser()`ã€‚
