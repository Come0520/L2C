# 罗莱L2C销售管理系统 - 开发计划文档 v2.0

## 🎯 项目概览

### 项目现状评估

#### 已完成项目
- ✅ **需求分析**：业务需求梳理和功能规范定义
- ✅ **系统设计**：架构设计、数据库设计 (Postgres)
- ✅ **技术选型**：Next.js 15+ + Supabase (BaaS)
- ✅ **开发环境**：Supabase Local Development 配置

#### 进行中项目
- 🔄 **数据库迁移**：核心表结构 SQL 编写与 RLS 策略设计
- 🔄 **基础组件**：Next.js Layout 与 Auth Context

#### 待开发项目
- ⏳ **线索管理模块**：Server Actions & UI
- ⏳ **销售单管理模块**：状态机流转与 Postgres Triggers
- ⏳ **积分激励体系**：Edge Functions 异步计算
- ⏳ **报表分析**：Supabase Postgres Search & Charts

## 📅 8周详细开发计划

### 第1周：基础设施与 Auth (2025-01-06 ~ 2025-01-12)

#### 开发目标
- 搭建 Next.js + Supabase 本地开发环境
- 实现基于 RLS 的用户权限体系
- 完成通用 UI 组件库集成

#### 具体任务

**全栈开发 (3天)**
- [x] 初始化 Next.js 项目与 Tailwind CSS
- [x] `supabase start` 并生成 `types/supabase.ts`
- [ ] **DB**: 设计 `profiles` 表与 Trigger (自动创建 Profile)
- [ ] **Auth**: 集成 Supabase Auth (Email/Password)
- [ ] **RLS**: 编写并测试 `profiles` 表的访问策略

**前端/UI (2天)**
- [ ] 封装 `SupabaseProvider` 与 `useUser` Hook
- [ ] 开发登录/注册页面
- [ ] 搭建 Dashboard 布局 (Sidebar, Header)

**测试与部署 (2天)**
- [ ] 配置 GitHub Actions (Lint, TypeCheck)
- [ ] 部署 Vercel Preview 环境
- [ ] 连接 Supabase Cloud 项目

#### 里程碑验收标准
- [ ] 用户可注册登录，数据自动写入 `auth.users` 和 `public.profiles`
- [ ] 未登录用户无法访问 Dashboard (Middleware 拦截)

---

### 第2周：线索管理核心功能 (2025-01-13 ~ 2025-01-19)

#### 开发目标
- 完成线索录入、列表查询与状态流转
- 实现线索分配 (利用 RLS 控制可见性)

#### 具体任务

**Schema & Logic (3天)**
- [ ] **DB**: 设计 `leads` 表 (字段: status, source, owner_id)
- [ ] **RLS**: 策略 `View Own Leads` (Sales) vs `View All Leads` (Admin)
- [ ] **Server Actions**: `createLead`, `updateLeadStatus`, `assignLead`
- [ ] **Validation**: Zod Schema for Lead Form

**UI 开发 (3天)**
- [ ] 线索列表页 (Server Component + Pagination)
- [ ] 线索创建抽屉 (Client Component + Server Action)
- [ ] 线索详情页与状态变更操作

**测试 (1天)**
- [ ] 编写 Integration Test (模拟 Sales 创建线索)
- [ ] 验证 RLS (确保 Sales 看不到别人的私有线索)

---

### 第3周：订单与商机管理 (2025-01-20 ~ 2025-01-26)

#### 开发目标
- 实现复杂的订单状态流转
- 关联产品 SKU 与价格计算

#### 具体任务
- [ ] **DB**: 设计 `orders`, `order_items`, `products` 表
- [ ] **Logic**: 使用 Postgres Function 计算订单总价 (防止前端篡改)
- [ ] **UI**: 订单创建向导 (Wizard Form)
- [ ] **Feature**: 订单状态变更日志 (Audit Log via Trigger)

---

### 第4周：积分与激励系统 (2025-01-27 ~ 2025-02-02)

#### 开发目标
- 实现销售行为自动触发积分奖励
- 积分排行榜与兑换

#### 具体任务
- [ ] **DB**: `points_wallet`, `points_history`
- [ ] **Async**: 使用 Supabase Database Webhooks 监听 `orders` 状态变更 -> 触发 Edge Function 发放积分
- [ ] **UI**: 积分商城与兑换记录

---

### 第5-6周：报表与数据可视化 (2025-02-03 ~ 2025-02-16)

#### 开发目标
- 销售漏斗图表
- 关键业务指标仪表盘

#### 具体任务
- [ ] **Data**: 编写 SQL View 聚合销售数据
- [ ] **UI**: 使用 Recharts 渲染报表

---

### 第7-8周：测试验收与上线 (2025-02-17 ~ 2025-03-02)

#### 开发目标
- 全面回归测试
- 生产环境部署

#### 具体任务
- [ ] Playwright E2E 测试覆盖核心路径
- [ ] 压力测试 (Supabase 实例规格评估)
- [ ] 生产环境数据迁移与域名配置
