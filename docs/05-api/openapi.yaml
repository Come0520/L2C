openapi: 3.0.3
info:
  title: L2C API
  description: |
    Lead to Cash (线索到现金) 全流程管理系统 API
    
    ## 认证方式
    所有 API 请求需要在请求头中携带 JWT Token：
    ```
    Authorization: Bearer {token}
    ```
    
    ## 多租户
    需要在请求头中携带租户 ID：
    ```
    Tenant-ID: {tenant_id}
    ```
  version: 1.0.0
  contact:
    name: L2C 技术团队
    email: tech@l2c.example.com

servers:
  - url: https://api.l2c.example.com/api/v1
    description: 生产环境
  - url: http://localhost:3000/api/v1
    description: 开发环境

tags:
  - name: leads
    description: 线索管理
  - name: customers
    description: 客户管理
  - name: quotes
    description: 报价单管理
  - name: orders
    description: 订单管理
  - name: measurement
    description: 测量任务
  - name: installation
    description: 安装任务
  - name: finance
    description: 财务管理
  - name: supply-chain
    description: 供应链管理

paths:
  /leads:
    get:
      tags:
        - leads
      summary: 获取线索列表
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING_ASSIGNMENT, PENDING_FOLLOWUP, FOLLOWING_UP, WON, INVALID]
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadListResponse'
    post:
      tags:
        - leads
      summary: 创建线索
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLeadRequest'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadResponse'

  /leads/{id}:
    get:
      tags:
        - leads
      summary: 获取线索详情
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadResponse'

  /orders:
    get:
      tags:
        - orders
      summary: 获取订单列表
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'

  /orders/{id}:
    get:
      tags:
        - orders
      summary: 获取订单详情
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 成功

  /orders/{id}/halt:
    post:
      tags:
        - orders
      summary: 叫停订单
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  enum: [CUSTOMER_REQUEST, PAYMENT_ISSUE, PRODUCTION_ISSUE, LOGISTICS_ISSUE, MATERIAL_SHORTAGE, OTHER]
                remark:
                  type: string
      responses:
        '200':
          description: 叫停成功

  /orders/{id}/resume:
    post:
      tags:
        - orders
      summary: 恢复订单
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 恢复成功

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        default: 1
    PageSizeParam:
      name: pageSize
      in: query
      schema:
        type: integer
        default: 20
        maximum: 100

  schemas:
    LeadListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Lead'
            total:
              type: integer
            page:
              type: integer
            pageSize:
              type: integer

    LeadResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Lead'

    Lead:
      type: object
      properties:
        id:
          type: string
          format: uuid
        leadNo:
          type: string
        customerPhone:
          type: string
        community:
          type: string
        address:
          type: string
        status:
          type: string
        salesId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    CreateLeadRequest:
      type: object
      required:
        - customerPhone
        - community
      properties:
        customerPhone:
          type: string
        community:
          type: string
        address:
          type: string
        channelId:
          type: string
          format: uuid

    OrderListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Order'
            total:
              type: integer
            page:
              type: integer
            pageSize:
              type: integer
            totalPages:
              type: integer

    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderNo:
          type: string
        customerId:
          type: string
          format: uuid
        customerName:
          type: string
        totalAmount:
          type: string
        paidAmount:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time

security:
  - BearerAuth: []
