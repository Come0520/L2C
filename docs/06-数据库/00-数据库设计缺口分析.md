# ç½—è±L2Cæ•°æ®åº“è®¾è®¡ç¼ºå£åˆ†ææŠ¥å‘Š

## ğŸ“Š ç°æœ‰æ•°æ®åº“æ¦‚è§ˆ

### å·²å»ºç«‹çš„15ä¸ªè¡¨

| åºå· | è¡¨å | ç”¨é€” | çŠ¶æ€ |
|------|------|------|------|
| 1 | lead_leads | æ½œåœ¨å®¢æˆ·/çº¿ç´¢ | âœ… å·²å»ºç«‹ |
| 2 | customer_customers | å®¢æˆ·åŸºç¡€ä¿¡æ¯ | âœ… å·²å»ºç«‹ |
| 3 | business_customers | Bç«¯å®¢æˆ·è¯¦ç»†ä¿¡æ¯ | âœ… å·²å»ºç«‹ |
| 4 | usr_users | äººå‘˜ä¿¡æ¯ | âœ… å·²å»ºç«‹ |
| 5 | store_stores | é—¨åº—ä¿¡æ¯ | âœ… å·²å»ºç«‹ |
| 6 | channel_channels | æ¸ é“ä¿¡æ¯ | âœ… å·²å»ºç«‹ |
| 7 | sales_orders | é”€å”®è®¢å•ä¸»è¡¨ | âœ… å·²å»ºç«‹ |
| 8 | sales_order_amounts | è®¢å•é‡‘é¢æ˜ç»† | âœ… å·²å»ºç«‹ |
| 9 | sales_order_items | è®¢å•å•†å“æ˜ç»† | âœ… å·²å»ºç«‹ |
| 10 | sales_order_packages | è®¢å•å¥—é¤å…³è” | âœ… å·²å»ºç«‹ |
| 11 | packages | å¥—é¤å®šä¹‰ | âœ… å·²å»ºç«‹ |
| 12 | package_items | å¥—é¤å•†å“å…³è” | âœ… å·²å»ºç«‹ |
| 13 | measurement_orders | æµ‹é‡è®¢å• | âœ… å·²å»ºç«‹ |
| 14 | installation_orders | å®‰è£…è®¢å• | âœ… å·²å»ºç«‹ |
| 15 | reconciliation_orders | å¯¹è´¦è®¢å• | âœ… å·²å»ºç«‹ |

---

## âš ï¸ å…³é”®ä¸šåŠ¡ç¼ºå£åˆ†æ

### 1. ã€é«˜ä¼˜å…ˆçº§ã€‘çº¿ç´¢ç®¡ç†ç¼ºå£

#### 1.1 çº¿ç´¢è¡¨å­—æ®µä¸¥é‡ä¸è¶³

**å½“å‰å­—æ®µ**ï¼ˆä»…7ä¸ªï¼‰:
```
id, name, contact_info, status, created_at, updated_at, deleted_at
```

**ç¼ºå¤±çš„å…³é”®å­—æ®µ**ï¼ˆæ ¹æ®éœ€æ±‚æ–‡æ¡£ï¼‰:
- âŒ `customer_address` - å®¢æˆ·åœ°å€ï¼ˆé‡å¤æ£€æŸ¥çš„æ ¸å¿ƒå­—æ®µï¼‰
- âŒ `designer_id` / `designer_name` - åœ£éƒ½è®¾è®¡å¸ˆä¿¡æ¯
- âŒ `salesperson_id` / `salesperson_name` - åœ£éƒ½å¯¼è´­ä¿¡æ¯
- âŒ `city` - ç»è¥åŸå¸‚åº—
- âŒ `decoration_signed_at` - ç¡¬è£…æ­£ç­¾æ—¶é—´
- âŒ `area` - é¢ç§¯
- âŒ `package_name` - å¥—é¤åç§°
- âŒ `source` - çº¿ç´¢æ¥æºï¼ˆExcelå¯¼å…¥/æ‰‹åŠ¨åˆ›å»º/æ¨èç­‰ï¼‰
- âŒ `store_id` - æ‰€å±é—¨åº—
- âŒ `assigned_to_user_id` - åˆ†é…ç»™çš„é”€å”®äººå‘˜
- âŒ `last_followup_at` - æœ€åè·Ÿè¸ªæ—¶é—´
- âŒ `followup_count` - è·Ÿè¸ªæ¬¡æ•°
- âŒ `next_followup_at` - ä¸‹æ¬¡è·Ÿè¸ªæ—¶é—´
- âŒ `similarity_score` - é‡å¤æ£€æŸ¥ç›¸ä¼¼åº¦åˆ†æ•°
- âŒ `quoted_at` - é¢„æŠ¥ä»·æ—¶é—´ï¼ˆquotedæ ‡ç­¾ï¼‰
- âŒ `quoted_file_url` - é¢„æŠ¥ä»·æ–‡ä»¶è·¯å¾„

**å½“å‰çŠ¶æ€å®šä¹‰ä¸å®Œæ•´**:
```
status: 1-æ½œåœ¨, 2-è½¬åŒ–, 3-å¤±æ•ˆ
```

**éœ€æ±‚ä¸­çš„5ä¸ªçŠ¶æ€**:
```
1-å¾…åˆ†é…, 2-å¾…è·Ÿè¸ª, 3-è·Ÿè¸ªä¸­, 4-è‰ç­¾, 5-å·²å¤±æ•ˆ
```

#### 1.2 ç¼ºå¤±çº¿ç´¢æ ‡ç­¾ç³»ç»Ÿ

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `lead_tags` å’Œ `lead_tag_assignments`

**éœ€æ±‚ä¸­çš„æ ‡ç­¾åˆ†ç±»**:
1. **äº§å“ç±»æ ‡ç­¾**: çª—å¸˜ã€å¢™å¸ƒã€å¢™å’”
2. **è£…ä¿®é˜¶æ®µæ ‡ç­¾**: ç¡¬è£…é˜¶æ®µã€è½¯è£…é˜¶æ®µã€å·²å…¥ä½
3. **æ„æ„¿å¼ºåº¦æ ‡ç­¾**: é«˜æ„å‘ã€ä¸­æ„å‘ã€ä½æ„å‘
4. **ç³»ç»Ÿè‡ªåŠ¨æ ‡ç­¾**: quoted(å·²æŠ¥ä»·)ã€éœ€ç»´æŠ¤

**å½±å“**: 
- âŒ æ— æ³•å®ç°çº¿ç´¢æ ‡ç­¾ç®¡ç†
- âŒ æ— æ³•å®ç°"quotedæ ‡ç­¾>10å¤©æœªè½¬åŒ–è‡ªåŠ¨æ·»åŠ éœ€ç»´æŠ¤æ ‡ç­¾"
- âŒ æ— æ³•æŒ‰æ ‡ç­¾ç­›é€‰å’Œç»Ÿè®¡çº¿ç´¢

#### 1.3 ç¼ºå¤±çº¿ç´¢è·Ÿè¸ªè®°å½•è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `lead_followups`

**å¿…éœ€å­—æ®µ**:
```sql
id, lead_id, user_id, followup_type, followup_content, 
next_followup_at, created_at
```

**å½±å“**:
- âŒ æ— æ³•è®°å½•æ¯æ¬¡è·Ÿè¸ªçš„è¯¦ç»†å†…å®¹
- âŒ æ— æ³•å®ç°è·Ÿè¸ªå†å²æŸ¥è¯¢
- âŒ æ— æ³•ç»Ÿè®¡é”€å”®äººå‘˜çš„è·Ÿè¸ªæ•ˆæœ

#### 1.4 ç¼ºå¤±çº¿ç´¢åˆ†é…å†å²è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `lead_assignments`

**å¿…éœ€å­—æ®µ**:
```sql
id, lead_id, from_user_id, to_user_id, assigned_by_user_id,
assignment_reason, created_at
```

**å½±å“**:
- âŒ æ— æ³•è¿½æº¯çº¿ç´¢åˆ†é…å†å²
- âŒ æ— æ³•ç»Ÿè®¡é”€å”®è´Ÿè´£äººçš„åˆ†é…æ•ˆç‡

---

### 2. ã€é«˜ä¼˜å…ˆçº§ã€‘é”€å”®å•27çŠ¶æ€æµè½¬ç¼ºå£

#### 2.1 é”€å”®å•çŠ¶æ€å®šä¹‰ä¸¥é‡ä¸ç¬¦

**å½“å‰çŠ¶æ€å®šä¹‰**ï¼ˆä»…5ä¸ªï¼‰:
```
status: 1-å¾…å®¡æ ¸, 2-å·²å®¡æ ¸, 3-å·²å‘è´§, 4-å·²å®Œæˆ, 5-å·²å–æ¶ˆ
```

**éœ€æ±‚ä¸­çš„27ä¸ªçŠ¶æ€**:

**çº¿ç´¢é˜¶æ®µ(5ä¸ª)**: å¾…åˆ†é…ã€å¾…è·Ÿè¸ªã€è·Ÿè¸ªä¸­ã€è‰ç­¾ã€å·²å¤±æ•ˆ  
**è®¢å•é˜¶æ®µ(15ä¸ª)**: é¢„ç®—ä¸­ã€ç­‰å¾…æ¨å•ã€å¾…æµ‹é‡ã€æµ‹é‡ä¸­-å¾…åˆ†é…ã€æµ‹é‡ä¸­-åˆ†é…ä¸­ã€æµ‹é‡ä¸­-å¾…ä¸Šé—¨ã€æµ‹é‡ä¸­-å¾…ç¡®è®¤ã€æ–¹æ¡ˆå¾…ç¡®è®¤ã€å¾…æ¨å•ã€å¾…ä¸‹å•ã€ç”Ÿäº§ä¸­ã€å¤‡è´§å®Œæˆã€å®‰è£…ä¸­-å¾…åˆ†é…ã€å®‰è£…ä¸­-åˆ†é…ä¸­ã€å®‰è£…ä¸­-å¾…ä¸Šé—¨ã€å®‰è£…ä¸­-å¾…ç¡®è®¤ã€å¾…å¯¹è´¦  
**è´¢åŠ¡é˜¶æ®µ(2ä¸ª)**: å¾…å›æ¬¾ã€å·²å®Œæˆ  
**å¼‚å¸¸çŠ¶æ€(5ä¸ª)**: å·²å–æ¶ˆã€æš‚åœã€å¼‚å¸¸

**å½±å“**:
- âŒ æ— æ³•å®ç°å®Œæ•´çš„çŠ¶æ€æœºæµè½¬
- âŒ æ— æ³•æ”¯æŒå¤æ‚çš„ä¸šåŠ¡æµç¨‹
- âŒ çŠ¶æ€å®šä¹‰ä¸ä¸šåŠ¡éœ€æ±‚å®Œå…¨ä¸åŒ¹é…

#### 2.2 é”€å”®å•ç¼ºå¤±å…³é”®å­—æ®µ

**ç¼ºå¤±å­—æ®µ**:
- âŒ `quote_status` - æŠ¥ä»·çŠ¶æ€ï¼ˆè‰ç­¾/ç­‰å¾…æ¨å•/å¾…æ¨å•ç­‰ï¼‰
- âŒ `budget_quote_file_url` - é¢„ç®—æŠ¥ä»·å•æ–‡ä»¶è·¯å¾„
- âŒ `budget_quote_uploaded_at` - é¢„ç®—æŠ¥ä»·å•ä¸Šä¼ æ—¶é—´
- âŒ `push_order_screenshot_url` - æ¨å•æˆªå›¾è·¯å¾„ï¼ˆåœ£éƒ½Homeé‡‡è´­ç”³è¯·ï¼‰
- âŒ `push_order_uploaded_at` - æ¨å•ä¸Šä¼ æ—¶é—´
- âŒ `push_order_confirmed_at` - æ¨å•ç¡®è®¤æ—¶é—´ï¼ˆè®¢å•å®¢æœç¡®è®¤ï¼‰
- âŒ `push_order_confirmed_by_user_id` - æ¨å•ç¡®è®¤äºº
- âŒ `production_order_nos` - ç”Ÿäº§å•å·ï¼ˆå¤šä¸ªï¼ŒJSONæˆ–æ•°ç»„ï¼‰
- âŒ `all_production_completed_at` - æ‰€æœ‰ç”Ÿäº§å•å¤‡è´§å®Œæˆæ—¶é—´
- âŒ `designer_id` - åœ£éƒ½è®¾è®¡å¸ˆIDï¼ˆç½—è±å¥½ä¼™ä¼´ï¼‰
- âŒ `guide_id` - åœ£éƒ½å¯¼è´­IDï¼ˆç½—è±å¥½ä¼™ä¼´ï¼‰
- âŒ `installation_notes` - å®‰è£…å¤‡æ³¨ï¼ˆè¿›é—¨å¯†ç ç­‰ï¼‰
- âŒ `installation_photo_urls` - å®‰è£…åç…§ç‰‡ï¼ˆJSONæ•°ç»„ï¼‰
- âŒ `plan_confirmed_photo_urls` - æ–¹æ¡ˆç¡®è®¤ç…§ç‰‡ï¼ˆJSONæ•°ç»„ï¼‰

#### 2.3 ç¼ºå¤±çŠ¶æ€æµè½¬å†å²è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `sales_order_status_history`

**å¿…éœ€å­—æ®µ**:
```sql
id, sales_order_id, from_status, to_status, changed_by_user_id,
change_reason, created_at
```

**å½±å“**:
- âŒ æ— æ³•è¿½æº¯è®¢å•çŠ¶æ€å˜åŒ–å†å²
- âŒ æ— æ³•ç»Ÿè®¡å„çŠ¶æ€çš„åœç•™æ—¶é—´
- âŒ æ— æ³•åˆ†ææµç¨‹ç“¶é¢ˆ

---

### 3. ã€é«˜ä¼˜å…ˆçº§ã€‘ç§¯åˆ†æ¿€åŠ±ç³»ç»Ÿå®Œå…¨ç¼ºå¤±

#### 3.1 ç¼ºå¤±ç§¯åˆ†è´¦æˆ·è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `points_accounts`

**å¿…éœ€å­—æ®µ**:
```sql
id, user_id, user_type, total_points, available_points, 
pending_points, frozen_points, used_points, 
created_at, updated_at
```

**å½±å“**:
- âŒ æ— æ³•ç®¡ç†ç”¨æˆ·ç§¯åˆ†è´¦æˆ·
- âŒ æ— æ³•å®ç°åœ¨é€”ç§¯åˆ†æœºåˆ¶

#### 3.2 ç¼ºå¤±ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `points_transactions`

**å¿…éœ€å­—æ®µ**:
```sql
id, account_id, transaction_type, points, balance_after,
related_order_id, related_entity_type, related_entity_id,
status, created_at, completed_at
```

**transaction_typeæšä¸¾**:
- EARN_LEAD_CREATE - çº¿ç´¢åˆ›å»º
- EARN_LEAD_FOLLOWUP - çº¿ç´¢è·Ÿè¿›
- EARN_LEAD_CONVERT - çº¿ç´¢è½¬åŒ–
- EARN_CUSTOMER_VISIT - å®¢æˆ·åˆ°åº—
- EARN_ORDER_CREATE - è®¢å•åˆ›å»º
- EARN_ORDER_SIGN - è‰ç­¾å®Œæˆ
- EARN_MEASUREMENT_COMPLETE - æµ‹é‡å®Œæˆ
- EARN_INSTALLATION_COMPLETE - å®‰è£…å®Œæˆ
- EARN_ORDER_COMPLETE - è®¢å•å®Œæˆ
- EARN_PARTNER_ORDER - å¥½ä¼™ä¼´è®¢å•ç§¯åˆ†
- SPEND_MALL_EXCHANGE - å•†åŸå…‘æ¢
- REFUND - é€€æ¬¾è¿”è¿˜
- FREEZE - å†»ç»“
- UNFREEZE - è§£å†»

**å½±å“**:
- âŒ æ— æ³•è®°å½•ç§¯åˆ†æ˜ç»†
- âŒ æ— æ³•è¿½æº¯ç§¯åˆ†æ¥æº
- âŒ æ— æ³•å®ç°ç§¯åˆ†å¯¹è´¦

#### 3.3 ç¼ºå¤±ç§¯åˆ†è§„åˆ™é…ç½®è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `points_rules`

**å¿…éœ€å­—æ®µ**:
```sql
id, rule_name, rule_type, base_points, 
product_category_multiplier, time_period_multiplier, store_multiplier,
is_active, created_at, updated_at
```

**å½±å“**:
- âŒ æ— æ³•çµæ´»é…ç½®ç§¯åˆ†è§„åˆ™
- âŒ æ— æ³•åŠ¨æ€è°ƒæ•´ç§¯åˆ†ç³»æ•°

#### 3.4 ç¼ºå¤±ç§¯åˆ†å•†åŸç›¸å…³è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**:
- `points_products` - ç§¯åˆ†å•†å“
- `points_orders` - ç§¯åˆ†å…‘æ¢è®¢å•
- `points_order_items` - å…‘æ¢è®¢å•æ˜ç»†
- `points_product_categories` - å•†å“åˆ†ç±»

**å½±å“**:
- âŒ æ— æ³•å®ç°ç§¯åˆ†å•†åŸåŠŸèƒ½ï¼ˆç¬¬ä¸€é˜¶æ®µä¼˜å…ˆï¼‰
- âŒ æ— æ³•å®ç°ä¸“å±ç¤¼å“ç®¡ç†

---

### 4. ã€é«˜ä¼˜å…ˆçº§ã€‘ç½—è±å¥½ä¼™ä¼´ç®¡ç†ç¼ºå¤±

#### 4.1 ç¼ºå¤±å¥½ä¼™ä¼´è¯¦ç»†ä¿¡æ¯è¡¨

**å½“å‰**: `usr_users`è¡¨ä¸­ä»…æœ‰ä¸€ä¸ª`partner_level`å­—æ®µ

**éœ€è¦ç‹¬ç«‹çš„è¡¨**: `partner_profiles`

**å¿…éœ€å­—æ®µ**:
```sql
id, user_id, partner_type, company_name, position,
certification_date, performance_level, total_orders,
total_points_earned, wechat_openid, phone,
created_at, updated_at
```

**partner_typeæšä¸¾**:
- DESIGNER - åœ£éƒ½è®¾è®¡å¸ˆ
- GUIDE - åœ£éƒ½å¯¼è´­

**å½±å“**:
- âŒ æ— æ³•ç®¡ç†å¥½ä¼™ä¼´çš„è¯¦ç»†ä¿¡æ¯
- âŒ æ— æ³•ç»Ÿè®¡å¥½ä¼™ä¼´çš„ä¸šç»©

#### 4.2 ç¼ºå¤±å¥½ä¼™ä¼´ä¸è®¢å•å…³è”è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `sales_order_partners`

**å¿…éœ€å­—æ®µ**:
```sql
id, sales_order_id, partner_id, partner_type, partner_role,
points_earned, points_status, created_at
```

**å½±å“**:
- âŒ è®¢å•æ— æ³•å…³è”åœ£éƒ½è®¾è®¡å¸ˆå’Œå¯¼è´­
- âŒ æ— æ³•è®¡ç®—å¥½ä¼™ä¼´çš„ç§¯åˆ†å¥–åŠ±
- âŒ æ— æ³•å®ç°7å¤©å»¶è¿Ÿç¡®è®¤æœºåˆ¶

---

### 5. ã€é«˜ä¼˜å…ˆçº§ã€‘è´¢åŠ¡ç®¡ç†ç¼ºå£

#### 5.1 ç¼ºå¤±å‘ç¥¨ç®¡ç†è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `invoices`

**å¿…éœ€å­—æ®µ**:
```sql
id, sales_order_id, invoice_no, invoice_type, invoice_amount,
tax_rate, tax_amount, issue_date, issued_by_user_id,
invoice_file_url, status, created_at, updated_at
```

**å½±å“**:
- âŒ æ— æ³•ç®¡ç†é”€å”®å‘ç¥¨
- âŒ æ— æ³•å®ç°"å¿…é¡»å…ˆå¼€å…·å‘ç¥¨æ‰èƒ½è¿›å…¥å›æ¬¾ç¯èŠ‚"çš„ä¸šåŠ¡è§„åˆ™
- âŒ sales_order_amountsè¡¨ä¸­çš„invoice_statuså­—æ®µç¼ºå°‘è¯¦ç»†è®°å½•æ”¯æŒ

#### 5.2 ç¼ºå¤±å›æ¬¾è®°å½•è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `payments`

**å¿…éœ€å­—æ®µ**:
```sql
id, sales_order_id, payment_type, payment_amount, payment_date,
payment_method, payment_proof_url, confirmed_by_user_id,
confirmed_at, created_at, updated_at
```

**payment_typeæšä¸¾**:
- DEPOSIT - å®šé‡‘
- PROGRESS - è¿›åº¦æ¬¾
- FINAL - å°¾æ¬¾

**å½±å“**:
- âŒ æ— æ³•è¯¦ç»†è®°å½•åˆ†æœŸå›æ¬¾
- âŒ sales_order_amountsè¡¨åªæœ‰æ€»é‡‘é¢ï¼Œæ— æ³•æ”¯æŒå¤šæ¬¡å›æ¬¾
- âŒ æ— æ³•å®ç°"ä¸Šä¼ å›æ¬¾å›¾ç‰‡å¹¶å‹¾é€‰å¯¹åº”å•å·"çš„åŠŸèƒ½

#### 5.3 reconciliation_ordersè¡¨è®¾è®¡ä¸è¶³

**å½“å‰å­—æ®µè¿‡äºç®€å•**:
```
id, sales_order_id, reconciliation_date, amount, status, notes
```

**ç¼ºå¤±å­—æ®µ**:
- âŒ `invoice_id` - å…³è”çš„å‘ç¥¨ID
- âŒ `reconciler_user_id` - å¯¹è´¦äºº
- âŒ `reconciliation_items` - å¯¹è´¦æ˜ç»†ï¼ˆJSONï¼‰
- âŒ `difference_amount` - å·®å¼‚é‡‘é¢
- âŒ `difference_reason` - å·®å¼‚åŸå› 

---

### 6. ã€ä¸­ä¼˜å…ˆçº§ã€‘æµ‹é‡/å®‰è£…ç®¡ç†ç¼ºå£

#### 6.1 measurement_ordersè¡¨å­—æ®µä¸è¶³

**å½“å‰å­—æ®µè¿‡äºç®€å•**ï¼ˆä»…9ä¸ªå­—æ®µï¼‰

**ç¼ºå¤±çš„å…³é”®å­—æ®µ**:
- âŒ `measurement_data` - æµ‹é‡æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- âŒ `measurement_photos` - æµ‹é‡ç…§ç‰‡ï¼ˆJSONæ•°ç»„ï¼‰
- âŒ `assigned_by_user_id` - æ´¾å•äººID
- âŒ `assigned_at` - æ´¾å•æ—¶é—´
- âŒ `accepted_at` - æ¥å•æ—¶é—´
- âŒ `started_at` - å¼€å§‹æµ‹é‡æ—¶é—´
- âŒ `completed_at` - å®Œæˆæ—¶é—´
- âŒ `confirmed_by_user_id` - ç¡®è®¤äººï¼ˆé”€å”®ï¼‰
- âŒ `confirmed_at` - ç¡®è®¤æ—¶é—´
- âŒ `rejected_reason` - é©³å›åŸå› 
- âŒ `service_fee` - æœåŠ¡è´¹ç”¨
- âŒ `settlement_status` - ç»“ç®—çŠ¶æ€

**å½“å‰çŠ¶æ€å®šä¹‰ä¸å®Œæ•´**:
```
1-å¾…æµ‹é‡, 2-æµ‹é‡ä¸­, 3-æµ‹é‡å®Œæˆ, 4-æµ‹é‡å¤±è´¥
```

**éœ€æ±‚ä¸­çš„ç»†åˆ†çŠ¶æ€**:
```
å¾…åˆ†é… â†’ åˆ†é…ä¸­ â†’ å¾…ä¸Šé—¨ â†’ æµ‹é‡ä¸­ â†’ å¾…ç¡®è®¤ â†’ å·²ç¡®è®¤/å·²é©³å›
```

#### 6.2 installation_ordersè¡¨å­—æ®µä¸è¶³

**å½“å‰å­—æ®µè¿‡äºç®€å•**ï¼ˆä»…9ä¸ªå­—æ®µï¼‰

**ç¼ºå¤±çš„å…³é”®å­—æ®µ**:
- âŒ `installation_address_notes` - å®‰è£…åœ°å€å¤‡æ³¨ï¼ˆè¿›é—¨å¯†ç ç­‰ï¼‰
- âŒ `installation_photos` - å®‰è£…ç…§ç‰‡ï¼ˆJSONæ•°ç»„ï¼‰
- âŒ `assigned_by_user_id` - æ´¾å•äººID
- âŒ `assigned_at` - æ´¾å•æ—¶é—´
- âŒ `accepted_at` - æ¥å•æ—¶é—´
- âŒ `started_at` - å¼€å§‹å®‰è£…æ—¶é—´
- âŒ `completed_at` - å®Œæˆæ—¶é—´
- âŒ `confirmed_by_user_id` - ç¡®è®¤äººï¼ˆé”€å”®ï¼‰
- âŒ `confirmed_at` - ç¡®è®¤æ—¶é—´
- âŒ `quality_rating` - è´¨é‡è¯„åˆ†
- âŒ `service_fee` - æœåŠ¡è´¹ç”¨
- âŒ `settlement_status` - ç»“ç®—çŠ¶æ€

#### 6.3 ç¼ºå¤±æœåŠ¡å•†ç»“ç®—è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `technician_settlements`

**å¿…éœ€å­—æ®µ**:
```sql
id, technician_id, settlement_period_start, settlement_period_end,
total_orders, total_fee, settlement_status, paid_at,
created_at, updated_at
```

**å½±å“**:
- âŒ æ— æ³•ç®¡ç†æµ‹é‡å¸ˆ/å®‰è£…å¸ˆçš„è´¹ç”¨ç»“ç®—
- âŒ æ— æ³•ç»Ÿè®¡æœåŠ¡å•†æ”¶å…¥

---

### 7. ã€ä¸­ä¼˜å…ˆçº§ã€‘å®¡æ‰¹æµç¨‹å®Œå…¨ç¼ºå¤±

#### 7.1 ç¼ºå¤±å®¡æ‰¹æµç¨‹å®šä¹‰è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `approval_workflows`

**å¿…éœ€å­—æ®µ**:
```sql
id, workflow_name, workflow_type, trigger_conditions,
approval_steps, is_active, created_at, updated_at
```

**workflow_typeæšä¸¾**:
- DISCOUNT_APPROVAL - ç‰¹æ®ŠæŠ˜æ‰£å®¡æ‰¹
- QUOTE_APPROVAL - æŠ¥ä»·å®¡æ‰¹
- BUDGET_APPROVAL - é¢„ç®—å®¡æ‰¹
- URGENT_TAG - åŠ æ€¥æ ‡ç­¾å®¡æ‰¹

#### 7.2 ç¼ºå¤±å®¡æ‰¹å®ä¾‹è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `approval_instances`

**å¿…éœ€å­—æ®µ**:
```sql
id, workflow_id, related_entity_type, related_entity_id,
initiator_user_id, current_step, approval_status,
created_at, updated_at, completed_at
```

#### 7.3 ç¼ºå¤±å®¡æ‰¹è®°å½•è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `approval_logs`

**å¿…éœ€å­—æ®µ**:
```sql
id, instance_id, approver_user_id, step_number,
approval_action, approval_comment, created_at
```

**å½±å“**:
- âŒ æ— æ³•å®ç°å®¡æ‰¹æµç¨‹
- âŒ æ— æ³•æ”¯æŒä¸šåŠ¡/è´¢åŠ¡/ç®¡ç†å®¡æ‰¹äººè§’è‰²
- âŒ å®¡æ‰¹æƒé™æ— æ³•ä½“ç°åœ¨æ•°æ®åº“è®¾è®¡ä¸­

---

### 8. ã€ä¸­ä¼˜å…ˆçº§ã€‘é€šçŸ¥ç³»ç»Ÿå®Œå…¨ç¼ºå¤±

#### 8.1 ç¼ºå¤±é€šçŸ¥æ¨¡æ¿è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `notification_templates`

**å¿…éœ€å­—æ®µ**:
```sql
id, template_name, template_type, content, 
channels, is_active, created_at, updated_at
```

**template_typeæšä¸¾**:
- LEAD_FOLLOWUP_REMINDER - çº¿ç´¢è·Ÿè¸ªæé†’
- ORDER_STATUS_CHANGE - è®¢å•çŠ¶æ€å˜æ›´
- POINTS_EARNED - ç§¯åˆ†åˆ°è´¦
- APPROVAL_REQUEST - å®¡æ‰¹è¯·æ±‚
- PAYMENT_REMINDER - å›æ¬¾æé†’

#### 8.2 ç¼ºå¤±é€šçŸ¥å‘é€è®°å½•è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `notifications`

**å¿…éœ€å­—æ®µ**:
```sql
id, template_id, recipient_user_id, title, content,
channel, status, sent_at, read_at, created_at
```

**å½±å“**:
- âŒ æ— æ³•å®ç°ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥
- âŒ æ— æ³•å®ç°å¾®ä¿¡é€šçŸ¥
- âŒ æ— æ³•è®°å½•é€šçŸ¥å†å²

---

### 9. ã€ä¸­ä¼˜å…ˆçº§ã€‘å•†å“ç®¡ç†ç¼ºå£

#### 9.1 ç¼ºå¤±å•†å“ä¸»è¡¨

**å½“å‰**: åªæœ‰`packages`ï¼ˆå¥—é¤ï¼‰å’Œ`package_items`ï¼ˆå¥—é¤å•†å“å…³è”ï¼‰

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `products`

**å¿…éœ€å­—æ®µ**:
```sql
id, product_code, product_name, category, subcategory,
unit, unit_price, cost_price, status, stock_quantity,
supplier_id, description, images, created_at, updated_at
```

**categoryæšä¸¾**:
- CURTAIN - çª—å¸˜
- WALLPAPER - å¢™å¸ƒ
- WALLBOARD - å¢™å’”

**å½±å“**:
- âŒ æ— æ³•ç‹¬ç«‹ç®¡ç†å•†å“ç›®å½•
- âŒ package_itemsè¡¨çš„å•†å“ä¿¡æ¯æ— å¤„å­˜å‚¨
- âŒ sales_order_itemsè¡¨çš„å•†å“æ¥æºä¸æ˜ç¡®

#### 9.2 ç¼ºå¤±å•†å“åˆ†ç±»è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `product_categories`

**å¿…éœ€å­—æ®µ**:
```sql
id, category_name, parent_category_id, level,
sort_order, is_active, created_at, updated_at
```

#### 9.3 ç¼ºå¤±ä¾›åº”å•†ç®¡ç†è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `suppliers`

**å¿…éœ€å­—æ®µ**:
```sql
id, supplier_name, supplier_code, contact_person,
contact_phone, contact_email, address, 
cooperation_status, created_at, updated_at
```

**å½±å“**:
- âŒ æ— æ³•ç®¡ç†ä¾›åº”å•†ä¿¡æ¯
- âŒ å•†å“è¡¨çš„supplier_idæ— æ³•å…³è”

---

### 10. ã€ä¸­ä¼˜å…ˆçº§ã€‘æ–‡ä»¶ç®¡ç†ç¼ºå¤±

#### 10.1 ç¼ºå¤±æ–‡ä»¶å­˜å‚¨è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `files`

**å¿…éœ€å­—æ®µ**:
```sql
id, file_name, file_path, file_size, file_type, mime_type,
uploaded_by_user_id, related_entity_type, related_entity_id,
storage_location, created_at, deleted_at
```

**å½±å“**:
- âŒ å„è¡¨ä¸­çš„æ–‡ä»¶è·¯å¾„å­—æ®µï¼ˆå¦‚quoted_file_urlï¼‰æ— ç»Ÿä¸€ç®¡ç†
- âŒ æ— æ³•ç»Ÿè®¡æ–‡ä»¶å­˜å‚¨å®¹é‡
- âŒ æ— æ³•æ‰¹é‡æ¸…ç†è¿‡æœŸæ–‡ä»¶

---

### 11. ã€ä½ä¼˜å…ˆçº§ã€‘å…¶ä»–ç¼ºå¤±çš„è¡¨

#### 11.1 ç³»ç»Ÿé…ç½®è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `system_configs`

**ç”¨é€”**: å­˜å‚¨ç³»ç»Ÿçº§é…ç½®ï¼ˆå¦‚ç§¯åˆ†ç³»æ•°ã€é»˜è®¤å€¼ç­‰ï¼‰

#### 11.2 æ“ä½œæ—¥å¿—è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `audit_logs`

**ç”¨é€”**: è®°å½•å…³é”®æ“ä½œçš„å®¡è®¡æ—¥å¿—

#### 11.3 æƒé™ç®¡ç†è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: 
- `roles` - è§’è‰²å®šä¹‰
- `permissions` - æƒé™å®šä¹‰
- `role_permissions` - è§’è‰²æƒé™å…³è”
- `user_roles` - ç”¨æˆ·è§’è‰²å…³è”

**å½±å“**:
- âŒ usr_usersè¡¨çš„user_typeå­—æ®µé‡‡ç”¨ç¡¬ç¼–ç æ–¹å¼
- âŒ æ— æ³•çµæ´»é…ç½®æƒé™
- âŒ æƒé™å˜æ›´éœ€è¦ä¿®æ”¹ä»£ç 

#### 11.4 æ•°æ®å­—å…¸è¡¨

**å®Œå…¨ç¼ºå¤±çš„è¡¨**: `dictionaries`

**ç”¨é€”**: å­˜å‚¨çŠ¶æ€ã€ç±»å‹ç­‰æšä¸¾å€¼å®šä¹‰ï¼Œé¿å…ç¡¬ç¼–ç 

---

## ğŸ”— æ•°æ®å…³è”ç¼ºå£åˆ†æ

### 1. lead_leadsè¡¨å…³è”ç¼ºå¤±

**å½“å‰å…³è”**: 
- âœ… customer_customers.lead_id â†’ lead_leads.id
- âœ… sales_orders.lead_id â†’ lead_leads.id

**ç¼ºå¤±å…³è”**:
- âŒ æœªå…³è”åˆ°store_storesï¼ˆæ‰€å±é—¨åº—ï¼‰
- âŒ æœªå…³è”åˆ°usr_usersï¼ˆåˆ†é…ç»™çš„é”€å”®äººå‘˜ï¼‰
- âŒ æ— æ³•å…³è”åˆ°ç½—è±å¥½ä¼™ä¼´ï¼ˆè®¾è®¡å¸ˆ/å¯¼è´­ï¼‰

### 2. sales_ordersè¡¨å…³è”ç¼ºå¤±

**å½“å‰å…³è”**:
- âœ… sales_orders.lead_id â†’ lead_leads.id
- âœ… sales_orders.customer_id â†’ customer_customers.id
- âœ… sales_orders.salesperson_id â†’ usr_users.id
- âœ… sales_orders.store_id â†’ store_stores.id

**ç¼ºå¤±å…³è”**:
- âŒ æœªå…³è”åˆ°ç½—è±å¥½ä¼™ä¼´ï¼ˆdesigner_id, guide_idï¼‰
- âŒ æœªå…³è”åˆ°å‘ç¥¨è¡¨
- âŒ æœªå…³è”åˆ°å›æ¬¾è®°å½•è¡¨
- âŒ æ— æ³•å…³è”åˆ°ç§¯åˆ†äº¤æ˜“

### 3. usr_usersè¡¨å…³è”ä¸å®Œæ•´

**é—®é¢˜**: ä½¿ç”¨å•ä¸€è¡¨åˆå¹¶äº†å¤ªå¤šç±»å‹çš„äººå‘˜

**å»ºè®®**: åˆ†ç¦»ä¸ºä¸åŒçš„è¡¨
- `internal_users` - å†…éƒ¨å‘˜å·¥
- `partner_users` - ç½—è±å¥½ä¼™ä¼´
- `technician_users` - æµ‹é‡å¸ˆ/å®‰è£…å¸ˆ
- `external_contacts` - å¤–éƒ¨è”ç³»äºº

### 4. measurement_orderså’Œinstallation_orderså…³è”ç¼ºå¤±

**ç¼ºå¤±å…³è”**:
- âŒ æœªå…³è”åˆ°æ´¾å•å‘˜ï¼ˆassigned_by_user_idï¼‰
- âŒ æœªå…³è”åˆ°ç¡®è®¤äººï¼ˆconfirmed_by_user_idï¼‰
- âŒ æ— æ³•å…³è”åˆ°ç»“ç®—è¡¨

---

## ğŸ“‹ ä¸šåŠ¡é€»è¾‘ç¼ºå£æ€»ç»“

### 1. çº¿ç´¢ç®¡ç†æµç¨‹æ— æ³•å®ç°

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **Excelæ‰¹é‡å¯¼å…¥**: æ— æ‰¹é‡å¯¼å…¥è®°å½•è¡¨
2. âŒ **æ™ºèƒ½é‡å¤æ£€æŸ¥**: ç¼ºå°‘åœ°å€ã€è®¾è®¡å¸ˆã€å¯¼è´­ç­‰å…³é”®å­—æ®µ
3. âŒ **è‡ªåŠ¨åˆ†é…è§„åˆ™**: æ— åˆ†é…è§„åˆ™é…ç½®è¡¨
4. âŒ **é¢„è­¦æé†’æœºåˆ¶**: æ— é€šçŸ¥ç³»ç»Ÿæ”¯æŒ
5. âŒ **æ ‡ç­¾ç®¡ç†**: æ— æ ‡ç­¾ç³»ç»Ÿ
6. âŒ **é¢„æŠ¥ä»·ç®¡ç†**: æ— æŠ¥ä»·æ–‡ä»¶å­˜å‚¨
7. âŒ **è·Ÿè¸ªè®°å½•**: æ— è·Ÿè¸ªå†å²è¡¨

### 2. é”€å”®å•27çŠ¶æ€æµè½¬æ— æ³•å®ç°

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **å®Œæ•´çŠ¶æ€æœº**: çŠ¶æ€å®šä¹‰ä¸åŒ¹é…
2. âŒ **æ¨å•æµç¨‹**: æ— æ¨å•æˆªå›¾ã€ç¡®è®¤ç­‰å­—æ®µ
3. âŒ **ç”Ÿäº§å•ç®¡ç†**: æ— ç”Ÿäº§å•å·å’Œå¤‡è´§çŠ¶æ€
4. âŒ **æ–¹æ¡ˆç¡®è®¤**: æ— æ–¹æ¡ˆç¡®è®¤ç…§ç‰‡å­—æ®µ
5. âŒ **å®‰è£…ç®¡ç†**: æ— å®‰è£…å¤‡æ³¨å’Œç…§ç‰‡å­—æ®µ
6. âŒ **çŠ¶æ€å†å²**: æ— çŠ¶æ€æµè½¬è®°å½•è¡¨

### 3. ç§¯åˆ†æ¿€åŠ±ä½“ç³»æ— æ³•å®ç°

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **ç§¯åˆ†è´¦æˆ·**: æ— è´¦æˆ·è¡¨
2. âŒ **ç§¯åˆ†è®¡ç®—**: æ— è§„åˆ™é…ç½®è¡¨
3. âŒ **åœ¨é€”ç§¯åˆ†**: æ— ç§¯åˆ†çŠ¶æ€ç®¡ç†
4. âŒ **ç§¯åˆ†å•†åŸ**: æ— å•†åŸç›¸å…³è¡¨
5. âŒ **å¥½ä¼™ä¼´ç§¯åˆ†**: æ— å¥½ä¼™ä¼´å…³è”å’Œç§¯åˆ†è®¡ç®—

### 4. ç½—è±å¥½ä¼™ä¼´ç®¡ç†æ— æ³•å®ç°

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **å¥½ä¼™ä¼´æ¡£æ¡ˆ**: æ— è¯¦ç»†ä¿¡æ¯è¡¨
2. âŒ **è®¢å•å…³è”**: æ— å¥½ä¼™ä¼´ä¸è®¢å•å…³è”è¡¨
3. âŒ **ç§¯åˆ†æ¿€åŠ±**: æ— ç§¯åˆ†å‘æ”¾æœºåˆ¶
4. âŒ **7å¤©å»¶è¿Ÿç¡®è®¤**: æ— è®¢å•ç¡®è®¤çŠ¶æ€ç®¡ç†

### 5. è´¢åŠ¡ç®¡ç†æµç¨‹ä¸å®Œæ•´

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **å‘ç¥¨ç®¡ç†**: æ— å‘ç¥¨è¡¨
2. âŒ **åˆ†æœŸå›æ¬¾**: æ— å›æ¬¾è®°å½•è¡¨
3. âŒ **å¯¹è´¦æ˜ç»†**: reconciliation_ordersè¡¨è¿‡äºç®€å•
4. âŒ **å›æ¬¾é¢„è­¦**: æ— é¢„è­¦é…ç½®å’Œé€šçŸ¥

### 6. å®¡æ‰¹æµç¨‹æ— æ³•å®ç°

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **å®¡æ‰¹å·¥ä½œæµ**: æ— æµç¨‹å®šä¹‰è¡¨
2. âŒ **å®¡æ‰¹å®ä¾‹**: æ— å®¡æ‰¹è®°å½•è¡¨
3. âŒ **æƒé™æ§åˆ¶**: å®¡æ‰¹æƒé™æ— æ³•ä½“ç°

### 7. æµ‹é‡/å®‰è£…æœåŠ¡ä¸å®Œæ•´

#### ç¼ºå¤±åŠŸèƒ½:
1. âŒ **æ™ºèƒ½æ´¾å•**: æ— æ´¾å•ç®—æ³•æ”¯æŒçš„å­—æ®µ
2. âŒ **æœåŠ¡è´¨é‡**: æ— è´¨é‡è¯„åˆ†å­—æ®µ
3. âŒ **æœåŠ¡å•†ç»“ç®—**: æ— ç»“ç®—ç®¡ç†è¡¨
4. âŒ **ç»©æ•ˆè¯„ä¼°**: æ— ç»©æ•ˆæ•°æ®æ”¯æŒ

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

### Phase 1: ç«‹å³ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 1.1 çº¿ç´¢è¡¨å¢å¼º
```sql
ALTER TABLE lead_leads ADD COLUMN customer_address TEXT;
ALTER TABLE lead_leads ADD COLUMN designer_name VARCHAR(100);
ALTER TABLE lead_leads ADD COLUMN salesperson_name VARCHAR(100);
ALTER TABLE lead_leads ADD COLUMN city VARCHAR(100);
ALTER TABLE lead_leads ADD COLUMN decoration_signed_at DATE;
ALTER TABLE lead_leads ADD COLUMN area DECIMAL(10,2);
ALTER TABLE lead_leads ADD COLUMN package_name VARCHAR(100);
ALTER TABLE lead_leads ADD COLUMN source SMALLINT;
ALTER TABLE lead_leads ADD COLUMN store_id BIGINT;
ALTER TABLE lead_leads ADD COLUMN assigned_to_user_id BIGINT;
ALTER TABLE lead_leads ADD COLUMN last_followup_at TIMESTAMPTZ;
ALTER TABLE lead_leads ADD COLUMN followup_count INT DEFAULT 0;
ALTER TABLE lead_leads ADD COLUMN quoted_at TIMESTAMPTZ;
ALTER TABLE lead_leads ADD COLUMN quoted_file_url TEXT;
-- ä¿®æ”¹statusæšä¸¾
```

#### 1.2 åˆ›å»ºçº¿ç´¢æ ‡ç­¾ç³»ç»Ÿ
```sql
CREATE TABLE lead_tags (
  id BIGSERIAL PRIMARY KEY,
  tag_name VARCHAR(50) NOT NULL,
  tag_category SMALLINT NOT NULL, 
  -- 1-äº§å“ç±», 2-è£…ä¿®é˜¶æ®µ, 3-æ„æ„¿å¼ºåº¦, 4-ç³»ç»Ÿè‡ªåŠ¨
  is_auto BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE lead_tag_assignments (
  id BIGSERIAL PRIMARY KEY,
  lead_id BIGINT NOT NULL,
  tag_id BIGINT NOT NULL,
  assigned_by_user_id BIGINT,
  assigned_at TIMESTAMPTZ DEFAULT NOW(),
  FOREIGN KEY (lead_id) REFERENCES lead_leads(id),
  FOREIGN KEY (tag_id) REFERENCES lead_tags(id)
);
```

#### 1.3 åˆ›å»ºçº¿ç´¢è·Ÿè¸ªè®°å½•è¡¨
```sql
CREATE TABLE lead_followups (
  id BIGSERIAL PRIMARY KEY,
  lead_id BIGINT NOT NULL,
  user_id BIGINT NOT NULL,
  followup_type SMALLINT NOT NULL,
  followup_content TEXT,
  next_followup_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  FOREIGN KEY (lead_id) REFERENCES lead_leads(id),
  FOREIGN KEY (user_id) REFERENCES usr_users(id)
);
```

#### 1.4 é”€å”®å•çŠ¶æ€é‡æ–°è®¾è®¡
```sql
-- å»ºè®®å°†statuså­—æ®µæ”¹ä¸ºVARCHAR(50)å­˜å‚¨çŠ¶æ€ç 
ALTER TABLE sales_orders ALTER COLUMN status TYPE VARCHAR(50);

-- æˆ–åˆ›å»ºçŠ¶æ€æ˜ å°„è¡¨
CREATE TABLE order_statuses (
  id SMALLINT PRIMARY KEY,
  status_code VARCHAR(50) UNIQUE NOT NULL,
  status_name VARCHAR(100) NOT NULL,
  status_category SMALLINT NOT NULL,
  -- 1-çº¿ç´¢, 2-è®¢å•, 3-è´¢åŠ¡, 4-å¼‚å¸¸
  sort_order INT NOT NULL
);
```

#### 1.5 é”€å”®å•å­—æ®µå¢å¼º
```sql
ALTER TABLE sales_orders ADD COLUMN budget_quote_file_url TEXT;
ALTER TABLE sales_orders ADD COLUMN push_order_screenshot_url TEXT;
ALTER TABLE sales_orders ADD COLUMN production_order_nos JSONB;
ALTER TABLE sales_orders ADD COLUMN designer_id BIGINT;
ALTER TABLE sales_orders ADD COLUMN guide_id BIGINT;
ALTER TABLE sales_orders ADD COLUMN installation_notes TEXT;
ALTER TABLE sales_orders ADD COLUMN installation_photo_urls JSONB;
-- ... å…¶ä»–å­—æ®µ
```

#### 1.6 åˆ›å»ºç§¯åˆ†ç³»ç»Ÿæ ¸å¿ƒè¡¨
```sql
CREATE TABLE points_accounts (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  total_points INT DEFAULT 0,
  available_points INT DEFAULT 0,
  pending_points INT DEFAULT 0,
  used_points INT DEFAULT 0,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  FOREIGN KEY (user_id) REFERENCES usr_users(id)
);

CREATE TABLE points_transactions (
  id BIGSERIAL PRIMARY KEY,
  account_id BIGINT NOT NULL,
  transaction_type VARCHAR(50) NOT NULL,
  points INT NOT NULL,
  balance_after INT NOT NULL,
  related_order_id BIGINT,
  status SMALLINT DEFAULT 1,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  FOREIGN KEY (account_id) REFERENCES points_accounts(id)
);
```

### Phase 2: åŠŸèƒ½å®Œå–„ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 2.1 åˆ›å»ºç½—è±å¥½ä¼™ä¼´ç®¡ç†è¡¨
#### 2.2 åˆ›å»ºå®¡æ‰¹æµç¨‹è¡¨
#### 2.3 å®Œå–„æµ‹é‡/å®‰è£…ç®¡ç†
#### 2.4 åˆ›å»ºè´¢åŠ¡ç®¡ç†å®Œæ•´è¡¨ï¼ˆå‘ç¥¨ã€å›æ¬¾ï¼‰
#### 2.5 åˆ›å»ºé€šçŸ¥ç³»ç»Ÿ

### Phase 3: ç³»ç»Ÿä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

#### 3.1 åˆ›å»ºæƒé™ç®¡ç†ä½“ç³»
#### 3.2 åˆ›å»ºæ“ä½œå®¡è®¡æ—¥å¿—
#### 3.3 åˆ›å»ºæ•°æ®å­—å…¸
#### 3.4 åˆ›å»ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿ
#### 3.5 åˆ›å»ºå•†å“å®Œæ•´ä½“ç³»

---

## ğŸ“Š ç»Ÿè®¡æ€»ç»“

### ç¼ºå¤±è¡¨ç»Ÿè®¡
- **å·²å»ºç«‹**: 15ä¸ªè¡¨
- **éœ€è¦æ–°å»º**: çº¦30-35ä¸ªè¡¨
- **éœ€è¦é‡å¤§ä¿®æ”¹**: 5ä¸ªè¡¨ï¼ˆlead_leads, sales_orders, measurement_orders, installation_orders, usr_usersï¼‰

### ç¼ºå¤±å­—æ®µç»Ÿè®¡
- **lead_leads**: çº¦15ä¸ªå…³é”®å­—æ®µç¼ºå¤±
- **sales_orders**: çº¦12ä¸ªå…³é”®å­—æ®µç¼ºå¤±
- **measurement_orders**: çº¦12ä¸ªå…³é”®å­—æ®µç¼ºå¤±
- **installation_orders**: çº¦11ä¸ªå…³é”®å­—æ®µç¼ºå¤±

### ä¸šåŠ¡åŠŸèƒ½è¦†ç›–ç‡
- âœ… **åŸºç¡€L2Cæµç¨‹**: 40%
- âŒ **ç§¯åˆ†æ¿€åŠ±ç³»ç»Ÿ**: 0%
- âŒ **ç½—è±å¥½ä¼™ä¼´ç®¡ç†**: 5%
- âœ… **æµ‹é‡/å®‰è£…åŸºç¡€**: 30%
- âŒ **å®¡æ‰¹æµç¨‹**: 0%
- âŒ **é€šçŸ¥ç³»ç»Ÿ**: 0%
- âœ… **è´¢åŠ¡ç®¡ç†**: 25%
- âœ… **å•†å“ç®¡ç†**: 20%

**æ€»ä½“è¦†ç›–ç‡**: çº¦25%ï¼ˆä»…æ»¡è¶³åŸºç¡€æ¡†æ¶ï¼Œæ ¸å¿ƒåŠŸèƒ½æ— æ³•å®ç°ï¼‰

---

## âš¡ è¡ŒåŠ¨å»ºè®®

### ä¼˜å…ˆçº§æ’åº

**P0ï¼ˆæ ¸å¿ƒé˜»å¡ï¼‰**:
1. çº¿ç´¢è¡¨å­—æ®µå¢å¼º + æ ‡ç­¾ç³»ç»Ÿ
2. é”€å”®å•27çŠ¶æ€é‡æ–°è®¾è®¡
3. ç§¯åˆ†è´¦æˆ·å’Œäº¤æ˜“è¡¨åˆ›å»º

**P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰**:
4. ç½—è±å¥½ä¼™ä¼´ç®¡ç†è¡¨
5. å‘ç¥¨å’Œå›æ¬¾è¡¨
6. æµ‹é‡/å®‰è£…å­—æ®µå¢å¼º

**P2ï¼ˆå®Œå–„åŠŸèƒ½ï¼‰**:
7. å®¡æ‰¹æµç¨‹è¡¨
8. é€šçŸ¥ç³»ç»Ÿè¡¨
9. å•†å“å®Œæ•´ä½“ç³»

**P3ï¼ˆä¼˜åŒ–é¡¹ï¼‰**:
10. æƒé™ç®¡ç†RBAC
11. æ“ä½œå®¡è®¡æ—¥å¿—
12. æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-28  
**åˆ†æäººå‘˜**: æ•°æ®åº“æ¶æ„å¸ˆ  
**ç‰ˆæœ¬**: v1.0
