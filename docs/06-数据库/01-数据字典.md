# 罗莱L2C 数据字典

> **版本**: v1.0
> **更新日期**: 2025-12-07
> **状态**: 正式 (基于分散文档整合)

## 📚 目录

1. [用户与权限 (User & Auth)](#1-用户与权限-user--auth)
   - [usr_users (人员表)](#11-人员表-usr_users)
2. [线索与客户 (CRM)](#2-线索与客户-crm)
   - [lead_leads (线索表)](#21-线索表-lead_leads)
   - [customer_customers (客户表)](#22-客户表-customer_customers)
   - [business_customers (B端客户表)](#23-b端客户表-business_customers)
3. [渠道与门店 (Channel & Store)](#3-渠道与门店-channel--store)
   - [channel_channels (渠道表)](#31-渠道表-channel_channels)
   - [store_stores (门店表)](#32-门店表-store_stores)
4. [商品与供应链 (Product & Supply Chain)](#4-商品与供应链-product--supply-chain)
   - [product_categories (商品分类表)](#41-商品分类表-product_categories)
   - [products (商品表)](#42-商品表-products)
   - [packages (套餐表)](#43-套餐表-packages)
   - [package_items (套餐商品表)](#44-套餐商品表-package_items)
   - [suppliers (供应商表)](#45-供应商表-suppliers)
5. [销售订单 (Sales Order)](#5-销售订单-sales-order)
   - [sales_orders (销售订单表)](#51-销售订单表-sales_orders)
   - [sales_order_items (销售订单商品表)](#52-销售订单商品表-sales_order_items)
   - [sales_order_packages (销售订单套餐表)](#53-销售订单套餐表-sales_order_packages)
   - [sales_order_amounts (销售订单金额表)](#54-销售订单金额表-sales_order_amounts)
6. [交付与服务 (Delivery & Service)](#6-交付与服务-delivery--service)
   - [measurement_orders (测量订单表)](#61-测量订单表-measurement_orders)
   - [installation_orders (安装订单表)](#62-安装订单表-installation_orders)
   - [reconciliation_orders (对账订单表)](#63-对账订单表-reconciliation_orders)

---

## 1. 用户与权限 (User & Auth)

### 1.1 人员表 (usr_users)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 人员ID |
| user_type | SMALLINT | NOT NULL | 人员类型：1-内部员工-驻店销售, 2-内部员工-远程销售, 3-内部员工-订单客服, 4-内部员工-派单员, 5-内部员工-销售负责人, 6-内部员工-渠道负责人, 7-罗莱好伙伴, 8-测量师, 9-安装师, 10-外部联系人-渠道关键人, 11-外部联系人-门店关键对接人, 12-外部联系人-其他 |
| name | VARCHAR(100) | NOT NULL | 姓名 |
| contact_info | VARCHAR(200) | NOT NULL | 联系方式 |
| store_id | BIGINT | FOREIGN KEY REFERENCES store_stores(id) ON DELETE SET NULL | 所属门店ID |
| is_external | BOOLEAN | DEFAULT FALSE | 是否为外部联系人 |
| external_company | VARCHAR(200) | | 外部联系人所属公司 |
| external_position | VARCHAR(100) | | 外部联系人职位 |
| certification_level | VARCHAR(50) | | 测量师/安装师认证等级 |
| partner_level | VARCHAR(50) | | 罗莱好伙伴等级 |
| status | SMALLINT | DEFAULT 1 | 状态：1-启用, 2-禁用 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

#### 索引设计

| 索引名称 | 索引字段 | 索引类型 | 描述 |
|----------|----------|----------|------|
| idx_user_type | user_type | INDEX | 按人员类型查询 |
| idx_user_name | name | INDEX | 按姓名查询 |
| idx_user_store_id | store_id | INDEX | 按所属门店查询 |
| idx_user_is_external | is_external | INDEX | 按是否为外部联系人查询 |
| idx_user_status | status | INDEX | 按状态查询 |

---

## 2. 线索与客户 (CRM)

### 2.1 线索表 (lead_leads)

#### 表结构设计

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| `id` | BIGSERIAL | PRIMARY KEY | 线索ID |
| `name` | VARCHAR(100) | NOT NULL | 客户姓名 |
| `contact_info` | VARCHAR(255) | NOT NULL | 联系方式（手机号） |
| `status` | SMALLINT | NOT NULL | 线索状态：1-待分配, 2-待跟踪, 3-跟踪中, 4-草签, 5-已失效 |
| `customer_address` | TEXT | NULL | 客户地址（重复检查核心字段） |
| `designer_id` | BIGINT | NULL | 圣都设计师ID（外键：usr_users） |
| `designer_name` | VARCHAR(100) | NULL | 圣都设计师姓名（冗余存储） |
| `salesperson_id` | BIGINT | NULL | 圣都导购ID（外键：usr_users） |
| `salesperson_name` | VARCHAR(100) | NULL | 圣都导购姓名（冗余存储） |
| `city` | VARCHAR(100) | NULL | 经营城市店 |
| `decoration_signed_at` | DATE | NULL | 硬装正签时间 |
| `area` | DECIMAL(10,2) | NULL | 面积（平方米） |
| `package_name` | VARCHAR(100) | NULL | 套餐名称 |
| `source` | SMALLINT | NOT NULL DEFAULT 1 | 线索来源：1-Excel导入, 2-手动创建, 3-推荐, 4-线上渠道, 5-展会活动, 6-其他 |
| `store_id` | BIGINT | NULL | 所属门店（外键：store_stores） |
| `assigned_to_user_id` | BIGINT | NULL | 分配给的销售人员（外键：usr_users） |
| `last_followup_at` | TIMESTAMPTZ | NULL | 最后跟踪时间 |
| `followup_count` | INT | NOT NULL DEFAULT 0 | 跟踪次数 |
| `next_followup_at` | TIMESTAMPTZ | NULL | 下次跟踪时间 |
| `similarity_score` | DECIMAL(5,2) | NULL | 重复检查相似度分数（0-100） |
| `quoted_at` | TIMESTAMPTZ | NULL | 预报价时间 |
| `quoted_file_url` | TEXT | NULL | 预报价文件路径 |
| `created_by_user_id` | BIGINT | NULL | 创建人（外键：usr_users） |
| `created_at` | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| `updated_at` | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| `deleted_at` | TIMESTAMPTZ | NULL | 软删除时间 |

#### 索引设计

- `idx_lead_status`: 状态索引
- `idx_lead_assigned_to`: 分配人索引
- `idx_lead_store`: 门店索引
- `idx_lead_city`: 城市索引
- `idx_lead_contact`: 手机号索引（重复检查）
- `idx_lead_address_gin`: 地址索引（GIN索引支持模糊查询）
- `idx_lead_name_address`: 姓名+地址复合索引

### 2.2 客户表 (customer_customers)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 客户ID |
| lead_id | BIGINT | FOREIGN KEY REFERENCES lead_leads(id) ON DELETE SET NULL | 关联的潜在客户ID |
| customer_type | SMALLINT | NOT NULL | 客户类型：1-C端个人客户, 2-B端企业客户 |
| name | VARCHAR(100) | NOT NULL | 客户名称 |
| contact_info | VARCHAR(200) | NOT NULL | 联系方式 |
| address | TEXT | NOT NULL | 客户地址 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

### 2.3 B端客户表 (business_customers)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | B端客户ID |
| customer_id | BIGINT | UNIQUE, FOREIGN KEY REFERENCES customer_customers(id) ON DELETE CASCADE | 关联的客户ID（一对一关系） |
| company_name | VARCHAR(100) | NOT NULL | 企业名称 |
| legal_representative | VARCHAR(50) | NOT NULL | 法定代表人 |
| business_license | VARCHAR(50) | NOT NULL | 营业执照编号 |
| tax_registration | VARCHAR(50) | NOT NULL | 税务登记证号 |
| company_scale | SMALLINT | NOT NULL | 企业规模：1-微型, 2-小型, 3-中型, 4-大型 |
| business_scope | TEXT | NOT NULL | 经营范围 |
| established_date | DATE | NOT NULL | 成立日期 |
| status | SMALLINT | DEFAULT 1 | 合作状态：1-合作中, 2-暂停合作, 3-终止合作 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

---

## 3. 渠道与门店 (Channel & Store)

### 3.1 渠道表 (channel_channels)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 渠道ID |
| channel_name | VARCHAR(100) | NOT NULL | 渠道名称 |
| channel_level | SMALLINT | NOT NULL | 渠道级别：1-一级渠道, 2-二级渠道, 3-三级渠道 |
| involved_cities | TEXT | | 涉及的城市（多个城市用逗号分隔） |
| channel_manager_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 渠道负责人ID |
| channel_key_person_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 渠道关键人ID |
| status | SMALLINT | DEFAULT 1 | 渠道状态：1-合作中, 2-未合作, 3-开发中 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

### 3.2 门店表 (store_stores)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 门店ID |
| store_name | VARCHAR(100) | NOT NULL | 门店名称 |
| address | TEXT | NOT NULL | 门店地址 |
| city | VARCHAR(100) | NOT NULL | 所在城市 |
| contact_info | VARCHAR(200) | NOT NULL | 联系方式 |
| channel_id | BIGINT | FOREIGN KEY REFERENCES channel_channels(id) ON DELETE SET NULL | 所属渠道ID |
| in_store_sales_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 驻店销售ID |
| remote_sales_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 远程销售ID |
| order_service_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 订单客服ID |
| dispatcher_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 派单员ID |
| sales_manager_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 销售负责人ID |
| key_contact_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 关键对接人ID |
| status | SMALLINT | DEFAULT 1 | 门店状态：1-开店, 2-装修中, 3-闭店 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

---

## 4. 商品与供应链 (Product & Supply Chain)

### 4.1 商品分类表 (product_categories)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 分类ID |
| category_code | VARCHAR(50) | UNIQUE, NOT NULL | 分类编码 |
| category_name | VARCHAR(100) | NOT NULL | 分类名称 |
| parent_category_id | BIGINT | FOREIGN KEY REFERENCES product_categories(id) ON DELETE SET NULL | 父分类ID |
| level | SMALLINT | NOT NULL | 分类层级 |
| category_type | VARCHAR(50) | NOT NULL | 分类类型：PRODUCT-商品分类, PACKAGE-套餐分类 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |

### 4.2 商品表 (products)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 商品ID |
| product_code | VARCHAR(50) | UNIQUE, NOT NULL | 商品编码 |
| product_name | VARCHAR(200) | NOT NULL | 商品名称 |
| category | VARCHAR(50) | NOT NULL | 商品品类：CURTAIN, WALLPAPER, WALLBOARD |
| unit | VARCHAR(20) | NOT NULL | 计量单位 |
| standard_price | DECIMAL(10,2) | NOT NULL | 标准售价 |
| cost_price | DECIMAL(10,2) | | 成本价 |
| supplier_id | BIGINT | FOREIGN KEY REFERENCES suppliers(id) ON DELETE SET NULL | 供应商ID |
| product_features | JSONB | | 商品特性（JSON：颜色、材质、风格等） |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

### 4.3 套餐表 (packages)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 套餐ID |
| name | VARCHAR(100) | NOT NULL | 套餐名称 |
| description | TEXT | NOT NULL | 套餐描述 |
| price | DECIMAL(10,2) | NOT NULL | 套餐价格 |
| status | SMALLINT | NOT NULL | 套餐状态：1-启用, 2-禁用 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

### 4.4 套餐商品表 (package_items)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 套餐商品ID |
| package_id | BIGINT | FOREIGN KEY REFERENCES packages(id) ON DELETE CASCADE | 套餐ID |
| item_id | BIGINT | NOT NULL | 商品ID |
| item_name | VARCHAR(100) | NOT NULL | 商品名称 |
| quantity | INT | NOT NULL | 商品数量 |

### 4.5 供应商表 (suppliers)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 供应商ID |
| supplier_code | VARCHAR(50) | UNIQUE, NOT NULL | 供应商编码 |
| supplier_name | VARCHAR(200) | NOT NULL | 供应商名称 |
| supplier_type | VARCHAR(50) | NOT NULL | 供应商类型：MANUFACTURER, DISTRIBUTOR, AGENT |
| contact_person | VARCHAR(100) | NOT NULL | 联系人 |
| contact_phone | VARCHAR(20) | NOT NULL | 联系电话 |
| cooperation_status | VARCHAR(50) | NOT NULL DEFAULT 'ACTIVE' | 合作状态 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

---

## 5. 销售订单 (Sales Order)

### 5.1 销售订单表 (sales_orders)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 销售订单ID |
| order_no | VARCHAR(50) | UNIQUE, NOT NULL | 订单编号 |
| lead_id | BIGINT | FOREIGN KEY REFERENCES lead_leads(id) ON DELETE SET NULL | 潜在客户ID |
| customer_id | BIGINT | FOREIGN KEY REFERENCES customer_customers(id) ON DELETE SET NULL | 客户ID |
| salesperson_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 销售人员ID |
| store_id | BIGINT | FOREIGN KEY REFERENCES store_stores(id) ON DELETE SET NULL | 门店ID |
| order_type | SMALLINT | NOT NULL | 订单类型：1-零售, 2-批发, 3-定制 |
| order_date | DATE | NOT NULL | 订单日期 |
| status | SMALLINT | NOT NULL | 订单状态：1-待审核, 2-已审核, 3-已发货, 4-已完成, 5-已取消 |
| delivery_address | TEXT | NOT NULL | 交付地址 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 更新时间 |
| deleted_at | TIMESTAMPTZ | NULL | 删除时间(软删除) |

### 5.2 销售订单商品表 (sales_order_items)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 商品ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE CASCADE | 订单ID |
| item_id | BIGINT | FOREIGN KEY REFERENCES package_items(id) ON DELETE SET NULL | 套餐商品ID |
| quantity | INT | NOT NULL | 商品数量 |
| price | DECIMAL(10,2) | NOT NULL | 商品单价 |

### 5.3 销售订单套餐表 (sales_order_packages)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 套餐ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE CASCADE | 订单ID |
| package_id | BIGINT | FOREIGN KEY REFERENCES packages(id) ON DELETE SET NULL | 套餐ID |
| quantity | INT | NOT NULL | 套餐数量 |
| price | DECIMAL(10,2) | NOT NULL | 套餐单价 |

### 5.4 销售订单金额表 (sales_order_amounts)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 金额ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE CASCADE | 订单ID |
| customer_id | BIGINT | FOREIGN KEY REFERENCES customer_customers(id) ON DELETE SET NULL | 客户ID |
| total_amount | DECIMAL(10,2) | NOT NULL | 订单总金额 |
| discount | DECIMAL(10,2) | DEFAULT 0.00 | 折扣金额 |
| actual_payment | DECIMAL(10,2) | NOT NULL | 实际支付金额 |
| payment_status | SMALLINT | NOT NULL | 支付状态：1-待支付, 2-部分支付, 3-已支付, 4-已退款 |
| paid_amount | DECIMAL(10,2) | DEFAULT 0.00 | 已支付金额 |
| remaining_amount | DECIMAL(10,2) | DEFAULT 0.00 | 剩余金额 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |

---

## 6. 交付与服务 (Delivery & Service)

### 6.1 测量订单表 (measurement_orders)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 测量订单ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE SET NULL | 销售订单ID |
| technician_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 测量技师ID |
| measurement_date | DATE | NOT NULL | 测量日期 |
| status | SMALLINT | NOT NULL | 测量状态：1-待测量, 2-测量中, 3-测量完成, 4-测量失败 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |

### 6.2 安装订单表 (installation_orders)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 安装订单ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE SET NULL | 销售订单ID |
| technician_id | BIGINT | FOREIGN KEY REFERENCES usr_users(id) ON DELETE SET NULL | 安装技师ID |
| installation_date | DATE | NOT NULL | 安装日期 |
| status | SMALLINT | NOT NULL | 安装状态：1-待安装, 2-安装中, 3-安装完成, 4-安装失败 |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |

### 6.3 对账订单表 (reconciliation_orders)

#### 表结构设计

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | BIGSERIAL | PRIMARY KEY | 对账订单ID |
| sales_order_id | BIGINT | FOREIGN KEY REFERENCES sales_orders(id) ON DELETE SET NULL | 销售订单ID |
| reconciliation_date | DATE | NOT NULL | 对账日期 |
| amount | DECIMAL(10,2) | NOT NULL | 对账金额 |
| status | VARCHAR(20) | NOT NULL | 对账状态：pending, reconciling, completed, discrepancy, adjusted, cancelled |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | 创建时间 |
