# 小程序产品需求文档 (PRD)

## 1. 产品概述

**目标**：打造一个统一的“L2C 窗帘业务平台”小程序，连接租户（商家）、员工和终端客户。通过一个 AppID 满足不同角色的业务需求，并实现私域流量的自然沉淀。

## 2. 用户角色 (User Roles)

| 角色                 | 代码标识    | 核心职责       | 数据权限                  | 关键场景                                       |
| :------------------- | :---------- | :------------- | :------------------------ | :--------------------------------------------- |
| **老板 (Boss)**      | `admin`     | 全局管理、决策 | **全员可见** (Public Sea) | 看经营报表、审批特价、分配线索                 |
| **销售 (Sales)**     | `sales`     | 谈单、跟进     | **仅己方可见** (Private)  | 开报价单、跟进私海客户                         |
| **师傅 (Installer)** | `installer` | 量房、安装     | **仅任务可见** (No Price) | 查看分配的安装任务、上传现场图、**不可见金额** |
| **客户 (Customer)**  | `customer`  | 消费、体验     | 仅己方订单                | 浏览商品、确认报价、查看进度                   |

## 3. 功能需求 (Functional Requirements)

### 3.1 统一入口与落地页 (Landing & Entry)

- **场景描述**：未登录或未绑定租户的用户（访客）首次进入小程序。
- **页面内容**：
  - **营销轮播 (Carousel)**：展示平台/品牌优势、精选案例图。
  - **价值主张**：文字介绍核心服务。
  - **操作入口**：
    - [主按钮]：微信一键登录/注册（获取手机号）。
    - [副链接]：“我是商家，创建企业”。
- **逻辑要求**：
  - 已登录且有租户的用户，启动时**自动跳过**此页，直接进入首页。

### 3.2 获客与邀请 (Acquisition & Invitation)

- **员工入职 (老板 -> 员工)**：
  - 管理员生成“员工邀请卡片”。
  - 员工点击 -> 确认 -> 分配角色 (Sales/Installer)。
- **任务分配 (派单制)**：
  - 销售/老板创建安装/量房任务 -> 指定安装师傅。
  - 师傅在“任务列表”收到通知。
- **客户绑定 (业务即邀请)**：
  - 销售分享具体业务单据（报价单/案例）。
  - 客户点击 -> 静默绑定 -> 归属该销售。

### 3.3 角色化首页 (Role-Based Views)

#### A. 老板端 (Admin View)

- **工作台**：全店今日数据（销售额）、待审批单据。
- **CRM**：全店客户公海、线索分配。
- **报表**：经营分析图表。
- **我的**：企业设置、人员管理。

#### B. 销售端 (Sales View)

- **工作台**：今日跟进、我的待办。
- **CRM**：**我的客户**列表 (Private)。
- **我的**：个人业绩查看。

#### C. 师傅端 (Installer View)

- **任务列表**：待量房、待安装（仅显示地址、联系人、时间、备注）。
- **我的**：历史任务记录。
- **敏感信息屏蔽**：严禁展示订单金额、利润等信息。

#### D. 客户端 (Customer View)

- **首页**：业务进度卡片 + 推荐商品/案例。
- **订单**：历史交易记录。
- **服务**：预约/售后。

### 3.4 交易与交付 (Transaction & Delivery)

- **电子签约 (E-Signature)**：
  - **确认机制**：客户确认报价单时，**强制要求**在小程序上手写签名。
  - **凭证留存**：系统自动合成带签名的 PDF 订单/合同，作为法律凭证。
- **支付体系 (Flexible Payment)**：
  - **租户配置**：管理员在后台可开启/关闭“微信支付”功能。
  - **线下模式 (默认)**：客户转账 -> 销售/财务上传转账截图 -> 财务审核确认。
  - **线上模式 (可选)**：租户配置商户号 -> 客户一键支付 -> 自动核销订单 -> 资金直达租户账户。

### 3.5 分享与冷启动流程 (Share & Bind Workflow)

- **业务闭环**：销售分享报价单 -> 客户点击 -> (未登录则注册/绑定) -> 确认签字 -> 成为私域客户。
- **冷启动逻辑 (Cold Launch)**：
  - **场景**：用户通过点击分享卡片（如 `/pages/quotes/detail?id=xyz`）首次进入。
  - **未登录拦截**：
    1.  系统捕获目标路径与参数。
    2.  强制跳转至 `Landing` 页。
    3.  用户完成登录/注册后，**精准还原**跳转回原目标页（报价单详情），而非默认首页。
  - **自动绑定**：用户在登录/注册过程中，若带有分享参数（如 `salesId`），系统自动将其归属关系绑定至对应销售/门店。

## 4. 非功能需求 (Non-Functional)

- **消息触达 (Notifications)**：
  - **策略**：严格遵循微信规范，仅使用**订阅消息 (Subscription Messages)**。
  - **触发点**：
    - 客户侧：下单成功、发货提醒、预约确认。
    - 师傅侧：新任务提醒（需长期订阅或短信补充）。
    - 销售/老板侧：新订单通知、审批提醒。
  - **交互**：在关键按钮（如“确认下单”、“提交预约”）前请求订阅授权。
