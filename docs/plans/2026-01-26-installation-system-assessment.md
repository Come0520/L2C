# 安装系统技术选型与工作量评估报告

## 1. 评估背景
**需求目标**：开发“安装系统”模块，用于管理派单、安装、验收、售后等流程。
**核心对比**：
*   **方案 A**：在现有微信小程序（L2C-MiniProgram）中增加安装模块。
*   **方案 B**：开发一个独立的安装系统 App（iOS/Android）。

## 2. 结论摘要 (Executive Summary)

**推荐选择：方案 A（小程序集成）**

*   **工作量对比**：独立 App 的开发工作量约为小程序集成的 **2.5 倍 ~ 3 倍**。
*   **核心理由**：
    1.  **复用度高**：现有小程序已具备完整的账号体系、API 封装、UI 组件库（TDesign/Vant Weapp 等）及业务上下文（订单/商品数据）。
    2.  **维护成本低**：无需维护 iOS/Android 双端兼容性、证书签名、应用商店上架及审核。
    3.  **用户体验统一**：销售、派单员、师傅若在同一生态下协作，消息通知与数据流转更顺畅，无需切换应用。
    4.  **功能满足度**：微信小程序提供的 GPS、拍照、Canvas 签名能力完全满足《安装单需求文档》中的核心功能。

## 3. 详细维度对比分析

### 3.1 开发工作量 (Development Effort)

| 维度 | 方案 A：小程序集成 (推荐) | 方案 B：独立 App (Flutter/RN) | 差异分析 |
| :--- | :--- | :--- | :--- |
| **基础设施** | **已就绪** (直接复用 `miniprogram/` 架构) | **需新建** (约 5-10 人天) <br>包含项目搭建、CI/CD、原生模块配置 | 方案 B 需从零搭建脚手架 |
| **账号与权限** | **已就绪** (复用现有 Token/User 逻辑) | **需新建** (约 3-5 人天) <br>需重新对接登录、权限控制 | 方案 B 重复造轮子 |
| **公共组件** | **已就绪** (复用现有 UI/Utils) | **需新建/迁移** (约 10-15 人天) <br>需移植现有组件库 | 方案 B 无法直接复用 WXSS/WXML |
| **业务功能** | 专注业务逻辑实现 (约 20-30 人天) | 同样业务逻辑 (约 20-30 人天) | 核心业务耗时相近 |
| **发布上架** | 即时发布 (微信后台审核，<1天) | 繁琐 (App Store/Google Play, 3-7天) | 方案 B 审核不可控，热更需额外机制 |
| **总预估工时** | **~30 人天** | **~80 人天** | **增加 ~160% 工作量** |

### 3.2 技术可行性与限制 (Feasibility)

根据《安装单需求文档》，对关键技术点进行评估：

| 需求点 | 小程序能力 | 独立 App 能力 | 评估结论 |
| :--- | :--- | :--- | :--- |
| **GPS 签到/轨迹** | 支持 `wx.getLocation`。后台持续定位受限，但签到/签退（瞬时定位）完全支持。 | 支持更强大的后台持续定位和轨迹追踪。 | 若仅需签到/签退，小程序足够；若需实时行程监控，App 更优。 |
| **现场拍照** | 支持 `wx.chooseImage` (压缩/水印)。 | 支持原生相机，性能更优。 | 小程序完全满足。 |
| **电子签名** | 支持 Canvas 2D。 | 支持原生 Canvas。 | 体验差异不大，小程序已够用。 |
| **离线模式** | 支持 Storage/FileSystem (10MB 代码包，用户数据限制)。 | 支持 SQLite/Realm，本地存储空间大。 | 如果离线数据量巨大（如大量图纸），App 有优势；普通单据小程序没问题。 |
| **消息推送** | 模板消息 (Service Notification)，受限于用户交互。 | 原生 Push，送达率更高，无交互限制。 | 企业内部场景下，微信服务通知+短信触达率通常足够。 |

### 3.3 用户与运维成本

*   **安装门槛**：
    *   **小程序**：无需下载，扫码即用，极低门槛。适合外包/临时师傅快速上手。
    *   **App**：需下载安装包（iOS 甚至需要 TestFlight 或企业签），更新需重新下载，推广阻力大。
*   **版本更新**：
    *   **小程序**：全量强制推更，保证所有师傅使用最新逻辑，避免数据版本冲突。
    *   **App**：用户可能长期不更新，导致多版本并存，后端需维护旧接口兼容，增加维护负担。

## 4. 潜在风险与应对 (Risks & Mitigations)

如果选择**小程序方案**，需注意以下潜在风险：

1.  **后台定位限制**：微信对后台持续定位管控严格。
    *   *应对*：在需求中明确，只需要“签到”和“签退”时的点状定位，而非全程轨迹，这完全符合小程序规范。
2.  **图片上传体验**：大量高清图上传可能在此弱网下卡顿。
    *   *应对*：利用微信自带的图片压缩接口，限制上传分辨率，并实现断点续传/队列上传机制。

## 5. 建议实施路径

1.  **复用现有 `miniprogram` 目录**：在 `pages` 下新增 `install` 分包（Subpackage），避免主包体积过大。
2.  **共享逻辑**：将 `utils/request.ts`, `models/` 等逻辑抽离，确保订单模块与安装模块的数据模型一致。
3.  **灰度测试**：利用小程序体验版功能，先让部分核心安装师傅试用，收集反馈。

此致
Antigravity 开发组
