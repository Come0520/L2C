# L2C 开发待办清单 (TodoList)

> 生成时间：2026-01-15
> 范围：全部模块

---

## 📊 模块优先级概览

| 优先级 | 模块 | 当前完成度 | 目标完成度 | 预计工时 |
|--------|------|------------|------------|----------|
| P0 | 审批流程 (Approval) | 30% | 80% | 5 天 |
| P0 | 通知中心 (Notifications) | 35% | 80% | 4 天 |
| P1 | 渠道管理 (Channels) | 40% | 85% | 2 天 |
| P1 | 数据分析 (Analytics) | 50% | 85% | 3 天 |
| P2 | 产品管理 (Products) | 65% | 90% | 2 天 |
| P2 | 订单管理 (Orders) | 70% | 90% | 2 天 |
| P3 | 系统设置 (Settings) | 70% | 85% | 1.5 天 |
| P3 | 财务模块 (Finance) | 75% | 90% | 2 天 |
| P3 | 服务模块 (测量/安装) | 80% | 90% | 1.5 天 |
| P3 | 供应链 (Supply-Chain) | 80% | 90% | 1.5 天 |
| **P4** | **客户管理 (Customers)** | **85%** | **95%** | **1 天** |
| **P4** | **售后服务 (After-Sales)** | **85%** | **95%** | **1 天** |
| **P4** | **线索管理 (Leads)** | **90%** | **98%** | **0.5 天** |
| **P4** | **报价系统 (Quotes)** | **95%** | **100%** | **0.5 天** |

---

## 🔴 P0 - 紧急 (阻塞上线)

### 1. 审批流程 (Approval) - 30% → 80%

**现状分析**：
- 仅有 1 个 `workflow-list.tsx` 组件
- 有 actions 目录但功能不完整
- 无 E2E 测试覆盖

**待办事项**：

- [ ] **[Approval-01] 完善审批引擎核心逻辑**
  - 实现 `ApprovalTemplate` 数据模型
  - 实现 `ApprovalNode` 节点配置
  - 实现 `ApprovalInstance` 实例管理
  - 预计工时：2 天

- [ ] **[Approval-02] 实现可视化审批流设计器**
  - 创建 `approval-flow-designer.tsx` 拖拽式配置界面
  - 支持串行/并行节点
  - 支持条件分支
  - 预计工时：1.5 天

- [ ] **[Approval-03] 预置常用审批模板**
  - 报价折扣审批 (折扣 > 20%)
  - 订单撤销审批
  - 特殊工费审批
  - 坏账核销审批
  - 预计工时：1 天

- [ ] **[Approval-04] 添加 E2E 测试**
  - 创建 `e2e/flows/approval.spec.ts`
  - 覆盖审批发起、审核、驳回流程
  - 预计工时：0.5 天

---

### 2. 通知中心 (Notifications) - 35% → 80%

**现状分析**：
- 有 `notification-list.tsx` 和 `sla-monitor.tsx` 两个组件
- 有 `sla-checker.ts` SLA 检查器
- 有适配器目录 `adapters/`，但多渠道推送未完全实现
- 无 E2E 测试

**待办事项**：

- [ ] **[Notify-01] 实现站内信 (In-App) 完整功能**
  - 通知列表分页 (未实现)
  - 已读/未读状态管理
  - 批量标记已读
  - 预计工时：0.5 天

- [x] **[Notify-02] 集成飞书 (Lark) Webhook**
  - 实现 `lark-adapter.ts`
  - 配置 Webhook URL
  - 支持富文本卡片消息
  - 预计工时：1 天

- [ ] **[Notify-03] 集成微信服务号推送**
  - 实现 `wechat-adapter.ts` (仅实现 Stub)
  - 模板消息配置
  - 用户 OpenID 绑定
  - 预计工时：1.5 天

- [ ] **[Notify-04] 用户通知偏好设置**
  - 完善 `notification-preferences-form.tsx` (仅 UI Mock)
  - 按消息类型配置接收渠道
  - 预计工时：0.5 天

- [ ] **[Notify-05] 添加 E2E 测试**
  - 创建 `e2e/flows/notifications.spec.ts`
  - 预计工时：0.5 天

---

## 🟠 P1 - 高优先级 (核心功能完善)

### 3. 渠道管理 (Channels) - 40% → 85%

**现状分析**：
- 有 `channel-table.tsx`、`channel-form.tsx`、`channel-picker.tsx` 三个组件
- Actions 目录有 3 个文件
- 无 E2E 测试

**待办事项**：

- [ ] **[Channel-01] 完善三级渠道结构**
  - 大类 (线上/线下/转介绍)
  - 子渠道 (抖音/小红书/门店)
  - 具体来源 (具体账号/门店名)
  - 预计工时：0.5 天

- [ ] **[Channel-02] 渠道效果分析面板**
  - 创建 `channel-analytics.tsx`
  - 展示转化率、客单价、ROI
  - 预计工时：1 天

- [ ] **[Channel-03] 渠道归因规则配置**
  - 首次触点 / 末次触点
  - 预计工时：0.5 天

- [ ] **[Channel-04] 添加 E2E 测试**
  - 创建 `e2e/flows/channels.spec.ts`
  - 预计工时：0.5 天

---

### 4. 数据分析 (Analytics) - 50% → 85%

**现状分析**：
- 有 `stat-card.tsx`、`order-trend-chart.tsx`、`sales-funnel-chart.tsx`、`leaderboard-table.tsx` 四个组件
- 有 `actions.ts` (10KB) 较完整
- 无 E2E 测试

**待办事项**：

- [ ] **[Analytics-01] 完善 Dashboard 组件库**
  - 新增财务 AR/AP 组件
  - 新增交付效率组件
  - 新增客户来源分布组件
  - 预计工时：1 天

- [ ] **[Analytics-02] 实现可配置仪表盘**
  - 拖拽布局支持
  - 组件隐藏/显示
  - 独立筛选参数
  - 预计工时：1.5 天

- [ ] **[Analytics-03] 数据导出功能**
  - 支持 CSV / Excel 导出
  - 支持 PDF 报表导出
  - 预计工时：0.5 天

- [ ] **[Analytics-04] 添加 E2E 测试**
  - 创建 `e2e/flows/analytics.spec.ts`
  - 预计工时：0.5 天

---

## 🟡 P2 - 中优先级 (体验优化)

### 5. 产品管理 (Products) - 65% → 90%

**现状分析**：
- 有 8 个组件，功能较完整
- 有 1 个单元测试
- 无 E2E 测试

**待办事项**：

- [ ] **[Product-01] 完善动态属性模板**
  - 优化 `attribute-template-manager.tsx`
  - 支持更多属性类型 (数字/枚举/布尔)
  - 预计工时：0.5 天

- [ ] **[Product-02] 产品批量导入优化**
  - 完善 `product-import-dialog.tsx`
  - 增加数据校验和错误提示
  - 预计工时：0.5 天

- [ ] **[Product-03] 产品供应商关联增强**
  - 多供应商价格对比
  - 默认供应商自动切换
  - 预计工时：0.5 天

- [ ] **[Product-04] 添加 E2E 测试**
  - 创建 `e2e/flows/products.spec.ts`
  - 覆盖 CRUD 和导入流程
  - 预计工时：0.5 天

---

### 6. 订单管理 (Orders) - 70% → 90%

**现状分析**：
- 有 7 个组件
- 有 4 个单元测试
- 有 1 个 E2E 测试 (`order-lifecycle.spec.ts`)
- 有 `logic/` 业务逻辑目录

**待办事项**：

- [ ] **[Order-01] 完善订单拆单功能**
  - 实现 `splitOrder` Server Action
  - UI 拆单确认对话框
  - 预计工时：0.5 天

- [ ] **[Order-02] 实现发货申请流程**
  - 实现 `requestDelivery` Server Action
  - 物流信息填写表单
  - 预计工时：0.5 天

- [ ] **[Order-03] 订单变更申请**
  - Change Order 流程
  - 与审批模块集成
  - 预计工时：0.5 天

- [ ] **[Order-04] 增强 E2E 测试**
  - 扩展 `order-lifecycle.spec.ts`
  - 覆盖拆单和发货流程
  - 预计工时：0.5 天

---

## 🟢 P3 - 低优先级 (收尾优化)

### 7. 系统设置 (Settings) - 70% → 85%

**现状分析**：
- 有 17 个组件，功能较完整
- 有 workflow 子目录
- 有 1 个 E2E 测试 (`permissions.spec.ts`)

**待办事项**：

- [ ] **[Settings-01] 完善审批流程设计器集成**
  - 与 Approval 模块联动
  - 预计工时：0.5 天

- [ ] **[Settings-02] 系统参数配置**
  - 报价有效期默认值
  - 提醒规则默认值
  - 预计工时：0.5 天

- [ ] **[Settings-03] 操作日志查看**
  - 系统审计日志面板
  - 预计工时：0.5 天

---

### 8. 财务模块 (Finance) - 75% → 90%

**现状分析**：
- 有 15 个组件
- 有 3 个单元测试
- 有 AR/AP 子模块
- 有 3 个 E2E 测试

**待办事项**：

- [ ] **[Finance-01] 完善对账单生成逻辑**
  - 多订单聚合对账
  - 自动生成账单周期
  - 预计工时：0.5 天

- [ ] **[Finance-02] 收款计划管理**
  - 多节点收款计划
  - 到期提醒
  - 预计工时：0.5 天

- [ ] **[Finance-03] 坏账核销流程**
  - 与审批模块集成
  - 预计工时：0.5 天

- [ ] **[Finance-04] 增强 E2E 测试**
  - 完善 AR/AP 测试覆盖
  - 预计工时：0.5 天

---

### 9. 服务模块 (测量/安装) - 80% → 90%

**现状分析**：
- 测量模块有 12 个组件
- 安装模块有 10 个组件
- 有 smart-dispatch 智能派单子模块
- 有 2 个 E2E 测试

**待办事项**：

- [ ] **[Service-01] 移动端适配验证**
  - 测量师/安装师端响应式
  - 大按钮触控优化
  - 预计工时：0.5 天

- [ ] **[Service-02] 离线能力增强**
  - 草稿本地缓存
  - 照片离线上传队列
  - 预计工时：0.5 天

- [ ] **[Service-03] GPS 打卡优化**
  - 定位精度提升
  - 位置异常告警
  - 预计工时：0.5 天

---

### 10. 供应链 (Supply-Chain) - 80% → 90%

**现状分析**：
- 有 17 个组件
- 有 5 个单元测试
- 有完整的 actions 目录 (11 个文件)
- 有 1 个 E2E 测试

**待办事项**：

- [ ] **[Supply-01] 待采购池优化**
  - 跨订单合并采购
  - 批量操作
  - 预计工时：0.5 天

- [ ] **[Supply-02] 供应商评价体系**
  - 交期准时率
  - 质量合格率
  - 预计工时：0.5 天

- [ ] **[Supply-03] 增强 E2E 测试**
  - 扩展 `purchase-order.spec.ts`
  - 覆盖加工单流程
  - 预计工时：0.5 天

---

## 🔵 P4 - 收尾打磨 (高完成度模块)

### 11. 客户管理 (Customers) - 85% → 95%

**现状分析**：
- 有 11 个组件，功能完整
- 有 `customer-table`、`customer-form`、`customer-detail-view` 等核心组件
- 有 `ReferralScanner` 推荐码扫描器
- 有 1 个 E2E 测试 (`customer-lifecycle.spec.ts`)

**差距分析**：
- 客户画像功能不够深入
- 缺少客户价值分层可视化
- 转介绍追踪链路不完整

**待办事项**：

- [ ] **[Customer-01] 客户画像增强**
  - 累计交易金额统计
  - 最近购买时间显示
  - 购买频次分析
  - 预计工时：0.5 天

- [ ] **[Customer-02] 客户价值分层可视化**
  - RFM 模型简化展示 (最近/频率/金额)
  - 价值标签自动标注 (高价值/潜力/沉默)
  - 预计工时：0.5 天

- [ ] **[Customer-03] 转介绍追踪完善**
  - 推荐人 → 被推荐人关系链
  - 转介绍奖励统计
  - 预计工时：0.5 天

---

### 12. 售后服务 (After-Sales) - 85% → 95%

**现状分析**：
- 有 15 个组件，功能较完整
- 有 `traceability-view`  全链路溯源视图
- 有 `liability-notice-dialog` 定责单
- 有 `sla-status` SLA 状态组件
- 有 1 个 E2E 测试 (`after-sales.spec.ts`)

**差距分析**：
- 售后质量分析报表缺失
- 保修期自动判定逻辑待完善
- 与财务模块的联动 (扣款) 待验证

**待办事项**：

- [ ] **[AfterSales-01] 售后质量分析报表**
  - 按责任方统计售后数量
  - 售后成本趋势图
  - 预计工时：0.5 天

- [ ] **[AfterSales-02] 保修期自动判定**
  - 根据订单完成日期自动计算
  - 过保提示标识
  - 预计工时：0.25 天

- [ ] **[AfterSales-03] 财务联动验证**
  - 确认定责扣款流程正确
  - 供应商 AP / 工人 AP 扣款
  - 预计工时：0.25 天

---

### 13. 线索管理 (Leads) - 90% → 98%

**现状分析**：
- 有 15 个组件，非常完整
- 有 `SmartDuplicateCheck` 智能去重
- 有完整的跟进系统 (`lead-activity-log`、`add-followup-dialog`)
- 有 **12 个 E2E 测试**，覆盖率极高

**差距分析**：
- 线索评分模型可进一步优化
- 批量导入时的去重逻辑可增强
- 部分筛选组件可合并简化

**待办事项**：

- [ ] **[Lead-01] 线索评分模型优化**
  - 基于意向度 + 预算 + 来源权重自动评分
  - 分数可视化 (星级/进度条)
  - 预计工时：0.25 天

- [ ] **[Lead-02] 批量导入去重增强**
  - 手机号 + 地址组合去重
  - 重复提示和合并建议
  - 预计工时：0.25 天

---

### 14. 报价系统 (Quotes) - 95% → 100%

**现状分析**：
- 有 **55 个组件**，是最复杂的模块
- 有完整的计算策略 (`calc-strategies/`) 支持多品类
- 有 `quick-quote` 快速报价子模块
- 有版本对比、打印模板等高级功能
- 有 5 个单元测试 + 2 个 E2E 测试

**差距分析**：
- 报价模板功能可增强 (常用配置快速调用)
- AI 报价助手 (`quote-copilot-dialog`) 待完善
- 部分计算策略文档缺失

**待办事项**：

- [ ] **[Quote-01] 报价模板库**
  - 保存常用报价配置为模板
  - 一键应用模板
  - 预计工时：0.25 天

- [ ] **[Quote-02] AI 报价助手完善**
  - 完善 `quote-copilot-dialog.tsx`
  - 智能推荐产品组合
  - 预计工时：0.25 天

- [ ] **[Quote-03] 计算策略文档**
  - 为 `calc-strategies/` 添加注释文档
  - 方便后续维护
  - 预计工时：0.5 天

---

## 📅 执行计划建议

### Week 1-2: P0 紧急任务

| 天数 | 任务 |
|------|------|
| Day 1-2 | Approval-01 审批引擎核心逻辑 |
| Day 3-4 | Approval-02 可视化设计器 |
| Day 5 | Approval-03 预置模板 + Approval-04 E2E |
| Day 6-7 | Notify-01~02 站内信 + 飞书集成 |
| Day 8-9 | Notify-03 微信集成 |
| Day 10 | Notify-04~05 偏好设置 + E2E |

### Week 3: P1 高优先级

| 天数 | 任务 |
|------|------|
| Day 11-12 | Channel 全部任务 |
| Day 13-15 | Analytics 全部任务 |

### Week 4: P2 + P3 收尾

| 天数 | 任务 |
|------|------|
| Day 16 | Product 全部任务 |
| Day 17 | Order 全部任务 |
| Day 18-20 | Settings + Finance + Service + Supply-Chain |

### Week 5: P4 打磨 (可并行)

| 天数 | 任务 |
|------|------|
| Day 21 | Customer-01~03 客户模块收尾 |
| Day 22 | AfterSales-01~03 售后模块收尾 |
| Day 23 | Lead-01~02 + Quote-01~03 线索和报价收尾 |

---

## 📊 任务统计

| 优先级 | 模块数 | 任务数 | 预计工时 |
|--------|--------|--------|----------|
| P0 紧急 | 2 | 9 | 9 天 |
| P1 高优 | 2 | 8 | 5 天 |
| P2 中优 | 2 | 8 | 4 天 |
| P3 收尾 | 4 | 13 | 5 天 |
| **P4 打磨** | **4** | **11** | **3 天** |
| **总计** | **14** | **49** | **26 天** |

---

## 📝 API 文档整改 (docs/04-api)

> 评估时间：2026-01-15
> 当前质量评分：7/10

### 问题概览

| 问题类型 | 严重程度 | 数量 |
|---------|---------|------|
| 模块文档缺失 | 🔴 高 | 11 个模块 |
| 命名风格不一致 | 🔴 高 | 多处 |
| 格式问题 | 🟡 中 | 1 个文件 |
| 功能文档缺失 | 🟡 中 | 2 个 |
| 规范文档缺失 | 🟢 低 | 1 个 |

---

### 🔴 高优先级

#### [API-01] 补充缺失的模块 API 文档

**问题**：`README.md` 列出了 13 个核心模块，但 `02-modules/` 仅有 2 个文件

**待补充模块**：

- [ ] **[API-01-a]** `customers.md` - 客户管理 API
- [ ] **[API-01-b]** `quotes.md` - 报价单模块 API
- [ ] **[API-01-c]** `measurement.md` - 测量模块 API
- [ ] **[API-01-d]** `installation.md` - 安装模块 API
- [ ] **[API-01-e]** `supply-chain.md` - 供应链模块 API
- [ ] **[API-01-f]** `finance.md` - 财务模块 API
- [ ] **[API-01-g]** `products.md` - 商品模块 API
- [ ] **[API-01-h]** `channels.md` - 渠道模块 API
- [ ] **[API-01-i]** `after-sales.md` - 售后模块 API
- [ ] **[API-01-j]** `approval.md` - 审批模块 API
- [ ] **[API-01-k]** `users-roles.md` - 用户和角色 API

**预计工时**：5-10 天

---

#### [API-02] 统一字段命名风格

**问题**：文档中 `snake_case` 和 `camelCase` 混用

- `conventions.md` 声明使用 `camelCase`
- `api_specification.md` 和各模块文档使用 `snake_case`

**待办事项**：

- [ ] **[API-02-a]** 确定统一命名规范 (推荐 `camelCase`)
- [ ] **[API-02-b]** 更新 `api_specification.md` 中所有示例
- [ ] **[API-02-c]** 更新 `leads.md` 和 `orders.md` 中所有示例
- [ ] **[API-02-d]** 更新移动端文档中的示例

**预计工时**：2 天

---

### 🟡 中优先级

#### [API-03] 修复 `api_specification.md` JSON 格式问题

**问题**：使用非法 JSON 注释格式 `-- Required`

```json
// ❌ 非法格式
{ "customer_phone": "13800138000", -- Required }
```

**待办事项**：

- [ ] **[API-03-a]** 将内联注释移到表格说明中
- [ ] **[API-03-b]** 确保所有 JSON 示例可被解析器验证

**预计工时**：0.5 天

---

#### [API-04] 补充移动端 `data-sync.md`

**问题**：`README.md` 列出了移动端数据同步文档，但文件不存在

**待办事项**：

- [ ] **[API-04-a]** 创建 `03-mobile/data-sync.md`
- [ ] 内容包括：离线数据存储、增量同步、冲突解决策略

**预计工时**：1 天

---

#### [API-05] 添加 OpenAPI/Swagger 规范

**问题**：缺少机器可读的 API 规范文件，无法自动生成客户端

**待办事项**：

- [ ] **[API-05-a]** 创建 `openapi.yaml` 或 `swagger.json`
- [ ] **[API-05-b]** 配置 Swagger UI 或 Redoc 预览

**预计工时**：3 天

---

### 🟢 低优先级

#### [API-06] 添加 Webhook 事件文档

**问题**：`introduction.md` 提及 Webhook，但无事件列表

**待办事项**：

- [ ] **[API-06-a]** 创建 `04-reference/webhooks.md`
- [ ] 列出所有事件类型、Payload 格式、签名验证

**预计工时**：1 天

---

#### [API-07] 完善版本管理机制

**问题**：变更日志仅一条记录，废弃策略不明确

**待办事项**：

- [ ] **[API-07-a]** 创建 `CHANGELOG.md` 专用文件
- [ ] **[API-07-b]** 为接口添加 `@since` / `@deprecated` 标注

**预计工时**：0.5 天

---

#### [API-08] 核实认证流程描述

**问题**：文档描述支持 OAuth 2.0，但实际可能使用 NextAuth.js

**待办事项**：

- [ ] **[API-08-a]** 核实实际认证实现
- [ ] **[API-08-b]** 移除未实现的认证方式或标注为"计划中"

**预计工时**：1 天

---

### 📊 API 文档任务统计

| 优先级 | 任务数 | 预计工时 |
|--------|--------|----------|
| 🔴 高 | 15 | 7-12 天 |
| 🟡 中 | 4 | 4.5 天 |
| 🟢 低 | 4 | 2.5 天 |
| **总计** | **23** | **14-19 天** |

---

## ✅ 完成标准

每个模块完成后需满足：
1. ✅ 所有待办项标记完成
2. ✅ E2E 测试通过
3. ✅ 无 TypeScript 类型错误
4. ✅ 核心流程可演示

---

*文档维护：请在完成任务后及时更新状态*
*更新时间：2026-01-15 22:14*
*新增 API 文档整改任务 23 项，总任务数 72 项*
