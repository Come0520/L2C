<!--pages/manager/targets/index.wxml-->
<view class="container">
  
  <view class="tabs">
    <view class="tab-item {{activeTab === 'monthly' ? 'active' : ''}}" bindtap="switchTab" data-tab="monthly">
        <text>月目标</text>
    </view>
    <view class="tab-item {{activeTab === 'weekly' ? 'active' : ''}}" bindtap="switchTab" data-tab="weekly">
        <text>周目标</text>
    </view>
  </view>

  <view class="card header-card">
    <view class="date-picker">
        <text wx:if="{{activeTab === 'monthly'}}">{{year}}年{{month}}月</text>
        <text wx:else>{{year}}年 第{{week}}周</text>
    </view>
    <view class="stats">
        <view class="stat-item">
            <text class="stat-label">总目标</text>
            <text class="stat-value">¥{{totalTarget}}</text>
        </view>
        <view class="stat-item">
            <text class="stat-label">已完成</text>
            <text class="stat-value achieved">¥{{totalAchieved}}</text>
        </view>
        <view class="stat-item">
            <text class="stat-label">达成率</text>
            <text class="stat-value rate {{totalRate >= 100 ? 'high' : totalRate >= 80 ? 'medium' : 'low'}}">{{totalRate}}%</text>
        </view>
    </view>
  </view>

  <view class="card list-card">
    <view class="list-header">
        <text>销售人员</text>
        <text>目标金额</text>
        <text>操作</text>
    </view>
    
    <block wx:for="{{list}}" wx:key="userId">
        <view class="list-item" bindtap="onEdit" data-item="{{item}}">
            <view class="user-info">
                <image class="avatar" src="{{item.userAvatar || '/assets/default-avatar.png'}}" />
                <text class="name">{{item.userName}}</text>
            </view>
            <view class="target-data">
                <view class="amount {{item.targetAmount > 0 ? '' : 'empty'}}">
                    {{item.targetAmount > 0 ? '¥' + item.targetAmount : '未设置'}}
                </view>
                <view class="achieved-row" wx:if="{{item.targetAmount > 0}}">
                    <text class="achieved-amount">完成 ¥{{item.achievedAmount || '0'}}</text>
                    <text class="rate {{item.completionRate >= 100 ? 'high' : item.completionRate >= 80 ? 'medium' : 'low'}}">{{item.completionRate || 0}}%</text>
                </view>
            </view>
            <view class="action">
                <text class="edit-btn">设置</text>
            </view>
        </view>
    </block>
  </view>

  <!-- Edit Dialog -->
  <view class="dialog-mask {{showDialog ? 'show' : ''}}" bindtap="closeDialog">
    <view class="dialog-content" catchtap>
        <view class="dialog-header">
            <text>设置目标</text>
        </view>
        <view class="dialog-body">
            <view class="user-preview">
                <text wx:if="{{activeTab === 'monthly'}}">{{currentItem.userName}} - {{month}}月目标</text>
                <text wx:else>{{currentItem.userName}} - 第{{week}}周目标</text>
            </view>
            <input 
                class="target-input" 
                type="digit" 
                placeholder="请输入金额" 
                value="{{tempTarget}}"
                bindinput="onInputTarget"
                focus="{{showDialog}}"
            />
        </view>
        <view class="dialog-footer">
            <button class="btn cancel" bindtap="closeDialog">取消</button>
            <button class="btn confirm" bindtap="onSave" loading="{{saving}}">保存</button>
        </view>
    </view>
  </view>
</view>
