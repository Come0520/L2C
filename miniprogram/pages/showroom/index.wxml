<!-- pages/showroom/index.wxml -->
<view class="container">
  <!-- Search Header -->
  <view class="search-header">
    <view class="search-bar">
      <icon type="search" size="14" color="var(--text-placeholder)"></icon>
      <input 
        class="search-input" 
        placeholder="搜索商品 / 案例..." 
        placeholder-class="search-placeholder"
        bindinput="onSearchInput"
        disabled="{{isSelectionMode}}"
      />
    </view>
    
    <!-- Filter -->
    <view class="filter-btn" bindtap="toggleFilter" wx:if="{{!isSelectionMode}}">
        <!-- SVG not available directly without image, use text icon -->
        <text class="filter-icon" style="font-size:20px; color:var(--text-body);">⚡</text>
    </view>

    <!-- Selection Mode Toggle -->
    <view class="select-btn" bindtap="toggleSelectionMode">
        {{isSelectionMode ? '取消' : '选择'}}
    </view>
  </view>

  <!-- Filter Drawer -->
  <view class="filter-drawer {{isFilterOpen ? 'open' : ''}}">
      <view class="drawer-mask" bindtap="toggleFilter"></view>
      <view class="drawer-content">
          <view class="drawer-header">高级筛选</view>
          
          <scroll-view class="drawer-body" scroll-y="true">
              <block wx:for="{{filterOptions.details}}" wx:key="key">
                  <view class="filter-section">
                      <view class="filter-label">{{item.label}}</view>
                      <view class="filter-options">
                          <view 
                            class="option-tag {{activeFilters[item.key] === option ? 'active' : ''}}" 
                            wx:for="{{item.options}}" 
                            wx:key="*this" 
                            wx:for-item="option"
                            bindtap="selectFilterOption"
                            data-key="{{item.key}}"
                            data-value="{{option}}"
                          >
                            {{option}}
                          </view>
                      </view>
                  </view>
              </block>
          </scroll-view>

          <view class="drawer-footer">
              <button class="btn-secondary reset-btn" bindtap="resetFilter">重置</button>
              <button class="btn-primary confirm-btn" bindtap="confirmFilter">确认</button>
          </view>
      </view>
  </view>

  <!-- Tabs (Hidden in Selection Mode) -->
  <view class="tabs" style="height: {{isSelectionMode ? 0 : 'auto'}}; opacity: {{isSelectionMode ? 0 : 1}}; overflow: hidden;">
    <view 
      class="tab-item {{activeTab === 'featured' ? 'active' : ''}}" 
      bindtap="onTabChange" 
      data-tab="featured"
    >
      精选
    </view>
    <view 
      class="tab-item {{activeTab === 'products' ? 'active' : ''}}" 
      bindtap="onTabChange" 
      data-tab="products"
    >
      商品
    </view>
    <view 
      class="tab-item {{activeTab === 'cases' ? 'active' : ''}}" 
      bindtap="onTabChange" 
      data-tab="cases"
    >
      案例
    </view>
  </view>

  <!-- Content Grid (Masonry-like) -->
  <scroll-view class="content-scroll" scroll-y="true">
    <view class="masonry-grid">
      <block wx:for="{{resources}}" wx:key="id">
        <view 
            class="resource-card animate-slide-up {{item.selected ? 'selected' : ''}}" 
            bindtap="onResourceTap" 
            data-id="{{item.id}}" 
            style="animation-delay: {{index * 0.05}}s"
        >
          <!-- Checkbox Overlay -->
          <view class="checkbox-overlay" wx:if="{{isSelectionMode}}">
              <view class="checkbox {{item.selected ? 'checked' : ''}}"></view>
          </view>
          
          <image class="resource-img" src="{{item.image}}" mode="widthFix" lazy-load="true"></image>
          <view class="card-body">
            <view class="resource-title">{{item.title}}</view>
            <view class="resource-meta">
              <text wx:if="{{item.price}}" class="price tag">{{item.price}}</text>
              <text wx:if="{{item.tag}}" class="tag type-tag">{{item.tag}}</text>
              <text wx:if="{{item.views}}" class="views">{{item.views}} 浏览</text>
            </view>
          </view>
        </view>
      </block>
    </view>
    <view class="empty-state" wx:if="{{resources.length === 0 && !loading}}">
        <text class="empty-text">暂无内容</text>
    </view>
    <view style="height: 140rpx;"></view> <!-- Bottom spacer -->
  </scroll-view>

  <!-- Bottom Share Bar -->
  <view class="share-bar animate-slide-up" wx:if="{{isSelectionMode}}">
      <view class="selected-count">已选 {{selectedCount}} 个灵感</view>
      <button 
        class="share-btn btn-primary" 
        open-type="share" 
        disabled="{{selectedCount === 0}}"
      >
        生成分享胶囊
      </button>
  </view>
</view>
