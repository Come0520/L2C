<!-- pages/tasks/detail/detail.wxml -->
<view class="container" wx:if="{{task}}">
  <!-- Header Card -->
  <view class="card header-card">
    <view class="title-row">
      <text class="task-no">{{task.measureNo || task.taskNo}}</text>
      <text class="status-tag status-{{task.status}}">{{statusText}}</text>
    </view>
    <view class="time-row">
      <icon class="icon" type="waiting" size="14" color="var(--text-muted)" />
      <text>é¢„çº¦æ—¶é—´ï¼š{{scheduledTime}}</text>
    </view>
  </view>

  <!-- Customer Info Card -->
  <view class="card">
    <view class="section-title">å®¢æˆ·ä¿¡æ¯</view>
    <view class="address-box">
      <view class="address-text">{{task.customerAddress || task.address}}</view>
      <view class="contact-row">
        <view class="contact-info">
          <text class="name">{{task.customerName}}</text>
          <text class="phone" bindtap="makePhoneCall" data-phone="{{task.customerPhone}}">{{task.customerPhone}}</text>
        </view>
        <view class="action-bar">
           <view class="action-btn" bindtap="openLocation" hover-class="action-btn-hover">
             <text class="action-icon">ğŸ“</text>
             <text>å¯¼èˆª</text>
           </view>
           <view class="action-btn" bindtap="makePhoneCall" data-phone="{{task.customerPhone}}" hover-class="action-btn-hover">
             <text class="action-icon">ğŸ“</text>
             <text>æ‹¨æ‰“</text>
           </view>
        </view>
      </view>
    </view>
  </view>

  <!-- Remark Card -->
  <view class="card" wx:if="{{task.remark}}">
    <view class="section-title">å¤‡æ³¨</view>
    <view class="remark-content">{{task.remark}}</view>
  </view>
  
  <view class="footer-spacer"></view>

  <!-- Bottom Action Bar -->
  <view class="bottom-bar">
     <button 
        wx:if="{{task.status === 'PENDING' || task.status === 'PENDING_DISPATCH'}}" 
        class="btn-primary btn-flex"
        bindtap="updateStatus" 
        data-status="IN_PROGRESS"
        data-action="accept"
     >æ¥å•å‡ºå‘</button>

     <button 
        wx:if="{{task.status === 'IN_PROGRESS' || task.status === 'ASSIGNED'}}" 
        class="btn-secondary btn-flex"
        bindtap="checkIn"
     >ç­¾åˆ°</button>

     <button 
        wx:if="{{task.status === 'IN_PROGRESS'}}" 
        class="btn-primary btn-flex"
        bindtap="completeTask"
     >å®Œæˆä»»åŠ¡</button>
  </view>
</view>

<!-- Loading State -->
<view wx:if="{{loading}}" class="loading-state">
  <view class="spinner"></view>
  <text>åŠ è½½ä¸­...</text>
</view>

<!-- Error State -->
<view wx:if="{{error}}" class="empty-state">
    <text class="empty-text">{{error}}</text>
    <button class="btn-primary btn-retry" bindtap="onLoad">é‡è¯•</button>
</view>
