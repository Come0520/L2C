<!-- pages/tasks/index.wxml -->
<view class="container">
  <!-- Search -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <icon type="search" size="14" color="var(--text-placeholder)"/>
      <input 
        class="search-input" 
        placeholder="搜索任务编号或客户" 
        confirm-type="search"
        bindconfirm="onSearch"
      />
    </view>
  </view>

  <!-- Tabs -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'pending' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="pending"
    >
      待处理
    </view>
    <view 
      class="tab-item {{activeTab === 'completed' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="completed"
    >
      已完成
    </view>
  </view>

  <!-- Task List -->
  <scroll-view 
    class="task-list"
    scroll-y
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <view wx:if="{{loading}}" class="loading-state">
      <view class="spinner"></view>
      <text>加载中...</text>
    </view>

    <view wx:elif="{{taskList.length === 0}}" class="empty-state">
      <text class="empty-text">暂无任务</text>
    </view>

    <view wx:else>
      <view 
        wx:for="{{taskList}}" 
        wx:key="id" 
        class="card task-card"
        bindtap="goToDetail"
        data-id="{{item.id}}"
      >
        <!-- Header -->
        <view class="card-header">
          <text class="task-no">{{item.measureNo}}</text>
          <text class="status-tag status-{{item.status}}">{{formatStatus(item.status)}}</text>
        </view>

        <!-- Body -->
        <view class="card-body">
          <view class="info-row">
            <text class="label">客户名称：</text>
            <text class="value">{{item.customerName}}</text>
          </view>
          <view class="info-row">
            <text class="label">预约时间：</text>
            <text class="value">{{formatTime(item.scheduledAt)}}</text>
          </view>
        </view>

        <!-- Footer -->
        <view class="card-footer">
          <view class="tags">
            <text class="type-tag type-{{item.type}}">{{formatMeasureType(item.type)}}</text>
          </view>
          <view class="labor-fee" wx:if="{{item.laborFee}}">
            <text class="fee-label">工费</text>
            <text class="fee-value">¥{{item.laborFee}}</text>
          </view>
        </view>
      </view>
    </view>
    <view class="footer-spacer"></view>
  </scroll-view>
</view>
