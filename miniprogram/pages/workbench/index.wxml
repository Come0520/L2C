<!--pages/workbench/index.wxml-->
<view class="container workbench-page">
  <!-- 顶部问候 -->
  <view class="header animate-fade-in">
    <view class="greeting">
      <text class="greeting-text">你好, {{userInfo.name}}</text>
      <text class="greeting-date">{{today}}</text>
    </view>
    <image class="header-avatar" src="{{userInfo.avatarUrl || '/assets/default-avatar.png'}}"></image>
  </view>

  <!-- 数据概览 -->
  <view class="stats-grid animate-slide-up">
    <view class="stat-card">
      <text class="stat-num primary">{{dashboard.targetCompletion || '0'}}%</text>
      <text class="stat-desc">目标达成</text>
    </view>
    <view class="stat-card">
      <text class="stat-num">{{dashboard.stats.leads || '0'}}</text>
      <text class="stat-desc">线索</text>
    </view>
    <view class="stat-card">
      <text class="stat-num">{{dashboard.stats.quotes || '0'}}</text>
      <text class="stat-desc">报价</text>
    </view>
    <view class="stat-card">
      <text class="stat-num">{{dashboard.stats.orders || '0'}}</text>
      <text class="stat-desc">订单</text>
    </view>
  </view>

  <!-- 快捷入口 -->
  <view class="section-title animate-slide-up" style="animation-delay: 0.1s;">快捷入口</view>
  <view class="quick-actions animate-slide-up" style="animation-delay: 0.1s;">
    <view class="action-item" bindtap="navigateToCreateQuote">
      <view class="action-icon-box blue">
        <image class="action-icon" src="/assets/icons/flash-active.svg" />
      </view>
      <text class="action-text">快速报价</text>
    </view>
    <view class="action-item" bindtap="navigateToShowroom">
      <view class="action-icon-box purple">
        <image class="action-icon" src="/assets/icons/gallery-active.svg" />
      </view>
      <text class="action-text">云展厅</text>
    </view>
    <view class="action-item" wx:if="{{userInfo.role === 'admin' || userInfo.role === 'manager'}}" bindtap="navigateToTargets">
      <view class="action-icon-box green">
        <image class="action-icon" src="/assets/icons/success-active.svg" />
      </view>
      <text class="action-text">销售目标</text>
    </view>
    <view class="action-item" wx:if="{{userInfo.role === 'admin'}}" bindtap="navigateToReports">
      <view class="action-icon-box orange">
        <image class="action-icon" src="/assets/icons/chart-active.svg" />
      </view>
      <text class="action-text">数据报表</text>
    </view>
    <view class="action-item" wx:if="{{userInfo.role === 'admin' || userInfo.role === 'engineer'}}" bindtap="navigateToEngineer">
      <view class="action-icon-box teal">
        <image class="action-icon" src="/assets/icons/list-active.svg" />
      </view>
      <text class="action-text">工程任务</text>
    </view>
  </view>

  <!-- 实时动态 -->
  <view class="section-title animate-slide-up" style="animation-delay: 0.2s;">待办事项</view>
  <view class="todo-list animate-slide-up" style="animation-delay: 0.2s;">
    <block wx:for="{{dashboard.todos}}" wx:key="id">
      <view class="card todo-item" bindtap="handleTodoTap" data-id="{{item.id}}">
        <view class="todo-main">
          <view class="todo-title">{{item.title}}</view>
          <view class="todo-desc">{{item.desc}}</view>
        </view>
        <view class="todo-right">
          <view class="badge {{item.status === 'urgent' ? 'badge-danger' : item.status === 'pending' ? 'badge-warning' : 'badge-info'}}">
            {{item.statusText || item.status}}
          </view>
          <view class="todo-time">{{item.time}}</view>
        </view>
      </view>
    </block>
    <view class="empty-state" wx:if="{{!dashboard.todos.length}}">
      暂无待办事项
    </view>
  </view>
</view>
