# æŠ¥ä»·è®¡ç®—ç­–ç•¥æ¨¡å—æ–‡æ¡£

> æœ€åæ›´æ–°ï¼š2026-01-19
> æ¨¡å—è·¯å¾„ï¼š`src/features/quotes/calc-strategies/`

---

## ğŸ“– æ¦‚è¿°

æœ¬æ¨¡å—å®ç°äº†æŠ¥ä»·ç³»ç»Ÿçš„**å¤šå“ç±»è®¡ç®—ç­–ç•¥**æ¨¡å¼ï¼Œé‡‡ç”¨ç­–ç•¥å·¥å‚è®¾è®¡æ¨¡å¼ï¼Œæ”¯æŒä¸åŒäº§å“ç±»å‹ä½¿ç”¨ä¸åŒçš„è®¡ç®—é€»è¾‘ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
calc-strategies/
â”œâ”€â”€ base-strategy.ts          # åŸºç¡€ç­–ç•¥æ¥å£
â”œâ”€â”€ strategy-factory.ts       # ç­–ç•¥å·¥å‚ï¼ˆæ ¹æ®å“ç±»è·å–ç­–ç•¥ï¼‰
â”œâ”€â”€ curtain-strategy.ts       # çª—å¸˜è®¡ç®—ç­–ç•¥
â”œâ”€â”€ wallpaper-strategy.ts     # å¢™çº¸/å¢™å¸ƒè®¡ç®—ç­–ç•¥
â”œâ”€â”€ standard-product-strategy.ts # æ ‡å‡†äº§å“ç­–ç•¥ï¼ˆç®€å•æ•°é‡Ã—å•ä»·ï¼‰
â”œâ”€â”€ index.ts                  # æ¨¡å—å¯¼å‡º
â””â”€â”€ __tests__/                # å•å…ƒæµ‹è¯•
```

---

## ğŸ“ æ ¸å¿ƒæ¥å£

### CalcStrategy æ¥å£

```typescript
interface CalcStrategy {
  /**
   * è®¡ç®—å•é¡¹é‡‘é¢
   * @param item - æŠ¥ä»·é¡¹ï¼ˆåŒ…å«å°ºå¯¸ã€æ•°é‡ã€å±æ€§ç­‰ï¼‰
   * @param config - è®¡ç®—é…ç½®ï¼ˆå€ç‡ã€æŸè€—ç­‰ï¼‰
   * @returns è®¡ç®—ç»“æœï¼ˆå•ä»·ã€æ€»ä»·ã€ç”¨é‡æ˜ç»†ï¼‰
   */
  calculate(item: QuoteItem, config: CalcConfig): CalcResult;
}
```

---

## ğŸ¯ ç­–ç•¥è¯¦è§£

### 1. çª—å¸˜ç­–ç•¥ (CurtainStrategy)

**é€‚ç”¨å“ç±»**ï¼šçª—å¸˜ã€çª—çº±ã€å¸˜å¤´ç­‰

**è®¡ç®—é€»è¾‘**ï¼š
1. **å¸ƒæ–™ç”¨é‡** = çª—æˆ·å®½åº¦ Ã— è¤¶çš±å€ç‡ + æŸè€—è¾¹è·
2. **æˆå“é«˜åº¦** = çª—æˆ·é«˜åº¦ + ä¸Šä¸‹è¾¹è·
3. **æ€»é¢ç§¯** = å¸ƒæ–™ç”¨é‡ Ã— æˆå“é«˜åº¦ Ã— çª—æˆ·æ•°é‡
4. **æ€»ä»·** = æ€»é¢ç§¯ Ã— å¸ƒæ–™å•ä»· + è¾…æ–™è´¹ç”¨

**å…³é”®å‚æ•°**ï¼š
- `multiplier`ï¼šè¤¶çš±å€ç‡ï¼ˆé»˜è®¤ 2 å€ï¼‰
- `lossMargin`ï¼šæŸè€—è¾¹è·ï¼ˆé»˜è®¤ 10cmï¼‰
- `hemAllowance`ï¼šå·è¾¹é¢„ç•™ï¼ˆé»˜è®¤ 20cmï¼‰

**ç¤ºä¾‹**ï¼š
```typescript
// çª—æˆ·å®½ 3mï¼Œé«˜ 2.5mï¼Œè¤¶çš± 2 å€
// å¸ƒæ–™ç”¨é‡ = 3 Ã— 2 + 0.1 = 6.1m
// æˆå“é«˜åº¦ = 2.5 + 0.2 = 2.7m
// æ€»é¢ç§¯ = 6.1 Ã— 2.7 = 16.47ã¡
```

---

### 2. å¢™çº¸ç­–ç•¥ (WallpaperStrategy)

**é€‚ç”¨å“ç±»**ï¼šå¢™çº¸ã€å¢™å¸ƒã€æ— ç¼å£ç”»

**è®¡ç®—é€»è¾‘**ï¼š
1. **å¢™é¢é¢ç§¯** = å‘¨é•¿ Ã— é«˜åº¦ - é—¨çª—é¢ç§¯
2. **å·æ•°** = å¢™é¢é¢ç§¯ Ã· å•å·é¢ç§¯ Ã— æŸè€—ç³»æ•°
3. **æ€»ä»·** = å·æ•° Ã— å•å·ä»·æ ¼ + æ–½å·¥è´¹

**å…³é”®å‚æ•°**ï¼š
- `lossRate`ï¼šæŸè€—ç‡ï¼ˆé»˜è®¤ 10%ï¼‰
- `rollWidth`ï¼šå·å®½ï¼ˆé€šå¸¸ 0.53m æˆ– 1.06mï¼‰
- `rollLength`ï¼šå·é•¿ï¼ˆé€šå¸¸ 10m æˆ– 50mï¼‰

**ç¤ºä¾‹**ï¼š
```typescript
// æˆ¿é—´å‘¨é•¿ 16mï¼Œé«˜ 2.8mï¼Œé—¨çª—é¢ç§¯ 8ã¡
// å¢™é¢é¢ç§¯ = 16 Ã— 2.8 - 8 = 36.8ã¡
// å•å·é¢ç§¯ = 0.53 Ã— 10 = 5.3ã¡
// å·æ•° = 36.8 Ã· 5.3 Ã— 1.1 â‰ˆ 8 å·
```

---

### 3. æ ‡å‡†äº§å“ç­–ç•¥ (StandardProductStrategy)

**é€‚ç”¨å“ç±»**ï¼šçª—å¸˜æ†ã€è½¨é“ã€é…ä»¶ç­‰

**è®¡ç®—é€»è¾‘**ï¼š
```
æ€»ä»· = æ•°é‡ Ã— å•ä»·
```

ç®€å•ç›´æ¥ï¼Œæ— éœ€å¤æ‚è®¡ç®—ã€‚

---

## ğŸ­ ç­–ç•¥å·¥å‚

### ä½¿ç”¨æ–¹å¼

```typescript
import { StrategyFactory } from './strategy-factory';

// æ ¹æ®äº§å“å“ç±»è·å–å¯¹åº”ç­–ç•¥
const strategy = StrategyFactory.getStrategy('çª—å¸˜');
const result = strategy.calculate(item, config);
```

### å“ç±»æ˜ å°„

| å“ç±»å…³é”®å­— | ä½¿ç”¨ç­–ç•¥ |
|-----------|---------|
| çª—å¸˜ã€çª—çº±ã€å¸˜å¤´ | CurtainStrategy |
| å¢™çº¸ã€å¢™å¸ƒã€å£çº¸ã€å£ç”» | WallpaperStrategy |
| å…¶ä»– | StandardProductStrategy |

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

æµ‹è¯•æ–‡ä»¶ä½äº `__tests__/` ç›®å½•ï¼š

- `curtain-strategy.test.ts`ï¼šçª—å¸˜è®¡ç®—è¾¹ç•Œæµ‹è¯•
- `wallpaper-strategy.test.ts`ï¼šå¢™çº¸æŸè€—è®¡ç®—æµ‹è¯•
- `strategy-factory.test.ts`ï¼šç­–ç•¥å·¥å‚æ˜ å°„æµ‹è¯•

è¿è¡Œæµ‹è¯•ï¼š
```bash
pnpm test src/features/quotes/calc-strategies
```

---

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°å“ç±»ç­–ç•¥

1. åˆ›å»ºç­–ç•¥æ–‡ä»¶ `xxx-strategy.ts`
2. å®ç° `CalcStrategy` æ¥å£
3. åœ¨ `strategy-factory.ts` ä¸­æ³¨å†Œæ˜ å°„
4. æ·»åŠ å¯¹åº”å•å…ƒæµ‹è¯•

```typescript
// ç¤ºä¾‹ï¼šç™¾å¶çª—ç­–ç•¥
export class BlindStrategy implements CalcStrategy {
  calculate(item: QuoteItem, config: CalcConfig): CalcResult {
    // ç™¾å¶çª—æŒ‰å¹³æ–¹ç±³è®¡ä»·
    const area = item.width * item.height;
    const price = area * item.unitPrice;
    return { area, price, breakdown: [] };
  }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å•ä½ç»Ÿä¸€**ï¼šæ‰€æœ‰å°ºå¯¸ç»Ÿä¸€ä½¿ç”¨ç±³ (m)ï¼Œé¢ç§¯ä½¿ç”¨å¹³æ–¹ç±³ (ã¡)
2. **ç²¾åº¦å¤„ç†**ï¼šé‡‘é¢ä¿ç•™ 2 ä½å°æ•°ï¼Œé¢ç§¯ä¿ç•™ 3 ä½å°æ•°
3. **æŸè€—è®¡ç®—**ï¼šä¸åŒå“ç±»æŸè€—ç‡ä¸åŒï¼Œéœ€åœ¨ç­–ç•¥ä¸­æ­£ç¡®é…ç½®
4. **ä»·æ ¼æ¥æº**ï¼šå•ä»·ä»äº§å“è¡¨è·å–ï¼Œç­–ç•¥åªè´Ÿè´£æ•°é‡/é¢ç§¯è®¡ç®—

---

*æ–‡æ¡£ç»´æŠ¤ï¼šè¯·åœ¨ä¿®æ”¹ç­–ç•¥é€»è¾‘ååŒæ­¥æ›´æ–°æœ¬æ–‡æ¡£*
